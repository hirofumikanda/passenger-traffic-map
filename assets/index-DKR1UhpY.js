(function(){const re=document.createElement("link").relList;if(re&&re.supports&&re.supports("modulepreload"))return;for(const Me of document.querySelectorAll('link[rel="modulepreload"]'))H(Me);new MutationObserver(Me=>{for(const $e of Me)if($e.type==="childList")for(const I of $e.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&H(I)}).observe(document,{childList:!0,subtree:!0});function ae(Me){const $e={};return Me.integrity&&($e.integrity=Me.integrity),Me.referrerPolicy&&($e.referrerPolicy=Me.referrerPolicy),Me.crossOrigin==="use-credentials"?$e.credentials="include":Me.crossOrigin==="anonymous"?$e.credentials="omit":$e.credentials="same-origin",$e}function H(Me){if(Me.ep)return;Me.ep=!0;const $e=ae(Me);fetch(Me.href,$e)}})();function Nm(K){return K&&K.__esModule&&Object.prototype.hasOwnProperty.call(K,"default")?K.default:K}var $p={exports:{}},Lf={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cm;function Vm(){if(cm)return Lf;cm=1;var K=Symbol.for("react.transitional.element"),re=Symbol.for("react.fragment");function ae(H,Me,$e){var I=null;if($e!==void 0&&(I=""+$e),Me.key!==void 0&&(I=""+Me.key),"key"in Me){$e={};for(var d in Me)d!=="key"&&($e[d]=Me[d])}else $e=Me;return Me=$e.ref,{$$typeof:K,type:H,key:I,ref:Me!==void 0?Me:null,props:$e}}return Lf.Fragment=re,Lf.jsx=ae,Lf.jsxs=ae,Lf}var um;function Zm(){return um||(um=1,$p.exports=Vm()),$p.exports}var Ad=Zm(),Xp={exports:{}},Kt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hm;function Gm(){if(hm)return Kt;hm=1;var K=Symbol.for("react.transitional.element"),re=Symbol.for("react.portal"),ae=Symbol.for("react.fragment"),H=Symbol.for("react.strict_mode"),Me=Symbol.for("react.profiler"),$e=Symbol.for("react.consumer"),I=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),ze=Symbol.for("react.suspense"),Ie=Symbol.for("react.memo"),ot=Symbol.for("react.lazy"),Ye=Symbol.for("react.activity"),Ke=Symbol.iterator;function be(he){return he===null||typeof he!="object"?null:(he=Ke&&he[Ke]||he["@@iterator"],typeof he=="function"?he:null)}var ci={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Bt=Object.assign,tn={};function dn(he,Ne,at){this.props=he,this.context=Ne,this.refs=tn,this.updater=at||ci}dn.prototype.isReactComponent={},dn.prototype.setState=function(he,Ne){if(typeof he!="object"&&typeof he!="function"&&he!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,he,Ne,"setState")},dn.prototype.forceUpdate=function(he){this.updater.enqueueForceUpdate(this,he,"forceUpdate")};function hi(){}hi.prototype=dn.prototype;function It(he,Ne,at){this.props=he,this.context=Ne,this.refs=tn,this.updater=at||ci}var Ci=It.prototype=new hi;Ci.constructor=It,Bt(Ci,dn.prototype),Ci.isPureReactComponent=!0;var Kn=Array.isArray;function Ui(){}var Nt={H:null,A:null,T:null,S:null},An=Object.prototype.hasOwnProperty;function zn(he,Ne,at){var ut=at.ref;return{$$typeof:K,type:he,key:Ne,ref:ut!==void 0?ut:null,props:at}}function Pn(he,Ne){return zn(he.type,Ne,he.props)}function gi(he){return typeof he=="object"&&he!==null&&he.$$typeof===K}function ji(he){var Ne={"=":"=0",":":"=2"};return"$"+he.replace(/[=:]/g,function(at){return Ne[at]})}var ha=/\/+/g;function ba(he,Ne){return typeof he=="object"&&he!==null&&he.key!=null?ji(""+he.key):Ne.toString(36)}function Dn(he){switch(he.status){case"fulfilled":return he.value;case"rejected":throw he.reason;default:switch(typeof he.status=="string"?he.then(Ui,Ui):(he.status="pending",he.then(function(Ne){he.status==="pending"&&(he.status="fulfilled",he.value=Ne)},function(Ne){he.status==="pending"&&(he.status="rejected",he.reason=Ne)})),he.status){case"fulfilled":return he.value;case"rejected":throw he.reason}}throw he}function Be(he,Ne,at,ut,Mt){var Ct=typeof he;(Ct==="undefined"||Ct==="boolean")&&(he=null);var Qt=!1;if(he===null)Qt=!0;else switch(Ct){case"bigint":case"string":case"number":Qt=!0;break;case"object":switch(he.$$typeof){case K:case re:Qt=!0;break;case ot:return Qt=he._init,Be(Qt(he._payload),Ne,at,ut,Mt)}}if(Qt)return Mt=Mt(he),Qt=ut===""?"."+ba(he,0):ut,Kn(Mt)?(at="",Qt!=null&&(at=Qt.replace(ha,"$&/")+"/"),Be(Mt,Ne,at,"",function(tr){return tr})):Mt!=null&&(gi(Mt)&&(Mt=Pn(Mt,at+(Mt.key==null||he&&he.key===Mt.key?"":(""+Mt.key).replace(ha,"$&/")+"/")+Qt)),Ne.push(Mt)),1;Qt=0;var wi=ut===""?".":ut+":";if(Kn(he))for(var si=0;si<he.length;si++)ut=he[si],Ct=wi+ba(ut,si),Qt+=Be(ut,Ne,at,Ct,Mt);else if(si=be(he),typeof si=="function")for(he=si.call(he),si=0;!(ut=he.next()).done;)ut=ut.value,Ct=wi+ba(ut,si++),Qt+=Be(ut,Ne,at,Ct,Mt);else if(Ct==="object"){if(typeof he.then=="function")return Be(Dn(he),Ne,at,ut,Mt);throw Ne=String(he),Error("Objects are not valid as a React child (found: "+(Ne==="[object Object]"?"object with keys {"+Object.keys(he).join(", ")+"}":Ne)+"). If you meant to render a collection of children, use an array instead.")}return Qt}function rt(he,Ne,at){if(he==null)return he;var ut=[],Mt=0;return Be(he,ut,"","",function(Ct){return Ne.call(at,Ct,Mt++)}),ut}function St(he){if(he._status===-1){var Ne=he._result;Ne=Ne(),Ne.then(function(at){(he._status===0||he._status===-1)&&(he._status=1,he._result=at)},function(at){(he._status===0||he._status===-1)&&(he._status=2,he._result=at)}),he._status===-1&&(he._status=0,he._result=Ne)}if(he._status===1)return he._result.default;throw he._result}var _t=typeof reportError=="function"?reportError:function(he){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ne=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof he=="object"&&he!==null&&typeof he.message=="string"?String(he.message):String(he),error:he});if(!window.dispatchEvent(Ne))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",he);return}console.error(he)},ni={map:rt,forEach:function(he,Ne,at){rt(he,function(){Ne.apply(this,arguments)},at)},count:function(he){var Ne=0;return rt(he,function(){Ne++}),Ne},toArray:function(he){return rt(he,function(Ne){return Ne})||[]},only:function(he){if(!gi(he))throw Error("React.Children.only expected to receive a single React element child.");return he}};return Kt.Activity=Ye,Kt.Children=ni,Kt.Component=dn,Kt.Fragment=ae,Kt.Profiler=Me,Kt.PureComponent=It,Kt.StrictMode=H,Kt.Suspense=ze,Kt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Nt,Kt.__COMPILER_RUNTIME={__proto__:null,c:function(he){return Nt.H.useMemoCache(he)}},Kt.cache=function(he){return function(){return he.apply(null,arguments)}},Kt.cacheSignal=function(){return null},Kt.cloneElement=function(he,Ne,at){if(he==null)throw Error("The argument must be a React element, but you passed "+he+".");var ut=Bt({},he.props),Mt=he.key;if(Ne!=null)for(Ct in Ne.key!==void 0&&(Mt=""+Ne.key),Ne)!An.call(Ne,Ct)||Ct==="key"||Ct==="__self"||Ct==="__source"||Ct==="ref"&&Ne.ref===void 0||(ut[Ct]=Ne[Ct]);var Ct=arguments.length-2;if(Ct===1)ut.children=at;else if(1<Ct){for(var Qt=Array(Ct),wi=0;wi<Ct;wi++)Qt[wi]=arguments[wi+2];ut.children=Qt}return zn(he.type,Mt,ut)},Kt.createContext=function(he){return he={$$typeof:I,_currentValue:he,_currentValue2:he,_threadCount:0,Provider:null,Consumer:null},he.Provider=he,he.Consumer={$$typeof:$e,_context:he},he},Kt.createElement=function(he,Ne,at){var ut,Mt={},Ct=null;if(Ne!=null)for(ut in Ne.key!==void 0&&(Ct=""+Ne.key),Ne)An.call(Ne,ut)&&ut!=="key"&&ut!=="__self"&&ut!=="__source"&&(Mt[ut]=Ne[ut]);var Qt=arguments.length-2;if(Qt===1)Mt.children=at;else if(1<Qt){for(var wi=Array(Qt),si=0;si<Qt;si++)wi[si]=arguments[si+2];Mt.children=wi}if(he&&he.defaultProps)for(ut in Qt=he.defaultProps,Qt)Mt[ut]===void 0&&(Mt[ut]=Qt[ut]);return zn(he,Ct,Mt)},Kt.createRef=function(){return{current:null}},Kt.forwardRef=function(he){return{$$typeof:d,render:he}},Kt.isValidElement=gi,Kt.lazy=function(he){return{$$typeof:ot,_payload:{_status:-1,_result:he},_init:St}},Kt.memo=function(he,Ne){return{$$typeof:Ie,type:he,compare:Ne===void 0?null:Ne}},Kt.startTransition=function(he){var Ne=Nt.T,at={};Nt.T=at;try{var ut=he(),Mt=Nt.S;Mt!==null&&Mt(at,ut),typeof ut=="object"&&ut!==null&&typeof ut.then=="function"&&ut.then(Ui,_t)}catch(Ct){_t(Ct)}finally{Ne!==null&&at.types!==null&&(Ne.types=at.types),Nt.T=Ne}},Kt.unstable_useCacheRefresh=function(){return Nt.H.useCacheRefresh()},Kt.use=function(he){return Nt.H.use(he)},Kt.useActionState=function(he,Ne,at){return Nt.H.useActionState(he,Ne,at)},Kt.useCallback=function(he,Ne){return Nt.H.useCallback(he,Ne)},Kt.useContext=function(he){return Nt.H.useContext(he)},Kt.useDebugValue=function(){},Kt.useDeferredValue=function(he,Ne){return Nt.H.useDeferredValue(he,Ne)},Kt.useEffect=function(he,Ne){return Nt.H.useEffect(he,Ne)},Kt.useEffectEvent=function(he){return Nt.H.useEffectEvent(he)},Kt.useId=function(){return Nt.H.useId()},Kt.useImperativeHandle=function(he,Ne,at){return Nt.H.useImperativeHandle(he,Ne,at)},Kt.useInsertionEffect=function(he,Ne){return Nt.H.useInsertionEffect(he,Ne)},Kt.useLayoutEffect=function(he,Ne){return Nt.H.useLayoutEffect(he,Ne)},Kt.useMemo=function(he,Ne){return Nt.H.useMemo(he,Ne)},Kt.useOptimistic=function(he,Ne){return Nt.H.useOptimistic(he,Ne)},Kt.useReducer=function(he,Ne,at){return Nt.H.useReducer(he,Ne,at)},Kt.useRef=function(he){return Nt.H.useRef(he)},Kt.useState=function(he){return Nt.H.useState(he)},Kt.useSyncExternalStore=function(he,Ne,at){return Nt.H.useSyncExternalStore(he,Ne,at)},Kt.useTransition=function(){return Nt.H.useTransition()},Kt.version="19.2.0",Kt}var dm;function nm(){return dm||(dm=1,Xp.exports=Gm()),Xp.exports}var Ep=nm(),Yp={exports:{}},kf={},Kp={exports:{}},Qp={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fm;function qm(){return fm||(fm=1,(function(K){function re(Be,rt){var St=Be.length;Be.push(rt);e:for(;0<St;){var _t=St-1>>>1,ni=Be[_t];if(0<Me(ni,rt))Be[_t]=rt,Be[St]=ni,St=_t;else break e}}function ae(Be){return Be.length===0?null:Be[0]}function H(Be){if(Be.length===0)return null;var rt=Be[0],St=Be.pop();if(St!==rt){Be[0]=St;e:for(var _t=0,ni=Be.length,he=ni>>>1;_t<he;){var Ne=2*(_t+1)-1,at=Be[Ne],ut=Ne+1,Mt=Be[ut];if(0>Me(at,St))ut<ni&&0>Me(Mt,at)?(Be[_t]=Mt,Be[ut]=St,_t=ut):(Be[_t]=at,Be[Ne]=St,_t=Ne);else if(ut<ni&&0>Me(Mt,St))Be[_t]=Mt,Be[ut]=St,_t=ut;else break e}}return rt}function Me(Be,rt){var St=Be.sortIndex-rt.sortIndex;return St!==0?St:Be.id-rt.id}if(K.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var $e=performance;K.unstable_now=function(){return $e.now()}}else{var I=Date,d=I.now();K.unstable_now=function(){return I.now()-d}}var ze=[],Ie=[],ot=1,Ye=null,Ke=3,be=!1,ci=!1,Bt=!1,tn=!1,dn=typeof setTimeout=="function"?setTimeout:null,hi=typeof clearTimeout=="function"?clearTimeout:null,It=typeof setImmediate<"u"?setImmediate:null;function Ci(Be){for(var rt=ae(Ie);rt!==null;){if(rt.callback===null)H(Ie);else if(rt.startTime<=Be)H(Ie),rt.sortIndex=rt.expirationTime,re(ze,rt);else break;rt=ae(Ie)}}function Kn(Be){if(Bt=!1,Ci(Be),!ci)if(ae(ze)!==null)ci=!0,Ui||(Ui=!0,ji());else{var rt=ae(Ie);rt!==null&&Dn(Kn,rt.startTime-Be)}}var Ui=!1,Nt=-1,An=5,zn=-1;function Pn(){return tn?!0:!(K.unstable_now()-zn<An)}function gi(){if(tn=!1,Ui){var Be=K.unstable_now();zn=Be;var rt=!0;try{e:{ci=!1,Bt&&(Bt=!1,hi(Nt),Nt=-1),be=!0;var St=Ke;try{t:{for(Ci(Be),Ye=ae(ze);Ye!==null&&!(Ye.expirationTime>Be&&Pn());){var _t=Ye.callback;if(typeof _t=="function"){Ye.callback=null,Ke=Ye.priorityLevel;var ni=_t(Ye.expirationTime<=Be);if(Be=K.unstable_now(),typeof ni=="function"){Ye.callback=ni,Ci(Be),rt=!0;break t}Ye===ae(ze)&&H(ze),Ci(Be)}else H(ze);Ye=ae(ze)}if(Ye!==null)rt=!0;else{var he=ae(Ie);he!==null&&Dn(Kn,he.startTime-Be),rt=!1}}break e}finally{Ye=null,Ke=St,be=!1}rt=void 0}}finally{rt?ji():Ui=!1}}}var ji;if(typeof It=="function")ji=function(){It(gi)};else if(typeof MessageChannel<"u"){var ha=new MessageChannel,ba=ha.port2;ha.port1.onmessage=gi,ji=function(){ba.postMessage(null)}}else ji=function(){dn(gi,0)};function Dn(Be,rt){Nt=dn(function(){Be(K.unstable_now())},rt)}K.unstable_IdlePriority=5,K.unstable_ImmediatePriority=1,K.unstable_LowPriority=4,K.unstable_NormalPriority=3,K.unstable_Profiling=null,K.unstable_UserBlockingPriority=2,K.unstable_cancelCallback=function(Be){Be.callback=null},K.unstable_forceFrameRate=function(Be){0>Be||125<Be?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):An=0<Be?Math.floor(1e3/Be):5},K.unstable_getCurrentPriorityLevel=function(){return Ke},K.unstable_next=function(Be){switch(Ke){case 1:case 2:case 3:var rt=3;break;default:rt=Ke}var St=Ke;Ke=rt;try{return Be()}finally{Ke=St}},K.unstable_requestPaint=function(){tn=!0},K.unstable_runWithPriority=function(Be,rt){switch(Be){case 1:case 2:case 3:case 4:case 5:break;default:Be=3}var St=Ke;Ke=Be;try{return rt()}finally{Ke=St}},K.unstable_scheduleCallback=function(Be,rt,St){var _t=K.unstable_now();switch(typeof St=="object"&&St!==null?(St=St.delay,St=typeof St=="number"&&0<St?_t+St:_t):St=_t,Be){case 1:var ni=-1;break;case 2:ni=250;break;case 5:ni=1073741823;break;case 4:ni=1e4;break;default:ni=5e3}return ni=St+ni,Be={id:ot++,callback:rt,priorityLevel:Be,startTime:St,expirationTime:ni,sortIndex:-1},St>_t?(Be.sortIndex=St,re(Ie,Be),ae(ze)===null&&Be===ae(Ie)&&(Bt?(hi(Nt),Nt=-1):Bt=!0,Dn(Kn,St-_t))):(Be.sortIndex=ni,re(ze,Be),ci||be||(ci=!0,Ui||(Ui=!0,ji()))),Be},K.unstable_shouldYield=Pn,K.unstable_wrapCallback=function(Be){var rt=Ke;return function(){var St=Ke;Ke=rt;try{return Be.apply(this,arguments)}finally{Ke=St}}}})(Qp)),Qp}var pm;function Hm(){return pm||(pm=1,Kp.exports=qm()),Kp.exports}var Wp={exports:{}},yr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mm;function $m(){if(mm)return yr;mm=1;var K=nm();function re(ze){var Ie="https://react.dev/errors/"+ze;if(1<arguments.length){Ie+="?args[]="+encodeURIComponent(arguments[1]);for(var ot=2;ot<arguments.length;ot++)Ie+="&args[]="+encodeURIComponent(arguments[ot])}return"Minified React error #"+ze+"; visit "+Ie+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function ae(){}var H={d:{f:ae,r:function(){throw Error(re(522))},D:ae,C:ae,L:ae,m:ae,X:ae,S:ae,M:ae},p:0,findDOMNode:null},Me=Symbol.for("react.portal");function $e(ze,Ie,ot){var Ye=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Me,key:Ye==null?null:""+Ye,children:ze,containerInfo:Ie,implementation:ot}}var I=K.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(ze,Ie){if(ze==="font")return"";if(typeof Ie=="string")return Ie==="use-credentials"?Ie:""}return yr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=H,yr.createPortal=function(ze,Ie){var ot=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ie||Ie.nodeType!==1&&Ie.nodeType!==9&&Ie.nodeType!==11)throw Error(re(299));return $e(ze,Ie,null,ot)},yr.flushSync=function(ze){var Ie=I.T,ot=H.p;try{if(I.T=null,H.p=2,ze)return ze()}finally{I.T=Ie,H.p=ot,H.d.f()}},yr.preconnect=function(ze,Ie){typeof ze=="string"&&(Ie?(Ie=Ie.crossOrigin,Ie=typeof Ie=="string"?Ie==="use-credentials"?Ie:"":void 0):Ie=null,H.d.C(ze,Ie))},yr.prefetchDNS=function(ze){typeof ze=="string"&&H.d.D(ze)},yr.preinit=function(ze,Ie){if(typeof ze=="string"&&Ie&&typeof Ie.as=="string"){var ot=Ie.as,Ye=d(ot,Ie.crossOrigin),Ke=typeof Ie.integrity=="string"?Ie.integrity:void 0,be=typeof Ie.fetchPriority=="string"?Ie.fetchPriority:void 0;ot==="style"?H.d.S(ze,typeof Ie.precedence=="string"?Ie.precedence:void 0,{crossOrigin:Ye,integrity:Ke,fetchPriority:be}):ot==="script"&&H.d.X(ze,{crossOrigin:Ye,integrity:Ke,fetchPriority:be,nonce:typeof Ie.nonce=="string"?Ie.nonce:void 0})}},yr.preinitModule=function(ze,Ie){if(typeof ze=="string")if(typeof Ie=="object"&&Ie!==null){if(Ie.as==null||Ie.as==="script"){var ot=d(Ie.as,Ie.crossOrigin);H.d.M(ze,{crossOrigin:ot,integrity:typeof Ie.integrity=="string"?Ie.integrity:void 0,nonce:typeof Ie.nonce=="string"?Ie.nonce:void 0})}}else Ie==null&&H.d.M(ze)},yr.preload=function(ze,Ie){if(typeof ze=="string"&&typeof Ie=="object"&&Ie!==null&&typeof Ie.as=="string"){var ot=Ie.as,Ye=d(ot,Ie.crossOrigin);H.d.L(ze,ot,{crossOrigin:Ye,integrity:typeof Ie.integrity=="string"?Ie.integrity:void 0,nonce:typeof Ie.nonce=="string"?Ie.nonce:void 0,type:typeof Ie.type=="string"?Ie.type:void 0,fetchPriority:typeof Ie.fetchPriority=="string"?Ie.fetchPriority:void 0,referrerPolicy:typeof Ie.referrerPolicy=="string"?Ie.referrerPolicy:void 0,imageSrcSet:typeof Ie.imageSrcSet=="string"?Ie.imageSrcSet:void 0,imageSizes:typeof Ie.imageSizes=="string"?Ie.imageSizes:void 0,media:typeof Ie.media=="string"?Ie.media:void 0})}},yr.preloadModule=function(ze,Ie){if(typeof ze=="string")if(Ie){var ot=d(Ie.as,Ie.crossOrigin);H.d.m(ze,{as:typeof Ie.as=="string"&&Ie.as!=="script"?Ie.as:void 0,crossOrigin:ot,integrity:typeof Ie.integrity=="string"?Ie.integrity:void 0})}else H.d.m(ze)},yr.requestFormReset=function(ze){H.d.r(ze)},yr.unstable_batchedUpdates=function(ze,Ie){return ze(Ie)},yr.useFormState=function(ze,Ie,ot){return I.H.useFormState(ze,Ie,ot)},yr.useFormStatus=function(){return I.H.useHostTransitionStatus()},yr.version="19.2.0",yr}var gm;function Xm(){if(gm)return Wp.exports;gm=1;function K(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(K)}catch(re){console.error(re)}}return K(),Wp.exports=$m(),Wp.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _m;function Ym(){if(_m)return kf;_m=1;var K=Hm(),re=nm(),ae=Xm();function H(i){var s="https://react.dev/errors/"+i;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)s+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+i+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Me(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function $e(i){var s=i,c=i;if(i.alternate)for(;s.return;)s=s.return;else{i=s;do s=i,(s.flags&4098)!==0&&(c=s.return),i=s.return;while(i)}return s.tag===3?c:null}function I(i){if(i.tag===13){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function d(i){if(i.tag===31){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function ze(i){if($e(i)!==i)throw Error(H(188))}function Ie(i){var s=i.alternate;if(!s){if(s=$e(i),s===null)throw Error(H(188));return s!==i?null:i}for(var c=i,f=s;;){var x=c.return;if(x===null)break;var S=x.alternate;if(S===null){if(f=x.return,f!==null){c=f;continue}break}if(x.child===S.child){for(S=x.child;S;){if(S===c)return ze(x),i;if(S===f)return ze(x),s;S=S.sibling}throw Error(H(188))}if(c.return!==f.return)c=x,f=S;else{for(var R=!1,Z=x.child;Z;){if(Z===c){R=!0,c=x,f=S;break}if(Z===f){R=!0,f=x,c=S;break}Z=Z.sibling}if(!R){for(Z=S.child;Z;){if(Z===c){R=!0,c=S,f=x;break}if(Z===f){R=!0,f=S,c=x;break}Z=Z.sibling}if(!R)throw Error(H(189))}}if(c.alternate!==f)throw Error(H(190))}if(c.tag!==3)throw Error(H(188));return c.stateNode.current===c?i:s}function ot(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i;for(i=i.child;i!==null;){if(s=ot(i),s!==null)return s;i=i.sibling}return null}var Ye=Object.assign,Ke=Symbol.for("react.element"),be=Symbol.for("react.transitional.element"),ci=Symbol.for("react.portal"),Bt=Symbol.for("react.fragment"),tn=Symbol.for("react.strict_mode"),dn=Symbol.for("react.profiler"),hi=Symbol.for("react.consumer"),It=Symbol.for("react.context"),Ci=Symbol.for("react.forward_ref"),Kn=Symbol.for("react.suspense"),Ui=Symbol.for("react.suspense_list"),Nt=Symbol.for("react.memo"),An=Symbol.for("react.lazy"),zn=Symbol.for("react.activity"),Pn=Symbol.for("react.memo_cache_sentinel"),gi=Symbol.iterator;function ji(i){return i===null||typeof i!="object"?null:(i=gi&&i[gi]||i["@@iterator"],typeof i=="function"?i:null)}var ha=Symbol.for("react.client.reference");function ba(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===ha?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case Bt:return"Fragment";case dn:return"Profiler";case tn:return"StrictMode";case Kn:return"Suspense";case Ui:return"SuspenseList";case zn:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case ci:return"Portal";case It:return i.displayName||"Context";case hi:return(i._context.displayName||"Context")+".Consumer";case Ci:var s=i.render;return i=i.displayName,i||(i=s.displayName||s.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case Nt:return s=i.displayName||null,s!==null?s:ba(i.type)||"Memo";case An:s=i._payload,i=i._init;try{return ba(i(s))}catch{}}return null}var Dn=Array.isArray,Be=re.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,rt=ae.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,St={pending:!1,data:null,method:null,action:null},_t=[],ni=-1;function he(i){return{current:i}}function Ne(i){0>ni||(i.current=_t[ni],_t[ni]=null,ni--)}function at(i,s){ni++,_t[ni]=i.current,i.current=s}var ut=he(null),Mt=he(null),Ct=he(null),Qt=he(null);function wi(i,s){switch(at(Ct,s),at(Mt,i),at(ut,null),s.nodeType){case 9:case 11:i=(i=s.documentElement)&&(i=i.namespaceURI)?Xo(i):0;break;default:if(i=s.tagName,s=s.namespaceURI)s=Xo(s),i=Sf(s,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}Ne(ut),at(ut,i)}function si(){Ne(ut),Ne(Mt),Ne(Ct)}function tr(i){i.memoizedState!==null&&at(Qt,i);var s=ut.current,c=Sf(s,i.type);s!==c&&(at(Mt,i),at(ut,c))}function ir(i){Mt.current===i&&(Ne(ut),Ne(Mt)),Qt.current===i&&(Ne(Qt),Ze._currentValue=St)}var Qn,Ni;function zi(i){if(Qn===void 0)try{throw Error()}catch(c){var s=c.stack.trim().match(/\n( *(at )?)/);Qn=s&&s[1]||"",Ni=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Qn+i+Ni}var $a=!1;function nr(i,s){if(!i||$a)return"";$a=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(s){var He=function(){throw Error()};if(Object.defineProperty(He.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(He,[])}catch(ke){var De=ke}Reflect.construct(i,[],He)}else{try{He.call()}catch(ke){De=ke}i.call(He.prototype)}}else{try{throw Error()}catch(ke){De=ke}(He=i())&&typeof He.catch=="function"&&He.catch(function(){})}}catch(ke){if(ke&&De&&typeof ke.stack=="string")return[ke.stack,De.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var x=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");x&&x.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var S=f.DetermineComponentFrameRoot(),R=S[0],Z=S[1];if(R&&Z){var ce=R.split(`
`),Pe=Z.split(`
`);for(x=f=0;f<ce.length&&!ce[f].includes("DetermineComponentFrameRoot");)f++;for(;x<Pe.length&&!Pe[x].includes("DetermineComponentFrameRoot");)x++;if(f===ce.length||x===Pe.length)for(f=ce.length-1,x=Pe.length-1;1<=f&&0<=x&&ce[f]!==Pe[x];)x--;for(;1<=f&&0<=x;f--,x--)if(ce[f]!==Pe[x]){if(f!==1||x!==1)do if(f--,x--,0>x||ce[f]!==Pe[x]){var je=`
`+ce[f].replace(" at new "," at ");return i.displayName&&je.includes("<anonymous>")&&(je=je.replace("<anonymous>",i.displayName)),je}while(1<=f&&0<=x);break}}}finally{$a=!1,Error.prepareStackTrace=c}return(c=i?i.displayName||i.name:"")?zi(c):""}function xo(i,s){switch(i.tag){case 26:case 27:case 5:return zi(i.type);case 16:return zi("Lazy");case 13:return i.child!==s&&s!==null?zi("Suspense Fallback"):zi("Suspense");case 19:return zi("SuspenseList");case 0:case 15:return nr(i.type,!1);case 11:return nr(i.type.render,!1);case 1:return nr(i.type,!0);case 31:return zi("Activity");default:return""}}function vr(i){try{var s="",c=null;do s+=xo(i,c),c=i,i=i.return;while(i);return s}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}var ar=Object.prototype.hasOwnProperty,Os=K.unstable_scheduleCallback,Pr=K.unstable_cancelCallback,Fs=K.unstable_shouldYield,Us=K.unstable_requestPaint,Un=K.unstable_now,js=K.unstable_getCurrentPriorityLevel,ls=K.unstable_ImmediatePriority,cs=K.unstable_UserBlockingPriority,us=K.unstable_NormalPriority,pe=K.unstable_LowPriority,U=K.unstable_IdlePriority,j=K.log,G=K.unstable_setDisableYieldValue,ie=null,oe=null;function fe(i){if(typeof j=="function"&&G(i),oe&&typeof oe.setStrictMode=="function")try{oe.setStrictMode(ie,i)}catch{}}var xe=Math.clz32?Math.clz32:Xe,ye=Math.log,Le=Math.LN2;function Xe(i){return i>>>=0,i===0?32:31-(ye(i)/Le|0)|0}var Oe=256,ct=262144,_e=4194304;function wt(i){var s=i&42;if(s!==0)return s;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return i&261888;case 262144:case 524288:case 1048576:case 2097152:return i&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function Vt(i,s,c){var f=i.pendingLanes;if(f===0)return 0;var x=0,S=i.suspendedLanes,R=i.pingedLanes;i=i.warmLanes;var Z=f&134217727;return Z!==0?(f=Z&~S,f!==0?x=wt(f):(R&=Z,R!==0?x=wt(R):c||(c=Z&~i,c!==0&&(x=wt(c))))):(Z=f&~S,Z!==0?x=wt(Z):R!==0?x=wt(R):c||(c=f&~i,c!==0&&(x=wt(c)))),x===0?0:s!==0&&s!==x&&(s&S)===0&&(S=x&-x,c=s&-s,S>=c||S===32&&(c&4194048)!==0)?s:x}function pt(i,s){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&s)===0}function Ot(i,s){switch(i){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Pi(){var i=_e;return _e<<=1,(_e&62914560)===0&&(_e=4194304),i}function nn(i){for(var s=[],c=0;31>c;c++)s.push(i);return s}function an(i,s){i.pendingLanes|=s,s!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function jn(i,s,c,f,x,S){var R=i.pendingLanes;i.pendingLanes=c,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=c,i.entangledLanes&=c,i.errorRecoveryDisabledLanes&=c,i.shellSuspendCounter=0;var Z=i.entanglements,ce=i.expirationTimes,Pe=i.hiddenUpdates;for(c=R&~c;0<c;){var je=31-xe(c),He=1<<je;Z[je]=0,ce[je]=-1;var De=Pe[je];if(De!==null)for(Pe[je]=null,je=0;je<De.length;je++){var ke=De[je];ke!==null&&(ke.lane&=-536870913)}c&=~He}f!==0&&In(i,f,0),S!==0&&x===0&&i.tag!==0&&(i.suspendedLanes|=S&~(R&~s))}function In(i,s,c){i.pendingLanes|=s,i.suspendedLanes&=~s;var f=31-xe(s);i.entangledLanes|=s,i.entanglements[f]=i.entanglements[f]|1073741824|c&261930}function Di(i,s){var c=i.entangledLanes|=s;for(i=i.entanglements;c;){var f=31-xe(c),x=1<<f;x&s|i[f]&s&&(i[f]|=s),c&=~x}}function fn(i,s){var c=s&-s;return c=(c&42)!==0?1:Ue(c),(c&(i.suspendedLanes|s))!==0?0:c}function Ue(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function rn(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function Da(){var i=rt.p;return i!==0?i:(i=window.event,i===void 0?32:gr(i.type))}function Ns(i,s){var c=rt.p;try{return rt.p=i,s()}finally{rt.p=c}}var sn=Math.random().toString(36).slice(2),qe="__reactFiber$"+sn,xt="__reactProps$"+sn,Pt="__reactContainer$"+sn,Nn="__reactEvents$"+sn,bo="__reactListeners$"+sn,Vs="__reactHandles$"+sn,Rt="__reactResources$"+sn,Zs="__reactMarker$"+sn;function Dr(i){delete i[qe],delete i[xt],delete i[Nn],delete i[bo],delete i[Vs]}function hs(i){var s=i[qe];if(s)return s;for(var c=i.parentNode;c;){if(s=c[Pt]||c[qe]){if(c=s.alternate,s.child!==null||c!==null&&c.child!==null)for(i=Mp(i);i!==null;){if(c=i[qe])return c;i=Mp(i)}return s}i=c,c=i.parentNode}return null}function wa(i){if(i=i[qe]||i[Pt]){var s=i.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return i}return null}function Ir(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i.stateNode;throw Error(H(33))}function Ii(i){var s=i[Rt];return s||(s=i[Rt]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function _n(i){i[Zs]=!0}var Ta=new Set,Ti={};function Gs(i,s){Rr(i,s),Rr(i+"Capture",s)}function Rr(i,s){for(Ti[i]=s,i=0;i<s.length;i++)Ta.add(s[i])}var vu=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ds={},fs={};function xu(i){return ar.call(fs,i)?!0:ar.call(ds,i)?!1:vu.test(i)?fs[i]=!0:(ds[i]=!0,!1)}function Fl(i,s,c){if(xu(s))if(c===null)i.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":i.removeAttribute(s);return;case"boolean":var f=s.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){i.removeAttribute(s);return}}i.setAttribute(s,""+c)}}function Ul(i,s,c){if(c===null)i.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(s);return}i.setAttribute(s,""+c)}}function Ia(i,s,c,f){if(f===null)i.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(c);return}i.setAttributeNS(s,c,""+f)}}function Xa(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Ch(i){var s=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function zd(i,s,c){var f=Object.getOwnPropertyDescriptor(i.constructor.prototype,s);if(!i.hasOwnProperty(s)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var x=f.get,S=f.set;return Object.defineProperty(i,s,{configurable:!0,get:function(){return x.call(this)},set:function(R){c=""+R,S.call(this,R)}}),Object.defineProperty(i,s,{enumerable:f.enumerable}),{getValue:function(){return c},setValue:function(R){c=""+R},stopTracking:function(){i._valueTracker=null,delete i[s]}}}}function bu(i){if(!i._valueTracker){var s=Ch(i)?"checked":"value";i._valueTracker=zd(i,s,""+i[s])}}function Ec(i){if(!i)return!1;var s=i._valueTracker;if(!s)return!0;var c=s.getValue(),f="";return i&&(f=Ch(i)?i.checked?"true":"false":i.value),i=f,i!==c?(s.setValue(i),!0):!1}function ps(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var wu=/[\n"\\]/g;function Ra(i){return i.replace(wu,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function qs(i,s,c,f,x,S,R,Z){i.name="",R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?i.type=R:i.removeAttribute("type"),s!=null?R==="number"?(s===0&&i.value===""||i.value!=s)&&(i.value=""+Xa(s)):i.value!==""+Xa(s)&&(i.value=""+Xa(s)):R!=="submit"&&R!=="reset"||i.removeAttribute("value"),s!=null?jl(i,R,Xa(s)):c!=null?jl(i,R,Xa(c)):f!=null&&i.removeAttribute("value"),x==null&&S!=null&&(i.defaultChecked=!!S),x!=null&&(i.checked=x&&typeof x!="function"&&typeof x!="symbol"),Z!=null&&typeof Z!="function"&&typeof Z!="symbol"&&typeof Z!="boolean"?i.name=""+Xa(Z):i.removeAttribute("name")}function Ac(i,s,c,f,x,S,R,Z){if(S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(i.type=S),s!=null||c!=null){if(!(S!=="submit"&&S!=="reset"||s!=null)){bu(i);return}c=c!=null?""+Xa(c):"",s=s!=null?""+Xa(s):c,Z||s===i.value||(i.value=s),i.defaultValue=s}f=f??x,f=typeof f!="function"&&typeof f!="symbol"&&!!f,i.checked=Z?i.checked:!!f,i.defaultChecked=!!f,R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(i.name=R),bu(i)}function jl(i,s,c){s==="number"&&ps(i.ownerDocument)===i||i.defaultValue===""+c||(i.defaultValue=""+c)}function el(i,s,c,f){if(i=i.options,s){s={};for(var x=0;x<c.length;x++)s["$"+c[x]]=!0;for(c=0;c<i.length;c++)x=s.hasOwnProperty("$"+i[c].value),i[c].selected!==x&&(i[c].selected=x),x&&f&&(i[c].defaultSelected=!0)}else{for(c=""+Xa(c),s=null,x=0;x<i.length;x++){if(i[x].value===c){i[x].selected=!0,f&&(i[x].defaultSelected=!0);return}s!==null||i[x].disabled||(s=i[x])}s!==null&&(s.selected=!0)}}function wo(i,s,c){if(s!=null&&(s=""+Xa(s),s!==i.value&&(i.value=s),c==null)){i.defaultValue!==s&&(i.defaultValue=s);return}i.defaultValue=c!=null?""+Xa(c):""}function tl(i,s,c,f){if(s==null){if(f!=null){if(c!=null)throw Error(H(92));if(Dn(f)){if(1<f.length)throw Error(H(93));f=f[0]}c=f}c==null&&(c=""),s=c}c=Xa(s),i.defaultValue=c,f=i.textContent,f===c&&f!==""&&f!==null&&(i.value=f),bu(i)}function da(i,s){if(s){var c=i.firstChild;if(c&&c===i.lastChild&&c.nodeType===3){c.nodeValue=s;return}}i.textContent=s}var qt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Hs(i,s,c){var f=s.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?f?i.setProperty(s,""):s==="float"?i.cssFloat="":i[s]="":f?i.setProperty(s,c):typeof c!="number"||c===0||qt.has(s)?s==="float"?i.cssFloat=c:i[s]=(""+c).trim():i[s]=c+"px"}function ms(i,s,c){if(s!=null&&typeof s!="object")throw Error(H(62));if(i=i.style,c!=null){for(var f in c)!c.hasOwnProperty(f)||s!=null&&s.hasOwnProperty(f)||(f.indexOf("--")===0?i.setProperty(f,""):f==="float"?i.cssFloat="":i[f]="");for(var x in s)f=s[x],s.hasOwnProperty(x)&&c[x]!==f&&Hs(i,x,f)}else for(var S in s)s.hasOwnProperty(S)&&Hs(i,S,s[S])}function xr(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var To=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ht=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Lr(i){return Ht.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}function rr(){}var il=null;function oa(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var on=null,Rn=null;function yn(i){var s=wa(i);if(s&&(i=s.stateNode)){var c=i[xt]||null;e:switch(i=s.stateNode,s.type){case"input":if(qs(i,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),s=c.name,c.type==="radio"&&s!=null){for(c=i;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+Ra(""+s)+'"][type="radio"]'),s=0;s<c.length;s++){var f=c[s];if(f!==i&&f.form===i.form){var x=f[xt]||null;if(!x)throw Error(H(90));qs(f,x.value,x.defaultValue,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name)}}for(s=0;s<c.length;s++)f=c[s],f.form===i.form&&Ec(f)}break e;case"textarea":wo(i,c.value,c.defaultValue);break e;case"select":s=c.value,s!=null&&el(i,!!c.multiple,s,!1)}}}var _i=!1;function Tu(i,s,c){if(_i)return i(s,c);_i=!0;try{var f=i(s);return f}finally{if(_i=!1,(on!==null||Rn!==null)&&(cd(),on&&(s=on,i=Rn,Rn=on=null,yn(s),i)))for(s=0;s<i.length;s++)yn(i[s])}}function Vn(i,s){var c=i.stateNode;if(c===null)return null;var f=c[xt]||null;if(f===null)return null;c=f[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(i=i.type,f=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!f;break e;default:i=!1}if(i)return null;if(c&&typeof c!="function")throw Error(H(231,s,typeof c));return c}var vn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Wn=!1;if(vn)try{var yi={};Object.defineProperty(yi,"passive",{get:function(){Wn=!0}}),window.addEventListener("test",yi,yi),window.removeEventListener("test",yi,yi)}catch{Wn=!1}var La=null,bt=null,zt=null;function kr(){if(zt)return zt;var i,s=bt,c=s.length,f,x="value"in La?La.value:La.textContent,S=x.length;for(i=0;i<c&&s[i]===x[i];i++);var R=c-i;for(f=1;f<=R&&s[c-f]===x[S-f];f++);return zt=x.slice(i,1<f?1-f:void 0)}function Yt(i){var s=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&s===13&&(i=13)):i=s,i===10&&(i=13),32<=i||i===13?i:0}function fa(){return!0}function br(){return!1}function ln(i){function s(c,f,x,S,R){this._reactName=c,this._targetInst=x,this.type=f,this.nativeEvent=S,this.target=R,this.currentTarget=null;for(var Z in i)i.hasOwnProperty(Z)&&(c=i[Z],this[Z]=c?c(S):S[Z]);return this.isDefaultPrevented=(S.defaultPrevented!=null?S.defaultPrevented:S.returnValue===!1)?fa:br,this.isPropagationStopped=br,this}return Ye(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=fa)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=fa)},persist:function(){},isPersistent:fa}),s}var Br={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},nl=ln(Br),Or=Ye({},Br,{view:0,detail:0}),Nl=ln(Or),al,rl,$s,ka=Ye({},Or,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Mo,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==$s&&($s&&i.type==="mousemove"?(al=i.screenX-$s.screenX,rl=i.screenY-$s.screenY):rl=al=0,$s=i),al)},movementY:function(i){return"movementY"in i?i.movementY:rl}}),Zn=ln(ka),sl=Ye({},ka,{dataTransfer:0}),Vl=ln(sl),So=Ye({},Or,{relatedTarget:0}),Wi=ln(So),Eh=Ye({},Br,{animationName:0,elapsedTime:0,pseudoElement:0}),Zl=ln(Eh),Su=Ye({},Br,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Pd=ln(Su),ol=Ye({},Br,{data:0}),Jn=ln(ol),Gl={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Fr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ql={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Hl(i){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(i):(i=ql[i])?!!s[i]:!1}function Mo(){return Hl}var pa=Ye({},Or,{key:function(i){if(i.key){var s=Gl[i.key]||i.key;if(s!=="Unidentified")return s}return i.type==="keypress"?(i=Yt(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Fr[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Mo,charCode:function(i){return i.type==="keypress"?Yt(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Yt(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Ah=ln(pa),zc=Ye({},ka,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),zh=ln(zc),Mu=Ye({},Or,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Mo}),Dd=ln(Mu),Id=Ye({},Br,{propertyName:0,elapsedTime:0,pseudoElement:0}),Pc=ln(Id),Cu=Ye({},ka,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),Co=ln(Cu),Eu=Ye({},Br,{newState:0,oldState:0}),Dc=ln(Eu),wr=[9,13,27,32],Au=vn&&"CompositionEvent"in window,Xs=null;vn&&"documentMode"in document&&(Xs=document.documentMode);var $l=vn&&"TextEvent"in window&&!Xs,ll=vn&&(!Au||Xs&&8<Xs&&11>=Xs),Ph=" ",Xl=!1;function Dh(i,s){switch(i){case"keyup":return wr.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ys(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Eo=!1;function zu(i,s){switch(i){case"compositionend":return Ys(s);case"keypress":return s.which!==32?null:(Xl=!0,Ph);case"textInput":return i=s.data,i===Ph&&Xl?null:i;default:return null}}function Rd(i,s){if(Eo)return i==="compositionend"||!Au&&Dh(i,s)?(i=kr(),zt=bt=La=null,Eo=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return ll&&s.locale!=="ko"?null:s.data;default:return null}}var Ih={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ic(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s==="input"?!!Ih[i.type]:s==="textarea"}function Pu(i,s,c,f){on?Rn?Rn.push(f):Rn=[f]:on=f,s=hu(s,"onChange"),0<s.length&&(c=new nl("onChange","change",null,c,f),i.push({event:c,listeners:s}))}var Ks=null,cl=null;function Rh(i){gp(i,0)}function Ur(i){var s=Ir(i);if(Ec(s))return i}function Rc(i,s){if(i==="change")return s}var Lc=!1;if(vn){var Ao;if(vn){var Du="oninput"in document;if(!Du){var ul=document.createElement("div");ul.setAttribute("oninput","return;"),Du=typeof ul.oninput=="function"}Ao=Du}else Ao=!1;Lc=Ao&&(!document.documentMode||9<document.documentMode)}function Iu(){Ks&&(Ks.detachEvent("onpropertychange",Lh),cl=Ks=null)}function Lh(i){if(i.propertyName==="value"&&Ur(cl)){var s=[];Pu(s,cl,i,oa(i)),Tu(Rh,s)}}function kh(i,s,c){i==="focusin"?(Iu(),Ks=s,cl=c,Ks.attachEvent("onpropertychange",Lh)):i==="focusout"&&Iu()}function Bh(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Ur(cl)}function Ru(i,s){if(i==="click")return Ur(s)}function Lu(i,s){if(i==="input"||i==="change")return Ur(s)}function Oh(i,s){return i===s&&(i!==0||1/i===1/s)||i!==i&&s!==s}var ma=typeof Object.is=="function"?Object.is:Oh;function Ya(i,s){if(ma(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;var c=Object.keys(i),f=Object.keys(s);if(c.length!==f.length)return!1;for(f=0;f<c.length;f++){var x=c[f];if(!ar.call(s,x)||!ma(i[x],s[x]))return!1}return!0}function ai(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function kc(i,s){var c=ai(i);i=0;for(var f;c;){if(c.nodeType===3){if(f=i+c.textContent.length,i<=s&&f>=s)return{node:c,offset:s-i};i=f}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=ai(c)}}function Bc(i,s){return i&&s?i===s?!0:i&&i.nodeType===3?!1:s&&s.nodeType===3?Bc(i,s.parentNode):"contains"in i?i.contains(s):i.compareDocumentPosition?!!(i.compareDocumentPosition(s)&16):!1:!1}function ku(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var s=ps(i.document);s instanceof i.HTMLIFrameElement;){try{var c=typeof s.contentWindow.location.href=="string"}catch{c=!1}if(c)i=s.contentWindow;else break;s=ps(i.document)}return s}function Yl(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s&&(s==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||s==="textarea"||i.contentEditable==="true")}var zo=vn&&"documentMode"in document&&11>=document.documentMode,Qs=null,Bu=null,Kl=null,Ou=!1;function Fh(i,s,c){var f=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Ou||Qs==null||Qs!==ps(f)||(f=Qs,"selectionStart"in f&&Yl(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Kl&&Ya(Kl,f)||(Kl=f,f=hu(Bu,"onSelect"),0<f.length&&(s=new nl("onSelect","select",null,s,c),i.push({event:s,listeners:f}),s.target=Qs)))}function Ws(i,s){var c={};return c[i.toLowerCase()]=s.toLowerCase(),c["Webkit"+i]="webkit"+s,c["Moz"+i]="moz"+s,c}var hl={animationend:Ws("Animation","AnimationEnd"),animationiteration:Ws("Animation","AnimationIteration"),animationstart:Ws("Animation","AnimationStart"),transitionrun:Ws("Transition","TransitionRun"),transitionstart:Ws("Transition","TransitionStart"),transitioncancel:Ws("Transition","TransitionCancel"),transitionend:Ws("Transition","TransitionEnd")},Oc={},Ql={};vn&&(Ql=document.createElement("div").style,"AnimationEvent"in window||(delete hl.animationend.animation,delete hl.animationiteration.animation,delete hl.animationstart.animation),"TransitionEvent"in window||delete hl.transitionend.transition);function jr(i){if(Oc[i])return Oc[i];if(!hl[i])return i;var s=hl[i],c;for(c in s)if(s.hasOwnProperty(c)&&c in Ql)return Oc[i]=s[c];return i}var Wl=jr("animationend"),Fc=jr("animationiteration"),Js=jr("animationstart"),Jl=jr("transitionrun"),dl=jr("transitionstart"),sr=jr("transitioncancel"),Fu=jr("transitionend"),Uu=new Map,ec="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ec.push("scrollEnd");function la(i,s){Uu.set(i,s),Gs(s,[i])}var Po=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)},Sa=[],Nr=0,fl=0;function tc(){for(var i=Nr,s=fl=Nr=0;s<i;){var c=Sa[s];Sa[s++]=null;var f=Sa[s];Sa[s++]=null;var x=Sa[s];Sa[s++]=null;var S=Sa[s];if(Sa[s++]=null,f!==null&&x!==null){var R=f.pending;R===null?x.next=x:(x.next=R.next,R.next=x),f.pending=x}S!==0&&Uc(c,x,S)}}function gs(i,s,c,f){Sa[Nr++]=i,Sa[Nr++]=s,Sa[Nr++]=c,Sa[Nr++]=f,fl|=f,i.lanes|=f,i=i.alternate,i!==null&&(i.lanes|=f)}function Vr(i,s,c,f){return gs(i,s,c,f),Zt(i)}function eo(i,s){return gs(i,null,null,s),Zt(i)}function Uc(i,s,c){i.lanes|=c;var f=i.alternate;f!==null&&(f.lanes|=c);for(var x=!1,S=i.return;S!==null;)S.childLanes|=c,f=S.alternate,f!==null&&(f.childLanes|=c),S.tag===22&&(i=S.stateNode,i===null||i._visibility&1||(x=!0)),i=S,S=S.return;return i.tag===3?(S=i.stateNode,x&&s!==null&&(x=31-xe(c),i=S.hiddenUpdates,f=i[x],f===null?i[x]=[s]:f.push(s),s.lane=c|536870912),S):null}function Zt(i){if(50<wc)throw wc=0,Rl=null,Error(H(185));for(var s=i.return;s!==null;)i=s,s=i.return;return i.tag===3?i.stateNode:null}var Zr={};function Ld(i,s,c,f){this.tag=i,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ba(i,s,c,f){return new Ld(i,s,c,f)}function Gr(i){return i=i.prototype,!(!i||!i.isReactComponent)}function qr(i,s){var c=i.alternate;return c===null?(c=Ba(i.tag,s,i.key,i.mode),c.elementType=i.elementType,c.type=i.type,c.stateNode=i.stateNode,c.alternate=i,i.alternate=c):(c.pendingProps=s,c.type=i.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=i.flags&65011712,c.childLanes=i.childLanes,c.lanes=i.lanes,c.child=i.child,c.memoizedProps=i.memoizedProps,c.memoizedState=i.memoizedState,c.updateQueue=i.updateQueue,s=i.dependencies,c.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},c.sibling=i.sibling,c.index=i.index,c.ref=i.ref,c.refCleanup=i.refCleanup,c}function Uh(i,s){i.flags&=65011714;var c=i.alternate;return c===null?(i.childLanes=0,i.lanes=s,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=c.childLanes,i.lanes=c.lanes,i.child=c.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=c.memoizedProps,i.memoizedState=c.memoizedState,i.updateQueue=c.updateQueue,i.type=c.type,s=c.dependencies,i.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),i}function ic(i,s,c,f,x,S){var R=0;if(f=i,typeof i=="function")Gr(i)&&(R=1);else if(typeof i=="string")R=F(i,c,ut.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case zn:return i=Ba(31,c,s,x),i.elementType=zn,i.lanes=S,i;case Bt:return Do(c.children,x,S,s);case tn:R=8,x|=24;break;case dn:return i=Ba(12,c,s,x|2),i.elementType=dn,i.lanes=S,i;case Kn:return i=Ba(13,c,s,x),i.elementType=Kn,i.lanes=S,i;case Ui:return i=Ba(19,c,s,x),i.elementType=Ui,i.lanes=S,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case It:R=10;break e;case hi:R=9;break e;case Ci:R=11;break e;case Nt:R=14;break e;case An:R=16,f=null;break e}R=29,c=Error(H(130,i===null?"null":typeof i,"")),f=null}return s=Ba(R,c,s,x),s.elementType=i,s.type=f,s.lanes=S,s}function Do(i,s,c,f){return i=Ba(7,i,f,s),i.lanes=c,i}function nc(i,s,c){return i=Ba(6,i,null,s),i.lanes=c,i}function ac(i){var s=Ba(18,null,null,0);return s.stateNode=i,s}function Io(i,s,c){return s=Ba(4,i.children!==null?i.children:[],i.key,s),s.lanes=c,s.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},s}var pl=new WeakMap;function Oa(i,s){if(typeof i=="object"&&i!==null){var c=pl.get(i);return c!==void 0?c:(s={value:i,source:s,stack:vr(s)},pl.set(i,s),s)}return{value:i,source:s,stack:vr(s)}}var Ro=[],Hr=0,to=null,_s=0,ea=[],ga=0,$r=null,_a=1,or="";function Ka(i,s){Ro[Hr++]=_s,Ro[Hr++]=to,to=i,_s=s}function rc(i,s,c){ea[ga++]=_a,ea[ga++]=or,ea[ga++]=$r,$r=i;var f=_a;i=or;var x=32-xe(f)-1;f&=~(1<<x),c+=1;var S=32-xe(s)+x;if(30<S){var R=x-x%5;S=(f&(1<<R)-1).toString(32),f>>=R,x-=R,_a=1<<32-xe(s)+x|c<<x|f,or=S+i}else _a=1<<S|c<<x|f,or=i}function sc(i){i.return!==null&&(Ka(i,1),rc(i,1,0))}function jc(i){for(;i===to;)to=Ro[--Hr],Ro[Hr]=null,_s=Ro[--Hr],Ro[Hr]=null;for(;i===$r;)$r=ea[--ga],ea[ga]=null,or=ea[--ga],ea[ga]=null,_a=ea[--ga],ea[ga]=null}function ju(i,s){ea[ga++]=_a,ea[ga++]=or,ea[ga++]=$r,_a=s.id,or=s.overflow,$r=i}var Ln=null,Ri=null,Jt=!1,Xr=null,ei=!1,ys=Error(H(519));function kn(i){var s=Error(H(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw xs(Oa(s,i)),ys}function oc(i){var s=i.stateNode,c=i.type,f=i.memoizedProps;switch(s[qe]=i,s[xt]=f,c){case"dialog":Wt("cancel",s),Wt("close",s);break;case"iframe":case"object":case"embed":Wt("load",s);break;case"video":case"audio":for(c=0;c<yh.length;c++)Wt(yh[c],s);break;case"source":Wt("error",s);break;case"img":case"image":case"link":Wt("error",s),Wt("load",s);break;case"details":Wt("toggle",s);break;case"input":Wt("invalid",s),Ac(s,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0);break;case"select":Wt("invalid",s);break;case"textarea":Wt("invalid",s),tl(s,f.value,f.defaultValue,f.children)}c=f.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||s.textContent===""+c||f.suppressHydrationWarning===!0||mr(s.textContent,c)?(f.popover!=null&&(Wt("beforetoggle",s),Wt("toggle",s)),f.onScroll!=null&&Wt("scroll",s),f.onScrollEnd!=null&&Wt("scrollend",s),f.onClick!=null&&(s.onclick=rr),s=!0):s=!1,s||kn(i,!0)}function lc(i){for(Ln=i.return;Ln;)switch(Ln.tag){case 5:case 31:case 13:ei=!1;return;case 27:case 3:ei=!0;return;default:Ln=Ln.return}}function io(i){if(i!==Ln)return!1;if(!Jt)return lc(i),Jt=!0,!1;var s=i.tag,c;if((c=s!==3&&s!==27)&&((c=s===5)&&(c=i.type,c=!(c!=="form"&&c!=="button")||xd(i.type,i.memoizedProps)),c=!c),c&&Ri&&kn(i),lc(i),s===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(H(317));Ri=Sd(i)}else if(s===31){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(H(317));Ri=Sd(i)}else s===27?(s=Ri,Yo(i.type)?(i=Td,Td=null,Ri=i):Ri=s):Ri=Ln?Ar(i.stateNode.nextSibling):null;return!0}function Qa(){Ri=Ln=null,Jt=!1}function vs(){var i=Xr;return i!==null&&(Aa===null?Aa=i:Aa.push.apply(Aa,i),Xr=null),i}function xs(i){Xr===null?Xr=[i]:Xr.push(i)}var cc=he(null),no=null,Yr=null;function bs(i,s,c){at(cc,s._currentValue),s._currentValue=c}function Kr(i){i._currentValue=cc.current,Ne(cc)}function ao(i,s,c){for(;i!==null;){var f=i.alternate;if((i.childLanes&s)!==s?(i.childLanes|=s,f!==null&&(f.childLanes|=s)):f!==null&&(f.childLanes&s)!==s&&(f.childLanes|=s),i===c)break;i=i.return}}function Wa(i,s,c,f){var x=i.child;for(x!==null&&(x.return=i);x!==null;){var S=x.dependencies;if(S!==null){var R=x.child;S=S.firstContext;e:for(;S!==null;){var Z=S;S=x;for(var ce=0;ce<s.length;ce++)if(Z.context===s[ce]){S.lanes|=c,Z=S.alternate,Z!==null&&(Z.lanes|=c),ao(S.return,c,i),f||(R=null);break e}S=Z.next}}else if(x.tag===18){if(R=x.return,R===null)throw Error(H(341));R.lanes|=c,S=R.alternate,S!==null&&(S.lanes|=c),ao(R,c,i),R=null}else R=x.child;if(R!==null)R.return=x;else for(R=x;R!==null;){if(R===i){R=null;break}if(x=R.sibling,x!==null){x.return=R.return,R=x;break}R=R.return}x=R}}function Gn(i,s,c,f){i=null;for(var x=s,S=!1;x!==null;){if(!S){if((x.flags&524288)!==0)S=!0;else if((x.flags&262144)!==0)break}if(x.tag===10){var R=x.alternate;if(R===null)throw Error(H(387));if(R=R.memoizedProps,R!==null){var Z=x.type;ma(x.pendingProps.value,R.value)||(i!==null?i.push(Z):i=[Z])}}else if(x===Qt.current){if(R=x.alternate,R===null)throw Error(H(387));R.memoizedState.memoizedState!==x.memoizedState.memoizedState&&(i!==null?i.push(Ze):i=[Ze])}x=x.return}i!==null&&Wa(s,i,c,f),s.flags|=262144}function ws(i){for(i=i.firstContext;i!==null;){if(!ma(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function Ts(i){no=i,Yr=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function ta(i){return Lo(no,i)}function uc(i,s){return no===null&&Ts(i),Lo(i,s)}function Lo(i,s){var c=s._currentValue;if(s={context:s,memoizedValue:c,next:null},Yr===null){if(i===null)throw Error(H(308));Yr=s,i.dependencies={lanes:0,firstContext:s},i.flags|=524288}else Yr=Yr.next=s;return c}var Nu=typeof AbortController<"u"?AbortController:function(){var i=[],s=this.signal={aborted:!1,addEventListener:function(c,f){i.push(f)}};this.abort=function(){s.aborted=!0,i.forEach(function(c){return c()})}},Nc=K.unstable_scheduleCallback,Vc=K.unstable_NormalPriority,cn={$$typeof:It,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Fa(){return{controller:new Nu,data:new Map,refCount:0}}function qn(i){i.refCount--,i.refCount===0&&Nc(Vc,function(){i.controller.abort()})}var ml=null,Ja=0,Tr=0,Qr=null;function kd(i,s){if(ml===null){var c=ml=[];Ja=0,Tr=md(),Qr={status:"pending",value:void 0,then:function(f){c.push(f)}}}return Ja++,s.then(jh,jh),s}function jh(){if(--Ja===0&&ml!==null){Qr!==null&&(Qr.status="fulfilled");var i=ml;ml=null,Tr=0,Qr=null;for(var s=0;s<i.length;s++)(0,i[s])()}}function Zc(i,s){var c=[],f={status:"pending",value:null,reason:null,then:function(x){c.push(x)}};return i.then(function(){f.status="fulfilled",f.value=s;for(var x=0;x<c.length;x++)(0,c[x])(s)},function(x){for(f.status="rejected",f.reason=x,x=0;x<c.length;x++)(0,c[x])(void 0)}),f}var Vu=Be.S;Be.S=function(i,s){ap=Un(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&kd(i,s),Vu!==null&&Vu(i,s)};var er=he(null);function Ua(){var i=er.current;return i!==null?i:Hi.pooledCache}function st(i,s){s===null?at(er,er.current):at(er,s.pool)}function Gc(){var i=Ua();return i===null?null:{parent:cn._currentValue,pool:i}}var Ss=Error(H(460)),hc=Error(H(474)),Wr=Error(H(542)),Ms={then:function(){}};function qc(i){return i=i.status,i==="fulfilled"||i==="rejected"}function $t(i,s,c){switch(c=i[c],c===void 0?i.push(s):c!==s&&(s.then(rr,rr),s=c),s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,Zu(i),i;default:if(typeof s.status=="string")s.then(rr,rr);else{if(i=Hi,i!==null&&100<i.shellSuspendCounter)throw Error(H(482));i=s,i.status="pending",i.then(function(f){if(s.status==="pending"){var x=s;x.status="fulfilled",x.value=f}},function(f){if(s.status==="pending"){var x=s;x.status="rejected",x.reason=f}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,Zu(i),i}throw ro=s,Ss}}function Cs(i){try{var s=i._init;return s(i._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(ro=c,Ss):c}}var ro=null;function Hc(){if(ro===null)throw Error(H(459));var i=ro;return ro=null,i}function Zu(i){if(i===Ss||i===Wr)throw Error(H(483))}var ko=null,gl=0;function _l(i){var s=gl;return gl+=1,ko===null&&(ko=[]),$t(ko,i,s)}function Bo(i,s){s=s.props.ref,i.ref=s!==void 0?s:null}function dc(i,s){throw s.$$typeof===Ke?Error(H(525)):(i=Object.prototype.toString.call(s),Error(H(31,i==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":i)))}function $c(i){function s(ve,me){if(i){var Ae=ve.deletions;Ae===null?(ve.deletions=[me],ve.flags|=16):Ae.push(me)}}function c(ve,me){if(!i)return null;for(;me!==null;)s(ve,me),me=me.sibling;return null}function f(ve){for(var me=new Map;ve!==null;)ve.key!==null?me.set(ve.key,ve):me.set(ve.index,ve),ve=ve.sibling;return me}function x(ve,me){return ve=qr(ve,me),ve.index=0,ve.sibling=null,ve}function S(ve,me,Ae){return ve.index=Ae,i?(Ae=ve.alternate,Ae!==null?(Ae=Ae.index,Ae<me?(ve.flags|=67108866,me):Ae):(ve.flags|=67108866,me)):(ve.flags|=1048576,me)}function R(ve){return i&&ve.alternate===null&&(ve.flags|=67108866),ve}function Z(ve,me,Ae,Ge){return me===null||me.tag!==6?(me=nc(Ae,ve.mode,Ge),me.return=ve,me):(me=x(me,Ae),me.return=ve,me)}function ce(ve,me,Ae,Ge){var At=Ae.type;return At===Bt?je(ve,me,Ae.props.children,Ge,Ae.key):me!==null&&(me.elementType===At||typeof At=="object"&&At!==null&&At.$$typeof===An&&Cs(At)===me.type)?(me=x(me,Ae.props),Bo(me,Ae),me.return=ve,me):(me=ic(Ae.type,Ae.key,Ae.props,null,ve.mode,Ge),Bo(me,Ae),me.return=ve,me)}function Pe(ve,me,Ae,Ge){return me===null||me.tag!==4||me.stateNode.containerInfo!==Ae.containerInfo||me.stateNode.implementation!==Ae.implementation?(me=Io(Ae,ve.mode,Ge),me.return=ve,me):(me=x(me,Ae.children||[]),me.return=ve,me)}function je(ve,me,Ae,Ge,At){return me===null||me.tag!==7?(me=Do(Ae,ve.mode,Ge,At),me.return=ve,me):(me=x(me,Ae),me.return=ve,me)}function He(ve,me,Ae){if(typeof me=="string"&&me!==""||typeof me=="number"||typeof me=="bigint")return me=nc(""+me,ve.mode,Ae),me.return=ve,me;if(typeof me=="object"&&me!==null){switch(me.$$typeof){case be:return Ae=ic(me.type,me.key,me.props,null,ve.mode,Ae),Bo(Ae,me),Ae.return=ve,Ae;case ci:return me=Io(me,ve.mode,Ae),me.return=ve,me;case An:return me=Cs(me),He(ve,me,Ae)}if(Dn(me)||ji(me))return me=Do(me,ve.mode,Ae,null),me.return=ve,me;if(typeof me.then=="function")return He(ve,_l(me),Ae);if(me.$$typeof===It)return He(ve,uc(ve,me),Ae);dc(ve,me)}return null}function De(ve,me,Ae,Ge){var At=me!==null?me.key:null;if(typeof Ae=="string"&&Ae!==""||typeof Ae=="number"||typeof Ae=="bigint")return At!==null?null:Z(ve,me,""+Ae,Ge);if(typeof Ae=="object"&&Ae!==null){switch(Ae.$$typeof){case be:return Ae.key===At?ce(ve,me,Ae,Ge):null;case ci:return Ae.key===At?Pe(ve,me,Ae,Ge):null;case An:return Ae=Cs(Ae),De(ve,me,Ae,Ge)}if(Dn(Ae)||ji(Ae))return At!==null?null:je(ve,me,Ae,Ge,null);if(typeof Ae.then=="function")return De(ve,me,_l(Ae),Ge);if(Ae.$$typeof===It)return De(ve,me,uc(ve,Ae),Ge);dc(ve,Ae)}return null}function ke(ve,me,Ae,Ge,At){if(typeof Ge=="string"&&Ge!==""||typeof Ge=="number"||typeof Ge=="bigint")return ve=ve.get(Ae)||null,Z(me,ve,""+Ge,At);if(typeof Ge=="object"&&Ge!==null){switch(Ge.$$typeof){case be:return ve=ve.get(Ge.key===null?Ae:Ge.key)||null,ce(me,ve,Ge,At);case ci:return ve=ve.get(Ge.key===null?Ae:Ge.key)||null,Pe(me,ve,Ge,At);case An:return Ge=Cs(Ge),ke(ve,me,Ae,Ge,At)}if(Dn(Ge)||ji(Ge))return ve=ve.get(Ae)||null,je(me,ve,Ge,At,null);if(typeof Ge.then=="function")return ke(ve,me,Ae,_l(Ge),At);if(Ge.$$typeof===It)return ke(ve,me,Ae,uc(me,Ge),At);dc(me,Ge)}return null}function yt(ve,me,Ae,Ge){for(var At=null,kt=null,ht=me,Ft=me=0,jt=null;ht!==null&&Ft<Ae.length;Ft++){ht.index>Ft?(jt=ht,ht=null):jt=ht.sibling;var ii=De(ve,ht,Ae[Ft],Ge);if(ii===null){ht===null&&(ht=jt);break}i&&ht&&ii.alternate===null&&s(ve,ht),me=S(ii,me,Ft),kt===null?At=ii:kt.sibling=ii,kt=ii,ht=jt}if(Ft===Ae.length)return c(ve,ht),Jt&&Ka(ve,Ft),At;if(ht===null){for(;Ft<Ae.length;Ft++)ht=He(ve,Ae[Ft],Ge),ht!==null&&(me=S(ht,me,Ft),kt===null?At=ht:kt.sibling=ht,kt=ht);return Jt&&Ka(ve,Ft),At}for(ht=f(ht);Ft<Ae.length;Ft++)jt=ke(ht,ve,Ft,Ae[Ft],Ge),jt!==null&&(i&&jt.alternate!==null&&ht.delete(jt.key===null?Ft:jt.key),me=S(jt,me,Ft),kt===null?At=jt:kt.sibling=jt,kt=jt);return i&&ht.forEach(function(Pa){return s(ve,Pa)}),Jt&&Ka(ve,Ft),At}function Dt(ve,me,Ae,Ge){if(Ae==null)throw Error(H(151));for(var At=null,kt=null,ht=me,Ft=me=0,jt=null,ii=Ae.next();ht!==null&&!ii.done;Ft++,ii=Ae.next()){ht.index>Ft?(jt=ht,ht=null):jt=ht.sibling;var Pa=De(ve,ht,ii.value,Ge);if(Pa===null){ht===null&&(ht=jt);break}i&&ht&&Pa.alternate===null&&s(ve,ht),me=S(Pa,me,Ft),kt===null?At=Pa:kt.sibling=Pa,kt=Pa,ht=jt}if(ii.done)return c(ve,ht),Jt&&Ka(ve,Ft),At;if(ht===null){for(;!ii.done;Ft++,ii=Ae.next())ii=He(ve,ii.value,Ge),ii!==null&&(me=S(ii,me,Ft),kt===null?At=ii:kt.sibling=ii,kt=ii);return Jt&&Ka(ve,Ft),At}for(ht=f(ht);!ii.done;Ft++,ii=Ae.next())ii=ke(ht,ve,Ft,ii.value,Ge),ii!==null&&(i&&ii.alternate!==null&&ht.delete(ii.key===null?Ft:ii.key),me=S(ii,me,Ft),kt===null?At=ii:kt.sibling=ii,kt=ii);return i&&ht.forEach(function(jm){return s(ve,jm)}),Jt&&Ka(ve,Ft),At}function ti(ve,me,Ae,Ge){if(typeof Ae=="object"&&Ae!==null&&Ae.type===Bt&&Ae.key===null&&(Ae=Ae.props.children),typeof Ae=="object"&&Ae!==null){switch(Ae.$$typeof){case be:e:{for(var At=Ae.key;me!==null;){if(me.key===At){if(At=Ae.type,At===Bt){if(me.tag===7){c(ve,me.sibling),Ge=x(me,Ae.props.children),Ge.return=ve,ve=Ge;break e}}else if(me.elementType===At||typeof At=="object"&&At!==null&&At.$$typeof===An&&Cs(At)===me.type){c(ve,me.sibling),Ge=x(me,Ae.props),Bo(Ge,Ae),Ge.return=ve,ve=Ge;break e}c(ve,me);break}else s(ve,me);me=me.sibling}Ae.type===Bt?(Ge=Do(Ae.props.children,ve.mode,Ge,Ae.key),Ge.return=ve,ve=Ge):(Ge=ic(Ae.type,Ae.key,Ae.props,null,ve.mode,Ge),Bo(Ge,Ae),Ge.return=ve,ve=Ge)}return R(ve);case ci:e:{for(At=Ae.key;me!==null;){if(me.key===At)if(me.tag===4&&me.stateNode.containerInfo===Ae.containerInfo&&me.stateNode.implementation===Ae.implementation){c(ve,me.sibling),Ge=x(me,Ae.children||[]),Ge.return=ve,ve=Ge;break e}else{c(ve,me);break}else s(ve,me);me=me.sibling}Ge=Io(Ae,ve.mode,Ge),Ge.return=ve,ve=Ge}return R(ve);case An:return Ae=Cs(Ae),ti(ve,me,Ae,Ge)}if(Dn(Ae))return yt(ve,me,Ae,Ge);if(ji(Ae)){if(At=ji(Ae),typeof At!="function")throw Error(H(150));return Ae=At.call(Ae),Dt(ve,me,Ae,Ge)}if(typeof Ae.then=="function")return ti(ve,me,_l(Ae),Ge);if(Ae.$$typeof===It)return ti(ve,me,uc(ve,Ae),Ge);dc(ve,Ae)}return typeof Ae=="string"&&Ae!==""||typeof Ae=="number"||typeof Ae=="bigint"?(Ae=""+Ae,me!==null&&me.tag===6?(c(ve,me.sibling),Ge=x(me,Ae),Ge.return=ve,ve=Ge):(c(ve,me),Ge=nc(Ae,ve.mode,Ge),Ge.return=ve,ve=Ge),R(ve)):c(ve,me)}return function(ve,me,Ae,Ge){try{gl=0;var At=ti(ve,me,Ae,Ge);return ko=null,At}catch(ht){if(ht===Ss||ht===Wr)throw ht;var kt=Ba(29,ht,null,ve.mode);return kt.lanes=Ge,kt.return=ve,kt}finally{}}}var so=$c(!0),fc=$c(!1),Ma=!1;function ui(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Gu(i,s){i=i.updateQueue,s.updateQueue===i&&(s.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function Sr(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function Mr(i,s,c){var f=i.updateQueue;if(f===null)return null;if(f=f.shared,(bi&2)!==0){var x=f.pending;return x===null?s.next=s:(s.next=x.next,x.next=s),f.pending=s,s=Zt(i),Uc(i,null,c),s}return gs(i,f,s,c),Zt(i)}function Oo(i,s,c){if(s=s.updateQueue,s!==null&&(s=s.shared,(c&4194048)!==0)){var f=s.lanes;f&=i.pendingLanes,c|=f,s.lanes=c,Di(i,c)}}function pc(i,s){var c=i.updateQueue,f=i.alternate;if(f!==null&&(f=f.updateQueue,c===f)){var x=null,S=null;if(c=c.firstBaseUpdate,c!==null){do{var R={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};S===null?x=S=R:S=S.next=R,c=c.next}while(c!==null);S===null?x=S=s:S=S.next=s}else x=S=s;c={baseState:f.baseState,firstBaseUpdate:x,lastBaseUpdate:S,shared:f.shared,callbacks:f.callbacks},i.updateQueue=c;return}i=c.lastBaseUpdate,i===null?c.firstBaseUpdate=s:i.next=s,c.lastBaseUpdate=s}var Xc=!1;function mc(){if(Xc){var i=Qr;if(i!==null)throw i}}function ja(i,s,c,f){Xc=!1;var x=i.updateQueue;Ma=!1;var S=x.firstBaseUpdate,R=x.lastBaseUpdate,Z=x.shared.pending;if(Z!==null){x.shared.pending=null;var ce=Z,Pe=ce.next;ce.next=null,R===null?S=Pe:R.next=Pe,R=ce;var je=i.alternate;je!==null&&(je=je.updateQueue,Z=je.lastBaseUpdate,Z!==R&&(Z===null?je.firstBaseUpdate=Pe:Z.next=Pe,je.lastBaseUpdate=ce))}if(S!==null){var He=x.baseState;R=0,je=Pe=ce=null,Z=S;do{var De=Z.lane&-536870913,ke=De!==Z.lane;if(ke?(oi&De)===De:(f&De)===De){De!==0&&De===Tr&&(Xc=!0),je!==null&&(je=je.next={lane:0,tag:Z.tag,payload:Z.payload,callback:null,next:null});e:{var yt=i,Dt=Z;De=s;var ti=c;switch(Dt.tag){case 1:if(yt=Dt.payload,typeof yt=="function"){He=yt.call(ti,He,De);break e}He=yt;break e;case 3:yt.flags=yt.flags&-65537|128;case 0:if(yt=Dt.payload,De=typeof yt=="function"?yt.call(ti,He,De):yt,De==null)break e;He=Ye({},He,De);break e;case 2:Ma=!0}}De=Z.callback,De!==null&&(i.flags|=64,ke&&(i.flags|=8192),ke=x.callbacks,ke===null?x.callbacks=[De]:ke.push(De))}else ke={lane:De,tag:Z.tag,payload:Z.payload,callback:Z.callback,next:null},je===null?(Pe=je=ke,ce=He):je=je.next=ke,R|=De;if(Z=Z.next,Z===null){if(Z=x.shared.pending,Z===null)break;ke=Z,Z=ke.next,ke.next=null,x.lastBaseUpdate=ke,x.shared.pending=null}}while(!0);je===null&&(ce=He),x.baseState=ce,x.firstBaseUpdate=Pe,x.lastBaseUpdate=je,S===null&&(x.shared.lanes=0),qo|=R,i.lanes=R,i.memoizedState=He}}function gc(i,s){if(typeof i!="function")throw Error(H(191,i));i.call(s)}function dt(i,s){var c=i.callbacks;if(c!==null)for(i.callbacks=null,i=0;i<c.length;i++)gc(c[i],s)}var mt=he(null),oo=he(0);function qu(i,s){i=Go,at(oo,i),at(mt,s),Go=i|s.baseLanes}function yl(){at(oo,Go),at(mt,mt.current)}function ia(){Go=oo.current,Ne(mt),Ne(oo)}var Na=he(null),pn=null;function Va(i){var s=i.alternate;at(Yi,Yi.current&1),at(Na,i),pn===null&&(s===null||mt.current!==null||s.memoizedState!==null)&&(pn=i)}function lo(i){at(Yi,Yi.current),at(Na,i),pn===null&&(pn=i)}function Li(i){i.tag===22?(at(Yi,Yi.current),at(Na,i),pn===null&&(pn=i)):vi()}function vi(){at(Yi,Yi.current),at(Na,Na.current)}function ya(i){Ne(Na),pn===i&&(pn=null),Ne(Yi)}var Yi=he(0);function Jr(i){for(var s=i;s!==null;){if(s.tag===13){var c=s.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||Bl(c)||ra(c)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Ca=0,Ut=null,di=null,Ei=null,vl=!1,co=!1,es=!1,xl=0,m=0,e=null,r=0;function l(){throw Error(H(321))}function h(i,s){if(s===null)return!1;for(var c=0;c<s.length&&c<i.length;c++)if(!ma(i[c],s[c]))return!1;return!0}function g(i,s,c,f,x,S){return Ca=S,Ut=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Be.H=i===null||i.memoizedState===null?Vh:Zh,es=!1,S=c(f,x),es=!1,co&&(S=w(s,c,f,x)),y(i),S}function y(i){Be.H=Qc;var s=di!==null&&di.next!==null;if(Ca=0,Ei=di=Ut=null,vl=!1,m=0,e=null,s)throw Error(H(300));i===null||un||(i=i.dependencies,i!==null&&ws(i)&&(un=!0))}function w(i,s,c,f){Ut=i;var x=0;do{if(co&&(e=null),m=0,co=!1,25<=x)throw Error(H(301));if(x+=1,Ei=di=null,i.updateQueue!=null){var S=i.updateQueue;S.lastEffect=null,S.events=null,S.stores=null,S.memoCache!=null&&(S.memoCache.index=0)}Be.H=Sl,S=s(c,f)}while(co);return S}function T(){var i=Be.H,s=i.useState()[0];return s=typeof s.then=="function"?$(s):s,i=i.useState()[0],(di!==null?di.memoizedState:null)!==i&&(Ut.flags|=1024),s}function E(){var i=xl!==0;return xl=0,i}function A(i,s,c){s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~c}function D(i){if(vl){for(i=i.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}vl=!1}Ca=0,Ei=di=Ut=null,co=!1,m=xl=0,e=null}function P(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ei===null?Ut.memoizedState=Ei=i:Ei=Ei.next=i,Ei}function B(){if(di===null){var i=Ut.alternate;i=i!==null?i.memoizedState:null}else i=di.next;var s=Ei===null?Ut.memoizedState:Ei.next;if(s!==null)Ei=s,di=i;else{if(i===null)throw Ut.alternate===null?Error(H(467)):Error(H(310));di=i,i={memoizedState:di.memoizedState,baseState:di.baseState,baseQueue:di.baseQueue,queue:di.queue,next:null},Ei===null?Ut.memoizedState=Ei=i:Ei=Ei.next=i}return Ei}function N(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function $(i){var s=m;return m+=1,e===null&&(e=[]),i=$t(e,i,s),s=Ut,(Ei===null?s.memoizedState:Ei.next)===null&&(s=s.alternate,Be.H=s===null||s.memoizedState===null?Vh:Zh),i}function X(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return $(i);if(i.$$typeof===It)return ta(i)}throw Error(H(438,String(i)))}function Y(i){var s=null,c=Ut.updateQueue;if(c!==null&&(s=c.memoCache),s==null){var f=Ut.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(s={data:f.data.map(function(x){return x.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),c===null&&(c=N(),Ut.updateQueue=c),c.memoCache=s,c=s.data[s.index],c===void 0)for(c=s.data[s.index]=Array(i),f=0;f<i;f++)c[f]=Pn;return s.index++,c}function Q(i,s){return typeof s=="function"?s(i):s}function ee(i){var s=B();return J(s,di,i)}function J(i,s,c){var f=i.queue;if(f===null)throw Error(H(311));f.lastRenderedReducer=c;var x=i.baseQueue,S=f.pending;if(S!==null){if(x!==null){var R=x.next;x.next=S.next,S.next=R}s.baseQueue=x=S,f.pending=null}if(S=i.baseState,x===null)i.memoizedState=S;else{s=x.next;var Z=R=null,ce=null,Pe=s,je=!1;do{var He=Pe.lane&-536870913;if(He!==Pe.lane?(oi&He)===He:(Ca&He)===He){var De=Pe.revertLane;if(De===0)ce!==null&&(ce=ce.next={lane:0,revertLane:0,gesture:null,action:Pe.action,hasEagerState:Pe.hasEagerState,eagerState:Pe.eagerState,next:null}),He===Tr&&(je=!0);else if((Ca&De)===De){Pe=Pe.next,De===Tr&&(je=!0);continue}else He={lane:0,revertLane:Pe.revertLane,gesture:null,action:Pe.action,hasEagerState:Pe.hasEagerState,eagerState:Pe.eagerState,next:null},ce===null?(Z=ce=He,R=S):ce=ce.next=He,Ut.lanes|=De,qo|=De;He=Pe.action,es&&c(S,He),S=Pe.hasEagerState?Pe.eagerState:c(S,He)}else De={lane:He,revertLane:Pe.revertLane,gesture:Pe.gesture,action:Pe.action,hasEagerState:Pe.hasEagerState,eagerState:Pe.eagerState,next:null},ce===null?(Z=ce=De,R=S):ce=ce.next=De,Ut.lanes|=He,qo|=He;Pe=Pe.next}while(Pe!==null&&Pe!==s);if(ce===null?R=S:ce.next=Z,!ma(S,i.memoizedState)&&(un=!0,je&&(c=Qr,c!==null)))throw c;i.memoizedState=S,i.baseState=R,i.baseQueue=ce,f.lastRenderedState=S}return x===null&&(f.lanes=0),[i.memoizedState,f.dispatch]}function se(i){var s=B(),c=s.queue;if(c===null)throw Error(H(311));c.lastRenderedReducer=i;var f=c.dispatch,x=c.pending,S=s.memoizedState;if(x!==null){c.pending=null;var R=x=x.next;do S=i(S,R.action),R=R.next;while(R!==x);ma(S,s.memoizedState)||(un=!0),s.memoizedState=S,s.baseQueue===null&&(s.baseState=S),c.lastRenderedState=S}return[S,f]}function ue(i,s,c){var f=Ut,x=B(),S=Jt;if(S){if(c===void 0)throw Error(H(407));c=c()}else c=s();var R=!ma((di||x).memoizedState,c);if(R&&(x.memoizedState=c,un=!0),x=x.queue,ts(Ce.bind(null,f,x,i),[i]),x.getSnapshot!==s||R||Ei!==null&&Ei.memoizedState.tag&1){if(f.flags|=2048,Si(9,{destroy:void 0},de.bind(null,f,x,c,s),null),Hi===null)throw Error(H(349));S||(Ca&127)!==0||te(f,s,c)}return c}function te(i,s,c){i.flags|=16384,i={getSnapshot:s,value:c},s=Ut.updateQueue,s===null?(s=N(),Ut.updateQueue=s,s.stores=[i]):(c=s.stores,c===null?s.stores=[i]:c.push(i))}function de(i,s,c,f){s.value=c,s.getSnapshot=f,Te(s)&&Se(i)}function Ce(i,s,c){return c(function(){Te(s)&&Se(i)})}function Te(i){var s=i.getSnapshot;i=i.value;try{var c=s();return!ma(i,c)}catch{return!0}}function Se(i){var s=eo(i,2);s!==null&&pr(s,i,2)}function Ee(i){var s=P();if(typeof i=="function"){var c=i;if(i=c(),es){fe(!0);try{c()}finally{fe(!1)}}}return s.memoizedState=s.baseState=i,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Q,lastRenderedState:i},s}function We(i,s,c,f){return i.baseState=c,J(i,di,typeof f=="function"?f:Q)}function Qe(i,s,c,f,x){if(Uo(i))throw Error(H(485));if(i=s.action,i!==null){var S={payload:x,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(R){S.listeners.push(R)}};Be.T!==null?c(!0):S.isTransition=!1,f(S),c=s.pending,c===null?(S.next=s.pending=S,Ve(s,S)):(S.next=c.next,s.pending=c.next=S)}}function Ve(i,s){var c=s.action,f=s.payload,x=i.state;if(s.isTransition){var S=Be.T,R={};Be.T=R;try{var Z=c(x,f),ce=Be.S;ce!==null&&ce(R,Z),lt(i,s,Z)}catch(Pe){li(i,s,Pe)}finally{S!==null&&R.types!==null&&(S.types=R.types),Be.T=S}}else try{S=c(x,f),lt(i,s,S)}catch(Pe){li(i,s,Pe)}}function lt(i,s,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(f){Lt(i,s,f)},function(f){return li(i,s,f)}):Lt(i,s,c)}function Lt(i,s,c){s.status="fulfilled",s.value=c,ki(s),i.state=c,s=i.pending,s!==null&&(c=s.next,c===s?i.pending=null:(c=c.next,s.next=c,Ve(i,c)))}function li(i,s,c){var f=i.pending;if(i.pending=null,f!==null){f=f.next;do s.status="rejected",s.reason=c,ki(s),s=s.next;while(s!==f)}i.action=null}function ki(i){i=i.listeners;for(var s=0;s<i.length;s++)(0,i[s])()}function Ai(i,s){return s}function Vi(i,s){if(Jt){var c=Hi.formState;if(c!==null){e:{var f=Ut;if(Jt){if(Ri){t:{for(var x=Ri,S=ei;x.nodeType!==8;){if(!S){x=null;break t}if(x=Ar(x.nextSibling),x===null){x=null;break t}}S=x.data,x=S==="F!"||S==="F"?x:null}if(x){Ri=Ar(x.nextSibling),f=x.data==="F!";break e}}kn(f)}f=!1}f&&(s=c[0])}}return c=P(),c.memoizedState=c.baseState=s,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ai,lastRenderedState:s},c.queue=f,c=ns.bind(null,Ut,f),f.dispatch=c,f=Ee(!1),S=yc.bind(null,Ut,!1,f.queue),f=P(),x={state:s,dispatch:null,action:i,pending:null},f.queue=x,c=Qe.bind(null,Ut,x,S,c),x.dispatch=c,f.memoizedState=i,[s,c,!1]}function Bi(i){var s=B();return Bn(s,di,i)}function Bn(i,s,c){if(s=J(i,s,Ai)[0],i=ee(Q)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var f=$(s)}catch(R){throw R===Ss?Wr:R}else f=s;s=B();var x=s.queue,S=x.dispatch;return c!==s.memoizedState&&(Ut.flags|=2048,Si(9,{destroy:void 0},Zi.bind(null,x,c),null)),[f,S,i]}function Zi(i,s){i.action=s}function xi(i){var s=B(),c=di;if(c!==null)return Bn(s,c,i);B(),s=s.memoizedState,c=B();var f=c.queue.dispatch;return c.memoizedState=i,[s,f,!1]}function Si(i,s,c,f){return i={tag:i,create:c,deps:f,inst:s,next:null},s=Ut.updateQueue,s===null&&(s=N(),Ut.updateQueue=s),c=s.lastEffect,c===null?s.lastEffect=i.next=i:(f=c.next,c.next=i,i.next=f,s.lastEffect=i),i}function Gt(){return B().memoizedState}function On(i,s,c,f){var x=P();Ut.flags|=i,x.memoizedState=Si(1|s,{destroy:void 0},c,f===void 0?null:f)}function lr(i,s,c,f){var x=B();f=f===void 0?null:f;var S=x.memoizedState.inst;di!==null&&f!==null&&h(f,di.memoizedState.deps)?x.memoizedState=Si(s,S,c,f):(Ut.flags|=i,x.memoizedState=Si(1|s,S,c,f))}function uo(i,s){On(8390656,8,i,s)}function ts(i,s){lr(2048,8,i,s)}function Fo(i){Ut.flags|=4;var s=Ut.updateQueue;if(s===null)s=N(),Ut.updateQueue=s,s.events=[i];else{var c=s.events;c===null?s.events=[i]:c.push(i)}}function bl(i){var s=B().memoizedState;return Fo({ref:s,nextImpl:i}),function(){if((bi&2)!==0)throw Error(H(440));return s.impl.apply(void 0,arguments)}}function Es(i,s){return lr(4,2,i,s)}function ho(i,s){return lr(4,4,i,s)}function Za(i,s){if(typeof s=="function"){i=i();var c=s(i);return function(){typeof c=="function"?c():s(null)}}if(s!=null)return i=i(),s.current=i,function(){s.current=null}}function As(i,s,c){c=c!=null?c.concat([i]):null,lr(4,4,Za.bind(null,s,i),c)}function Cr(){}function zs(i,s){var c=B();s=s===void 0?null:s;var f=c.memoizedState;return s!==null&&h(s,f[1])?f[0]:(c.memoizedState=[i,s],i)}function xn(i,s){var c=B();s=s===void 0?null:s;var f=c.memoizedState;if(s!==null&&h(s,f[1]))return f[0];if(f=i(),es){fe(!0);try{i()}finally{fe(!1)}}return c.memoizedState=[f,s],f}function mn(i,s,c){return c===void 0||(Ca&1073741824)!==0&&(oi&261930)===0?i.memoizedState=s:(i.memoizedState=c,i=rp(),Ut.lanes|=i,qo|=i,c)}function va(i,s,c,f){return ma(c,s)?c:mt.current!==null?(i=mn(i,c,f),ma(i,s)||(un=!0),i):(Ca&42)===0||(Ca&1073741824)!==0&&(oi&261930)===0?(un=!0,i.memoizedState=c):(i=rp(),Ut.lanes|=i,qo|=i,s)}function Oi(i,s,c,f,x){var S=rt.p;rt.p=S!==0&&8>S?S:8;var R=Be.T,Z={};Be.T=Z,yc(i,!1,s,c);try{var ce=x(),Pe=Be.S;if(Pe!==null&&Pe(Z,ce),ce!==null&&typeof ce=="object"&&typeof ce.then=="function"){var je=Zc(ce,f);fo(i,s,je,fr(i))}else fo(i,s,f,fr(i))}catch(He){fo(i,s,{then:function(){},status:"rejected",reason:He},fr())}finally{rt.p=S,R!==null&&Z.types!==null&&(R.types=Z.types),Be.T=R}}function Yc(){}function Kc(i,s,c,f){if(i.tag!==5)throw Error(H(476));var x=Hu(i).queue;Oi(i,x,s,St,c===null?Yc:function(){return Nh(i),c(f)})}function Hu(i){var s=i.memoizedState;if(s!==null)return s;s={memoizedState:St,baseState:St,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Q,lastRenderedState:St},next:null};var c={};return s.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Q,lastRenderedState:c},next:null},i.memoizedState=s,i=i.alternate,i!==null&&(i.memoizedState=s),s}function Nh(i){var s=Hu(i);s.next===null&&(s=i.alternate.memoizedState),fo(i,s.next.queue,{},fr())}function _c(){return ta(Ze)}function wl(){return B().memoizedState}function Ga(){return B().memoizedState}function is(i){for(var s=i.return;s!==null;){switch(s.tag){case 24:case 3:var c=fr();i=Sr(c);var f=Mr(s,i,c);f!==null&&(pr(f,s,c),Oo(f,s,c)),s={cache:Fa()},i.payload=s;return}s=s.return}}function cr(i,s,c){var f=fr();c={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Uo(i)?Tl(s,c):(c=Vr(i,s,c,f),c!==null&&(pr(c,i,f),Uf(c,s,f)))}function ns(i,s,c){var f=fr();fo(i,s,c,f)}function fo(i,s,c,f){var x={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(Uo(i))Tl(s,x);else{var S=i.alternate;if(i.lanes===0&&(S===null||S.lanes===0)&&(S=s.lastRenderedReducer,S!==null))try{var R=s.lastRenderedState,Z=S(R,c);if(x.hasEagerState=!0,x.eagerState=Z,ma(Z,R))return gs(i,s,x,0),Hi===null&&tc(),!1}catch{}finally{}if(c=Vr(i,s,x,f),c!==null)return pr(c,i,f),Uf(c,s,f),!0}return!1}function yc(i,s,c,f){if(f={lane:2,revertLane:md(),gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},Uo(i)){if(s)throw Error(H(479))}else s=Vr(i,c,f,2),s!==null&&pr(s,i,2)}function Uo(i){var s=i.alternate;return i===Ut||s!==null&&s===Ut}function Tl(i,s){co=vl=!0;var c=i.pending;c===null?s.next=s:(s.next=c.next,c.next=s),i.pending=s}function Uf(i,s,c){if((c&4194048)!==0){var f=s.lanes;f&=i.pendingLanes,c|=f,s.lanes=c,Di(i,c)}}var Qc={readContext:ta,use:X,useCallback:l,useContext:l,useEffect:l,useImperativeHandle:l,useLayoutEffect:l,useInsertionEffect:l,useMemo:l,useReducer:l,useRef:l,useState:l,useDebugValue:l,useDeferredValue:l,useTransition:l,useSyncExternalStore:l,useId:l,useHostTransitionStatus:l,useFormState:l,useActionState:l,useOptimistic:l,useMemoCache:l,useCacheRefresh:l};Qc.useEffectEvent=l;var Vh={readContext:ta,use:X,useCallback:function(i,s){return P().memoizedState=[i,s===void 0?null:s],i},useContext:ta,useEffect:uo,useImperativeHandle:function(i,s,c){c=c!=null?c.concat([i]):null,On(4194308,4,Za.bind(null,s,i),c)},useLayoutEffect:function(i,s){return On(4194308,4,i,s)},useInsertionEffect:function(i,s){On(4,2,i,s)},useMemo:function(i,s){var c=P();s=s===void 0?null:s;var f=i();if(es){fe(!0);try{i()}finally{fe(!1)}}return c.memoizedState=[f,s],f},useReducer:function(i,s,c){var f=P();if(c!==void 0){var x=c(s);if(es){fe(!0);try{c(s)}finally{fe(!1)}}}else x=s;return f.memoizedState=f.baseState=x,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:x},f.queue=i,i=i.dispatch=cr.bind(null,Ut,i),[f.memoizedState,i]},useRef:function(i){var s=P();return i={current:i},s.memoizedState=i},useState:function(i){i=Ee(i);var s=i.queue,c=ns.bind(null,Ut,s);return s.dispatch=c,[i.memoizedState,c]},useDebugValue:Cr,useDeferredValue:function(i,s){var c=P();return mn(c,i,s)},useTransition:function(){var i=Ee(!1);return i=Oi.bind(null,Ut,i.queue,!0,!1),P().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,s,c){var f=Ut,x=P();if(Jt){if(c===void 0)throw Error(H(407));c=c()}else{if(c=s(),Hi===null)throw Error(H(349));(oi&127)!==0||te(f,s,c)}x.memoizedState=c;var S={value:c,getSnapshot:s};return x.queue=S,uo(Ce.bind(null,f,S,i),[i]),f.flags|=2048,Si(9,{destroy:void 0},de.bind(null,f,S,c,s),null),c},useId:function(){var i=P(),s=Hi.identifierPrefix;if(Jt){var c=or,f=_a;c=(f&~(1<<32-xe(f)-1)).toString(32)+c,s="_"+s+"R_"+c,c=xl++,0<c&&(s+="H"+c.toString(32)),s+="_"}else c=r++,s="_"+s+"r_"+c.toString(32)+"_";return i.memoizedState=s},useHostTransitionStatus:_c,useFormState:Vi,useActionState:Vi,useOptimistic:function(i){var s=P();s.memoizedState=s.baseState=i;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=c,s=yc.bind(null,Ut,!0,c),c.dispatch=s,[i,s]},useMemoCache:Y,useCacheRefresh:function(){return P().memoizedState=is.bind(null,Ut)},useEffectEvent:function(i){var s=P(),c={impl:i};return s.memoizedState=c,function(){if((bi&2)!==0)throw Error(H(440));return c.impl.apply(void 0,arguments)}}},Zh={readContext:ta,use:X,useCallback:zs,useContext:ta,useEffect:ts,useImperativeHandle:As,useInsertionEffect:Es,useLayoutEffect:ho,useMemo:xn,useReducer:ee,useRef:Gt,useState:function(){return ee(Q)},useDebugValue:Cr,useDeferredValue:function(i,s){var c=B();return va(c,di.memoizedState,i,s)},useTransition:function(){var i=ee(Q)[0],s=B().memoizedState;return[typeof i=="boolean"?i:$(i),s]},useSyncExternalStore:ue,useId:wl,useHostTransitionStatus:_c,useFormState:Bi,useActionState:Bi,useOptimistic:function(i,s){var c=B();return We(c,di,i,s)},useMemoCache:Y,useCacheRefresh:Ga};Zh.useEffectEvent=bl;var Sl={readContext:ta,use:X,useCallback:zs,useContext:ta,useEffect:ts,useImperativeHandle:As,useInsertionEffect:Es,useLayoutEffect:ho,useMemo:xn,useReducer:se,useRef:Gt,useState:function(){return se(Q)},useDebugValue:Cr,useDeferredValue:function(i,s){var c=B();return di===null?mn(c,i,s):va(c,di.memoizedState,i,s)},useTransition:function(){var i=se(Q)[0],s=B().memoizedState;return[typeof i=="boolean"?i:$(i),s]},useSyncExternalStore:ue,useId:wl,useHostTransitionStatus:_c,useFormState:xi,useActionState:xi,useOptimistic:function(i,s){var c=B();return di!==null?We(c,di,i,s):(c.baseState=i,[i,c.queue.dispatch])},useMemoCache:Y,useCacheRefresh:Ga};Sl.useEffectEvent=bl;function jo(i,s,c,f){s=i.memoizedState,c=c(f,s),c=c==null?s:Ye({},s,c),i.memoizedState=c,i.lanes===0&&(i.updateQueue.baseState=c)}var Gh={enqueueSetState:function(i,s,c){i=i._reactInternals;var f=fr(),x=Sr(f);x.payload=s,c!=null&&(x.callback=c),s=Mr(i,x,f),s!==null&&(pr(s,i,f),Oo(s,i,f))},enqueueReplaceState:function(i,s,c){i=i._reactInternals;var f=fr(),x=Sr(f);x.tag=1,x.payload=s,c!=null&&(x.callback=c),s=Mr(i,x,f),s!==null&&(pr(s,i,f),Oo(s,i,f))},enqueueForceUpdate:function(i,s){i=i._reactInternals;var c=fr(),f=Sr(c);f.tag=2,s!=null&&(f.callback=s),s=Mr(i,f,c),s!==null&&(pr(s,i,c),Oo(s,i,c))}};function jf(i,s,c,f,x,S,R){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(f,S,R):s.prototype&&s.prototype.isPureReactComponent?!Ya(c,f)||!Ya(x,S):!0}function qh(i,s,c,f){i=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(c,f),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(c,f),s.state!==i&&Gh.enqueueReplaceState(s,s.state,null)}function Ml(i,s){var c=s;if("ref"in s){c={};for(var f in s)f!=="ref"&&(c[f]=s[f])}if(i=i.defaultProps){c===s&&(c=Ye({},c));for(var x in i)c[x]===void 0&&(c[x]=i[x])}return c}function $u(i){Po(i)}function Bd(i){console.error(i)}function Nf(i){Po(i)}function Wc(i,s){try{var c=i.onUncaughtError;c(s.value,{componentStack:s.stack})}catch(f){setTimeout(function(){throw f})}}function Vf(i,s,c){try{var f=i.onCaughtError;f(c.value,{componentStack:c.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(x){setTimeout(function(){throw x})}}function Xu(i,s,c){return c=Sr(c),c.tag=3,c.payload={element:null},c.callback=function(){Wc(i,s)},c}function Od(i){return i=Sr(i),i.tag=3,i}function Fd(i,s,c,f){var x=c.type.getDerivedStateFromError;if(typeof x=="function"){var S=f.value;i.payload=function(){return x(S)},i.callback=function(){Vf(s,c,f)}}var R=c.stateNode;R!==null&&typeof R.componentDidCatch=="function"&&(i.callback=function(){Vf(s,c,f),typeof x!="function"&&($o===null?$o=new Set([this]):$o.add(this));var Z=f.stack;this.componentDidCatch(f.value,{componentStack:Z!==null?Z:""})})}function Jc(i,s,c,f,x){if(c.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(s=c.alternate,s!==null&&Gn(s,c,x,!0),c=Na.current,c!==null){switch(c.tag){case 31:case 13:return pn===null?ru():c.alternate===null&&Fn===0&&(Fn=3),c.flags&=-257,c.flags|=65536,c.lanes=x,f===Ms?c.flags|=16384:(s=c.updateQueue,s===null?c.updateQueue=new Set([f]):s.add(f),hf(i,f,x)),!1;case 22:return c.flags|=65536,f===Ms?c.flags|=16384:(s=c.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([f])},c.updateQueue=s):(c=s.retryQueue,c===null?s.retryQueue=new Set([f]):c.add(f)),hf(i,f,x)),!1}throw Error(H(435,c.tag))}return hf(i,f,x),ru(),!1}if(Jt)return s=Na.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=x,f!==ys&&(i=Error(H(422),{cause:f}),xs(Oa(i,c)))):(f!==ys&&(s=Error(H(423),{cause:f}),xs(Oa(s,c))),i=i.current.alternate,i.flags|=65536,x&=-x,i.lanes|=x,f=Oa(f,c),x=Xu(i.stateNode,f,x),pc(i,x),Fn!==4&&(Fn=2)),!1;var S=Error(H(520),{cause:f});if(S=Oa(S,c),uh===null?uh=[S]:uh.push(S),Fn!==4&&(Fn=2),s===null)return!0;f=Oa(f,c),c=s;do{switch(c.tag){case 3:return c.flags|=65536,i=x&-x,c.lanes|=i,i=Xu(c.stateNode,f,i),pc(c,i),!1;case 1:if(s=c.type,S=c.stateNode,(c.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&($o===null||!$o.has(S))))return c.flags|=65536,x&=-x,c.lanes|=x,x=Od(x),Fd(x,i,c,f),pc(c,x),!1}c=c.return}while(c!==null);return!1}var Ud=Error(H(461)),un=!1;function na(i,s,c,f){s.child=i===null?fc(s,null,c,f):so(s,i.child,c,f)}function Yu(i,s,c,f,x){c=c.render;var S=s.ref;if("ref"in f){var R={};for(var Z in f)Z!=="ref"&&(R[Z]=f[Z])}else R=f;return Ts(s),f=g(i,s,c,R,S,x),Z=E(),i!==null&&!un?(A(i,s,x),No(i,s,x)):(Jt&&Z&&sc(s),s.flags|=1,na(i,s,f,x),s.child)}function Zf(i,s,c,f,x){if(i===null){var S=c.type;return typeof S=="function"&&!Gr(S)&&S.defaultProps===void 0&&c.compare===null?(s.tag=15,s.type=S,Gf(i,s,S,f,x)):(i=ic(c.type,null,f,s,s.mode,x),i.ref=s.ref,i.return=s,s.child=i)}if(S=i.child,!Yh(i,x)){var R=S.memoizedProps;if(c=c.compare,c=c!==null?c:Ya,c(R,f)&&i.ref===s.ref)return No(i,s,x)}return s.flags|=1,i=qr(S,f),i.ref=s.ref,i.return=s,s.child=i}function Gf(i,s,c,f,x){if(i!==null){var S=i.memoizedProps;if(Ya(S,f)&&i.ref===s.ref)if(un=!1,s.pendingProps=f=S,Yh(i,x))(i.flags&131072)!==0&&(un=!0);else return s.lanes=i.lanes,No(i,s,x)}return Vd(i,s,c,f,x)}function qf(i,s,c,f){var x=f.children,S=i!==null?i.memoizedState:null;if(i===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.mode==="hidden"){if((s.flags&128)!==0){if(S=S!==null?S.baseLanes|c:c,i!==null){for(f=s.child=i.child,x=0;f!==null;)x=x|f.lanes|f.childLanes,f=f.sibling;f=x&~S}else f=0,s.child=null;return jd(i,s,S,c,f)}if((c&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},i!==null&&st(s,S!==null?S.cachePool:null),S!==null?qu(s,S):yl(),Li(s);else return f=s.lanes=536870912,jd(i,s,S!==null?S.baseLanes|c:c,c,f)}else S!==null?(st(s,S.cachePool),qu(s,S),vi(),s.memoizedState=null):(i!==null&&st(s,null),yl(),vi());return na(i,s,x,c),s.child}function Ku(i,s){return i!==null&&i.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function jd(i,s,c,f,x){var S=Ua();return S=S===null?null:{parent:cn._currentValue,pool:S},s.memoizedState={baseLanes:c,cachePool:S},i!==null&&st(s,null),yl(),Li(s),i!==null&&Gn(i,s,f,!0),s.childLanes=x,null}function eu(i,s){return s=Ju({mode:s.mode,children:s.children},i.mode),s.ref=i.ref,i.child=s,s.return=i,s}function Nd(i,s,c){return so(s,i.child,null,c),i=eu(s,s.pendingProps),i.flags|=2,ya(s),s.memoizedState=null,i}function Hf(i,s,c){var f=s.pendingProps,x=(s.flags&128)!==0;if(s.flags&=-129,i===null){if(Jt){if(f.mode==="hidden")return i=eu(s,f),s.lanes=536870912,Ku(null,i);if(lo(s),(i=Ri)?(i=Sp(i,ei),i=i!==null&&i.data==="&"?i:null,i!==null&&(s.memoizedState={dehydrated:i,treeContext:$r!==null?{id:_a,overflow:or}:null,retryLane:536870912,hydrationErrors:null},c=ac(i),c.return=s,s.child=c,Ln=s,Ri=null)):i=null,i===null)throw kn(s);return s.lanes=536870912,null}return eu(s,f)}var S=i.memoizedState;if(S!==null){var R=S.dehydrated;if(lo(s),x)if(s.flags&256)s.flags&=-257,s=Nd(i,s,c);else if(s.memoizedState!==null)s.child=i.child,s.flags|=128,s=null;else throw Error(H(558));else if(un||Gn(i,s,c,!1),x=(c&i.childLanes)!==0,un||x){if(f=Hi,f!==null&&(R=fn(f,c),R!==0&&R!==S.retryLane))throw S.retryLane=R,eo(i,R),pr(f,i,R),Ud;ru(),s=Nd(i,s,c)}else i=S.treeContext,Ri=Ar(R.nextSibling),Ln=s,Jt=!0,Xr=null,ei=!1,i!==null&&ju(s,i),s=eu(s,f),s.flags|=4096;return s}return i=qr(i.child,{mode:f.mode,children:f.children}),i.ref=s.ref,s.child=i,i.return=s,i}function Hh(i,s){var c=s.ref;if(c===null)i!==null&&i.ref!==null&&(s.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(H(284));(i===null||i.ref!==c)&&(s.flags|=4194816)}}function Vd(i,s,c,f,x){return Ts(s),c=g(i,s,c,f,void 0,x),f=E(),i!==null&&!un?(A(i,s,x),No(i,s,x)):(Jt&&f&&sc(s),s.flags|=1,na(i,s,c,x),s.child)}function Zd(i,s,c,f,x,S){return Ts(s),s.updateQueue=null,c=w(s,f,c,x),y(i),f=E(),i!==null&&!un?(A(i,s,S),No(i,s,S)):(Jt&&f&&sc(s),s.flags|=1,na(i,s,c,S),s.child)}function Gd(i,s,c,f,x){if(Ts(s),s.stateNode===null){var S=Zr,R=c.contextType;typeof R=="object"&&R!==null&&(S=ta(R)),S=new c(f,S),s.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,S.updater=Gh,s.stateNode=S,S._reactInternals=s,S=s.stateNode,S.props=f,S.state=s.memoizedState,S.refs={},ui(s),R=c.contextType,S.context=typeof R=="object"&&R!==null?ta(R):Zr,S.state=s.memoizedState,R=c.getDerivedStateFromProps,typeof R=="function"&&(jo(s,c,R,f),S.state=s.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof S.getSnapshotBeforeUpdate=="function"||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(R=S.state,typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount(),R!==S.state&&Gh.enqueueReplaceState(S,S.state,null),ja(s,f,S,x),mc(),S.state=s.memoizedState),typeof S.componentDidMount=="function"&&(s.flags|=4194308),f=!0}else if(i===null){S=s.stateNode;var Z=s.memoizedProps,ce=Ml(c,Z);S.props=ce;var Pe=S.context,je=c.contextType;R=Zr,typeof je=="object"&&je!==null&&(R=ta(je));var He=c.getDerivedStateFromProps;je=typeof He=="function"||typeof S.getSnapshotBeforeUpdate=="function",Z=s.pendingProps!==Z,je||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(Z||Pe!==R)&&qh(s,S,f,R),Ma=!1;var De=s.memoizedState;S.state=De,ja(s,f,S,x),mc(),Pe=s.memoizedState,Z||De!==Pe||Ma?(typeof He=="function"&&(jo(s,c,He,f),Pe=s.memoizedState),(ce=Ma||jf(s,c,ce,f,De,Pe,R))?(je||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(s.flags|=4194308)):(typeof S.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=f,s.memoizedState=Pe),S.props=f,S.state=Pe,S.context=R,f=ce):(typeof S.componentDidMount=="function"&&(s.flags|=4194308),f=!1)}else{S=s.stateNode,Gu(i,s),R=s.memoizedProps,je=Ml(c,R),S.props=je,He=s.pendingProps,De=S.context,Pe=c.contextType,ce=Zr,typeof Pe=="object"&&Pe!==null&&(ce=ta(Pe)),Z=c.getDerivedStateFromProps,(Pe=typeof Z=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(R!==He||De!==ce)&&qh(s,S,f,ce),Ma=!1,De=s.memoizedState,S.state=De,ja(s,f,S,x),mc();var ke=s.memoizedState;R!==He||De!==ke||Ma||i!==null&&i.dependencies!==null&&ws(i.dependencies)?(typeof Z=="function"&&(jo(s,c,Z,f),ke=s.memoizedState),(je=Ma||jf(s,c,je,f,De,ke,ce)||i!==null&&i.dependencies!==null&&ws(i.dependencies))?(Pe||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(f,ke,ce),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(f,ke,ce)),typeof S.componentDidUpdate=="function"&&(s.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof S.componentDidUpdate!="function"||R===i.memoizedProps&&De===i.memoizedState||(s.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||R===i.memoizedProps&&De===i.memoizedState||(s.flags|=1024),s.memoizedProps=f,s.memoizedState=ke),S.props=f,S.state=ke,S.context=ce,f=je):(typeof S.componentDidUpdate!="function"||R===i.memoizedProps&&De===i.memoizedState||(s.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||R===i.memoizedProps&&De===i.memoizedState||(s.flags|=1024),f=!1)}return S=f,Hh(i,s),f=(s.flags&128)!==0,S||f?(S=s.stateNode,c=f&&typeof c.getDerivedStateFromError!="function"?null:S.render(),s.flags|=1,i!==null&&f?(s.child=so(s,i.child,null,x),s.child=so(s,null,c,x)):na(i,s,c,x),s.memoizedState=S.state,i=s.child):i=No(i,s,x),i}function $f(i,s,c,f){return Qa(),s.flags|=256,na(i,s,c,f),s.child}var Qu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function $h(i){return{baseLanes:i,cachePool:Gc()}}function Wu(i,s,c){return i=i!==null?i.childLanes&~c:0,s&&(i|=dr),i}function tu(i,s,c){var f=s.pendingProps,x=!1,S=(s.flags&128)!==0,R;if((R=S)||(R=i!==null&&i.memoizedState===null?!1:(Yi.current&2)!==0),R&&(x=!0,s.flags&=-129),R=(s.flags&32)!==0,s.flags&=-33,i===null){if(Jt){if(x?Va(s):vi(),(i=Ri)?(i=Sp(i,ei),i=i!==null&&i.data!=="&"?i:null,i!==null&&(s.memoizedState={dehydrated:i,treeContext:$r!==null?{id:_a,overflow:or}:null,retryLane:536870912,hydrationErrors:null},c=ac(i),c.return=s,s.child=c,Ln=s,Ri=null)):i=null,i===null)throw kn(s);return ra(i)?s.lanes=32:s.lanes=536870912,null}var Z=f.children;return f=f.fallback,x?(vi(),x=s.mode,Z=Ju({mode:"hidden",children:Z},x),f=Do(f,x,c,null),Z.return=s,f.return=s,Z.sibling=f,s.child=Z,f=s.child,f.memoizedState=$h(c),f.childLanes=Wu(i,R,c),s.memoizedState=Qu,Ku(null,f)):(Va(s),Ea(s,Z))}var ce=i.memoizedState;if(ce!==null&&(Z=ce.dehydrated,Z!==null)){if(S)s.flags&256?(Va(s),s.flags&=-257,s=eh(i,s,c)):s.memoizedState!==null?(vi(),s.child=i.child,s.flags|=128,s=null):(vi(),Z=f.fallback,x=s.mode,f=Ju({mode:"visible",children:f.children},x),Z=Do(Z,x,c,null),Z.flags|=2,f.return=s,Z.return=s,f.sibling=Z,s.child=f,so(s,i.child,null,c),f=s.child,f.memoizedState=$h(c),f.childLanes=Wu(i,R,c),s.memoizedState=Qu,s=Ku(null,f));else if(Va(s),ra(Z)){if(R=Z.nextSibling&&Z.nextSibling.dataset,R)var Pe=R.dgst;R=Pe,f=Error(H(419)),f.stack="",f.digest=R,xs({value:f,source:null,stack:null}),s=eh(i,s,c)}else if(un||Gn(i,s,c,!1),R=(c&i.childLanes)!==0,un||R){if(R=Hi,R!==null&&(f=fn(R,c),f!==0&&f!==ce.retryLane))throw ce.retryLane=f,eo(i,f),pr(R,i,f),Ud;Bl(Z)||ru(),s=eh(i,s,c)}else Bl(Z)?(s.flags|=192,s.child=i.child,s=null):(i=ce.treeContext,Ri=Ar(Z.nextSibling),Ln=s,Jt=!0,Xr=null,ei=!1,i!==null&&ju(s,i),s=Ea(s,f.children),s.flags|=4096);return s}return x?(vi(),Z=f.fallback,x=s.mode,ce=i.child,Pe=ce.sibling,f=qr(ce,{mode:"hidden",children:f.children}),f.subtreeFlags=ce.subtreeFlags&65011712,Pe!==null?Z=qr(Pe,Z):(Z=Do(Z,x,c,null),Z.flags|=2),Z.return=s,f.return=s,f.sibling=Z,s.child=f,Ku(null,f),f=s.child,Z=i.child.memoizedState,Z===null?Z=$h(c):(x=Z.cachePool,x!==null?(ce=cn._currentValue,x=x.parent!==ce?{parent:ce,pool:ce}:x):x=Gc(),Z={baseLanes:Z.baseLanes|c,cachePool:x}),f.memoizedState=Z,f.childLanes=Wu(i,R,c),s.memoizedState=Qu,Ku(i.child,f)):(Va(s),c=i.child,i=c.sibling,c=qr(c,{mode:"visible",children:f.children}),c.return=s,c.sibling=null,i!==null&&(R=s.deletions,R===null?(s.deletions=[i],s.flags|=16):R.push(i)),s.child=c,s.memoizedState=null,c)}function Ea(i,s){return s=Ju({mode:"visible",children:s},i.mode),s.return=i,i.child=s}function Ju(i,s){return i=Ba(22,i,null,s),i.lanes=0,i}function eh(i,s,c){return so(s,i.child,null,c),i=Ea(s,s.pendingProps.children),i.flags|=2,s.memoizedState=null,i}function Xf(i,s,c){i.lanes|=s;var f=i.alternate;f!==null&&(f.lanes|=s),ao(i.return,s,c)}function Xh(i,s,c,f,x,S){var R=i.memoizedState;R===null?i.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:f,tail:c,tailMode:x,treeForkCount:S}:(R.isBackwards=s,R.rendering=null,R.renderingStartTime=0,R.last=f,R.tail=c,R.tailMode=x,R.treeForkCount=S)}function Yf(i,s,c){var f=s.pendingProps,x=f.revealOrder,S=f.tail;f=f.children;var R=Yi.current,Z=(R&2)!==0;if(Z?(R=R&1|2,s.flags|=128):R&=1,at(Yi,R),na(i,s,f,c),f=Jt?_s:0,!Z&&i!==null&&(i.flags&128)!==0)e:for(i=s.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Xf(i,c,s);else if(i.tag===19)Xf(i,c,s);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}switch(x){case"forwards":for(c=s.child,x=null;c!==null;)i=c.alternate,i!==null&&Jr(i)===null&&(x=c),c=c.sibling;c=x,c===null?(x=s.child,s.child=null):(x=c.sibling,c.sibling=null),Xh(s,!1,x,c,S,f);break;case"backwards":case"unstable_legacy-backwards":for(c=null,x=s.child,s.child=null;x!==null;){if(i=x.alternate,i!==null&&Jr(i)===null){s.child=x;break}i=x.sibling,x.sibling=c,c=x,x=i}Xh(s,!0,c,null,S,f);break;case"together":Xh(s,!1,null,null,void 0,f);break;default:s.memoizedState=null}return s.child}function No(i,s,c){if(i!==null&&(s.dependencies=i.dependencies),qo|=s.lanes,(c&s.childLanes)===0)if(i!==null){if(Gn(i,s,c,!1),(c&s.childLanes)===0)return null}else return null;if(i!==null&&s.child!==i.child)throw Error(H(153));if(s.child!==null){for(i=s.child,c=qr(i,i.pendingProps),s.child=c,c.return=s;i.sibling!==null;)i=i.sibling,c=c.sibling=qr(i,i.pendingProps),c.return=s;c.sibling=null}return s.child}function Yh(i,s){return(i.lanes&s)!==0?!0:(i=i.dependencies,!!(i!==null&&ws(i)))}function Ip(i,s,c){switch(s.tag){case 3:wi(s,s.stateNode.containerInfo),bs(s,cn,i.memoizedState.cache),Qa();break;case 27:case 5:tr(s);break;case 4:wi(s,s.stateNode.containerInfo);break;case 10:bs(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,lo(s),null;break;case 13:var f=s.memoizedState;if(f!==null)return f.dehydrated!==null?(Va(s),s.flags|=128,null):(c&s.child.childLanes)!==0?tu(i,s,c):(Va(s),i=No(i,s,c),i!==null?i.sibling:null);Va(s);break;case 19:var x=(i.flags&128)!==0;if(f=(c&s.childLanes)!==0,f||(Gn(i,s,c,!1),f=(c&s.childLanes)!==0),x){if(f)return Yf(i,s,c);s.flags|=128}if(x=s.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),at(Yi,Yi.current),f)break;return null;case 22:return s.lanes=0,qf(i,s,c,s.pendingProps);case 24:bs(s,cn,i.memoizedState.cache)}return No(i,s,c)}function Kh(i,s,c){if(i!==null)if(i.memoizedProps!==s.pendingProps)un=!0;else{if(!Yh(i,c)&&(s.flags&128)===0)return un=!1,Ip(i,s,c);un=(i.flags&131072)!==0}else un=!1,Jt&&(s.flags&1048576)!==0&&rc(s,_s,s.index);switch(s.lanes=0,s.tag){case 16:e:{var f=s.pendingProps;if(i=Cs(s.elementType),s.type=i,typeof i=="function")Gr(i)?(f=Ml(i,f),s.tag=1,s=Gd(null,s,i,f,c)):(s.tag=0,s=Vd(null,s,i,f,c));else{if(i!=null){var x=i.$$typeof;if(x===Ci){s.tag=11,s=Yu(null,s,i,f,c);break e}else if(x===Nt){s.tag=14,s=Zf(null,s,i,f,c);break e}}throw s=ba(i)||i,Error(H(306,s,""))}}return s;case 0:return Vd(i,s,s.type,s.pendingProps,c);case 1:return f=s.type,x=Ml(f,s.pendingProps),Gd(i,s,f,x,c);case 3:e:{if(wi(s,s.stateNode.containerInfo),i===null)throw Error(H(387));f=s.pendingProps;var S=s.memoizedState;x=S.element,Gu(i,s),ja(s,f,null,c);var R=s.memoizedState;if(f=R.cache,bs(s,cn,f),f!==S.cache&&Wa(s,[cn],c,!0),mc(),f=R.element,S.isDehydrated)if(S={element:f,isDehydrated:!1,cache:R.cache},s.updateQueue.baseState=S,s.memoizedState=S,s.flags&256){s=$f(i,s,f,c);break e}else if(f!==x){x=Oa(Error(H(424)),s),xs(x),s=$f(i,s,f,c);break e}else{switch(i=s.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(Ri=Ar(i.firstChild),Ln=s,Jt=!0,Xr=null,ei=!0,c=fc(s,null,f,c),s.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(Qa(),f===x){s=No(i,s,c);break e}na(i,s,f,c)}s=s.child}return s;case 26:return Hh(i,s),i===null?(c=a(s.type,null,s.pendingProps,null))?s.memoizedState=c:Jt||(c=s.type,i=s.pendingProps,f=xh(Ct.current).createElement(c),f[qe]=s,f[xt]=i,bn(f,c,i),_n(f),s.stateNode=f):s.memoizedState=a(s.type,i.memoizedProps,s.pendingProps,i.memoizedState),null;case 27:return tr(s),i===null&&Jt&&(f=s.stateNode=Ef(s.type,s.pendingProps,Ct.current),Ln=s,ei=!0,x=Ri,Yo(s.type)?(Td=x,Ri=Ar(f.firstChild)):Ri=x),na(i,s,s.pendingProps.children,c),Hh(i,s),i===null&&(s.flags|=4194304),s.child;case 5:return i===null&&Jt&&((x=f=Ri)&&(f=Gp(f,s.type,s.pendingProps,ei),f!==null?(s.stateNode=f,Ln=s,Ri=Ar(f.firstChild),ei=!1,x=!0):x=!1),x||kn(s)),tr(s),x=s.type,S=s.pendingProps,R=i!==null?i.memoizedProps:null,f=S.children,xd(x,S)?f=null:R!==null&&xd(x,R)&&(s.flags|=32),s.memoizedState!==null&&(x=g(i,s,T,null,null,c),Ze._currentValue=x),Hh(i,s),na(i,s,f,c),s.child;case 6:return i===null&&Jt&&((i=c=Ri)&&(c=qp(c,s.pendingProps,ei),c!==null?(s.stateNode=c,Ln=s,Ri=null,i=!0):i=!1),i||kn(s)),null;case 13:return tu(i,s,c);case 4:return wi(s,s.stateNode.containerInfo),f=s.pendingProps,i===null?s.child=so(s,null,f,c):na(i,s,f,c),s.child;case 11:return Yu(i,s,s.type,s.pendingProps,c);case 7:return na(i,s,s.pendingProps,c),s.child;case 8:return na(i,s,s.pendingProps.children,c),s.child;case 12:return na(i,s,s.pendingProps.children,c),s.child;case 10:return f=s.pendingProps,bs(s,s.type,f.value),na(i,s,f.children,c),s.child;case 9:return x=s.type._context,f=s.pendingProps.children,Ts(s),x=ta(x),f=f(x),s.flags|=1,na(i,s,f,c),s.child;case 14:return Zf(i,s,s.type,s.pendingProps,c);case 15:return Gf(i,s,s.type,s.pendingProps,c);case 19:return Yf(i,s,c);case 31:return Hf(i,s,c);case 22:return qf(i,s,c,s.pendingProps);case 24:return Ts(s),f=ta(cn),i===null?(x=Ua(),x===null&&(x=Hi,S=Fa(),x.pooledCache=S,S.refCount++,S!==null&&(x.pooledCacheLanes|=c),x=S),s.memoizedState={parent:f,cache:x},ui(s),bs(s,cn,x)):((i.lanes&c)!==0&&(Gu(i,s),ja(s,null,null,c),mc()),x=i.memoizedState,S=s.memoizedState,x.parent!==f?(x={parent:f,cache:f},s.memoizedState=x,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=x),bs(s,cn,f)):(f=S.cache,bs(s,cn,f),f!==x.cache&&Wa(s,[cn],c,!0))),na(i,s,s.pendingProps.children,c),s.child;case 29:throw s.pendingProps}throw Error(H(156,s.tag))}function po(i){i.flags|=4}function Qh(i,s,c,f,x){if((s=(i.mode&32)!==0)&&(s=!1),s){if(i.flags|=16777216,(x&335544128)===x)if(i.stateNode.complete)i.flags|=8192;else if(cp())i.flags|=8192;else throw ro=Ms,hc}else i.flags&=-16777217}function Kf(i,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!V(s))if(cp())i.flags|=8192;else throw ro=Ms,hc}function Wh(i,s){s!==null&&(i.flags|=4),i.flags&16384&&(s=i.tag!==22?Pi():536870912,i.lanes|=s,bc|=s)}function th(i,s){if(!Jt)switch(i.tailMode){case"hidden":s=i.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?i.tail=null:c.sibling=null;break;case"collapsed":c=i.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?s||i.tail===null?i.tail=null:i.tail.sibling=null:f.sibling=null}}function Gi(i){var s=i.alternate!==null&&i.alternate.child===i.child,c=0,f=0;if(s)for(var x=i.child;x!==null;)c|=x.lanes|x.childLanes,f|=x.subtreeFlags&65011712,f|=x.flags&65011712,x.return=i,x=x.sibling;else for(x=i.child;x!==null;)c|=x.lanes|x.childLanes,f|=x.subtreeFlags,f|=x.flags,x.return=i,x=x.sibling;return i.subtreeFlags|=f,i.childLanes=c,s}function qd(i,s,c){var f=s.pendingProps;switch(jc(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Gi(s),null;case 1:return Gi(s),null;case 3:return c=s.stateNode,f=null,i!==null&&(f=i.memoizedState.cache),s.memoizedState.cache!==f&&(s.flags|=2048),Kr(cn),si(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(i===null||i.child===null)&&(io(s)?po(s):i===null||i.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,vs())),Gi(s),null;case 26:var x=s.type,S=s.memoizedState;return i===null?(po(s),S!==null?(Gi(s),Kf(s,S)):(Gi(s),Qh(s,x,null,f,c))):S?S!==i.memoizedState?(po(s),Gi(s),Kf(s,S)):(Gi(s),s.flags&=-16777217):(i=i.memoizedProps,i!==f&&po(s),Gi(s),Qh(s,x,i,f,c)),null;case 27:if(ir(s),c=Ct.current,x=s.type,i!==null&&s.stateNode!=null)i.memoizedProps!==f&&po(s);else{if(!f){if(s.stateNode===null)throw Error(H(166));return Gi(s),null}i=ut.current,io(s)?oc(s):(i=Ef(x,f,c),s.stateNode=i,po(s))}return Gi(s),null;case 5:if(ir(s),x=s.type,i!==null&&s.stateNode!=null)i.memoizedProps!==f&&po(s);else{if(!f){if(s.stateNode===null)throw Error(H(166));return Gi(s),null}if(S=ut.current,io(s))oc(s);else{var R=xh(Ct.current);switch(S){case 1:S=R.createElementNS("http://www.w3.org/2000/svg",x);break;case 2:S=R.createElementNS("http://www.w3.org/1998/Math/MathML",x);break;default:switch(x){case"svg":S=R.createElementNS("http://www.w3.org/2000/svg",x);break;case"math":S=R.createElementNS("http://www.w3.org/1998/Math/MathML",x);break;case"script":S=R.createElement("div"),S.innerHTML="<script><\/script>",S=S.removeChild(S.firstChild);break;case"select":S=typeof f.is=="string"?R.createElement("select",{is:f.is}):R.createElement("select"),f.multiple?S.multiple=!0:f.size&&(S.size=f.size);break;default:S=typeof f.is=="string"?R.createElement(x,{is:f.is}):R.createElement(x)}}S[qe]=s,S[xt]=f;e:for(R=s.child;R!==null;){if(R.tag===5||R.tag===6)S.appendChild(R.stateNode);else if(R.tag!==4&&R.tag!==27&&R.child!==null){R.child.return=R,R=R.child;continue}if(R===s)break e;for(;R.sibling===null;){if(R.return===null||R.return===s)break e;R=R.return}R.sibling.return=R.return,R=R.sibling}s.stateNode=S;e:switch(bn(S,x,f),x){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&po(s)}}return Gi(s),Qh(s,s.type,i===null?null:i.memoizedProps,s.pendingProps,c),null;case 6:if(i&&s.stateNode!=null)i.memoizedProps!==f&&po(s);else{if(typeof f!="string"&&s.stateNode===null)throw Error(H(166));if(i=Ct.current,io(s)){if(i=s.stateNode,c=s.memoizedProps,f=null,x=Ln,x!==null)switch(x.tag){case 27:case 5:f=x.memoizedProps}i[qe]=s,i=!!(i.nodeValue===c||f!==null&&f.suppressHydrationWarning===!0||mr(i.nodeValue,c)),i||kn(s,!0)}else i=xh(i).createTextNode(f),i[qe]=s,s.stateNode=i}return Gi(s),null;case 31:if(c=s.memoizedState,i===null||i.memoizedState!==null){if(f=io(s),c!==null){if(i===null){if(!f)throw Error(H(318));if(i=s.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(H(557));i[qe]=s}else Qa(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Gi(s),i=!1}else c=vs(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=c),i=!0;if(!i)return s.flags&256?(ya(s),s):(ya(s),null);if((s.flags&128)!==0)throw Error(H(558))}return Gi(s),null;case 13:if(f=s.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(x=io(s),f!==null&&f.dehydrated!==null){if(i===null){if(!x)throw Error(H(318));if(x=s.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(H(317));x[qe]=s}else Qa(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Gi(s),x=!1}else x=vs(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=x),x=!0;if(!x)return s.flags&256?(ya(s),s):(ya(s),null)}return ya(s),(s.flags&128)!==0?(s.lanes=c,s):(c=f!==null,i=i!==null&&i.memoizedState!==null,c&&(f=s.child,x=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(x=f.alternate.memoizedState.cachePool.pool),S=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(S=f.memoizedState.cachePool.pool),S!==x&&(f.flags|=2048)),c!==i&&c&&(s.child.flags|=8192),Wh(s,s.updateQueue),Gi(s),null);case 4:return si(),i===null&&_d(s.stateNode.containerInfo),Gi(s),null;case 10:return Kr(s.type),Gi(s),null;case 19:if(Ne(Yi),f=s.memoizedState,f===null)return Gi(s),null;if(x=(s.flags&128)!==0,S=f.rendering,S===null)if(x)th(f,!1);else{if(Fn!==0||i!==null&&(i.flags&128)!==0)for(i=s.child;i!==null;){if(S=Jr(i),S!==null){for(s.flags|=128,th(f,!1),i=S.updateQueue,s.updateQueue=i,Wh(s,i),s.subtreeFlags=0,i=c,c=s.child;c!==null;)Uh(c,i),c=c.sibling;return at(Yi,Yi.current&1|2),Jt&&Ka(s,f.treeForkCount),s.child}i=i.sibling}f.tail!==null&&Un()>sd&&(s.flags|=128,x=!0,th(f,!1),s.lanes=4194304)}else{if(!x)if(i=Jr(S),i!==null){if(s.flags|=128,x=!0,i=i.updateQueue,s.updateQueue=i,Wh(s,i),th(f,!0),f.tail===null&&f.tailMode==="hidden"&&!S.alternate&&!Jt)return Gi(s),null}else 2*Un()-f.renderingStartTime>sd&&c!==536870912&&(s.flags|=128,x=!0,th(f,!1),s.lanes=4194304);f.isBackwards?(S.sibling=s.child,s.child=S):(i=f.last,i!==null?i.sibling=S:s.child=S,f.last=S)}return f.tail!==null?(i=f.tail,f.rendering=i,f.tail=i.sibling,f.renderingStartTime=Un(),i.sibling=null,c=Yi.current,at(Yi,x?c&1|2:c&1),Jt&&Ka(s,f.treeForkCount),i):(Gi(s),null);case 22:case 23:return ya(s),ia(),f=s.memoizedState!==null,i!==null?i.memoizedState!==null!==f&&(s.flags|=8192):f&&(s.flags|=8192),f?(c&536870912)!==0&&(s.flags&128)===0&&(Gi(s),s.subtreeFlags&6&&(s.flags|=8192)):Gi(s),c=s.updateQueue,c!==null&&Wh(s,c.retryQueue),c=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),f=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(f=s.memoizedState.cachePool.pool),f!==c&&(s.flags|=2048),i!==null&&Ne(er),null;case 24:return c=null,i!==null&&(c=i.memoizedState.cache),s.memoizedState.cache!==c&&(s.flags|=2048),Kr(cn),Gi(s),null;case 25:return null;case 30:return null}throw Error(H(156,s.tag))}function Qf(i,s){switch(jc(s),s.tag){case 1:return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 3:return Kr(cn),si(),i=s.flags,(i&65536)!==0&&(i&128)===0?(s.flags=i&-65537|128,s):null;case 26:case 27:case 5:return ir(s),null;case 31:if(s.memoizedState!==null){if(ya(s),s.alternate===null)throw Error(H(340));Qa()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 13:if(ya(s),i=s.memoizedState,i!==null&&i.dehydrated!==null){if(s.alternate===null)throw Error(H(340));Qa()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 19:return Ne(Yi),null;case 4:return si(),null;case 10:return Kr(s.type),null;case 22:case 23:return ya(s),ia(),i!==null&&Ne(er),i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 24:return Kr(cn),null;case 25:return null;default:return null}}function Cl(i,s){switch(jc(s),s.tag){case 3:Kr(cn),si();break;case 26:case 27:case 5:ir(s);break;case 4:si();break;case 31:s.memoizedState!==null&&ya(s);break;case 13:ya(s);break;case 19:Ne(Yi);break;case 10:Kr(s.type);break;case 22:case 23:ya(s),ia(),i!==null&&Ne(er);break;case 24:Kr(cn)}}function Vo(i,s){try{var c=s.updateQueue,f=c!==null?c.lastEffect:null;if(f!==null){var x=f.next;c=x;do{if((c.tag&i)===i){f=void 0;var S=c.create,R=c.inst;f=S(),R.destroy=f}c=c.next}while(c!==x)}}catch(Z){Fi(s,s.return,Z)}}function El(i,s,c){try{var f=s.updateQueue,x=f!==null?f.lastEffect:null;if(x!==null){var S=x.next;f=S;do{if((f.tag&i)===i){var R=f.inst,Z=R.destroy;if(Z!==void 0){R.destroy=void 0,x=s;var ce=c,Pe=Z;try{Pe()}catch(je){Fi(x,ce,je)}}}f=f.next}while(f!==S)}}catch(je){Fi(s,s.return,je)}}function Wf(i){var s=i.updateQueue;if(s!==null){var c=i.stateNode;try{dt(s,c)}catch(f){Fi(i,i.return,f)}}}function Jf(i,s,c){c.props=Ml(i.type,i.memoizedProps),c.state=i.memoizedState;try{c.componentWillUnmount()}catch(f){Fi(i,s,f)}}function ih(i,s){try{var c=i.ref;if(c!==null){switch(i.tag){case 26:case 27:case 5:var f=i.stateNode;break;case 30:f=i.stateNode;break;default:f=i.stateNode}typeof c=="function"?i.refCleanup=c(f):c.current=f}}catch(x){Fi(i,s,x)}}function mo(i,s){var c=i.ref,f=i.refCleanup;if(c!==null)if(typeof f=="function")try{f()}catch(x){Fi(i,s,x)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(x){Fi(i,s,x)}else c.current=null}function ep(i){var s=i.type,c=i.memoizedProps,f=i.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":c.autoFocus&&f.focus();break e;case"img":c.src?f.src=c.src:c.srcSet&&(f.srcset=c.srcSet)}}catch(x){Fi(i,i.return,x)}}function Hd(i,s,c){try{var f=i.stateNode;vp(f,i.type,c,s),f[xt]=s}catch(x){Fi(i,i.return,x)}}function Jh(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&Yo(i.type)||i.tag===4}function $d(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||Jh(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&Yo(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function ed(i,s,c){var f=i.tag;if(f===5||f===6)i=i.stateNode,s?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(i,s):(s=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,s.appendChild(i),c=c._reactRootContainer,c!=null||s.onclick!==null||(s.onclick=rr));else if(f!==4&&(f===27&&Yo(i.type)&&(c=i.stateNode,s=null),i=i.child,i!==null))for(ed(i,s,c),i=i.sibling;i!==null;)ed(i,s,c),i=i.sibling}function Al(i,s,c){var f=i.tag;if(f===5||f===6)i=i.stateNode,s?c.insertBefore(i,s):c.appendChild(i);else if(f!==4&&(f===27&&Yo(i.type)&&(c=i.stateNode),i=i.child,i!==null))for(Al(i,s,c),i=i.sibling;i!==null;)Al(i,s,c),i=i.sibling}function tp(i){var s=i.stateNode,c=i.memoizedProps;try{for(var f=i.type,x=s.attributes;x.length;)s.removeAttributeNode(x[0]);bn(s,f,c),s[qe]=i,s[xt]=c}catch(S){Fi(i,i.return,S)}}var Mi=!1,hn=!1,td=!1,nh=typeof WeakSet=="function"?WeakSet:Set,Hn=null;function ah(i,s){if(i=i.containerInfo,vd=Et,i=ku(i),Yl(i)){if("selectionStart"in i)var c={start:i.selectionStart,end:i.selectionEnd};else e:{c=(c=i.ownerDocument)&&c.defaultView||window;var f=c.getSelection&&c.getSelection();if(f&&f.rangeCount!==0){c=f.anchorNode;var x=f.anchorOffset,S=f.focusNode;f=f.focusOffset;try{c.nodeType,S.nodeType}catch{c=null;break e}var R=0,Z=-1,ce=-1,Pe=0,je=0,He=i,De=null;t:for(;;){for(var ke;He!==c||x!==0&&He.nodeType!==3||(Z=R+x),He!==S||f!==0&&He.nodeType!==3||(ce=R+f),He.nodeType===3&&(R+=He.nodeValue.length),(ke=He.firstChild)!==null;)De=He,He=ke;for(;;){if(He===i)break t;if(De===c&&++Pe===x&&(Z=R),De===S&&++je===f&&(ce=R),(ke=He.nextSibling)!==null)break;He=De,De=He.parentNode}He=ke}c=Z===-1||ce===-1?null:{start:Z,end:ce}}else c=null}c=c||{start:0,end:0}}else c=null;for(Tf={focusedElem:i,selectionRange:c},Et=!1,Hn=s;Hn!==null;)if(s=Hn,i=s.child,(s.subtreeFlags&1028)!==0&&i!==null)i.return=s,Hn=i;else for(;Hn!==null;){switch(s=Hn,S=s.alternate,i=s.flags,s.tag){case 0:if((i&4)!==0&&(i=s.updateQueue,i=i!==null?i.events:null,i!==null))for(c=0;c<i.length;c++)x=i[c],x.ref.impl=x.nextImpl;break;case 11:case 15:break;case 1:if((i&1024)!==0&&S!==null){i=void 0,c=s,x=S.memoizedProps,S=S.memoizedState,f=c.stateNode;try{var yt=Ml(c.type,x);i=f.getSnapshotBeforeUpdate(yt,S),f.__reactInternalSnapshotBeforeUpdate=i}catch(Dt){Fi(c,c.return,Dt)}}break;case 3:if((i&1024)!==0){if(i=s.stateNode.containerInfo,c=i.nodeType,c===9)fu(i);else if(c===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":fu(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(H(163))}if(i=s.sibling,i!==null){i.return=s.return,Hn=i;break}Hn=s.return}}function Xd(i,s,c){var f=c.flags;switch(c.tag){case 0:case 11:case 15:go(i,c),f&4&&Vo(5,c);break;case 1:if(go(i,c),f&4)if(i=c.stateNode,s===null)try{i.componentDidMount()}catch(R){Fi(c,c.return,R)}else{var x=Ml(c.type,s.memoizedProps);s=s.memoizedState;try{i.componentDidUpdate(x,s,i.__reactInternalSnapshotBeforeUpdate)}catch(R){Fi(c,c.return,R)}}f&64&&Wf(c),f&512&&ih(c,c.return);break;case 3:if(go(i,c),f&64&&(i=c.updateQueue,i!==null)){if(s=null,c.child!==null)switch(c.child.tag){case 27:case 5:s=c.child.stateNode;break;case 1:s=c.child.stateNode}try{dt(i,s)}catch(R){Fi(c,c.return,R)}}break;case 27:s===null&&f&4&&tp(c);case 26:case 5:go(i,c),s===null&&f&4&&ep(c),f&512&&ih(c,c.return);break;case 12:go(i,c);break;case 31:go(i,c),f&4&&vc(i,c);break;case 13:go(i,c),f&4&&iu(i,c),f&64&&(i=c.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(c=Fp.bind(null,c),Cf(i,c))));break;case 22:if(f=c.memoizedState!==null||Mi,!f){s=s!==null&&s.memoizedState!==null||hn,x=Mi;var S=hn;Mi=f,(hn=s)&&!S?Zo(i,c,(c.subtreeFlags&8772)!==0):go(i,c),Mi=x,hn=S}break;case 30:break;default:go(i,c)}}function Yd(i){var s=i.alternate;s!==null&&(i.alternate=null,Yd(s)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(s=i.stateNode,s!==null&&Dr(s)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var qi=null,qa=!1;function ur(i,s,c){for(c=c.child;c!==null;)rh(i,s,c),c=c.sibling}function rh(i,s,c){if(oe&&typeof oe.onCommitFiberUnmount=="function")try{oe.onCommitFiberUnmount(ie,c)}catch{}switch(c.tag){case 26:hn||mo(c,s),ur(i,s,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:hn||mo(c,s);var f=qi,x=qa;Yo(c.type)&&(qi=c.stateNode,qa=!1),ur(i,s,c),pu(c.stateNode),qi=f,qa=x;break;case 5:hn||mo(c,s);case 6:if(f=qi,x=qa,qi=null,ur(i,s,c),qi=f,qa=x,qi!==null)if(qa)try{(qi.nodeType===9?qi.body:qi.nodeName==="HTML"?qi.ownerDocument.body:qi).removeChild(c.stateNode)}catch(S){Fi(c,s,S)}else try{qi.removeChild(c.stateNode)}catch(S){Fi(c,s,S)}break;case 18:qi!==null&&(qa?(i=qi,bh(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,c.stateNode),gu(i)):bh(qi,c.stateNode));break;case 4:f=qi,x=qa,qi=c.stateNode.containerInfo,qa=!0,ur(i,s,c),qi=f,qa=x;break;case 0:case 11:case 14:case 15:El(2,c,s),hn||El(4,c,s),ur(i,s,c);break;case 1:hn||(mo(c,s),f=c.stateNode,typeof f.componentWillUnmount=="function"&&Jf(c,s,f)),ur(i,s,c);break;case 21:ur(i,s,c);break;case 22:hn=(f=hn)||c.memoizedState!==null,ur(i,s,c),hn=f;break;default:ur(i,s,c)}}function vc(i,s){if(s.memoizedState===null&&(i=s.alternate,i!==null&&(i=i.memoizedState,i!==null))){i=i.dehydrated;try{gu(i)}catch(c){Fi(s,s.return,c)}}}function iu(i,s){if(s.memoizedState===null&&(i=s.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{gu(i)}catch(c){Fi(s,s.return,c)}}function Rp(i){switch(i.tag){case 31:case 13:case 19:var s=i.stateNode;return s===null&&(s=i.stateNode=new nh),s;case 22:return i=i.stateNode,s=i._retryCache,s===null&&(s=i._retryCache=new nh),s;default:throw Error(H(435,i.tag))}}function sh(i,s){var c=Rp(i);s.forEach(function(f){if(!c.has(f)){c.add(f);var x=pp.bind(null,i,f);f.then(x,x)}})}function aa(i,s){var c=s.deletions;if(c!==null)for(var f=0;f<c.length;f++){var x=c[f],S=i,R=s,Z=R;e:for(;Z!==null;){switch(Z.tag){case 27:if(Yo(Z.type)){qi=Z.stateNode,qa=!1;break e}break;case 5:qi=Z.stateNode,qa=!1;break e;case 3:case 4:qi=Z.stateNode.containerInfo,qa=!0;break e}Z=Z.return}if(qi===null)throw Error(H(160));rh(S,R,x),qi=null,qa=!1,S=x.alternate,S!==null&&(S.return=null),x.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)Kd(s,i),s=s.sibling}var Ps=null;function Kd(i,s){var c=i.alternate,f=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:aa(s,i),xa(i),f&4&&(El(3,i,i.return),Vo(3,i),El(5,i,i.return));break;case 1:aa(s,i),xa(i),f&512&&(hn||c===null||mo(c,c.return)),f&64&&Mi&&(i=i.updateQueue,i!==null&&(f=i.callbacks,f!==null&&(c=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=c===null?f:c.concat(f))));break;case 26:var x=Ps;if(aa(s,i),xa(i),f&512&&(hn||c===null||mo(c,c.return)),f&4){var S=c!==null?c.memoizedState:null;if(f=i.memoizedState,c===null)if(f===null)if(i.stateNode===null){e:{f=i.type,c=i.memoizedProps,x=x.ownerDocument||x;t:switch(f){case"title":S=x.getElementsByTagName("title")[0],(!S||S[Zs]||S[qe]||S.namespaceURI==="http://www.w3.org/2000/svg"||S.hasAttribute("itemprop"))&&(S=x.createElement(f),x.head.insertBefore(S,x.querySelector("head > title"))),bn(S,f,c),S[qe]=i,_n(S),f=S;break e;case"link":var R=k("link","href",x).get(f+(c.href||""));if(R){for(var Z=0;Z<R.length;Z++)if(S=R[Z],S.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&S.getAttribute("rel")===(c.rel==null?null:c.rel)&&S.getAttribute("title")===(c.title==null?null:c.title)&&S.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){R.splice(Z,1);break t}}S=x.createElement(f),bn(S,f,c),x.head.appendChild(S);break;case"meta":if(R=k("meta","content",x).get(f+(c.content||""))){for(Z=0;Z<R.length;Z++)if(S=R[Z],S.getAttribute("content")===(c.content==null?null:""+c.content)&&S.getAttribute("name")===(c.name==null?null:c.name)&&S.getAttribute("property")===(c.property==null?null:c.property)&&S.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&S.getAttribute("charset")===(c.charSet==null?null:c.charSet)){R.splice(Z,1);break t}}S=x.createElement(f),bn(S,f,c),x.head.appendChild(S);break;default:throw Error(H(468,f))}S[qe]=i,_n(S),f=S}i.stateNode=f}else O(x,i.type,i.stateNode);else i.stateNode=v(x,f,i.memoizedProps);else S!==f?(S===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):S.count--,f===null?O(x,i.type,i.stateNode):v(x,f,i.memoizedProps)):f===null&&i.stateNode!==null&&Hd(i,i.memoizedProps,c.memoizedProps)}break;case 27:aa(s,i),xa(i),f&512&&(hn||c===null||mo(c,c.return)),c!==null&&f&4&&Hd(i,i.memoizedProps,c.memoizedProps);break;case 5:if(aa(s,i),xa(i),f&512&&(hn||c===null||mo(c,c.return)),i.flags&32){x=i.stateNode;try{da(x,"")}catch(yt){Fi(i,i.return,yt)}}f&4&&i.stateNode!=null&&(x=i.memoizedProps,Hd(i,x,c!==null?c.memoizedProps:x)),f&1024&&(td=!0);break;case 6:if(aa(s,i),xa(i),f&4){if(i.stateNode===null)throw Error(H(162));f=i.memoizedProps,c=i.stateNode;try{c.nodeValue=f}catch(yt){Fi(i,i.return,yt)}}break;case 3:if(z=null,x=Ps,Ps=mu(s.containerInfo),aa(s,i),Ps=x,xa(i),f&4&&c!==null&&c.memoizedState.isDehydrated)try{gu(s.containerInfo)}catch(yt){Fi(i,i.return,yt)}td&&(td=!1,id(i));break;case 4:f=Ps,Ps=mu(i.stateNode.containerInfo),aa(s,i),xa(i),Ps=f;break;case 12:aa(s,i),xa(i);break;case 31:aa(s,i),xa(i),f&4&&(f=i.updateQueue,f!==null&&(i.updateQueue=null,sh(i,f)));break;case 13:aa(s,i),xa(i),i.child.flags&8192&&i.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(hh=Un()),f&4&&(f=i.updateQueue,f!==null&&(i.updateQueue=null,sh(i,f)));break;case 22:x=i.memoizedState!==null;var ce=c!==null&&c.memoizedState!==null,Pe=Mi,je=hn;if(Mi=Pe||x,hn=je||ce,aa(s,i),hn=je,Mi=Pe,xa(i),f&8192)e:for(s=i.stateNode,s._visibility=x?s._visibility&-2:s._visibility|1,x&&(c===null||ce||Mi||hn||zl(i)),c=null,s=i;;){if(s.tag===5||s.tag===26){if(c===null){ce=c=s;try{if(S=ce.stateNode,x)R=S.style,typeof R.setProperty=="function"?R.setProperty("display","none","important"):R.display="none";else{Z=ce.stateNode;var He=ce.memoizedProps.style,De=He!=null&&He.hasOwnProperty("display")?He.display:null;Z.style.display=De==null||typeof De=="boolean"?"":(""+De).trim()}}catch(yt){Fi(ce,ce.return,yt)}}}else if(s.tag===6){if(c===null){ce=s;try{ce.stateNode.nodeValue=x?"":ce.memoizedProps}catch(yt){Fi(ce,ce.return,yt)}}}else if(s.tag===18){if(c===null){ce=s;try{var ke=ce.stateNode;x?wh(ke,!0):wh(ce.stateNode,!1)}catch(yt){Fi(ce,ce.return,yt)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===i)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;c===s&&(c=null),s=s.return}c===s&&(c=null),s.sibling.return=s.return,s=s.sibling}f&4&&(f=i.updateQueue,f!==null&&(c=f.retryQueue,c!==null&&(f.retryQueue=null,sh(i,c))));break;case 19:aa(s,i),xa(i),f&4&&(f=i.updateQueue,f!==null&&(i.updateQueue=null,sh(i,f)));break;case 30:break;case 21:break;default:aa(s,i),xa(i)}}function xa(i){var s=i.flags;if(s&2){try{for(var c,f=i.return;f!==null;){if(Jh(f)){c=f;break}f=f.return}if(c==null)throw Error(H(160));switch(c.tag){case 27:var x=c.stateNode,S=$d(i);Al(i,S,x);break;case 5:var R=c.stateNode;c.flags&32&&(da(R,""),c.flags&=-33);var Z=$d(i);Al(i,Z,R);break;case 3:case 4:var ce=c.stateNode.containerInfo,Pe=$d(i);ed(i,Pe,ce);break;default:throw Error(H(161))}}catch(je){Fi(i,i.return,je)}i.flags&=-3}s&4096&&(i.flags&=-4097)}function id(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var s=i;id(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),i=i.sibling}}function go(i,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)Xd(i,s.alternate,s),s=s.sibling}function zl(i){for(i=i.child;i!==null;){var s=i;switch(s.tag){case 0:case 11:case 14:case 15:El(4,s,s.return),zl(s);break;case 1:mo(s,s.return);var c=s.stateNode;typeof c.componentWillUnmount=="function"&&Jf(s,s.return,c),zl(s);break;case 27:pu(s.stateNode);case 26:case 5:mo(s,s.return),zl(s);break;case 22:s.memoizedState===null&&zl(s);break;case 30:zl(s);break;default:zl(s)}i=i.sibling}}function Zo(i,s,c){for(c=c&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var f=s.alternate,x=i,S=s,R=S.flags;switch(S.tag){case 0:case 11:case 15:Zo(x,S,c),Vo(4,S);break;case 1:if(Zo(x,S,c),f=S,x=f.stateNode,typeof x.componentDidMount=="function")try{x.componentDidMount()}catch(Pe){Fi(f,f.return,Pe)}if(f=S,x=f.updateQueue,x!==null){var Z=f.stateNode;try{var ce=x.shared.hiddenCallbacks;if(ce!==null)for(x.shared.hiddenCallbacks=null,x=0;x<ce.length;x++)gc(ce[x],Z)}catch(Pe){Fi(f,f.return,Pe)}}c&&R&64&&Wf(S),ih(S,S.return);break;case 27:tp(S);case 26:case 5:Zo(x,S,c),c&&f===null&&R&4&&ep(S),ih(S,S.return);break;case 12:Zo(x,S,c);break;case 31:Zo(x,S,c),c&&R&4&&vc(x,S);break;case 13:Zo(x,S,c),c&&R&4&&iu(x,S);break;case 22:S.memoizedState===null&&Zo(x,S,c),ih(S,S.return);break;case 30:break;default:Zo(x,S,c)}s=s.sibling}}function Qd(i,s){var c=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),i=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(i=s.memoizedState.cachePool.pool),i!==c&&(i!=null&&i.refCount++,c!=null&&qn(c))}function Wd(i,s){i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&qn(i))}function Ds(i,s,c,f){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)ip(i,s,c,f),s=s.sibling}function ip(i,s,c,f){var x=s.flags;switch(s.tag){case 0:case 11:case 15:Ds(i,s,c,f),x&2048&&Vo(9,s);break;case 1:Ds(i,s,c,f);break;case 3:Ds(i,s,c,f),x&2048&&(i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&qn(i)));break;case 12:if(x&2048){Ds(i,s,c,f),i=s.stateNode;try{var S=s.memoizedProps,R=S.id,Z=S.onPostCommit;typeof Z=="function"&&Z(R,s.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(ce){Fi(s,s.return,ce)}}else Ds(i,s,c,f);break;case 31:Ds(i,s,c,f);break;case 13:Ds(i,s,c,f);break;case 23:break;case 22:S=s.stateNode,R=s.alternate,s.memoizedState!==null?S._visibility&2?Ds(i,s,c,f):oh(i,s):S._visibility&2?Ds(i,s,c,f):(S._visibility|=2,Is(i,s,c,f,(s.subtreeFlags&10256)!==0||!1)),x&2048&&Qd(R,s);break;case 24:Ds(i,s,c,f),x&2048&&Wd(s.alternate,s);break;default:Ds(i,s,c,f)}}function Is(i,s,c,f,x){for(x=x&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var S=i,R=s,Z=c,ce=f,Pe=R.flags;switch(R.tag){case 0:case 11:case 15:Is(S,R,Z,ce,x),Vo(8,R);break;case 23:break;case 22:var je=R.stateNode;R.memoizedState!==null?je._visibility&2?Is(S,R,Z,ce,x):oh(S,R):(je._visibility|=2,Is(S,R,Z,ce,x)),x&&Pe&2048&&Qd(R.alternate,R);break;case 24:Is(S,R,Z,ce,x),x&&Pe&2048&&Wd(R.alternate,R);break;default:Is(S,R,Z,ce,x)}s=s.sibling}}function oh(i,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var c=i,f=s,x=f.flags;switch(f.tag){case 22:oh(c,f),x&2048&&Qd(f.alternate,f);break;case 24:oh(c,f),x&2048&&Wd(f.alternate,f);break;default:oh(c,f)}s=s.sibling}}var lh=8192;function xc(i,s,c){if(i.subtreeFlags&lh)for(i=i.child;i!==null;)np(i,s,c),i=i.sibling}function np(i,s,c){switch(i.tag){case 26:xc(i,s,c),i.flags&lh&&i.memoizedState!==null&&q(c,Ps,i.memoizedState,i.memoizedProps);break;case 5:xc(i,s,c);break;case 3:case 4:var f=Ps;Ps=mu(i.stateNode.containerInfo),xc(i,s,c),Ps=f;break;case 22:i.memoizedState===null&&(f=i.alternate,f!==null&&f.memoizedState!==null?(f=lh,lh=16777216,xc(i,s,c),lh=f):xc(i,s,c));break;default:xc(i,s,c)}}function Jd(i){var s=i.alternate;if(s!==null&&(i=s.child,i!==null)){s.child=null;do s=i.sibling,i.sibling=null,i=s;while(i!==null)}}function ch(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var f=s[c];Hn=f,ad(f,i)}Jd(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)nd(i),i=i.sibling}function nd(i){switch(i.tag){case 0:case 11:case 15:ch(i),i.flags&2048&&El(9,i,i.return);break;case 3:ch(i);break;case 12:ch(i);break;case 22:var s=i.stateNode;i.memoizedState!==null&&s._visibility&2&&(i.return===null||i.return.tag!==13)?(s._visibility&=-3,Pl(i)):ch(i);break;default:ch(i)}}function Pl(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var f=s[c];Hn=f,ad(f,i)}Jd(i)}for(i=i.child;i!==null;){switch(s=i,s.tag){case 0:case 11:case 15:El(8,s,s.return),Pl(s);break;case 22:c=s.stateNode,c._visibility&2&&(c._visibility&=-3,Pl(s));break;default:Pl(s)}i=i.sibling}}function ad(i,s){for(;Hn!==null;){var c=Hn;switch(c.tag){case 0:case 11:case 15:El(8,c,s);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var f=c.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:qn(c.memoizedState.cache)}if(f=c.child,f!==null)f.return=c,Hn=f;else e:for(c=i;Hn!==null;){f=Hn;var x=f.sibling,S=f.return;if(Yd(f),f===c){Hn=null;break e}if(x!==null){x.return=S,Hn=x;break e}Hn=S}}}var Lp={getCacheForType:function(i){var s=ta(cn),c=s.data.get(i);return c===void 0&&(c=i(),s.data.set(i,c)),c},cacheSignal:function(){return ta(cn).controller.signal}},kp=typeof WeakMap=="function"?WeakMap:Map,bi=0,Hi=null,ri=null,oi=0,fi=0,hr=null,Dl=!1,nu=!1,ef=!1,Go=0,Fn=0,qo=0,Ho=0,rd=0,dr=0,bc=0,uh=null,Aa=null,tf=!1,hh=0,ap=0,sd=1/0,od=null,$o=null,ca=0,Il=null,_o=null,$i=0,dh=0,ld=null,nf=null,wc=0,Rl=null;function fr(){return(bi&2)!==0&&oi!==0?oi&-oi:Be.T!==null?md():Da()}function rp(){if(dr===0)if((oi&536870912)===0||Jt){var i=ct;ct<<=1,(ct&3932160)===0&&(ct=262144),dr=i}else dr=536870912;return i=Na.current,i!==null&&(i.flags|=32),dr}function pr(i,s,c){(i===Hi&&(fi===2||fi===9)||i.cancelPendingCommit!==null)&&(au(i,0),Ll(i,oi,dr,!1)),an(i,c),((bi&2)===0||i!==Hi)&&(i===Hi&&((bi&2)===0&&(Ho|=c),Fn===4&&Ll(i,oi,dr,!1)),rs(i))}function sp(i,s,c){if((bi&6)!==0)throw Error(H(327));var f=!c&&(s&127)===0&&(s&i.expiredLanes)===0||pt(i,s),x=f?fh(i,s):ud(i,s,!0),S=f;do{if(x===0){nu&&!f&&Ll(i,s,0,!1);break}else{if(c=i.current.alternate,S&&!Bp(c)){x=ud(i,s,!1),S=!1;continue}if(x===2){if(S=s,i.errorRecoveryDisabledLanes&S)var R=0;else R=i.pendingLanes&-536870913,R=R!==0?R:R&536870912?536870912:0;if(R!==0){s=R;e:{var Z=i;x=uh;var ce=Z.current.memoizedState.isDehydrated;if(ce&&(au(Z,R).flags|=256),R=ud(Z,R,!1),R!==2){if(ef&&!ce){Z.errorRecoveryDisabledLanes|=S,Ho|=S,x=4;break e}S=Aa,Aa=x,S!==null&&(Aa===null?Aa=S:Aa.push.apply(Aa,S))}x=R}if(S=!1,x!==2)continue}}if(x===1){au(i,0),Ll(i,s,0,!0);break}e:{switch(f=i,S=x,S){case 0:case 1:throw Error(H(345));case 4:if((s&4194048)!==s)break;case 6:Ll(f,s,dr,!Dl);break e;case 2:Aa=null;break;case 3:case 5:break;default:throw Error(H(329))}if((s&62914560)===s&&(x=hh+300-Un(),10<x)){if(Ll(f,s,dr,!Dl),Vt(f,0,!0)!==0)break e;$i=s,f.timeoutHandle=wp(op.bind(null,f,c,Aa,od,tf,s,dr,Ho,bc,Dl,S,"Throttled",-0,0),x);break e}op(f,c,Aa,od,tf,s,dr,Ho,bc,Dl,S,null,-0,0)}}break}while(!0);rs(i)}function op(i,s,c,f,x,S,R,Z,ce,Pe,je,He,De,ke){if(i.timeoutHandle=-1,He=s.subtreeFlags,He&8192||(He&16785408)===16785408){He={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:rr},np(s,S,He);var yt=(S&62914560)===S?hh-Un():(S&4194048)===S?ap-Un():0;if(yt=ge(He,yt),yt!==null){$i=S,i.cancelPendingCommit=yt(of.bind(null,i,s,S,c,f,x,R,Z,ce,je,He,null,De,ke)),Ll(i,S,R,!Pe);return}}of(i,s,S,c,f,x,R,Z,ce)}function Bp(i){for(var s=i;;){var c=s.tag;if((c===0||c===11||c===15)&&s.flags&16384&&(c=s.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var f=0;f<c.length;f++){var x=c[f],S=x.getSnapshot;x=x.value;try{if(!ma(S(),x))return!1}catch{return!1}}if(c=s.child,s.subtreeFlags&16384&&c!==null)c.return=s,s=c;else{if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Ll(i,s,c,f){s&=~rd,s&=~Ho,i.suspendedLanes|=s,i.pingedLanes&=~s,f&&(i.warmLanes|=s),f=i.expirationTimes;for(var x=s;0<x;){var S=31-xe(x),R=1<<S;f[S]=-1,x&=~R}c!==0&&In(i,c,s)}function cd(){return(bi&6)===0?(gh(0),!1):!0}function af(){if(ri!==null){if(fi===0)var i=ri.return;else i=ri,Yr=no=null,D(i),ko=null,gl=0,i=ri;for(;i!==null;)Cl(i.alternate,i),i=i.return;ri=null}}function au(i,s){var c=i.timeoutHandle;c!==-1&&(i.timeoutHandle=-1,Zp(c)),c=i.cancelPendingCommit,c!==null&&(i.cancelPendingCommit=null,c()),$i=0,af(),Hi=i,ri=c=qr(i.current,null),oi=s,fi=0,hr=null,Dl=!1,nu=pt(i,s),ef=!1,bc=dr=rd=Ho=qo=Fn=0,Aa=uh=null,tf=!1,(s&8)!==0&&(s|=s&32);var f=i.entangledLanes;if(f!==0)for(i=i.entanglements,f&=s;0<f;){var x=31-xe(f),S=1<<x;s|=i[x],f&=~S}return Go=s,tc(),c}function lp(i,s){Ut=null,Be.H=Qc,s===Ss||s===Wr?(s=Hc(),fi=3):s===hc?(s=Hc(),fi=4):fi=s===Ud?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,hr=s,ri===null&&(Fn=1,Wc(i,Oa(s,i.current)))}function cp(){var i=Na.current;return i===null?!0:(oi&4194048)===oi?pn===null:(oi&62914560)===oi||(oi&536870912)!==0?i===pn:!1}function up(){var i=Be.H;return Be.H=Qc,i===null?Qc:i}function rf(){var i=Be.A;return Be.A=Lp,i}function ru(){Fn=4,Dl||(oi&4194048)!==oi&&Na.current!==null||(nu=!0),(qo&134217727)===0&&(Ho&134217727)===0||Hi===null||Ll(Hi,oi,dr,!1)}function ud(i,s,c){var f=bi;bi|=2;var x=up(),S=rf();(Hi!==i||oi!==s)&&(od=null,au(i,s)),s=!1;var R=Fn;e:do try{if(fi!==0&&ri!==null){var Z=ri,ce=hr;switch(fi){case 8:af(),R=6;break e;case 3:case 2:case 9:case 6:Na.current===null&&(s=!0);var Pe=fi;if(fi=0,hr=null,ou(i,Z,ce,Pe),c&&nu){R=0;break e}break;default:Pe=fi,fi=0,hr=null,ou(i,Z,ce,Pe)}}kl(),R=Fn;break}catch(je){lp(i,je)}while(!0);return s&&i.shellSuspendCounter++,Yr=no=null,bi=f,Be.H=x,Be.A=S,ri===null&&(Hi=null,oi=0,tc()),R}function kl(){for(;ri!==null;)ph(ri)}function fh(i,s){var c=bi;bi|=2;var f=up(),x=rf();Hi!==i||oi!==s?(od=null,sd=Un()+500,au(i,s)):nu=pt(i,s);e:do try{if(fi!==0&&ri!==null){s=ri;var S=hr;t:switch(fi){case 1:fi=0,hr=null,ou(i,s,S,1);break;case 2:case 9:if(qc(S)){fi=0,hr=null,mh(s);break}s=function(){fi!==2&&fi!==9||Hi!==i||(fi=7),rs(i)},S.then(s,s);break e;case 3:fi=7;break e;case 4:fi=5;break e;case 7:qc(S)?(fi=0,hr=null,mh(s)):(fi=0,hr=null,ou(i,s,S,7));break;case 5:var R=null;switch(ri.tag){case 26:R=ri.memoizedState;case 5:case 27:var Z=ri;if(R?V(R):Z.stateNode.complete){fi=0,hr=null;var ce=Z.sibling;if(ce!==null)ri=ce;else{var Pe=Z.return;Pe!==null?(ri=Pe,hd(Pe)):ri=null}break t}}fi=0,hr=null,ou(i,s,S,5);break;case 6:fi=0,hr=null,ou(i,s,S,6);break;case 8:af(),Fn=6;break e;default:throw Error(H(462))}}su();break}catch(je){lp(i,je)}while(!0);return Yr=no=null,Be.H=f,Be.A=x,bi=c,ri!==null?0:(Hi=null,oi=0,tc(),Fn)}function su(){for(;ri!==null&&!Fs();)ph(ri)}function ph(i){var s=Kh(i.alternate,i,Go);i.memoizedProps=i.pendingProps,s===null?hd(i):ri=s}function mh(i){var s=i,c=s.alternate;switch(s.tag){case 15:case 0:s=Zd(c,s,s.pendingProps,s.type,void 0,oi);break;case 11:s=Zd(c,s,s.pendingProps,s.type.render,s.ref,oi);break;case 5:D(s);default:Cl(c,s),s=ri=Uh(s,Go),s=Kh(c,s,Go)}i.memoizedProps=i.pendingProps,s===null?hd(i):ri=s}function ou(i,s,c,f){Yr=no=null,D(s),ko=null,gl=0;var x=s.return;try{if(Jc(i,x,s,c,oi)){Fn=1,Wc(i,Oa(c,i.current)),ri=null;return}}catch(S){if(x!==null)throw ri=x,S;Fn=1,Wc(i,Oa(c,i.current)),ri=null;return}s.flags&32768?(Jt||f===1?i=!0:nu||(oi&536870912)!==0?i=!1:(Dl=i=!0,(f===2||f===9||f===3||f===6)&&(f=Na.current,f!==null&&f.tag===13&&(f.flags|=16384))),sf(s,i)):hd(s)}function hd(i){var s=i;do{if((s.flags&32768)!==0){sf(s,Dl);return}i=s.return;var c=qd(s.alternate,s,Go);if(c!==null){ri=c;return}if(s=s.sibling,s!==null){ri=s;return}ri=s=i}while(s!==null);Fn===0&&(Fn=5)}function sf(i,s){do{var c=Qf(i.alternate,i);if(c!==null){c.flags&=32767,ri=c;return}if(c=i.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!s&&(i=i.sibling,i!==null)){ri=i;return}ri=i=c}while(i!==null);Fn=6,ri=null}function of(i,s,c,f,x,S,R,Z,ce){i.cancelPendingCommit=null;do lu();while(ca!==0);if((bi&6)!==0)throw Error(H(327));if(s!==null){if(s===i.current)throw Error(H(177));if(S=s.lanes|s.childLanes,S|=fl,jn(i,c,S,R,Z,ce),i===Hi&&(ri=Hi=null,oi=0),_o=s,Il=i,$i=c,dh=S,ld=x,nf=f,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,mp(us,function(){return dp(),null})):(i.callbackNode=null,i.callbackPriority=0),f=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||f){f=Be.T,Be.T=null,x=rt.p,rt.p=2,R=bi,bi|=4;try{ah(i,s,c)}finally{bi=R,rt.p=x,Be.T=f}}ca=1,hp(),lf(),cf()}}function hp(){if(ca===1){ca=0;var i=Il,s=_o,c=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||c){c=Be.T,Be.T=null;var f=rt.p;rt.p=2;var x=bi;bi|=4;try{Kd(s,i);var S=Tf,R=ku(i.containerInfo),Z=S.focusedElem,ce=S.selectionRange;if(R!==Z&&Z&&Z.ownerDocument&&Bc(Z.ownerDocument.documentElement,Z)){if(ce!==null&&Yl(Z)){var Pe=ce.start,je=ce.end;if(je===void 0&&(je=Pe),"selectionStart"in Z)Z.selectionStart=Pe,Z.selectionEnd=Math.min(je,Z.value.length);else{var He=Z.ownerDocument||document,De=He&&He.defaultView||window;if(De.getSelection){var ke=De.getSelection(),yt=Z.textContent.length,Dt=Math.min(ce.start,yt),ti=ce.end===void 0?Dt:Math.min(ce.end,yt);!ke.extend&&Dt>ti&&(R=ti,ti=Dt,Dt=R);var ve=kc(Z,Dt),me=kc(Z,ti);if(ve&&me&&(ke.rangeCount!==1||ke.anchorNode!==ve.node||ke.anchorOffset!==ve.offset||ke.focusNode!==me.node||ke.focusOffset!==me.offset)){var Ae=He.createRange();Ae.setStart(ve.node,ve.offset),ke.removeAllRanges(),Dt>ti?(ke.addRange(Ae),ke.extend(me.node,me.offset)):(Ae.setEnd(me.node,me.offset),ke.addRange(Ae))}}}}for(He=[],ke=Z;ke=ke.parentNode;)ke.nodeType===1&&He.push({element:ke,left:ke.scrollLeft,top:ke.scrollTop});for(typeof Z.focus=="function"&&Z.focus(),Z=0;Z<He.length;Z++){var Ge=He[Z];Ge.element.scrollLeft=Ge.left,Ge.element.scrollTop=Ge.top}}Et=!!vd,Tf=vd=null}finally{bi=x,rt.p=f,Be.T=c}}i.current=s,ca=2}}function lf(){if(ca===2){ca=0;var i=Il,s=_o,c=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||c){c=Be.T,Be.T=null;var f=rt.p;rt.p=2;var x=bi;bi|=4;try{Xd(i,s.alternate,s)}finally{bi=x,rt.p=f,Be.T=c}}ca=3}}function cf(){if(ca===4||ca===3){ca=0,Us();var i=Il,s=_o,c=$i,f=nf;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?ca=5:(ca=0,_o=Il=null,dd(i,i.pendingLanes));var x=i.pendingLanes;if(x===0&&($o=null),rn(c),s=s.stateNode,oe&&typeof oe.onCommitFiberRoot=="function")try{oe.onCommitFiberRoot(ie,s,void 0,(s.current.flags&128)===128)}catch{}if(f!==null){s=Be.T,x=rt.p,rt.p=2,Be.T=null;try{for(var S=i.onRecoverableError,R=0;R<f.length;R++){var Z=f[R];S(Z.value,{componentStack:Z.stack})}}finally{Be.T=s,rt.p=x}}($i&3)!==0&&lu(),rs(i),x=i.pendingLanes,(c&261930)!==0&&(x&42)!==0?i===Rl?wc++:(wc=0,Rl=i):wc=0,gh(0)}}function dd(i,s){(i.pooledCacheLanes&=s)===0&&(s=i.pooledCache,s!=null&&(i.pooledCache=null,qn(s)))}function lu(){return hp(),lf(),cf(),dp()}function dp(){if(ca!==5)return!1;var i=Il,s=dh;dh=0;var c=rn($i),f=Be.T,x=rt.p;try{rt.p=32>c?32:c,Be.T=null,c=ld,ld=null;var S=Il,R=$i;if(ca=0,_o=Il=null,$i=0,(bi&6)!==0)throw Error(H(331));var Z=bi;if(bi|=4,nd(S.current),ip(S,S.current,R,c),bi=Z,gh(0,!1),oe&&typeof oe.onPostCommitFiberRoot=="function")try{oe.onPostCommitFiberRoot(ie,S)}catch{}return!0}finally{rt.p=x,Be.T=f,dd(i,s)}}function uf(i,s,c){s=Oa(c,s),s=Xu(i.stateNode,s,2),i=Mr(i,s,2),i!==null&&(an(i,2),rs(i))}function Fi(i,s,c){if(i.tag===3)uf(i,i,c);else for(;s!==null;){if(s.tag===3){uf(s,i,c);break}else if(s.tag===1){var f=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&($o===null||!$o.has(f))){i=Oa(c,i),c=Od(2),f=Mr(s,c,2),f!==null&&(Fd(c,f,s,i),an(f,2),rs(f));break}}s=s.return}}function hf(i,s,c){var f=i.pingCache;if(f===null){f=i.pingCache=new kp;var x=new Set;f.set(s,x)}else x=f.get(s),x===void 0&&(x=new Set,f.set(s,x));x.has(c)||(ef=!0,x.add(c),i=Op.bind(null,i,s,c),s.then(i,i))}function Op(i,s,c){var f=i.pingCache;f!==null&&f.delete(s),i.pingedLanes|=i.suspendedLanes&c,i.warmLanes&=~c,Hi===i&&(oi&c)===c&&(Fn===4||Fn===3&&(oi&62914560)===oi&&300>Un()-hh?(bi&2)===0&&au(i,0):rd|=c,bc===oi&&(bc=0)),rs(i)}function fp(i,s){s===0&&(s=Pi()),i=eo(i,s),i!==null&&(an(i,s),rs(i))}function Fp(i){var s=i.memoizedState,c=0;s!==null&&(c=s.retryLane),fp(i,c)}function pp(i,s){var c=0;switch(i.tag){case 31:case 13:var f=i.stateNode,x=i.memoizedState;x!==null&&(c=x.retryLane);break;case 19:f=i.stateNode;break;case 22:f=i.stateNode._retryCache;break;default:throw Error(H(314))}f!==null&&f.delete(s),fp(i,c)}function mp(i,s){return Os(i,s)}var as=null,Er=null,fd=!1,cu=!1,df=!1,Rs=0;function rs(i){i!==Er&&i.next===null&&(Er===null?as=Er=i:Er=Er.next=i),cu=!0,fd||(fd=!0,gf())}function gh(i,s){if(!df&&cu){df=!0;do for(var c=!1,f=as;f!==null;){if(i!==0){var x=f.pendingLanes;if(x===0)var S=0;else{var R=f.suspendedLanes,Z=f.pingedLanes;S=(1<<31-xe(42|i)+1)-1,S&=x&~(R&~Z),S=S&201326741?S&201326741|1:S?S|2:0}S!==0&&(c=!0,mf(f,S))}else S=oi,S=Vt(f,f===Hi?S:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(S&3)===0||pt(f,S)||(c=!0,mf(f,S));f=f.next}while(c);df=!1}}function ff(){pd()}function pd(){cu=fd=!1;var i=0;Rs!==0&&bp()&&(i=Rs);for(var s=Un(),c=null,f=as;f!==null;){var x=f.next,S=Tc(f,s);S===0?(f.next=null,c===null?as=x:c.next=x,x===null&&(Er=c)):(c=f,(i!==0||(S&3)!==0)&&(cu=!0)),f=x}ca!==0&&ca!==5||gh(i),Rs!==0&&(Rs=0)}function Tc(i,s){for(var c=i.suspendedLanes,f=i.pingedLanes,x=i.expirationTimes,S=i.pendingLanes&-62914561;0<S;){var R=31-xe(S),Z=1<<R,ce=x[R];ce===-1?((Z&c)===0||(Z&f)!==0)&&(x[R]=Ot(Z,s)):ce<=s&&(i.expiredLanes|=Z),S&=~Z}if(s=Hi,c=oi,c=Vt(i,i===s?c:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),f=i.callbackNode,c===0||i===s&&(fi===2||fi===9)||i.cancelPendingCommit!==null)return f!==null&&f!==null&&Pr(f),i.callbackNode=null,i.callbackPriority=0;if((c&3)===0||pt(i,c)){if(s=c&-c,s===i.callbackPriority)return s;switch(f!==null&&Pr(f),rn(c)){case 2:case 8:c=cs;break;case 32:c=us;break;case 268435456:c=U;break;default:c=us}return f=pf.bind(null,i),c=Os(c,f),i.callbackPriority=s,i.callbackNode=c,s}return f!==null&&f!==null&&Pr(f),i.callbackPriority=2,i.callbackNode=null,2}function pf(i,s){if(ca!==0&&ca!==5)return i.callbackNode=null,i.callbackPriority=0,null;var c=i.callbackNode;if(lu()&&i.callbackNode!==c)return null;var f=oi;return f=Vt(i,i===Hi?f:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),f===0?null:(sp(i,f,s),Tc(i,Un()),i.callbackNode!=null&&i.callbackNode===c?pf.bind(null,i):null)}function mf(i,s){if(lu())return null;sp(i,s,!0)}function gf(){Tp(function(){(bi&6)!==0?Os(ls,ff):pd()})}function md(){if(Rs===0){var i=Tr;i===0&&(i=Oe,Oe<<=1,(Oe&261888)===0&&(Oe=256)),Rs=i}return Rs}function _h(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:Lr(""+i)}function _f(i,s){var c=s.ownerDocument.createElement("input");return c.name=s.name,c.value=s.value,i.id&&c.setAttribute("form",i.id),s.parentNode.insertBefore(c,s),i=new FormData(i),c.parentNode.removeChild(c),i}function Up(i,s,c,f,x){if(s==="submit"&&c&&c.stateNode===x){var S=_h((x[xt]||null).action),R=f.submitter;R&&(s=(s=R[xt]||null)?_h(s.formAction):R.getAttribute("formAction"),s!==null&&(S=s,R=null));var Z=new nl("action","action",null,f,x);i.push({event:Z,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(Rs!==0){var ce=R?_f(x,R):new FormData(x);Kc(c,{pending:!0,data:ce,method:x.method,action:S},null,ce)}}else typeof S=="function"&&(Z.preventDefault(),ce=R?_f(x,R):new FormData(x),Kc(c,{pending:!0,data:ce,method:x.method,action:S},S,ce))},currentTarget:x}]})}}for(var yf=0;yf<ec.length;yf++){var gd=ec[yf],jp=gd.toLowerCase(),Np=gd[0].toUpperCase()+gd.slice(1);la(jp,"on"+Np)}la(Wl,"onAnimationEnd"),la(Fc,"onAnimationIteration"),la(Js,"onAnimationStart"),la("dblclick","onDoubleClick"),la("focusin","onFocus"),la("focusout","onBlur"),la(Jl,"onTransitionRun"),la(dl,"onTransitionStart"),la(sr,"onTransitionCancel"),la(Fu,"onTransitionEnd"),Rr("onMouseEnter",["mouseout","mouseover"]),Rr("onMouseLeave",["mouseout","mouseover"]),Rr("onPointerEnter",["pointerout","pointerover"]),Rr("onPointerLeave",["pointerout","pointerover"]),Gs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Gs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Gs("onBeforeInput",["compositionend","keypress","textInput","paste"]),Gs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Gs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Gs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Vp=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(yh));function gp(i,s){s=(s&4)!==0;for(var c=0;c<i.length;c++){var f=i[c],x=f.event;f=f.listeners;e:{var S=void 0;if(s)for(var R=f.length-1;0<=R;R--){var Z=f[R],ce=Z.instance,Pe=Z.currentTarget;if(Z=Z.listener,ce!==S&&x.isPropagationStopped())break e;S=Z,x.currentTarget=Pe;try{S(x)}catch(je){Po(je)}x.currentTarget=null,S=ce}else for(R=0;R<f.length;R++){if(Z=f[R],ce=Z.instance,Pe=Z.currentTarget,Z=Z.listener,ce!==S&&x.isPropagationStopped())break e;S=Z,x.currentTarget=Pe;try{S(x)}catch(je){Po(je)}x.currentTarget=null,S=ce}}}}function Wt(i,s){var c=s[Nn];c===void 0&&(c=s[Nn]=new Set);var f=i+"__bubble";c.has(f)||(vf(s,i,2,!1),c.add(f))}function yo(i,s,c){var f=0;s&&(f|=4),vf(c,i,f,s)}var vh="_reactListening"+Math.random().toString(36).slice(2);function _d(i){if(!i[vh]){i[vh]=!0,Ta.forEach(function(c){c!=="selectionchange"&&(Vp.has(c)||yo(c,!1,i),yo(c,!0,i))});var s=i.nodeType===9?i:i.ownerDocument;s===null||s[vh]||(s[vh]=!0,yo("selectionchange",!1,s))}}function vf(i,s,c,f){switch(gr(s)){case 2:var x=vt;break;case 8:x=ft;break;default:x=Xt}c=x.bind(null,s,c,i),x=void 0,!Wn||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(x=!0),f?x!==void 0?i.addEventListener(s,c,{capture:!0,passive:x}):i.addEventListener(s,c,!0):x!==void 0?i.addEventListener(s,c,{passive:x}):i.addEventListener(s,c,!1)}function yd(i,s,c,f,x){var S=f;if((s&1)===0&&(s&2)===0&&f!==null)e:for(;;){if(f===null)return;var R=f.tag;if(R===3||R===4){var Z=f.stateNode.containerInfo;if(Z===x)break;if(R===4)for(R=f.return;R!==null;){var ce=R.tag;if((ce===3||ce===4)&&R.stateNode.containerInfo===x)return;R=R.return}for(;Z!==null;){if(R=hs(Z),R===null)return;if(ce=R.tag,ce===5||ce===6||ce===26||ce===27){f=S=R;continue e}Z=Z.parentNode}}f=f.return}Tu(function(){var Pe=S,je=oa(c),He=[];e:{var De=Uu.get(i);if(De!==void 0){var ke=nl,yt=i;switch(i){case"keypress":if(Yt(c)===0)break e;case"keydown":case"keyup":ke=Ah;break;case"focusin":yt="focus",ke=Wi;break;case"focusout":yt="blur",ke=Wi;break;case"beforeblur":case"afterblur":ke=Wi;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ke=Zn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ke=Vl;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ke=Dd;break;case Wl:case Fc:case Js:ke=Zl;break;case Fu:ke=Pc;break;case"scroll":case"scrollend":ke=Nl;break;case"wheel":ke=Co;break;case"copy":case"cut":case"paste":ke=Pd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ke=zh;break;case"toggle":case"beforetoggle":ke=Dc}var Dt=(s&4)!==0,ti=!Dt&&(i==="scroll"||i==="scrollend"),ve=Dt?De!==null?De+"Capture":null:De;Dt=[];for(var me=Pe,Ae;me!==null;){var Ge=me;if(Ae=Ge.stateNode,Ge=Ge.tag,Ge!==5&&Ge!==26&&Ge!==27||Ae===null||ve===null||(Ge=Vn(me,ve),Ge!=null&&Dt.push(uu(me,Ge,Ae))),ti)break;me=me.return}0<Dt.length&&(De=new ke(De,yt,null,c,je),He.push({event:De,listeners:Dt}))}}if((s&7)===0){e:{if(De=i==="mouseover"||i==="pointerover",ke=i==="mouseout"||i==="pointerout",De&&c!==il&&(yt=c.relatedTarget||c.fromElement)&&(hs(yt)||yt[Pt]))break e;if((ke||De)&&(De=je.window===je?je:(De=je.ownerDocument)?De.defaultView||De.parentWindow:window,ke?(yt=c.relatedTarget||c.toElement,ke=Pe,yt=yt?hs(yt):null,yt!==null&&(ti=$e(yt),Dt=yt.tag,yt!==ti||Dt!==5&&Dt!==27&&Dt!==6)&&(yt=null)):(ke=null,yt=Pe),ke!==yt)){if(Dt=Zn,Ge="onMouseLeave",ve="onMouseEnter",me="mouse",(i==="pointerout"||i==="pointerover")&&(Dt=zh,Ge="onPointerLeave",ve="onPointerEnter",me="pointer"),ti=ke==null?De:Ir(ke),Ae=yt==null?De:Ir(yt),De=new Dt(Ge,me+"leave",ke,c,je),De.target=ti,De.relatedTarget=Ae,Ge=null,hs(je)===Pe&&(Dt=new Dt(ve,me+"enter",yt,c,je),Dt.target=Ae,Dt.relatedTarget=ti,Ge=Dt),ti=Ge,ke&&yt)t:{for(Dt=_p,ve=ke,me=yt,Ae=0,Ge=ve;Ge;Ge=Dt(Ge))Ae++;Ge=0;for(var At=me;At;At=Dt(At))Ge++;for(;0<Ae-Ge;)ve=Dt(ve),Ae--;for(;0<Ge-Ae;)me=Dt(me),Ge--;for(;Ae--;){if(ve===me||me!==null&&ve===me.alternate){Dt=ve;break t}ve=Dt(ve),me=Dt(me)}Dt=null}else Dt=null;ke!==null&&du(He,De,ke,Dt,!1),yt!==null&&ti!==null&&du(He,ti,yt,Dt,!0)}}e:{if(De=Pe?Ir(Pe):window,ke=De.nodeName&&De.nodeName.toLowerCase(),ke==="select"||ke==="input"&&De.type==="file")var kt=Rc;else if(Ic(De))if(Lc)kt=Lu;else{kt=Bh;var ht=kh}else ke=De.nodeName,!ke||ke.toLowerCase()!=="input"||De.type!=="checkbox"&&De.type!=="radio"?Pe&&xr(Pe.elementType)&&(kt=Rc):kt=Ru;if(kt&&(kt=kt(i,Pe))){Pu(He,kt,c,je);break e}ht&&ht(i,De,Pe),i==="focusout"&&Pe&&De.type==="number"&&Pe.memoizedProps.value!=null&&jl(De,"number",De.value)}switch(ht=Pe?Ir(Pe):window,i){case"focusin":(Ic(ht)||ht.contentEditable==="true")&&(Qs=ht,Bu=Pe,Kl=null);break;case"focusout":Kl=Bu=Qs=null;break;case"mousedown":Ou=!0;break;case"contextmenu":case"mouseup":case"dragend":Ou=!1,Fh(He,c,je);break;case"selectionchange":if(zo)break;case"keydown":case"keyup":Fh(He,c,je)}var Ft;if(Au)e:{switch(i){case"compositionstart":var jt="onCompositionStart";break e;case"compositionend":jt="onCompositionEnd";break e;case"compositionupdate":jt="onCompositionUpdate";break e}jt=void 0}else Eo?Dh(i,c)&&(jt="onCompositionEnd"):i==="keydown"&&c.keyCode===229&&(jt="onCompositionStart");jt&&(ll&&c.locale!=="ko"&&(Eo||jt!=="onCompositionStart"?jt==="onCompositionEnd"&&Eo&&(Ft=kr()):(La=je,bt="value"in La?La.value:La.textContent,Eo=!0)),ht=hu(Pe,jt),0<ht.length&&(jt=new Jn(jt,i,null,c,je),He.push({event:jt,listeners:ht}),Ft?jt.data=Ft:(Ft=Ys(c),Ft!==null&&(jt.data=Ft)))),(Ft=$l?zu(i,c):Rd(i,c))&&(jt=hu(Pe,"onBeforeInput"),0<jt.length&&(ht=new Jn("onBeforeInput","beforeinput",null,c,je),He.push({event:ht,listeners:jt}),ht.data=Ft)),Up(He,i,Pe,c,je)}gp(He,s)})}function uu(i,s,c){return{instance:i,listener:s,currentTarget:c}}function hu(i,s){for(var c=s+"Capture",f=[];i!==null;){var x=i,S=x.stateNode;if(x=x.tag,x!==5&&x!==26&&x!==27||S===null||(x=Vn(i,c),x!=null&&f.unshift(uu(i,x,S)),x=Vn(i,s),x!=null&&f.push(uu(i,x,S))),i.tag===3)return f;i=i.return}return[]}function _p(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function du(i,s,c,f,x){for(var S=s._reactName,R=[];c!==null&&c!==f;){var Z=c,ce=Z.alternate,Pe=Z.stateNode;if(Z=Z.tag,ce!==null&&ce===f)break;Z!==5&&Z!==26&&Z!==27||Pe===null||(ce=Pe,x?(Pe=Vn(c,S),Pe!=null&&R.unshift(uu(c,Pe,ce))):x||(Pe=Vn(c,S),Pe!=null&&R.push(uu(c,Pe,ce)))),c=c.return}R.length!==0&&i.push({event:s,listeners:R})}var yp=/\r\n?/g,xf=/\u0000|\uFFFD/g;function bf(i){return(typeof i=="string"?i:""+i).replace(yp,`
`).replace(xf,"")}function mr(i,s){return s=bf(s),bf(i)===s}function pi(i,s,c,f,x,S){switch(c){case"children":typeof f=="string"?s==="body"||s==="textarea"&&f===""||da(i,f):(typeof f=="number"||typeof f=="bigint")&&s!=="body"&&da(i,""+f);break;case"className":Ul(i,"class",f);break;case"tabIndex":Ul(i,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":Ul(i,c,f);break;case"style":ms(i,f,S);break;case"data":if(s!=="object"){Ul(i,"data",f);break}case"src":case"href":if(f===""&&(s!=="a"||c!=="href")){i.removeAttribute(c);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){i.removeAttribute(c);break}f=Lr(""+f),i.setAttribute(c,f);break;case"action":case"formAction":if(typeof f=="function"){i.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof S=="function"&&(c==="formAction"?(s!=="input"&&pi(i,s,"name",x.name,x,null),pi(i,s,"formEncType",x.formEncType,x,null),pi(i,s,"formMethod",x.formMethod,x,null),pi(i,s,"formTarget",x.formTarget,x,null)):(pi(i,s,"encType",x.encType,x,null),pi(i,s,"method",x.method,x,null),pi(i,s,"target",x.target,x,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){i.removeAttribute(c);break}f=Lr(""+f),i.setAttribute(c,f);break;case"onClick":f!=null&&(i.onclick=rr);break;case"onScroll":f!=null&&Wt("scroll",i);break;case"onScrollEnd":f!=null&&Wt("scrollend",i);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(H(61));if(c=f.__html,c!=null){if(x.children!=null)throw Error(H(60));i.innerHTML=c}}break;case"multiple":i.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":i.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){i.removeAttribute("xlink:href");break}c=Lr(""+f),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?i.setAttribute(c,""+f):i.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?i.setAttribute(c,""):i.removeAttribute(c);break;case"capture":case"download":f===!0?i.setAttribute(c,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?i.setAttribute(c,f):i.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?i.setAttribute(c,f):i.removeAttribute(c);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?i.removeAttribute(c):i.setAttribute(c,f);break;case"popover":Wt("beforetoggle",i),Wt("toggle",i),Fl(i,"popover",f);break;case"xlinkActuate":Ia(i,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":Ia(i,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":Ia(i,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":Ia(i,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":Ia(i,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":Ia(i,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":Ia(i,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":Ia(i,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":Ia(i,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":Fl(i,"is",f);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=To.get(c)||c,Fl(i,c,f))}}function Sc(i,s,c,f,x,S){switch(c){case"style":ms(i,f,S);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(H(61));if(c=f.__html,c!=null){if(x.children!=null)throw Error(H(60));i.innerHTML=c}}break;case"children":typeof f=="string"?da(i,f):(typeof f=="number"||typeof f=="bigint")&&da(i,""+f);break;case"onScroll":f!=null&&Wt("scroll",i);break;case"onScrollEnd":f!=null&&Wt("scrollend",i);break;case"onClick":f!=null&&(i.onclick=rr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ti.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(x=c.endsWith("Capture"),s=c.slice(2,x?c.length-7:void 0),S=i[xt]||null,S=S!=null?S[c]:null,typeof S=="function"&&i.removeEventListener(s,S,x),typeof f=="function")){typeof S!="function"&&S!==null&&(c in i?i[c]=null:i.hasAttribute(c)&&i.removeAttribute(c)),i.addEventListener(s,f,x);break e}c in i?i[c]=f:f===!0?i.setAttribute(c,""):Fl(i,c,f)}}}function bn(i,s,c){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Wt("error",i),Wt("load",i);var f=!1,x=!1,S;for(S in c)if(c.hasOwnProperty(S)){var R=c[S];if(R!=null)switch(S){case"src":f=!0;break;case"srcSet":x=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(H(137,s));default:pi(i,s,S,R,c,null)}}x&&pi(i,s,"srcSet",c.srcSet,c,null),f&&pi(i,s,"src",c.src,c,null);return;case"input":Wt("invalid",i);var Z=S=R=x=null,ce=null,Pe=null;for(f in c)if(c.hasOwnProperty(f)){var je=c[f];if(je!=null)switch(f){case"name":x=je;break;case"type":R=je;break;case"checked":ce=je;break;case"defaultChecked":Pe=je;break;case"value":S=je;break;case"defaultValue":Z=je;break;case"children":case"dangerouslySetInnerHTML":if(je!=null)throw Error(H(137,s));break;default:pi(i,s,f,je,c,null)}}Ac(i,S,Z,ce,Pe,R,x,!1);return;case"select":Wt("invalid",i),f=R=S=null;for(x in c)if(c.hasOwnProperty(x)&&(Z=c[x],Z!=null))switch(x){case"value":S=Z;break;case"defaultValue":R=Z;break;case"multiple":f=Z;default:pi(i,s,x,Z,c,null)}s=S,c=R,i.multiple=!!f,s!=null?el(i,!!f,s,!1):c!=null&&el(i,!!f,c,!0);return;case"textarea":Wt("invalid",i),S=x=f=null;for(R in c)if(c.hasOwnProperty(R)&&(Z=c[R],Z!=null))switch(R){case"value":f=Z;break;case"defaultValue":x=Z;break;case"children":S=Z;break;case"dangerouslySetInnerHTML":if(Z!=null)throw Error(H(91));break;default:pi(i,s,R,Z,c,null)}tl(i,f,x,S);return;case"option":for(ce in c)if(c.hasOwnProperty(ce)&&(f=c[ce],f!=null))switch(ce){case"selected":i.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:pi(i,s,ce,f,c,null)}return;case"dialog":Wt("beforetoggle",i),Wt("toggle",i),Wt("cancel",i),Wt("close",i);break;case"iframe":case"object":Wt("load",i);break;case"video":case"audio":for(f=0;f<yh.length;f++)Wt(yh[f],i);break;case"image":Wt("error",i),Wt("load",i);break;case"details":Wt("toggle",i);break;case"embed":case"source":case"link":Wt("error",i),Wt("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Pe in c)if(c.hasOwnProperty(Pe)&&(f=c[Pe],f!=null))switch(Pe){case"children":case"dangerouslySetInnerHTML":throw Error(H(137,s));default:pi(i,s,Pe,f,c,null)}return;default:if(xr(s)){for(je in c)c.hasOwnProperty(je)&&(f=c[je],f!==void 0&&Sc(i,s,je,f,c,void 0));return}}for(Z in c)c.hasOwnProperty(Z)&&(f=c[Z],f!=null&&pi(i,s,Z,f,c,null))}function vp(i,s,c,f){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var x=null,S=null,R=null,Z=null,ce=null,Pe=null,je=null;for(ke in c){var He=c[ke];if(c.hasOwnProperty(ke)&&He!=null)switch(ke){case"checked":break;case"value":break;case"defaultValue":ce=He;default:f.hasOwnProperty(ke)||pi(i,s,ke,null,f,He)}}for(var De in f){var ke=f[De];if(He=c[De],f.hasOwnProperty(De)&&(ke!=null||He!=null))switch(De){case"type":S=ke;break;case"name":x=ke;break;case"checked":Pe=ke;break;case"defaultChecked":je=ke;break;case"value":R=ke;break;case"defaultValue":Z=ke;break;case"children":case"dangerouslySetInnerHTML":if(ke!=null)throw Error(H(137,s));break;default:ke!==He&&pi(i,s,De,ke,f,He)}}qs(i,R,Z,ce,Pe,je,S,x);return;case"select":ke=R=Z=De=null;for(S in c)if(ce=c[S],c.hasOwnProperty(S)&&ce!=null)switch(S){case"value":break;case"multiple":ke=ce;default:f.hasOwnProperty(S)||pi(i,s,S,null,f,ce)}for(x in f)if(S=f[x],ce=c[x],f.hasOwnProperty(x)&&(S!=null||ce!=null))switch(x){case"value":De=S;break;case"defaultValue":Z=S;break;case"multiple":R=S;default:S!==ce&&pi(i,s,x,S,f,ce)}s=Z,c=R,f=ke,De!=null?el(i,!!c,De,!1):!!f!=!!c&&(s!=null?el(i,!!c,s,!0):el(i,!!c,c?[]:"",!1));return;case"textarea":ke=De=null;for(Z in c)if(x=c[Z],c.hasOwnProperty(Z)&&x!=null&&!f.hasOwnProperty(Z))switch(Z){case"value":break;case"children":break;default:pi(i,s,Z,null,f,x)}for(R in f)if(x=f[R],S=c[R],f.hasOwnProperty(R)&&(x!=null||S!=null))switch(R){case"value":De=x;break;case"defaultValue":ke=x;break;case"children":break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(H(91));break;default:x!==S&&pi(i,s,R,x,f,S)}wo(i,De,ke);return;case"option":for(var yt in c)if(De=c[yt],c.hasOwnProperty(yt)&&De!=null&&!f.hasOwnProperty(yt))switch(yt){case"selected":i.selected=!1;break;default:pi(i,s,yt,null,f,De)}for(ce in f)if(De=f[ce],ke=c[ce],f.hasOwnProperty(ce)&&De!==ke&&(De!=null||ke!=null))switch(ce){case"selected":i.selected=De&&typeof De!="function"&&typeof De!="symbol";break;default:pi(i,s,ce,De,f,ke)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Dt in c)De=c[Dt],c.hasOwnProperty(Dt)&&De!=null&&!f.hasOwnProperty(Dt)&&pi(i,s,Dt,null,f,De);for(Pe in f)if(De=f[Pe],ke=c[Pe],f.hasOwnProperty(Pe)&&De!==ke&&(De!=null||ke!=null))switch(Pe){case"children":case"dangerouslySetInnerHTML":if(De!=null)throw Error(H(137,s));break;default:pi(i,s,Pe,De,f,ke)}return;default:if(xr(s)){for(var ti in c)De=c[ti],c.hasOwnProperty(ti)&&De!==void 0&&!f.hasOwnProperty(ti)&&Sc(i,s,ti,void 0,f,De);for(je in f)De=f[je],ke=c[je],!f.hasOwnProperty(je)||De===ke||De===void 0&&ke===void 0||Sc(i,s,je,De,f,ke);return}}for(var ve in c)De=c[ve],c.hasOwnProperty(ve)&&De!=null&&!f.hasOwnProperty(ve)&&pi(i,s,ve,null,f,De);for(He in f)De=f[He],ke=c[He],!f.hasOwnProperty(He)||De===ke||De==null&&ke==null||pi(i,s,He,De,f,ke)}function wf(i){switch(i){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function xp(){if(typeof performance.getEntriesByType=="function"){for(var i=0,s=0,c=performance.getEntriesByType("resource"),f=0;f<c.length;f++){var x=c[f],S=x.transferSize,R=x.initiatorType,Z=x.duration;if(S&&Z&&wf(R)){for(R=0,Z=x.responseEnd,f+=1;f<c.length;f++){var ce=c[f],Pe=ce.startTime;if(Pe>Z)break;var je=ce.transferSize,He=ce.initiatorType;je&&wf(He)&&(ce=ce.responseEnd,R+=je*(ce<Z?1:(Z-Pe)/(ce-Pe)))}if(--f,s+=8*(S+R)/(x.duration/1e3),i++,10<i)break}}if(0<i)return s/i/1e6}return navigator.connection&&(i=navigator.connection.downlink,typeof i=="number")?i:5}var vd=null,Tf=null;function xh(i){return i.nodeType===9?i:i.ownerDocument}function Xo(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Sf(i,s){if(i===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&s==="foreignObject"?0:i}function xd(i,s){return i==="textarea"||i==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var bd=null;function bp(){var i=window.event;return i&&i.type==="popstate"?i===bd?!1:(bd=i,!0):(bd=null,!1)}var wp=typeof setTimeout=="function"?setTimeout:void 0,Zp=typeof clearTimeout=="function"?clearTimeout:void 0,Mf=typeof Promise=="function"?Promise:void 0,Tp=typeof queueMicrotask=="function"?queueMicrotask:typeof Mf<"u"?function(i){return Mf.resolve(null).then(i).catch(wd)}:wp;function wd(i){setTimeout(function(){throw i})}function Yo(i){return i==="head"}function bh(i,s){var c=s,f=0;do{var x=c.nextSibling;if(i.removeChild(c),x&&x.nodeType===8)if(c=x.data,c==="/$"||c==="/&"){if(f===0){i.removeChild(x),gu(s);return}f--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")f++;else if(c==="html")pu(i.ownerDocument.documentElement);else if(c==="head"){c=i.ownerDocument.head,pu(c);for(var S=c.firstChild;S;){var R=S.nextSibling,Z=S.nodeName;S[Zs]||Z==="SCRIPT"||Z==="STYLE"||Z==="LINK"&&S.rel.toLowerCase()==="stylesheet"||c.removeChild(S),S=R}}else c==="body"&&pu(i.ownerDocument.body);c=x}while(c);gu(s)}function wh(i,s){var c=i;i=0;do{var f=c.nextSibling;if(c.nodeType===1?s?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(s?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),f&&f.nodeType===8)if(c=f.data,c==="/$"){if(i===0)break;i--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||i++;c=f}while(c)}function fu(i){var s=i.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var c=s;switch(s=s.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":fu(c),Dr(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}i.removeChild(c)}}function Gp(i,s,c,f){for(;i.nodeType===1;){var x=c;if(i.nodeName.toLowerCase()!==s.toLowerCase()){if(!f&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(f){if(!i[Zs])switch(s){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(S=i.getAttribute("rel"),S==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(S!==x.rel||i.getAttribute("href")!==(x.href==null||x.href===""?null:x.href)||i.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin)||i.getAttribute("title")!==(x.title==null?null:x.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(S=i.getAttribute("src"),(S!==(x.src==null?null:x.src)||i.getAttribute("type")!==(x.type==null?null:x.type)||i.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin))&&S&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(s==="input"&&i.type==="hidden"){var S=x.name==null?null:""+x.name;if(x.type==="hidden"&&i.getAttribute("name")===S)return i}else return i;if(i=Ar(i.nextSibling),i===null)break}return null}function qp(i,s,c){if(s==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!c||(i=Ar(i.nextSibling),i===null))return null;return i}function Sp(i,s){for(;i.nodeType!==8;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!s||(i=Ar(i.nextSibling),i===null))return null;return i}function Bl(i){return i.data==="$?"||i.data==="$~"}function ra(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState!=="loading"}function Cf(i,s){var c=i.ownerDocument;if(i.data==="$~")i._reactRetry=s;else if(i.data!=="$?"||c.readyState!=="loading")s();else{var f=function(){s(),c.removeEventListener("DOMContentLoaded",f)};c.addEventListener("DOMContentLoaded",f),i._reactRetry=f}}function Ar(i){for(;i!=null;i=i.nextSibling){var s=i.nodeType;if(s===1||s===3)break;if(s===8){if(s=i.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return i}var Td=null;function Sd(i){i=i.nextSibling;for(var s=0;i;){if(i.nodeType===8){var c=i.data;if(c==="/$"||c==="/&"){if(s===0)return Ar(i.nextSibling);s--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||s++}i=i.nextSibling}return null}function Mp(i){i=i.previousSibling;for(var s=0;i;){if(i.nodeType===8){var c=i.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(s===0)return i;s--}else c!=="/$"&&c!=="/&"||s++}i=i.previousSibling}return null}function Ef(i,s,c){switch(s=xh(c),i){case"html":if(i=s.documentElement,!i)throw Error(H(452));return i;case"head":if(i=s.head,!i)throw Error(H(453));return i;case"body":if(i=s.body,!i)throw Error(H(454));return i;default:throw Error(H(451))}}function pu(i){for(var s=i.attributes;s.length;)i.removeAttributeNode(s[0]);Dr(i)}var ss=new Map,Af=new Set;function mu(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var Ls=rt.d;rt.d={f:Cp,r:Th,D:Pf,C:Md,L:Sh,m:Df,X:Rf,S:If,M:Hp};function Cp(){var i=Ls.f(),s=cd();return i||s}function Th(i){var s=wa(i);s!==null&&s.tag===5&&s.type==="form"?Nh(s):Ls.r(i)}var Ol=typeof document>"u"?null:document;function zf(i,s,c){var f=Ol;if(f&&typeof s=="string"&&s){var x=Ra(s);x='link[rel="'+i+'"][href="'+x+'"]',typeof c=="string"&&(x+='[crossorigin="'+c+'"]'),Af.has(x)||(Af.add(x),i={rel:i,crossOrigin:c,href:s},f.querySelector(x)===null&&(s=f.createElement("link"),bn(s,"link",i),_n(s),f.head.appendChild(s)))}}function Pf(i){Ls.D(i),zf("dns-prefetch",i,null)}function Md(i,s){Ls.C(i,s),zf("preconnect",i,s)}function Sh(i,s,c){Ls.L(i,s,c);var f=Ol;if(f&&i&&s){var x='link[rel="preload"][as="'+Ra(s)+'"]';s==="image"&&c&&c.imageSrcSet?(x+='[imagesrcset="'+Ra(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(x+='[imagesizes="'+Ra(c.imageSizes)+'"]')):x+='[href="'+Ra(i)+'"]';var S=x;switch(s){case"style":S=t(i);break;case"script":S=p(i)}ss.has(S)||(i=Ye({rel:"preload",href:s==="image"&&c&&c.imageSrcSet?void 0:i,as:s},c),ss.set(S,i),f.querySelector(x)!==null||s==="style"&&f.querySelector(n(S))||s==="script"&&f.querySelector(_(S))||(s=f.createElement("link"),bn(s,"link",i),_n(s),f.head.appendChild(s)))}}function Df(i,s){Ls.m(i,s);var c=Ol;if(c&&i){var f=s&&typeof s.as=="string"?s.as:"script",x='link[rel="modulepreload"][as="'+Ra(f)+'"][href="'+Ra(i)+'"]',S=x;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":S=p(i)}if(!ss.has(S)&&(i=Ye({rel:"modulepreload",href:i},s),ss.set(S,i),c.querySelector(x)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(_(S)))return}f=c.createElement("link"),bn(f,"link",i),_n(f),c.head.appendChild(f)}}}function If(i,s,c){Ls.S(i,s,c);var f=Ol;if(f&&i){var x=Ii(f).hoistableStyles,S=t(i);s=s||"default";var R=x.get(S);if(!R){var Z={loading:0,preload:null};if(R=f.querySelector(n(S)))Z.loading=5;else{i=Ye({rel:"stylesheet",href:i,"data-precedence":s},c),(c=ss.get(S))&&M(i,c);var ce=R=f.createElement("link");_n(ce),bn(ce,"link",i),ce._p=new Promise(function(Pe,je){ce.onload=Pe,ce.onerror=je}),ce.addEventListener("load",function(){Z.loading|=1}),ce.addEventListener("error",function(){Z.loading|=2}),Z.loading|=4,b(R,s,f)}R={type:"stylesheet",instance:R,count:1,state:Z},x.set(S,R)}}}function Rf(i,s){Ls.X(i,s);var c=Ol;if(c&&i){var f=Ii(c).hoistableScripts,x=p(i),S=f.get(x);S||(S=c.querySelector(_(x)),S||(i=Ye({src:i,async:!0},s),(s=ss.get(x))&&C(i,s),S=c.createElement("script"),_n(S),bn(S,"link",i),c.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},f.set(x,S))}}function Hp(i,s){Ls.M(i,s);var c=Ol;if(c&&i){var f=Ii(c).hoistableScripts,x=p(i),S=f.get(x);S||(S=c.querySelector(_(x)),S||(i=Ye({src:i,async:!0,type:"module"},s),(s=ss.get(x))&&C(i,s),S=c.createElement("script"),_n(S),bn(S,"link",i),c.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},f.set(x,S))}}function a(i,s,c,f){var x=(x=Ct.current)?mu(x):null;if(!x)throw Error(H(446));switch(i){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(s=t(c.href),c=Ii(x).hoistableStyles,f=c.get(s),f||(f={type:"style",instance:null,count:0,state:null},c.set(s,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){i=t(c.href);var S=Ii(x).hoistableStyles,R=S.get(i);if(R||(x=x.ownerDocument||x,R={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},S.set(i,R),(S=x.querySelector(n(i)))&&!S._p&&(R.instance=S,R.state.loading=5),ss.has(i)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},ss.set(i,c),S||u(x,i,c,R.state))),s&&f===null)throw Error(H(528,""));return R}if(s&&f!==null)throw Error(H(529,""));return null;case"script":return s=c.async,c=c.src,typeof c=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=p(c),c=Ii(x).hoistableScripts,f=c.get(s),f||(f={type:"script",instance:null,count:0,state:null},c.set(s,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(H(444,i))}}function t(i){return'href="'+Ra(i)+'"'}function n(i){return'link[rel="stylesheet"]['+i+"]"}function o(i){return Ye({},i,{"data-precedence":i.precedence,precedence:null})}function u(i,s,c,f){i.querySelector('link[rel="preload"][as="style"]['+s+"]")?f.loading=1:(s=i.createElement("link"),f.preload=s,s.addEventListener("load",function(){return f.loading|=1}),s.addEventListener("error",function(){return f.loading|=2}),bn(s,"link",c),_n(s),i.head.appendChild(s))}function p(i){return'[src="'+Ra(i)+'"]'}function _(i){return"script[async]"+i}function v(i,s,c){if(s.count++,s.instance===null)switch(s.type){case"style":var f=i.querySelector('style[data-href~="'+Ra(c.href)+'"]');if(f)return s.instance=f,_n(f),f;var x=Ye({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return f=(i.ownerDocument||i).createElement("style"),_n(f),bn(f,"style",x),b(f,c.precedence,i),s.instance=f;case"stylesheet":x=t(c.href);var S=i.querySelector(n(x));if(S)return s.state.loading|=4,s.instance=S,_n(S),S;f=o(c),(x=ss.get(x))&&M(f,x),S=(i.ownerDocument||i).createElement("link"),_n(S);var R=S;return R._p=new Promise(function(Z,ce){R.onload=Z,R.onerror=ce}),bn(S,"link",f),s.state.loading|=4,b(S,c.precedence,i),s.instance=S;case"script":return S=p(c.src),(x=i.querySelector(_(S)))?(s.instance=x,_n(x),x):(f=c,(x=ss.get(S))&&(f=Ye({},c),C(f,x)),i=i.ownerDocument||i,x=i.createElement("script"),_n(x),bn(x,"link",f),i.head.appendChild(x),s.instance=x);case"void":return null;default:throw Error(H(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(f=s.instance,s.state.loading|=4,b(f,c.precedence,i));return s.instance}function b(i,s,c){for(var f=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),x=f.length?f[f.length-1]:null,S=x,R=0;R<f.length;R++){var Z=f[R];if(Z.dataset.precedence===s)S=Z;else if(S!==x)break}S?S.parentNode.insertBefore(i,S.nextSibling):(s=c.nodeType===9?c.head:c,s.insertBefore(i,s.firstChild))}function M(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.title==null&&(i.title=s.title)}function C(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.integrity==null&&(i.integrity=s.integrity)}var z=null;function k(i,s,c){if(z===null){var f=new Map,x=z=new Map;x.set(c,f)}else x=z,f=x.get(c),f||(f=new Map,x.set(c,f));if(f.has(i))return f;for(f.set(i,null),c=c.getElementsByTagName(i),x=0;x<c.length;x++){var S=c[x];if(!(S[Zs]||S[qe]||i==="link"&&S.getAttribute("rel")==="stylesheet")&&S.namespaceURI!=="http://www.w3.org/2000/svg"){var R=S.getAttribute(s)||"";R=i+R;var Z=f.get(R);Z?Z.push(S):f.set(R,[S])}}return f}function O(i,s,c){i=i.ownerDocument||i,i.head.insertBefore(c,s==="title"?i.querySelector("head > title"):null)}function F(i,s,c){if(c===1||s.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return i=s.disabled,typeof s.precedence=="string"&&i==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function V(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}function q(i,s,c,f){if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var x=t(f.href),S=s.querySelector(n(x));if(S){s=S._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(i.count++,i=ne.bind(i),s.then(i,i)),c.state.loading|=4,c.instance=S,_n(S);return}S=s.ownerDocument||s,f=o(f),(x=ss.get(x))&&M(f,x),S=S.createElement("link"),_n(S);var R=S;R._p=new Promise(function(Z,ce){R.onload=Z,R.onerror=ce}),bn(S,"link",f),c.instance=S}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(c,s),(s=c.state.preload)&&(c.state.loading&3)===0&&(i.count++,c=ne.bind(i),s.addEventListener("load",c),s.addEventListener("error",c))}}var W=0;function ge(i,s){return i.stylesheets&&i.count===0&&we(i,i.stylesheets),0<i.count||0<i.imgCount?function(c){var f=setTimeout(function(){if(i.stylesheets&&we(i,i.stylesheets),i.unsuspend){var S=i.unsuspend;i.unsuspend=null,S()}},6e4+s);0<i.imgBytes&&W===0&&(W=62500*xp());var x=setTimeout(function(){if(i.waitingForImages=!1,i.count===0&&(i.stylesheets&&we(i,i.stylesheets),i.unsuspend)){var S=i.unsuspend;i.unsuspend=null,S()}},(i.imgBytes>W?50:800)+s);return i.unsuspend=c,function(){i.unsuspend=null,clearTimeout(f),clearTimeout(x)}}:null}function ne(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)we(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var le=null;function we(i,s){i.stylesheets=null,i.unsuspend!==null&&(i.count++,le=new Map,s.forEach(Re,i),le=null,ne.call(i))}function Re(i,s){if(!(s.state.loading&4)){var c=le.get(i);if(c)var f=c.get(null);else{c=new Map,le.set(i,c);for(var x=i.querySelectorAll("link[data-precedence],style[data-precedence]"),S=0;S<x.length;S++){var R=x[S];(R.nodeName==="LINK"||R.getAttribute("media")!=="not all")&&(c.set(R.dataset.precedence,R),f=R)}f&&c.set(null,f)}x=s.instance,R=x.getAttribute("data-precedence"),S=c.get(R)||f,S===f&&c.set(null,x),c.set(R,x),this.count++,f=ne.bind(this),x.addEventListener("load",f),x.addEventListener("error",f),S?S.parentNode.insertBefore(x,S.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(x,i.firstChild)),s.state.loading|=4}}var Ze={$$typeof:It,Provider:null,Consumer:null,_currentValue:St,_currentValue2:St,_threadCount:0};function nt(i,s,c,f,x,S,R,Z,ce){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=nn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=nn(0),this.hiddenUpdates=nn(null),this.identifierPrefix=f,this.onUncaughtError=x,this.onCaughtError=S,this.onRecoverableError=R,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ce,this.incompleteTransitions=new Map}function Je(i,s,c,f,x,S,R,Z,ce,Pe,je,He){return i=new nt(i,s,c,R,ce,Pe,je,He,Z),s=1,S===!0&&(s|=24),S=Ba(3,null,null,s),i.current=S,S.stateNode=i,s=Fa(),s.refCount++,i.pooledCache=s,s.refCount++,S.memoizedState={element:f,isDehydrated:c,cache:s},ui(S),i}function it(i){return i?(i=Zr,i):Zr}function gt(i,s,c,f,x,S){x=it(x),f.context===null?f.context=x:f.pendingContext=x,f=Sr(s),f.payload={element:c},S=S===void 0?null:S,S!==null&&(f.callback=S),c=Mr(i,f,s),c!==null&&(pr(c,i,s),Oo(c,i,s))}function et(i,s){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var c=i.retryLane;i.retryLane=c!==0&&c<s?c:s}}function tt(i,s){et(i,s),(i=i.alternate)&&et(i,s)}function Fe(i){if(i.tag===13||i.tag===31){var s=eo(i,67108864);s!==null&&pr(s,i,67108864),tt(i,67108864)}}function Tt(i){if(i.tag===13||i.tag===31){var s=fr();s=Ue(s);var c=eo(i,s);c!==null&&pr(c,i,s),tt(i,s)}}var Et=!0;function vt(i,s,c,f){var x=Be.T;Be.T=null;var S=rt.p;try{rt.p=2,Xt(i,s,c,f)}finally{rt.p=S,Be.T=x}}function ft(i,s,c,f){var x=Be.T;Be.T=null;var S=rt.p;try{rt.p=8,Xt(i,s,c,f)}finally{rt.p=S,Be.T=x}}function Xt(i,s,c,f){if(Et){var x=Ki(f);if(x===null)yd(i,s,f,gn,c),$n(i,f);else if(Xn(x,i,s,c,f))f.stopPropagation();else if($n(i,f),s&4&&-1<zr.indexOf(i)){for(;x!==null;){var S=wa(x);if(S!==null)switch(S.tag){case 3:if(S=S.stateNode,S.current.memoizedState.isDehydrated){var R=wt(S.pendingLanes);if(R!==0){var Z=S;for(Z.pendingLanes|=2,Z.entangledLanes|=2;R;){var ce=1<<31-xe(R);Z.entanglements[1]|=ce,R&=~ce}rs(S),(bi&6)===0&&(sd=Un()+500,gh(0))}}break;case 31:case 13:Z=eo(S,2),Z!==null&&pr(Z,S,2),cd(),tt(S,2)}if(S=Ki(f),S===null&&yd(i,s,f,gn,c),S===x)break;x=S}x!==null&&f.stopPropagation()}else yd(i,s,f,null,c)}}function Ki(i){return i=oa(i),sa(i)}var gn=null;function sa(i){if(gn=null,i=hs(i),i!==null){var s=$e(i);if(s===null)i=null;else{var c=s.tag;if(c===13){if(i=I(s),i!==null)return i;i=null}else if(c===31){if(i=d(s),i!==null)return i;i=null}else if(c===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null)}}return gn=i,null}function gr(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(js()){case ls:return 2;case cs:return 8;case us:case pe:return 32;case U:return 268435456;default:return 32}default:return 32}}var za=!1,Ji=null,mi=null,Qi=null,wn=new Map,Tn=new Map,Sn=[],zr="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function $n(i,s){switch(i){case"focusin":case"focusout":Ji=null;break;case"dragenter":case"dragleave":mi=null;break;case"mouseover":case"mouseout":Qi=null;break;case"pointerover":case"pointerout":wn.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Tn.delete(s.pointerId)}}function ua(i,s,c,f,x,S){return i===null||i.nativeEvent!==S?(i={blockedOn:s,domEventName:c,eventSystemFlags:f,nativeEvent:S,targetContainers:[x]},s!==null&&(s=wa(s),s!==null&&Fe(s)),i):(i.eventSystemFlags|=f,s=i.targetContainers,x!==null&&s.indexOf(x)===-1&&s.push(x),i)}function Xn(i,s,c,f,x){switch(s){case"focusin":return Ji=ua(Ji,i,s,c,f,x),!0;case"dragenter":return mi=ua(mi,i,s,c,f,x),!0;case"mouseover":return Qi=ua(Qi,i,s,c,f,x),!0;case"pointerover":var S=x.pointerId;return wn.set(S,ua(wn.get(S)||null,i,s,c,f,x)),!0;case"gotpointercapture":return S=x.pointerId,Tn.set(S,ua(Tn.get(S)||null,i,s,c,f,x)),!0}return!1}function Yn(i){var s=hs(i.target);if(s!==null){var c=$e(s);if(c!==null){if(s=c.tag,s===13){if(s=I(c),s!==null){i.blockedOn=s,Ns(i.priority,function(){Tt(c)});return}}else if(s===31){if(s=d(c),s!==null){i.blockedOn=s,Ns(i.priority,function(){Tt(c)});return}}else if(s===3&&c.stateNode.current.memoizedState.isDehydrated){i.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Mn(i){if(i.blockedOn!==null)return!1;for(var s=i.targetContainers;0<s.length;){var c=Ki(i.nativeEvent);if(c===null){c=i.nativeEvent;var f=new c.constructor(c.type,c);il=f,c.target.dispatchEvent(f),il=null}else return s=wa(c),s!==null&&Fe(s),i.blockedOn=c,!1;s.shift()}return!0}function Cn(i,s,c){Mn(i)&&c.delete(s)}function Xi(){za=!1,Ji!==null&&Mn(Ji)&&(Ji=null),mi!==null&&Mn(mi)&&(mi=null),Qi!==null&&Mn(Qi)&&(Qi=null),wn.forEach(Cn),Tn.forEach(Cn)}function _r(i,s){i.blockedOn===s&&(i.blockedOn=null,za||(za=!0,K.unstable_scheduleCallback(K.unstable_NormalPriority,Xi)))}var Ko=null;function os(i){Ko!==i&&(Ko=i,K.unstable_scheduleCallback(K.unstable_NormalPriority,function(){Ko===i&&(Ko=null);for(var s=0;s<i.length;s+=3){var c=i[s],f=i[s+1],x=i[s+2];if(typeof f!="function"){if(sa(f||c)===null)continue;break}var S=wa(c);S!==null&&(i.splice(s,3),s-=3,Kc(S,{pending:!0,data:x,method:c.method,action:f},f,x))}}))}function gu(i){function s(ce){return _r(ce,i)}Ji!==null&&_r(Ji,i),mi!==null&&_r(mi,i),Qi!==null&&_r(Qi,i),wn.forEach(s),Tn.forEach(s);for(var c=0;c<Sn.length;c++){var f=Sn[c];f.blockedOn===i&&(f.blockedOn=null)}for(;0<Sn.length&&(c=Sn[0],c.blockedOn===null);)Yn(c),c.blockedOn===null&&Sn.shift();if(c=(i.ownerDocument||i).$$reactFormReplay,c!=null)for(f=0;f<c.length;f+=3){var x=c[f],S=c[f+1],R=x[xt]||null;if(typeof S=="function")R||os(c);else if(R){var Z=null;if(S&&S.hasAttribute("formAction")){if(x=S,R=S[xt]||null)Z=R.formAction;else if(sa(x)!==null)continue}else Z=R.action;typeof Z=="function"?c[f+1]=Z:(c.splice(f,3),f-=3),os(c)}}}function Mc(){function i(S){S.canIntercept&&S.info==="react-transition"&&S.intercept({handler:function(){return new Promise(function(R){return x=R})},focusReset:"manual",scroll:"manual"})}function s(){x!==null&&(x(),x=null),f||setTimeout(c,20)}function c(){if(!f&&!navigation.transition){var S=navigation.currentEntry;S&&S.url!=null&&navigation.navigate(S.url,{state:S.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var f=!1,x=null;return navigation.addEventListener("navigate",i),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(c,100),function(){f=!0,navigation.removeEventListener("navigate",i),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),x!==null&&(x(),x=null)}}}function Qo(i){this._internalRoot=i}Wo.prototype.render=Qo.prototype.render=function(i){var s=this._internalRoot;if(s===null)throw Error(H(409));var c=s.current,f=fr();gt(c,f,i,s,null,null)},Wo.prototype.unmount=Qo.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var s=i.containerInfo;gt(i.current,2,null,i,null,null),cd(),s[Pt]=null}};function Wo(i){this._internalRoot=i}Wo.prototype.unstable_scheduleHydration=function(i){if(i){var s=Da();i={blockedOn:null,target:i,priority:s};for(var c=0;c<Sn.length&&s!==0&&s<Sn[c].priority;c++);Sn.splice(c,0,i),c===0&&Yn(i)}};var Cc=re.version;if(Cc!=="19.2.0")throw Error(H(527,Cc,"19.2.0"));rt.findDOMNode=function(i){var s=i._reactInternals;if(s===void 0)throw typeof i.render=="function"?Error(H(188)):(i=Object.keys(i).join(","),Error(H(268,i)));return i=Ie(s),i=i!==null?ot(i):null,i=i===null?null:i.stateNode,i};var _u={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:Be,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Mh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Mh.isDisabled&&Mh.supportsFiber)try{ie=Mh.inject(_u),oe=Mh}catch{}}return kf.createRoot=function(i,s){if(!Me(i))throw Error(H(299));var c=!1,f="",x=$u,S=Bd,R=Nf;return s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(f=s.identifierPrefix),s.onUncaughtError!==void 0&&(x=s.onUncaughtError),s.onCaughtError!==void 0&&(S=s.onCaughtError),s.onRecoverableError!==void 0&&(R=s.onRecoverableError)),s=Je(i,1,!1,null,null,c,f,null,x,S,R,Mc),i[Pt]=s.current,_d(i),new Qo(s)},kf.hydrateRoot=function(i,s,c){if(!Me(i))throw Error(H(299));var f=!1,x="",S=$u,R=Bd,Z=Nf,ce=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(x=c.identifierPrefix),c.onUncaughtError!==void 0&&(S=c.onUncaughtError),c.onCaughtError!==void 0&&(R=c.onCaughtError),c.onRecoverableError!==void 0&&(Z=c.onRecoverableError),c.formState!==void 0&&(ce=c.formState)),s=Je(i,1,!0,s,c??null,f,x,ce,S,R,Z,Mc),s.context=it(null),c=s.current,f=fr(),f=Ue(f),x=Sr(f),x.callback=null,Mr(c,x,f),c=f,s.current.lanes=c,an(s,c),rs(s),i[Pt]=s.current,_d(i),new Wo(s)},kf.version="19.2.0",kf}var ym;function Km(){if(ym)return Yp.exports;ym=1;function K(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(K)}catch(re){console.error(re)}}return K(),Yp.exports=Ym(),Yp.exports}var Qm=Km(),Ap={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.8.0/LICENSE.txt
 */var Wm=Ap.exports,vm;function Jm(){return vm||(vm=1,(function(K,re){(function(ae,H){K.exports=H()})(Wm,(function(){var ae={},H={};function Me(I,d,ze){if(H[I]=ze,I==="index"){var Ie="var sharedModule = {}; ("+H.shared+")(sharedModule); ("+H.worker+")(sharedModule);",ot={};return H.shared(ot),H.index(ae,ot),typeof window<"u"&&ae.setWorkerUrl(window.URL.createObjectURL(new Blob([Ie],{type:"text/javascript"}))),ae}}Me("shared",["exports"],(function(I){function d(a,t,n,o){return new(n||(n=Promise))((function(u,p){function _(M){try{b(o.next(M))}catch(C){p(C)}}function v(M){try{b(o.throw(M))}catch(C){p(C)}}function b(M){var C;M.done?u(M.value):(C=M.value,C instanceof n?C:new n((function(z){z(C)}))).then(_,v)}b((o=o.apply(a,t||[])).next())}))}function ze(a,t){this.x=a,this.y=t}function Ie(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var ot,Ye;typeof SuppressedError=="function"&&SuppressedError,ze.prototype={clone(){return new ze(this.x,this.y)},add(a){return this.clone()._add(a)},sub(a){return this.clone()._sub(a)},multByPoint(a){return this.clone()._multByPoint(a)},divByPoint(a){return this.clone()._divByPoint(a)},mult(a){return this.clone()._mult(a)},div(a){return this.clone()._div(a)},rotate(a){return this.clone()._rotate(a)},rotateAround(a,t){return this.clone()._rotateAround(a,t)},matMult(a){return this.clone()._matMult(a)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(a){return this.x===a.x&&this.y===a.y},dist(a){return Math.sqrt(this.distSqr(a))},distSqr(a){const t=a.x-this.x,n=a.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith(a){return this.angleWithSep(a.x,a.y)},angleWithSep(a,t){return Math.atan2(this.x*t-this.y*a,this.x*a+this.y*t)},_matMult(a){const t=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=t,this},_add(a){return this.x+=a.x,this.y+=a.y,this},_sub(a){return this.x-=a.x,this.y-=a.y,this},_mult(a){return this.x*=a,this.y*=a,this},_div(a){return this.x/=a,this.y/=a,this},_multByPoint(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint(a){return this.x/=a.x,this.y/=a.y,this},_unit(){return this._div(this.mag()),this},_perp(){const a=this.y;return this.y=this.x,this.x=-a,this},_rotate(a){const t=Math.cos(a),n=Math.sin(a),o=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=o,this},_rotateAround(a,t){const n=Math.cos(a),o=Math.sin(a),u=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-o*(this.y-t.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:ze},ze.convert=function(a){if(a instanceof ze)return a;if(Array.isArray(a))return new ze(+a[0],+a[1]);if(a.x!==void 0&&a.y!==void 0)return new ze(+a.x,+a.y);throw new Error("Expected [x, y] or {x, y} point format")};var Ke=(function(){if(Ye)return ot;function a(t,n,o,u){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=o,this.p2y=u}return Ye=1,ot=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,u=0;u<8;u++){var p=this.sampleCurveX(o)-t;if(Math.abs(p)<n)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o-=p/_}var v=0,b=1;for(o=t,u=0;u<20&&(p=this.sampleCurveX(o),!(Math.abs(p-t)<n));u++)t>p?v=o:b=o,o=.5*(b-v)+v;return o},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},ot})(),be=Ie(Ke);let ci,Bt;function tn(){return ci==null&&(ci=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ci}function dn(){if(Bt==null&&(Bt=!1,tn())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<25;o++){const u=4*o;t.fillStyle=`rgb(${u},${u+1},${u+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&n[o]!==o){Bt=!0;break}}}return Bt||!1}var hi=1e-6,It=typeof Float32Array<"u"?Float32Array:Array;function Ci(){var a=new It(9);return It!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function Kn(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Ui(){var a=new It(3);return It!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Nt(a){var t=a[0],n=a[1],o=a[2];return Math.sqrt(t*t+n*n+o*o)}function An(a,t,n){var o=new It(3);return o[0]=a,o[1]=t,o[2]=n,o}function zn(a,t,n){return a[0]=t[0]+n[0],a[1]=t[1]+n[1],a[2]=t[2]+n[2],a}function Pn(a,t,n){return a[0]=t[0]*n,a[1]=t[1]*n,a[2]=t[2]*n,a}function gi(a,t,n){var o=t[0],u=t[1],p=t[2],_=n[0],v=n[1],b=n[2];return a[0]=u*b-p*v,a[1]=p*_-o*b,a[2]=o*v-u*_,a}var ji,ha=Nt;function ba(a,t,n){var o=t[0],u=t[1],p=t[2],_=t[3];return a[0]=n[0]*o+n[4]*u+n[8]*p+n[12]*_,a[1]=n[1]*o+n[5]*u+n[9]*p+n[13]*_,a[2]=n[2]*o+n[6]*u+n[10]*p+n[14]*_,a[3]=n[3]*o+n[7]*u+n[11]*p+n[15]*_,a}function Dn(){var a=new It(4);return It!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function Be(a,t,n,o){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",p=Math.PI/360;t*=p,o*=p,n*=p;var _=Math.sin(t),v=Math.cos(t),b=Math.sin(n),M=Math.cos(n),C=Math.sin(o),z=Math.cos(o);switch(u){case"xyz":a[0]=_*M*z+v*b*C,a[1]=v*b*z-_*M*C,a[2]=v*M*C+_*b*z,a[3]=v*M*z-_*b*C;break;case"xzy":a[0]=_*M*z-v*b*C,a[1]=v*b*z-_*M*C,a[2]=v*M*C+_*b*z,a[3]=v*M*z+_*b*C;break;case"yxz":a[0]=_*M*z+v*b*C,a[1]=v*b*z-_*M*C,a[2]=v*M*C-_*b*z,a[3]=v*M*z+_*b*C;break;case"yzx":a[0]=_*M*z+v*b*C,a[1]=v*b*z+_*M*C,a[2]=v*M*C-_*b*z,a[3]=v*M*z-_*b*C;break;case"zxy":a[0]=_*M*z-v*b*C,a[1]=v*b*z+_*M*C,a[2]=v*M*C+_*b*z,a[3]=v*M*z-_*b*C;break;case"zyx":a[0]=_*M*z-v*b*C,a[1]=v*b*z+_*M*C,a[2]=v*M*C-_*b*z,a[3]=v*M*z+_*b*C;break;default:throw new Error("Unknown angle order "+u)}return a}function rt(){var a=new It(2);return It!=Float32Array&&(a[0]=0,a[1]=0),a}function St(a,t){var n=new It(2);return n[0]=a,n[1]=t,n}Ui(),ji=new It(4),It!=Float32Array&&(ji[0]=0,ji[1]=0,ji[2]=0,ji[3]=0),Ui(),An(1,0,0),An(0,1,0),Dn(),Dn(),Ci(),rt();const _t=8192;function ni(a,t,n){return t*(_t/(a.tileSize*Math.pow(2,n-a.tileID.overscaledZ)))}function he(a,t){return(a%t+t)%t}function Ne(a,t,n){return a*(1-n)+t*n}function at(a){if(a<=0)return 0;if(a>=1)return 1;const t=a*a,n=t*a;return 4*(a<.5?n:3*(a-t)+n-.75)}function ut(a,t,n,o){const u=new be(a,t,n,o);return p=>u.solve(p)}const Mt=ut(.25,.1,.25,1);function Ct(a,t,n){return Math.min(n,Math.max(t,a))}function Qt(a,t,n){const o=n-t,u=((a-t)%o+o)%o+t;return u===t?n:u}function wi(a,...t){for(const n of t)for(const o in n)a[o]=n[o];return a}let si=1;function tr(a,t,n){const o={};for(const u in a)o[u]=t.call(this,a[u],u,a);return o}function ir(a,t,n){const o={};for(const u in a)t.call(this,a[u],u,a)&&(o[u]=a[u]);return o}function Qn(a){return Array.isArray(a)?a.map(Qn):typeof a=="object"&&a?tr(a,Qn):a}const Ni={};function zi(a){Ni[a]||(typeof console<"u"&&console.warn(a),Ni[a]=!0)}function $a(a,t,n){return(n.y-a.y)*(t.x-a.x)>(t.y-a.y)*(n.x-a.x)}function nr(a){return typeof WorkerGlobalScope<"u"&&a!==void 0&&a instanceof WorkerGlobalScope}let xo=null;function vr(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const ar="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Os(a,t,n,o,u){return d(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const p=new VideoFrame(a,{timestamp:0});try{const _=p?.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);const v=_.startsWith("BGR"),b=new Uint8ClampedArray(o*u*4);if(yield p.copyTo(b,(function(M,C,z,k,O){const F=4*Math.max(-C,0),V=(Math.max(0,z)-z)*k*4+F,q=4*k,W=Math.max(0,C),ge=Math.max(0,z);return{rect:{x:W,y:ge,width:Math.min(M.width,C+k)-W,height:Math.min(M.height,z+O)-ge},layout:[{offset:V,stride:q}]}})(a,t,n,o,u)),v)for(let M=0;M<b.length;M+=4){const C=b[M];b[M]=b[M+2],b[M+2]=C}return b}finally{p.close()}}))}let Pr,Fs;function Us(a,t,n,o){return a.addEventListener(t,n,o),{unsubscribe:()=>{a.removeEventListener(t,n,o)}}}function Un(a){return a*Math.PI/180}function js(a){return a/Math.PI*180}const ls={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},cs={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},us="AbortError";function pe(){return new Error(us)}const U={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function j(a){return U.REGISTERED_PROTOCOLS[a.substring(0,a.indexOf("://"))]}const G="global-dispatcher";class ie extends Error{constructor(t,n,o,u){super(`AJAXError: ${n} (${t}): ${o}`),this.status=t,this.statusText=n,this.url=o,this.body=u}}const oe=()=>nr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,fe=function(a,t){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){const o=j(a.url);if(o)return o(a,t);if(nr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,targetMapId:G},t)}if(!(/^file:/.test(n=a.url)||/^file:/.test(oe())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,u){return d(this,void 0,void 0,(function*(){const p=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:oe(),signal:u.signal});let _,v;o.type!=="json"||p.headers.has("Accept")||p.headers.set("Accept","application/json");try{_=yield fetch(p)}catch(M){throw new ie(0,M.message,o.url,new Blob)}if(!_.ok){const M=yield _.blob();throw new ie(_.status,_.statusText,o.url,M)}v=o.type==="arrayBuffer"||o.type==="image"?_.arrayBuffer():o.type==="json"?_.json():_.text();const b=yield v;if(u.signal.aborted)throw pe();return{data:b,cacheControl:_.headers.get("Cache-Control"),expires:_.headers.get("Expires")}}))})(a,t);if(nr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,mustQueue:!0,targetMapId:G},t)}var n;return(function(o,u){return new Promise(((p,_)=>{var v;const b=new XMLHttpRequest;b.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(b.responseType="arraybuffer");for(const M in o.headers)b.setRequestHeader(M,o.headers[M]);o.type==="json"&&(b.responseType="text",!((v=o.headers)===null||v===void 0)&&v.Accept||b.setRequestHeader("Accept","application/json")),b.withCredentials=o.credentials==="include",b.onerror=()=>{_(new Error(b.statusText))},b.onload=()=>{if(!u.signal.aborted)if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let M=b.response;if(o.type==="json")try{M=JSON.parse(b.response)}catch(C){return void _(C)}p({data:M,cacheControl:b.getResponseHeader("Cache-Control"),expires:b.getResponseHeader("Expires")})}else{const M=new Blob([b.response],{type:b.getResponseHeader("Content-Type")});_(new ie(b.status,b.statusText,o.url,M))}},u.signal.addEventListener("abort",(()=>{b.abort(),_(pe())})),b.send(o.body)}))})(a,t)};function xe(a){if(!a||a.indexOf("://")<=0||a.indexOf("data:image/")===0||a.indexOf("blob:")===0)return!0;const t=new URL(a),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function ye(a,t,n){n[a]&&n[a].indexOf(t)!==-1||(n[a]=n[a]||[],n[a].push(t))}function Le(a,t,n){if(n&&n[a]){const o=n[a].indexOf(t);o!==-1&&n[a].splice(o,1)}}class Xe{constructor(t,n={}){wi(this,n),this.type=t}}class Oe extends Xe{constructor(t,n={}){super("error",wi({error:t},n))}}class ct{on(t,n){return this._listeners=this._listeners||{},ye(t,n,this._listeners),{unsubscribe:()=>{this.off(t,n)}}}off(t,n){return Le(t,n,this._listeners),Le(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},ye(t,n,this._oneTimeListeners),this):new Promise((o=>this.once(t,o)))}fire(t,n){typeof t=="string"&&(t=new Xe(t,n||{}));const o=t.type;if(this.listens(o)){t.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const v of u)v.call(this,t);const p=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const v of p)Le(o,v,this._oneTimeListeners),v.call(this,t);const _=this._eventedParent;_&&(wi(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(t))}else t instanceof Oe&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var _e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const wt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Vt(a,t){const n={};for(const o in a)o!=="ref"&&(n[o]=a[o]);return wt.forEach((o=>{o in t&&(n[o]=t[o])})),n}function pt(a,t){if(Array.isArray(a)){if(!Array.isArray(t)||a.length!==t.length)return!1;for(let n=0;n<a.length;n++)if(!pt(a[n],t[n]))return!1;return!0}if(typeof a=="object"&&a!==null&&t!==null){if(typeof t!="object"||Object.keys(a).length!==Object.keys(t).length)return!1;for(const n in a)if(!pt(a[n],t[n]))return!1;return!0}return a===t}function Ot(a,t){a.push(t)}function Pi(a,t,n){Ot(n,{command:"addSource",args:[a,t[a]]})}function nn(a,t,n){Ot(t,{command:"removeSource",args:[a]}),n[a]=!0}function an(a,t,n,o){nn(a,n,o),Pi(a,t,n)}function jn(a,t,n){let o;for(o in a[n])if(Object.prototype.hasOwnProperty.call(a[n],o)&&o!=="data"&&!pt(a[n][o],t[n][o]))return!1;for(o in t[n])if(Object.prototype.hasOwnProperty.call(t[n],o)&&o!=="data"&&!pt(a[n][o],t[n][o]))return!1;return!0}function In(a,t,n,o,u,p){a=a||{},t=t||{};for(const _ in a)Object.prototype.hasOwnProperty.call(a,_)&&(pt(a[_],t[_])||n.push({command:p,args:[o,_,t[_],u]}));for(const _ in t)Object.prototype.hasOwnProperty.call(t,_)&&!Object.prototype.hasOwnProperty.call(a,_)&&(pt(a[_],t[_])||n.push({command:p,args:[o,_,t[_],u]}))}function Di(a){return a.id}function fn(a,t){return a[t.id]=t,a}class Ue{constructor(t,n,o,u){this.message=(t?`${t}: `:"")+o,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function rn(a,...t){for(const n of t)for(const o in n)a[o]=n[o];return a}class Da extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class Ns{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[o,u]of n)this.bindings[o]=u}concat(t){return new Ns(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const sn={kind:"null"},qe={kind:"number"},xt={kind:"string"},Pt={kind:"boolean"},Nn={kind:"color"},bo={kind:"projectionDefinition"},Vs={kind:"object"},Rt={kind:"value"},Zs={kind:"collator"},Dr={kind:"formatted"},hs={kind:"padding"},wa={kind:"colorArray"},Ir={kind:"numberArray"},Ii={kind:"resolvedImage"},_n={kind:"variableAnchorOffsetCollection"};function Ta(a,t){return{kind:"array",itemType:a,N:t}}function Ti(a){if(a.kind==="array"){const t=Ti(a.itemType);return typeof a.N=="number"?`array<${t}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${t}>`}return a.kind}const Gs=[sn,qe,xt,Pt,Nn,bo,Dr,Vs,Ta(Rt),hs,Ir,wa,Ii,_n];function Rr(a,t){if(t.kind==="error")return null;if(a.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Rr(a.itemType,t.itemType))&&(typeof a.N!="number"||a.N===t.N))return null}else{if(a.kind===t.kind)return null;if(a.kind==="value"){for(const n of Gs)if(!Rr(n,t))return null}}return`Expected ${Ti(a)} but found ${Ti(t)} instead.`}function vu(a,t){return t.some((n=>n.kind===a.kind))}function ds(a,t){return t.some((n=>n==="null"?a===null:n==="array"?Array.isArray(a):n==="object"?a&&!Array.isArray(a)&&typeof a=="object":n===typeof a))}function fs(a,t){return a.kind==="array"&&t.kind==="array"?a.itemType.kind===t.itemType.kind&&typeof a.N=="number":a.kind===t.kind}const xu=.96422,Fl=.82521,Ul=4/29,Ia=6/29,Xa=3*Ia*Ia,Ch=Ia*Ia*Ia,zd=Math.PI/180,bu=180/Math.PI;function Ec(a){return(a%=360)<0&&(a+=360),a}function ps([a,t,n,o]){let u,p;const _=Ra((.2225045*(a=wu(a))+.7168786*(t=wu(t))+.0606169*(n=wu(n)))/1);a===t&&t===n?u=p=_:(u=Ra((.4360747*a+.3850649*t+.1430804*n)/xu),p=Ra((.0139322*a+.0971045*t+.7141733*n)/Fl));const v=116*_-16;return[v<0?0:v,500*(u-_),200*(_-p),o]}function wu(a){return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Ra(a){return a>Ch?Math.pow(a,1/3):a/Xa+Ul}function qs([a,t,n,o]){let u=(a+16)/116,p=isNaN(t)?u:u+t/500,_=isNaN(n)?u:u-n/200;return u=1*jl(u),p=xu*jl(p),_=Fl*jl(_),[Ac(3.1338561*p-1.6168667*u-.4906146*_),Ac(-.9787684*p+1.9161415*u+.033454*_),Ac(.0719453*p-.2289914*u+1.4052427*_),o]}function Ac(a){return(a=a<=.00304?12.92*a:1.055*Math.pow(a,1/2.4)-.055)<0?0:a>1?1:a}function jl(a){return a>Ia?a*a*a:Xa*(a-Ul)}const el=Object.hasOwn||function(a,t){return Object.prototype.hasOwnProperty.call(a,t)};function wo(a,t){return el(a,t)?a[t]:void 0}function tl(a){return parseInt(a.padEnd(2,a),16)/255}function da(a,t){return qt(t?a/100:a,0,1)}function qt(a,t,n){return Math.min(Math.max(t,a),n)}function Hs(a){return!a.some(Number.isNaN)}const ms={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function xr(a,t,n){return a+n*(t-a)}function To(a,t,n){return a.map(((o,u)=>xr(o,t[u],n)))}class Ht{constructor(t,n,o,u=1,p=!0){this.r=t,this.g=n,this.b=o,this.a=u,p||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[t,n,o,u]))}static parse(t){if(t instanceof Ht)return t;if(typeof t!="string")return;const n=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=wo(ms,o);if(u){const[_,v,b]=u;return[_/255,v/255,b/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const _=o.length<6?1:2;let v=1;return[tl(o.slice(v,v+=_)),tl(o.slice(v,v+=_)),tl(o.slice(v,v+=_)),tl(o.slice(v,v+_)||"ff")]}if(o.startsWith("rgb")){const _=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[v,b,M,C,z,k,O,F,V,q,W,ge]=_,ne=[C||" ",O||" ",q].join("");if(ne==="  "||ne==="  /"||ne===",,"||ne===",,,"){const le=[M,k,V].join(""),we=le==="%%%"?100:le===""?255:0;if(we){const Re=[qt(+b/we,0,1),qt(+z/we,0,1),qt(+F/we,0,1),W?da(+W,ge):1];if(Hs(Re))return Re}}return}}const p=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[_,v,b,M,C,z,k,O,F]=p,V=[b||" ",C||" ",k].join("");if(V==="  "||V==="  /"||V===",,"||V===",,,"){const q=[+v,qt(+M,0,100),qt(+z,0,100),O?da(+O,F):1];if(Hs(q))return(function([W,ge,ne,le]){function we(Re){const Ze=(Re+W/30)%12,nt=ge*Math.min(ne,1-ne);return ne-nt*Math.max(-1,Math.min(Ze-3,9-Ze,1))}return W=Ec(W),ge/=100,ne/=100,[we(0),we(8),we(4),le]})(q)}}})(t);return n?new Ht(...n,!1):void 0}get rgb(){const{r:t,g:n,b:o,a:u}=this,p=u||1/0;return this.overwriteGetter("rgb",[t/p,n/p,o/p,u])}get hcl(){return this.overwriteGetter("hcl",(function(t){const[n,o,u,p]=ps(t),_=Math.sqrt(o*o+u*u);return[Math.round(1e4*_)?Ec(Math.atan2(u,o)*bu):NaN,_,n,p]})(this.rgb))}get lab(){return this.overwriteGetter("lab",ps(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,o,u]=this.rgb;return`rgba(${[t,n,o].map((p=>Math.round(255*p))).join(",")},${u})`}static interpolate(t,n,o,u="rgb"){switch(u){case"rgb":{const[p,_,v,b]=To(t.rgb,n.rgb,o);return new Ht(p,_,v,b,!1)}case"hcl":{const[p,_,v,b]=t.hcl,[M,C,z,k]=n.hcl;let O,F;if(isNaN(p)||isNaN(M))isNaN(p)?isNaN(M)?O=NaN:(O=M,v!==1&&v!==0||(F=C)):(O=p,z!==1&&z!==0||(F=_));else{let ne=M-p;M>p&&ne>180?ne-=360:M<p&&p-M>180&&(ne+=360),O=p+o*ne}const[V,q,W,ge]=(function([ne,le,we,Re]){return ne=isNaN(ne)?0:ne*zd,qs([we,Math.cos(ne)*le,Math.sin(ne)*le,Re])})([O,F??xr(_,C,o),xr(v,z,o),xr(b,k,o)]);return new Ht(V,q,W,ge,!1)}case"lab":{const[p,_,v,b]=qs(To(t.lab,n.lab,o));return new Ht(p,_,v,b,!1)}}}}Ht.black=new Ht(0,0,0,1),Ht.white=new Ht(1,1,1,1),Ht.transparent=new Ht(0,0,0,0),Ht.red=new Ht(1,0,0,1);class Lr{constructor(t,n,o){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const rr=["bottom","center","top"];class il{constructor(t,n,o,u,p,_){this.text=t,this.image=n,this.scale=o,this.fontStack=u,this.textColor=p,this.verticalAlign=_}}class oa{constructor(t){this.sections=t}static fromString(t){return new oa([new il(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof oa?t:oa.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class on{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof on)return t;if(typeof t=="number")return new on([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new on(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){return new on(To(t.values,n.values,o))}}class Rn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Rn)return t;if(typeof t=="number")return new Rn([t]);if(Array.isArray(t)){for(const n of t)if(typeof n!="number")return;return new Rn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){return new Rn(To(t.values,n.values,o))}}class yn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof yn)return t;if(typeof t=="string"){const o=Ht.parse(t);return o?new yn([o]):void 0}if(!Array.isArray(t))return;const n=[];for(const o of t){if(typeof o!="string")return;const u=Ht.parse(o);if(!u)return;n.push(u)}return new yn(n)}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o,u="rgb"){const p=[];if(t.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let _=0;_<t.values.length;_++)p.push(Ht.interpolate(t.values[_],n.values[_],o,u));return new yn(p)}}class _i extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const Tu=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Vn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Vn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const o=t[n],u=t[n+1];if(typeof o!="string"||!Tu.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new Vn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){const u=t.values,p=n.values;if(u.length!==p.length)throw new _i(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${n.toString()}`);const _=[];for(let v=0;v<u.length;v+=2){if(u[v]!==p[v])throw new _i(`Cannot interpolate values containing mismatched anchors. from[${v}]: ${u[v]}, to[${v}]: ${p[v]}`);_.push(u[v]);const[b,M]=u[v+1],[C,z]=p[v+1];_.push([xr(b,C,o),xr(M,z,o)])}return new Vn(_)}}class vn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new vn({name:t,available:!1}):null}}class Wn{constructor(t,n,o){this.from=t,this.to=n,this.transition=o}static interpolate(t,n,o){return new Wn(t,n,o)}static parse(t){return t instanceof Wn?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new Wn(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new Wn(t.from,t.to,t.transition):typeof t=="string"?new Wn(t,t,1):void 0}}function yi(a,t,n,o){return typeof a=="number"&&a>=0&&a<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[a,t,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[a,t,n,o]:[a,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function La(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Wn||a instanceof Ht||a instanceof Lr||a instanceof oa||a instanceof on||a instanceof Rn||a instanceof yn||a instanceof Vn||a instanceof vn)return!0;if(Array.isArray(a)){for(const t of a)if(!La(t))return!1;return!0}if(typeof a=="object"){for(const t in a)if(!La(a[t]))return!1;return!0}return!1}function bt(a){if(a===null)return sn;if(typeof a=="string")return xt;if(typeof a=="boolean")return Pt;if(typeof a=="number")return qe;if(a instanceof Ht)return Nn;if(a instanceof Wn)return bo;if(a instanceof Lr)return Zs;if(a instanceof oa)return Dr;if(a instanceof on)return hs;if(a instanceof Rn)return Ir;if(a instanceof yn)return wa;if(a instanceof Vn)return _n;if(a instanceof vn)return Ii;if(Array.isArray(a)){const t=a.length;let n;for(const o of a){const u=bt(o);if(n){if(n===u)continue;n=Rt;break}n=u}return Ta(n||Rt,t)}return Vs}function zt(a){const t=typeof a;return a===null?"":t==="string"||t==="number"||t==="boolean"?String(a):a instanceof Ht||a instanceof Wn||a instanceof oa||a instanceof on||a instanceof Rn||a instanceof yn||a instanceof Vn||a instanceof vn?a.toString():JSON.stringify(a)}class kr{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!La(t[1]))return n.error("invalid value");const o=t[1];let u=bt(o);const p=n.expectedType;return u.kind!=="array"||u.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(u=p),new kr(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Yt={string:xt,number:qe,boolean:Pt,object:Vs};class fa{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o,u=1;const p=t[0];if(p==="array"){let v,b;if(t.length>2){const M=t[1];if(typeof M!="string"||!(M in Yt)||M==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);v=Yt[M],u++}else v=Rt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);b=t[2],u++}o=Ta(v,b)}else{if(!Yt[p])throw new Error(`Types doesn't contain name = ${p}`);o=Yt[p]}const _=[];for(;u<t.length;u++){const v=n.parse(t[u],u,Rt);if(!v)return null;_.push(v)}return new fa(o,_)}evaluate(t){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(t);if(!Rr(this.type,bt(o)))return o;if(n===this.args.length-1)throw new _i(`Expected value to be of type ${Ti(this.type)}, but found ${Ti(bt(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const br={"to-boolean":Pt,"to-color":Nn,"to-number":qe,"to-string":xt};class ln{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[0];if(!br[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return n.error("Expected one argument.");const u=br[o],p=[];for(let _=1;_<t.length;_++){const v=n.parse(t[_],_,Rt);if(!v)return null;p.push(v)}return new ln(u,p)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,o;for(const u of this.args){if(n=u.evaluate(t),o=null,n instanceof Ht)return n;if(typeof n=="string"){const p=t.parseColor(n);if(p)return p}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:yi(n[0],n[1],n[2],n[3]),!o))return new Ht(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new _i(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(t);const u=on.parse(n);if(u)return u}throw new _i(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const o of this.args){n=o.evaluate(t);const u=Rn.parse(n);if(u)return u}throw new _i(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const o of this.args){n=o.evaluate(t);const u=yn.parse(n);if(u)return u}throw new _i(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(t);const u=Vn.parse(n);if(u)return u}throw new _i(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(t),n===null)return 0;const u=Number(n);if(!isNaN(u))return u}throw new _i(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return oa.fromString(zt(this.args[0].evaluate(t)));case"resolvedImage":return vn.fromString(zt(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return zt(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Br=["Unknown","Point","LineString","Polygon"];class nl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Br[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache.get(t);return n||(n=Ht.parse(t),this._parseColorCache.set(t,n)),n}}class Or{constructor(t,n,o=[],u,p=new Ns,_=[]){this.registry=t,this.path=o,this.key=o.map((v=>`[${v}]`)).join(""),this.scope=p,this.errors=_,this.expectedType=u,this._isConstant=n}parse(t,n,o,u,p={}){return n?this.concat(n,o,u)._parse(t,p):this._parse(t,p)}_parse(t,n){function o(u,p,_){return _==="assert"?new fa(p,[u]):_==="coerce"?new ln(p,[u]):u}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=t[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[u];if(p){let _=p.parse(t,this);if(!_)return null;if(this.expectedType){const v=this.expectedType,b=_.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||b.kind!=="value"){if(v.kind==="projectionDefinition"&&["string","array"].includes(b.kind)||["color","formatted","resolvedImage"].includes(v.kind)&&["value","string"].includes(b.kind)||["padding","numberArray"].includes(v.kind)&&["value","number","array"].includes(b.kind)||v.kind==="colorArray"&&["value","string","array"].includes(b.kind)||v.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(b.kind))_=o(_,v,n.typeAnnotation||"coerce");else if(this.checkSubtype(v,b))return null}else _=o(_,v,n.typeAnnotation||"assert")}if(!(_ instanceof kr)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const v=new nl;try{_=new kr(_.type,_.evaluate(v))}catch(b){return this.error(b.message),null}}return _}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,o){const u=typeof t=="number"?this.path.concat(t):this.path,p=o?this.scope.concat(o):this.scope;return new Or(this.registry,this._isConstant,u,n||null,p,this.errors)}error(t,...n){const o=`${this.key}${n.map((u=>`[${u}]`)).join("")}`;this.errors.push(new Da(o,t))}checkSubtype(t,n){const o=Rr(t,n);return o&&this.error(o),o}}class Nl{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let p=1;p<t.length-1;p+=2){const _=t[p];if(typeof _!="string")return n.error(`Expected string, but found ${typeof _} instead.`,p);if(/[^a-zA-Z0-9_]/.test(_))return n.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=n.parse(t[p+1],p+1);if(!v)return null;o.push([_,v])}const u=n.parse(t[t.length-1],t.length-1,n.expectedType,o);return u?new Nl(o,u):null}outputDefined(){return this.result.outputDefined()}}class al{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=t[1];return n.scope.has(o)?new al(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class rl{constructor(t,n,o){this.type=t,this.index=n,this.input=o}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,qe),u=n.parse(t[2],2,Ta(n.expectedType||Rt));return o&&u?new rl(u.type.itemType,o,u):null}evaluate(t){const n=this.index.evaluate(t),o=this.input.evaluate(t);if(n<0)throw new _i(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new _i(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new _i(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class $s{constructor(t,n){this.type=Pt,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Rt),u=n.parse(t[2],2,Rt);return o&&u?vu(o.type,[Pt,xt,qe,sn,Rt])?new $s(o,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ti(o.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!ds(n,["boolean","string","number","null"]))throw new _i(`Expected first argument to be of type boolean, string, number or null, but found ${Ti(bt(n))} instead.`);if(!ds(o,["string","array"]))throw new _i(`Expected second argument to be of type array or string, but found ${Ti(bt(o))} instead.`);return o.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class ka{constructor(t,n,o){this.type=qe,this.needle=t,this.haystack=n,this.fromIndex=o}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Rt),u=n.parse(t[2],2,Rt);if(!o||!u)return null;if(!vu(o.type,[Pt,xt,qe,sn,Rt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ti(o.type)} instead`);if(t.length===4){const p=n.parse(t[3],3,qe);return p?new ka(o,u,p):null}return new ka(o,u)}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!ds(n,["boolean","string","number","null"]))throw new _i(`Expected first argument to be of type boolean, string, number or null, but found ${Ti(bt(n))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(t)),ds(o,["string"])){const p=o.indexOf(n,u);return p===-1?-1:[...o.slice(0,p)].length}if(ds(o,["array"]))return o.indexOf(n,u);throw new _i(`Expected second argument to be of type array or string, but found ${Ti(bt(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Zn{constructor(t,n,o,u,p,_){this.inputType=t,this.type=n,this.input=o,this.cases=u,this.outputs=p,this.otherwise=_}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let o,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);const p={},_=[];for(let M=2;M<t.length-1;M+=2){let C=t[M];const z=t[M+1];Array.isArray(C)||(C=[C]);const k=n.concat(M);if(C.length===0)return k.error("Expected at least one branch label.");for(const F of C){if(typeof F!="number"&&typeof F!="string")return k.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return k.error("Numeric branch labels must be integer values.");if(o){if(k.checkSubtype(o,bt(F)))return null}else o=bt(F);if(p[String(F)]!==void 0)return k.error("Branch labels must be unique.");p[String(F)]=_.length}const O=n.parse(z,M,u);if(!O)return null;u=u||O.type,_.push(O)}const v=n.parse(t[1],1,Rt);if(!v)return null;const b=n.parse(t[t.length-1],t.length-1,u);return b?v.type.kind!=="value"&&n.concat(1).checkSubtype(o,v.type)?null:new Zn(o,u,v,p,_,b):null}evaluate(t){const n=this.input.evaluate(t);return(bt(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class sl{constructor(t,n,o){this.type=t,this.branches=n,this.otherwise=o}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const u=[];for(let _=1;_<t.length-1;_+=2){const v=n.parse(t[_],_,Pt);if(!v)return null;const b=n.parse(t[_+1],_+1,o);if(!b)return null;u.push([v,b]),o=o||b.type}const p=n.parse(t[t.length-1],t.length-1,o);if(!p)return null;if(!o)throw new Error("Can't infer output type");return new sl(o,u,p)}evaluate(t){for(const[n,o]of this.branches)if(n.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,o]of this.branches)t(n),t(o);t(this.otherwise)}outputDefined(){return this.branches.every((([t,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}}class Vl{constructor(t,n,o,u){this.type=t,this.input=n,this.beginIndex=o,this.endIndex=u}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Rt),u=n.parse(t[2],2,qe);if(!o||!u)return null;if(!vu(o.type,[Ta(Rt),xt,Rt]))return n.error(`Expected first argument to be of type array or string, but found ${Ti(o.type)} instead`);if(t.length===4){const p=n.parse(t[3],3,qe);return p?new Vl(o.type,o,u,p):null}return new Vl(o.type,o,u)}evaluate(t){const n=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let u;if(this.endIndex&&(u=this.endIndex.evaluate(t)),ds(n,["string"]))return[...n].slice(o,u).join("");if(ds(n,["array"]))return n.slice(o,u);throw new _i(`Expected first argument to be of type array or string, but found ${Ti(bt(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function So(a,t){const n=a.length-1;let o,u,p=0,_=n,v=0;for(;p<=_;)if(v=Math.floor((p+_)/2),o=a[v],u=a[v+1],o<=t){if(v===n||t<u)return v;p=v+1}else{if(!(o>t))throw new _i("Input is not a number.");_=v-1}return 0}class Wi{constructor(t,n,o){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[u,p]of o)this.labels.push(u),this.outputs.push(p)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(t[1],1,qe);if(!o)return null;const u=[];let p=null;n.expectedType&&n.expectedType.kind!=="value"&&(p=n.expectedType);for(let _=1;_<t.length;_+=2){const v=_===1?-1/0:t[_],b=t[_+1],M=_,C=_+1;if(typeof v!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(u.length&&u[u.length-1][0]>=v)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const z=n.parse(b,C,p);if(!z)return null;p=p||z.type,u.push([v,z])}return new Wi(p,o,u)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return o[0].evaluate(t);const p=n.length;return u>=n[p-1]?o[p-1].evaluate(t):o[So(n,u)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Eh(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Zl,Su,Pd=(function(){if(Su)return Zl;function a(t,n,o,u){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=o,this.p2y=u}return Su=1,Zl=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,u=0;u<8;u++){var p=this.sampleCurveX(o)-t;if(Math.abs(p)<n)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o-=p/_}var v=0,b=1;for(o=t,u=0;u<20&&(p=this.sampleCurveX(o),!(Math.abs(p-t)<n));u++)t>p?v=o:b=o,o=.5*(b-v)+v;return o},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},Zl})(),ol=Eh(Pd);class Jn{constructor(t,n,o,u,p){this.type=t,this.operator=n,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[_,v]of p)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(t,n,o,u){let p=0;if(t.name==="exponential")p=Gl(n,t.base,o,u);else if(t.name==="linear")p=Gl(n,1,o,u);else if(t.name==="cubic-bezier"){const _=t.controlPoints;p=new ol(_[0],_[1],_[2],_[3]).solve(Gl(n,1,o,u))}return p}static parse(t,n){let[o,u,p,..._]=t;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const M=u[1];if(typeof M!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:M}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const M=u.slice(1);if(M.length!==4||M.some((C=>typeof C!="number"||C<0||C>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:M}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(p=n.parse(p,2,qe),!p)return null;const v=[];let b=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||n.expectedType==wa?n.expectedType&&n.expectedType.kind!=="value"&&(b=n.expectedType):b=Nn;for(let M=0;M<_.length;M+=2){const C=_[M],z=_[M+1],k=M+3,O=M+4;if(typeof C!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(v.length&&v[v.length-1][0]>=C)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const F=n.parse(z,O,b);if(!F)return null;b=b||F.type,v.push([C,F])}return fs(b,qe)||fs(b,bo)||fs(b,Nn)||fs(b,hs)||fs(b,Ir)||fs(b,wa)||fs(b,_n)||fs(b,Ta(qe))?new Jn(b,o,u,p,v):n.error(`Type ${Ti(b)} is not interpolatable.`)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return o[0].evaluate(t);const p=n.length;if(u>=n[p-1])return o[p-1].evaluate(t);const _=So(n,u),v=Jn.interpolationFactor(this.interpolation,u,n[_],n[_+1]),b=o[_].evaluate(t),M=o[_+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return xr(b,M,v);case"color":return Ht.interpolate(b,M,v);case"padding":return on.interpolate(b,M,v);case"colorArray":return yn.interpolate(b,M,v);case"numberArray":return Rn.interpolate(b,M,v);case"variableAnchorOffsetCollection":return Vn.interpolate(b,M,v);case"array":return To(b,M,v);case"projectionDefinition":return Wn.interpolate(b,M,v)}case"interpolate-hcl":switch(this.type.kind){case"color":return Ht.interpolate(b,M,v,"hcl");case"colorArray":return yn.interpolate(b,M,v,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Ht.interpolate(b,M,v,"lab");case"colorArray":return yn.interpolate(b,M,v,"lab")}}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Gl(a,t,n,o){const u=o-n,p=a-n;return u===0?0:t===1?p/u:(Math.pow(t,p)-1)/(Math.pow(t,u)-1)}const Fr={color:Ht.interpolate,number:xr,padding:on.interpolate,numberArray:Rn.interpolate,colorArray:yn.interpolate,variableAnchorOffsetCollection:Vn.interpolate,array:To};class ql{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o=null;const u=n.expectedType;u&&u.kind!=="value"&&(o=u);const p=[];for(const v of t.slice(1)){const b=n.parse(v,1+p.length,o,void 0,{typeAnnotation:"omit"});if(!b)return null;o=o||b.type,p.push(b)}if(!o)throw new Error("No output type");const _=u&&p.some((v=>Rr(u,v.type)));return new ql(_?Rt:o,p)}evaluate(t){let n,o=null,u=0;for(const p of this.args)if(u++,o=p.evaluate(t),o&&o instanceof vn&&!o.available&&(n||(n=o.name),o=null,u===this.args.length&&(o=n)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function Hl(a,t){return a==="=="||a==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Mo(a,t,n,o){return o.compare(t,n)===0}function pa(a,t,n){const o=a!=="=="&&a!=="!=";return class bm{constructor(p,_,v){this.type=Pt,this.lhs=p,this.rhs=_,this.collator=v,this.hasUntypedArgument=p.type.kind==="value"||_.type.kind==="value"}static parse(p,_){if(p.length!==3&&p.length!==4)return _.error("Expected two or three arguments.");const v=p[0];let b=_.parse(p[1],1,Rt);if(!b)return null;if(!Hl(v,b.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${Ti(b.type)}'.`);let M=_.parse(p[2],2,Rt);if(!M)return null;if(!Hl(v,M.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${Ti(M.type)}'.`);if(b.type.kind!==M.type.kind&&b.type.kind!=="value"&&M.type.kind!=="value")return _.error(`Cannot compare types '${Ti(b.type)}' and '${Ti(M.type)}'.`);o&&(b.type.kind==="value"&&M.type.kind!=="value"?b=new fa(M.type,[b]):b.type.kind!=="value"&&M.type.kind==="value"&&(M=new fa(b.type,[M])));let C=null;if(p.length===4){if(b.type.kind!=="string"&&M.type.kind!=="string"&&b.type.kind!=="value"&&M.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(C=_.parse(p[3],3,Zs),!C)return null}return new bm(b,M,C)}evaluate(p){const _=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(o&&this.hasUntypedArgument){const b=bt(_),M=bt(v);if(b.kind!==M.kind||b.kind!=="string"&&b.kind!=="number")throw new _i(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${b.kind}, ${M.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const b=bt(_),M=bt(v);if(b.kind!=="string"||M.kind!=="string")return t(p,_,v)}return this.collator?n(p,_,v,this.collator.evaluate(p)):t(p,_,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const Ah=pa("==",(function(a,t,n){return t===n}),Mo),zc=pa("!=",(function(a,t,n){return t!==n}),(function(a,t,n,o){return!Mo(0,t,n,o)})),zh=pa("<",(function(a,t,n){return t<n}),(function(a,t,n,o){return o.compare(t,n)<0})),Mu=pa(">",(function(a,t,n){return t>n}),(function(a,t,n,o){return o.compare(t,n)>0})),Dd=pa("<=",(function(a,t,n){return t<=n}),(function(a,t,n,o){return o.compare(t,n)<=0})),Id=pa(">=",(function(a,t,n){return t>=n}),(function(a,t,n,o){return o.compare(t,n)>=0}));class Pc{constructor(t,n,o){this.type=Zs,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const u=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Pt);if(!u)return null;const p=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Pt);if(!p)return null;let _=null;return o.locale&&(_=n.parse(o.locale,1,xt),!_)?null:new Pc(u,p,_)}evaluate(t){return new Lr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Cu{constructor(t,n,o,u,p){this.type=xt,this.number=t,this.locale=n,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const o=n.parse(t[1],1,qe);if(!o)return null;const u=t[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=n.parse(u.locale,1,xt),!p))return null;let _=null;if(u.currency&&(_=n.parse(u.currency,1,xt),!_))return null;let v=null;if(u["min-fraction-digits"]&&(v=n.parse(u["min-fraction-digits"],1,qe),!v))return null;let b=null;return u["max-fraction-digits"]&&(b=n.parse(u["max-fraction-digits"],1,qe),!b)?null:new Cu(o,p,_,v,b)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Co{constructor(t){this.type=Dr,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const u=[];let p=!1;for(let _=1;_<=t.length-1;++_){const v=t[_];if(p&&typeof v=="object"&&!Array.isArray(v)){p=!1;let b=null;if(v["font-scale"]&&(b=n.parse(v["font-scale"],1,qe),!b))return null;let M=null;if(v["text-font"]&&(M=n.parse(v["text-font"],1,Ta(xt)),!M))return null;let C=null;if(v["text-color"]&&(C=n.parse(v["text-color"],1,Nn),!C))return null;let z=null;if(v["vertical-align"]){if(typeof v["vertical-align"]=="string"&&!rr.includes(v["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${v["vertical-align"]}' instead.`);if(z=n.parse(v["vertical-align"],1,xt),!z)return null}const k=u[u.length-1];k.scale=b,k.font=M,k.textColor=C,k.verticalAlign=z}else{const b=n.parse(t[_],1,Rt);if(!b)return null;const M=b.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:b,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Co(u)}evaluate(t){return new oa(this.sections.map((n=>{const o=n.content.evaluate(t);return bt(o)===Ii?new il("",o,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(t):null):new il(zt(o),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null,n.verticalAlign?n.verticalAlign.evaluate(t):null)})))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor),n.verticalAlign&&t(n.verticalAlign)}outputDefined(){return!1}}class Eu{constructor(t){this.type=Ii,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const o=n.parse(t[1],1,xt);return o?new Eu(o):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),o=vn.fromString(n);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(n)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class Dc{constructor(t){this.type=qe,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=n.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Ti(o.type)} instead.`):new Dc(o):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new _i(`Expected value to be of type string or array, but found ${Ti(bt(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const wr=8192;function Au(a,t){const n=(180+a[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,u=Math.pow(2,t.z);return[Math.round(n*u*wr),Math.round(o*u*wr)]}function Xs(a,t){const n=Math.pow(2,t.z);return[(u=(a[0]/wr+t.x)/n,360*u-180),(o=(a[1]/wr+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,u}function $l(a,t){a[0]=Math.min(a[0],t[0]),a[1]=Math.min(a[1],t[1]),a[2]=Math.max(a[2],t[0]),a[3]=Math.max(a[3],t[1])}function ll(a,t){return!(a[0]<=t[0]||a[2]>=t[2]||a[1]<=t[1]||a[3]>=t[3])}function Ph(a,t,n){const o=a[0]-t[0],u=a[1]-t[1],p=a[0]-n[0],_=a[1]-n[1];return o*_-p*u==0&&o*p<=0&&u*_<=0}function Xl(a,t,n,o){return(u=[o[0]-n[0],o[1]-n[1]])[0]*(p=[t[0]-a[0],t[1]-a[1]])[1]-u[1]*p[0]!=0&&!(!Ih(a,t,n,o)||!Ih(n,o,a,t));var u,p}function Dh(a,t,n){for(const o of n)for(let u=0;u<o.length-1;++u)if(Xl(a,t,o[u],o[u+1]))return!0;return!1}function Ys(a,t,n=!1){let o=!1;for(const v of t)for(let b=0;b<v.length-1;b++){if(Ph(a,v[b],v[b+1]))return n;(p=v[b])[1]>(u=a)[1]!=(_=v[b+1])[1]>u[1]&&u[0]<(_[0]-p[0])*(u[1]-p[1])/(_[1]-p[1])+p[0]&&(o=!o)}var u,p,_;return o}function Eo(a,t){for(const n of t)if(Ys(a,n))return!0;return!1}function zu(a,t){for(const n of a)if(!Ys(n,t))return!1;for(let n=0;n<a.length-1;++n)if(Dh(a[n],a[n+1],t))return!1;return!0}function Rd(a,t){for(const n of t)if(zu(a,n))return!0;return!1}function Ih(a,t,n,o){const u=o[0]-n[0],p=o[1]-n[1],_=(a[0]-n[0])*p-u*(a[1]-n[1]),v=(t[0]-n[0])*p-u*(t[1]-n[1]);return _>0&&v<0||_<0&&v>0}function Ic(a,t,n){const o=[];for(let u=0;u<a.length;u++){const p=[];for(let _=0;_<a[u].length;_++){const v=Au(a[u][_],n);$l(t,v),p.push(v)}o.push(p)}return o}function Pu(a,t,n){const o=[];for(let u=0;u<a.length;u++){const p=Ic(a[u],t,n);o.push(p)}return o}function Ks(a,t,n,o){if(a[0]<n[0]||a[0]>n[2]){const u=.5*o;let p=a[0]-n[0]>u?-o:n[0]-a[0]>u?o:0;p===0&&(p=a[0]-n[2]>u?-o:n[2]-a[0]>u?o:0),a[0]+=p}$l(t,a)}function cl(a,t,n,o){const u=Math.pow(2,o.z)*wr,p=[o.x*wr,o.y*wr],_=[];for(const v of a)for(const b of v){const M=[b.x+p[0],b.y+p[1]];Ks(M,t,n,u),_.push(M)}return _}function Rh(a,t,n,o){const u=Math.pow(2,o.z)*wr,p=[o.x*wr,o.y*wr],_=[];for(const b of a){const M=[];for(const C of b){const z=[C.x+p[0],C.y+p[1]];$l(t,z),M.push(z)}_.push(M)}if(t[2]-t[0]<=u/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const b of _)for(const M of b)Ks(M,t,n,u)}var v;return _}class Ur{constructor(t,n){this.type=Pt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(La(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const u=[];for(const p of o.features){const{type:_,coordinates:v}=p.geometry;_==="Polygon"&&u.push(v),_==="MultiPolygon"&&u.push(...v)}if(u.length)return new Ur(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Ur(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Ur(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(n,o){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(o.type==="Polygon"){const v=Ic(o.coordinates,p,_),b=cl(n.geometry(),u,p,_);if(!ll(u,p))return!1;for(const M of b)if(!Ys(M,v))return!1}if(o.type==="MultiPolygon"){const v=Pu(o.coordinates,p,_),b=cl(n.geometry(),u,p,_);if(!ll(u,p))return!1;for(const M of b)if(!Eo(M,v))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(n,o){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(o.type==="Polygon"){const v=Ic(o.coordinates,p,_),b=Rh(n.geometry(),u,p,_);if(!ll(u,p))return!1;for(const M of b)if(!zu(M,v))return!1}if(o.type==="MultiPolygon"){const v=Pu(o.coordinates,p,_),b=Rh(n.geometry(),u,p,_);if(!ll(u,p))return!1;for(const M of b)if(!Rd(M,v))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Rc=class{constructor(a=[],t=(n,o)=>n<o?-1:n>o?1:0){if(this.data=a,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:t,compare:n}=this,o=t[a];for(;a>0;){const u=a-1>>1,p=t[u];if(n(o,p)>=0)break;t[a]=p,a=u}t[a]=o}_down(a){const{data:t,compare:n}=this,o=this.length>>1,u=t[a];for(;a<o;){let p=1+(a<<1);const _=p+1;if(_<this.length&&n(t[_],t[p])<0&&(p=_),n(t[p],u)>=0)break;t[a]=t[p],a=p}t[a]=u}};function Lc(a,t,n=0,o=a.length-1,u=Du){for(;o>n;){if(o-n>600){const b=o-n+1,M=t-n+1,C=Math.log(b),z=.5*Math.exp(2*C/3),k=.5*Math.sqrt(C*z*(b-z)/b)*(M-b/2<0?-1:1);Lc(a,t,Math.max(n,Math.floor(t-M*z/b+k)),Math.min(o,Math.floor(t+(b-M)*z/b+k)),u)}const p=a[t];let _=n,v=o;for(Ao(a,n,t),u(a[o],p)>0&&Ao(a,n,o);_<v;){for(Ao(a,_,v),_++,v--;u(a[_],p)<0;)_++;for(;u(a[v],p)>0;)v--}u(a[n],p)===0?Ao(a,n,v):(v++,Ao(a,v,o)),v<=t&&(n=v+1),t<=v&&(o=v-1)}}function Ao(a,t,n){const o=a[t];a[t]=a[n],a[n]=o}function Du(a,t){return a<t?-1:a>t?1:0}function ul(a,t){if(a.length<=1)return[a];const n=[];let o,u;for(const p of a){const _=Lh(p);_!==0&&(p.area=Math.abs(_),u===void 0&&(u=_<0),u===_<0?(o&&n.push(o),o=[p]):o.push(p))}if(o&&n.push(o),t>1)for(let p=0;p<n.length;p++)n[p].length<=t||(Lc(n[p],t,1,n[p].length-1,Iu),n[p]=n[p].slice(0,t));return n}function Iu(a,t){return t.area-a.area}function Lh(a){let t=0;for(let n,o,u=0,p=a.length,_=p-1;u<p;_=u++)n=a[u],o=a[_],t+=(o.x-n.x)*(n.y+o.y);return t}const kh=1/298.257223563,Bh=kh*(2-kh),Ru=Math.PI/180;class Lu{constructor(t){const n=6378.137*Ru*1e3,o=Math.cos(t*Ru),u=1/(1-Bh*(1-o*o)),p=Math.sqrt(u);this.kx=n*p*o,this.ky=n*p*u*(1-Bh)}distance(t,n){const o=this.wrap(t[0]-n[0])*this.kx,u=(t[1]-n[1])*this.ky;return Math.sqrt(o*o+u*u)}pointOnLine(t,n){let o,u,p,_,v=1/0;for(let b=0;b<t.length-1;b++){let M=t[b][0],C=t[b][1],z=this.wrap(t[b+1][0]-M)*this.kx,k=(t[b+1][1]-C)*this.ky,O=0;z===0&&k===0||(O=(this.wrap(n[0]-M)*this.kx*z+(n[1]-C)*this.ky*k)/(z*z+k*k),O>1?(M=t[b+1][0],C=t[b+1][1]):O>0&&(M+=z/this.kx*O,C+=k/this.ky*O)),z=this.wrap(n[0]-M)*this.kx,k=(n[1]-C)*this.ky;const F=z*z+k*k;F<v&&(v=F,o=M,u=C,p=b,_=O)}return{point:[o,u],index:p,t:Math.max(0,Math.min(1,_))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Oh(a,t){return t[0]-a[0]}function ma(a){return a[1]-a[0]+1}function Ya(a,t){return a[1]>=a[0]&&a[1]<t}function ai(a,t){if(a[0]>a[1])return[null,null];const n=ma(a);if(t){if(n===2)return[a,null];const u=Math.floor(n/2);return[[a[0],a[0]+u],[a[0]+u,a[1]]]}if(n===1)return[a,null];const o=Math.floor(n/2)-1;return[[a[0],a[0]+o],[a[0]+o+1,a[1]]]}function kc(a,t){if(!Ya(t,a.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)$l(n,a[o]);return n}function Bc(a){const t=[1/0,1/0,-1/0,-1/0];for(const n of a)for(const o of n)$l(t,o);return t}function ku(a){return a[0]!==-1/0&&a[1]!==-1/0&&a[2]!==1/0&&a[3]!==1/0}function Yl(a,t,n){if(!ku(a)||!ku(t))return NaN;let o=0,u=0;return a[2]<t[0]&&(o=t[0]-a[2]),a[0]>t[2]&&(o=a[0]-t[2]),a[1]>t[3]&&(u=a[1]-t[3]),a[3]<t[1]&&(u=t[1]-a[3]),n.distance([0,0],[o,u])}function zo(a,t,n){const o=n.pointOnLine(t,a);return n.distance(a,o.point)}function Qs(a,t,n,o,u){const p=Math.min(zo(a,[n,o],u),zo(t,[n,o],u)),_=Math.min(zo(n,[a,t],u),zo(o,[a,t],u));return Math.min(p,_)}function Bu(a,t,n,o,u){if(!Ya(t,a.length)||!Ya(o,n.length))return 1/0;let p=1/0;for(let _=t[0];_<t[1];++_){const v=a[_],b=a[_+1];for(let M=o[0];M<o[1];++M){const C=n[M],z=n[M+1];if(Xl(v,b,C,z))return 0;p=Math.min(p,Qs(v,b,C,z,u))}}return p}function Kl(a,t,n,o,u){if(!Ya(t,a.length)||!Ya(o,n.length))return NaN;let p=1/0;for(let _=t[0];_<=t[1];++_)for(let v=o[0];v<=o[1];++v)if(p=Math.min(p,u.distance(a[_],n[v])),p===0)return p;return p}function Ou(a,t,n){if(Ys(a,t,!0))return 0;let o=1/0;for(const u of t){const p=u[0],_=u[u.length-1];if(p!==_&&(o=Math.min(o,zo(a,[_,p],n)),o===0))return o;const v=n.pointOnLine(u,a);if(o=Math.min(o,n.distance(a,v.point)),o===0)return o}return o}function Fh(a,t,n,o){if(!Ya(t,a.length))return NaN;for(let p=t[0];p<=t[1];++p)if(Ys(a[p],n,!0))return 0;let u=1/0;for(let p=t[0];p<t[1];++p){const _=a[p],v=a[p+1];for(const b of n)for(let M=0,C=b.length,z=C-1;M<C;z=M++){const k=b[z],O=b[M];if(Xl(_,v,k,O))return 0;u=Math.min(u,Qs(_,v,k,O,o))}}return u}function Ws(a,t){for(const n of a)for(const o of n)if(Ys(o,t,!0))return!0;return!1}function hl(a,t,n,o=1/0){const u=Bc(a),p=Bc(t);if(o!==1/0&&Yl(u,p,n)>=o)return o;if(ll(u,p)){if(Ws(a,t))return 0}else if(Ws(t,a))return 0;let _=1/0;for(const v of a)for(let b=0,M=v.length,C=M-1;b<M;C=b++){const z=v[C],k=v[b];for(const O of t)for(let F=0,V=O.length,q=V-1;F<V;q=F++){const W=O[q],ge=O[F];if(Xl(z,k,W,ge))return 0;_=Math.min(_,Qs(z,k,W,ge,n))}}return _}function Oc(a,t,n,o,u,p){if(!p)return;const _=Yl(kc(o,p),u,n);_<t&&a.push([_,p,[0,0]])}function Ql(a,t,n,o,u,p,_){if(!p||!_)return;const v=Yl(kc(o,p),kc(u,_),n);v<t&&a.push([v,p,_])}function jr(a,t,n,o,u=1/0){let p=Math.min(o.distance(a[0],n[0][0]),u);if(p===0)return p;const _=new Rc([[0,[0,a.length-1],[0,0]]],Oh),v=Bc(n);for(;_.length>0;){const b=_.pop();if(b[0]>=p)continue;const M=b[1],C=t?50:100;if(ma(M)<=C){if(!Ya(M,a.length))return NaN;if(t){const z=Fh(a,M,n,o);if(isNaN(z)||z===0)return z;p=Math.min(p,z)}else for(let z=M[0];z<=M[1];++z){const k=Ou(a[z],n,o);if(p=Math.min(p,k),p===0)return 0}}else{const z=ai(M,t);Oc(_,p,o,a,v,z[0]),Oc(_,p,o,a,v,z[1])}}return p}function Wl(a,t,n,o,u,p=1/0){let _=Math.min(p,u.distance(a[0],n[0]));if(_===0)return _;const v=new Rc([[0,[0,a.length-1],[0,n.length-1]]],Oh);for(;v.length>0;){const b=v.pop();if(b[0]>=_)continue;const M=b[1],C=b[2],z=t?50:100,k=o?50:100;if(ma(M)<=z&&ma(C)<=k){if(!Ya(M,a.length)&&Ya(C,n.length))return NaN;let O;if(t&&o)O=Bu(a,M,n,C,u),_=Math.min(_,O);else if(t&&!o){const F=a.slice(M[0],M[1]+1);for(let V=C[0];V<=C[1];++V)if(O=zo(n[V],F,u),_=Math.min(_,O),_===0)return _}else if(!t&&o){const F=n.slice(C[0],C[1]+1);for(let V=M[0];V<=M[1];++V)if(O=zo(a[V],F,u),_=Math.min(_,O),_===0)return _}else O=Kl(a,M,n,C,u),_=Math.min(_,O)}else{const O=ai(M,t),F=ai(C,o);Ql(v,_,u,a,n,O[0],F[0]),Ql(v,_,u,a,n,O[0],F[1]),Ql(v,_,u,a,n,O[1],F[0]),Ql(v,_,u,a,n,O[1],F[1])}}return _}function Fc(a){return a.type==="MultiPolygon"?a.coordinates.map((t=>({type:"Polygon",coordinates:t}))):a.type==="MultiLineString"?a.coordinates.map((t=>({type:"LineString",coordinates:t}))):a.type==="MultiPoint"?a.coordinates.map((t=>({type:"Point",coordinates:t}))):[a]}class Js{constructor(t,n){this.type=qe,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(La(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new Js(o,o.features.map((u=>Fc(u.geometry))).flat());if(o.type==="Feature")return new Js(o,Fc(o.geometry));if("type"in o&&"coordinates"in o)return new Js(o,Fc(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(n,o){const u=n.geometry(),p=u.flat().map((b=>Xs([b.x,b.y],n.canonical)));if(u.length===0)return NaN;const _=new Lu(p[0][1]);let v=1/0;for(const b of o){switch(b.type){case"Point":v=Math.min(v,Wl(p,!1,[b.coordinates],!1,_,v));break;case"LineString":v=Math.min(v,Wl(p,!1,b.coordinates,!0,_,v));break;case"Polygon":v=Math.min(v,jr(p,!1,b.coordinates,_,v))}if(v===0)return v}return v})(t,this.geometries);if(t.geometryType()==="LineString")return(function(n,o){const u=n.geometry(),p=u.flat().map((b=>Xs([b.x,b.y],n.canonical)));if(u.length===0)return NaN;const _=new Lu(p[0][1]);let v=1/0;for(const b of o){switch(b.type){case"Point":v=Math.min(v,Wl(p,!0,[b.coordinates],!1,_,v));break;case"LineString":v=Math.min(v,Wl(p,!0,b.coordinates,!0,_,v));break;case"Polygon":v=Math.min(v,jr(p,!0,b.coordinates,_,v))}if(v===0)return v}return v})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(n,o){const u=n.geometry();if(u.length===0||u[0].length===0)return NaN;const p=ul(u,0).map((b=>b.map((M=>M.map((C=>Xs([C.x,C.y],n.canonical))))))),_=new Lu(p[0][0][0][1]);let v=1/0;for(const b of o)for(const M of p){switch(b.type){case"Point":v=Math.min(v,jr([b.coordinates],!1,M,_,v));break;case"LineString":v=Math.min(v,jr(b.coordinates,!0,M,_,v));break;case"Polygon":v=Math.min(v,hl(M,b.coordinates,_,v))}if(v===0)return v}return v})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Jl{constructor(t){this.type=Rt,this.key=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=t[1];return o==null?n.error("Global state property must be defined."):typeof o!="string"?n.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new Jl(o)}evaluate(t){var n;const o=(n=t.globals)===null||n===void 0?void 0:n.globalState;return o&&Object.keys(o).length!==0?wo(o,this.key):null}eachChild(){}outputDefined(){return!1}}const dl={"==":Ah,"!=":zc,">":Mu,"<":zh,">=":Id,"<=":Dd,array:fa,at:rl,boolean:fa,case:sl,coalesce:ql,collator:Pc,format:Co,image:Eu,in:$s,"index-of":ka,interpolate:Jn,"interpolate-hcl":Jn,"interpolate-lab":Jn,length:Dc,let:Nl,literal:kr,match:Zn,number:fa,"number-format":Cu,object:fa,slice:Vl,step:Wi,string:fa,"to-boolean":ln,"to-color":ln,"to-number":ln,"to-string":ln,var:al,within:Ur,distance:Js,"global-state":Jl};class sr{constructor(t,n,o,u){this.name=t,this.type=n,this._evaluate=o,this.args=u}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const o=t[0],u=sr.definitions[o];if(!u)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,_=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,v=_.filter((([M])=>!Array.isArray(M)||M.length===t.length-1));let b=null;for(const[M,C]of v){b=new Or(n.registry,Po,n.path,null,n.scope);const z=[];let k=!1;for(let O=1;O<t.length;O++){const F=t[O],V=Array.isArray(M)?M[O-1]:M.type,q=b.parse(F,1+z.length,V);if(!q){k=!0;break}z.push(q)}if(!k)if(Array.isArray(M)&&M.length!==z.length)b.error(`Expected ${M.length} arguments, but found ${z.length} instead.`);else{for(let O=0;O<z.length;O++){const F=Array.isArray(M)?M[O]:M.type,V=z[O];b.concat(O+1).checkSubtype(F,V.type)}if(b.errors.length===0)return new sr(o,p,C,z)}}if(v.length===1)n.errors.push(...b.errors);else{const M=(v.length?v:_).map((([z])=>{return k=z,Array.isArray(k)?`(${k.map(Ti).join(", ")})`:`(${Ti(k.type)}...)`;var k})).join(" | "),C=[];for(let z=1;z<t.length;z++){const k=n.parse(t[z],1+C.length);if(!k)return null;C.push(Ti(k.type))}n.error(`Expected arguments of type ${M}, but found (${C.join(", ")}) instead.`)}return null}static register(t,n){sr.definitions=n;for(const o in n)t[o]=sr}}function Fu(a,[t,n,o,u]){t=t.evaluate(a),n=n.evaluate(a),o=o.evaluate(a);const p=u?u.evaluate(a):1,_=yi(t,n,o,p);if(_)throw new _i(_);return new Ht(t/255,n/255,o/255,p,!1)}function Uu(a,t){return a in t}function ec(a,t){const n=t[a];return n===void 0?null:n}function la(a){return{type:a}}function Po(a){if(a instanceof al)return Po(a.boundExpression);if(a instanceof sr&&a.name==="error"||a instanceof Pc||a instanceof Ur||a instanceof Js||a instanceof Jl)return!1;const t=a instanceof ln||a instanceof fa;let n=!0;return a.eachChild((o=>{n=t?n&&Po(o):n&&o instanceof kr})),!!n&&Sa(a)&&fl(a,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Sa(a){if(a instanceof sr&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Ur||a instanceof Js)return!1;let t=!0;return a.eachChild((n=>{t&&!Sa(n)&&(t=!1)})),t}function Nr(a){if(a instanceof sr&&a.name==="feature-state")return!1;let t=!0;return a.eachChild((n=>{t&&!Nr(n)&&(t=!1)})),t}function fl(a,t){if(a instanceof sr&&t.indexOf(a.name)>=0)return!1;let n=!0;return a.eachChild((o=>{n&&!fl(o,t)&&(n=!1)})),n}function tc(a){return{result:"success",value:a}}function gs(a){return{result:"error",value:a}}function Vr(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function eo(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Uc(a){return!!a.expression&&a.expression.interpolated}function Zt(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function Zr(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)&&bt(a)===Vs}function Ld(a){return a}function Ba(a,t){const n=a.stops&&typeof a.stops[0][0]=="object",o=n||!(n||a.property!==void 0),u=a.type||(Uc(t)?"exponential":"interval"),p=(function(C){switch(C.type){case"color":return Ht.parse;case"padding":return on.parse;case"numberArray":return Rn.parse;case"colorArray":return yn.parse;default:return null}})(t);if(p&&((a=rn({},a)).stops&&(a.stops=a.stops.map((C=>[C[0],p(C[1])]))),a.default=p(a.default?a.default:t.default)),a.colorSpace&&(_=a.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${a.colorSpace}"`);var _;const v=(function(C){switch(C){case"exponential":return ic;case"interval":return Uh;case"categorical":return qr;case"identity":return Do;default:throw new Error(`Unknown function type "${C}"`)}})(u);let b,M;if(u==="categorical"){b=Object.create(null);for(const C of a.stops)b[C[0]]=C[1];M=typeof a.stops[0][0]}if(n){const C={},z=[];for(let F=0;F<a.stops.length;F++){const V=a.stops[F],q=V[0].zoom;C[q]===void 0&&(C[q]={zoom:q,type:a.type,property:a.property,default:a.default,stops:[]},z.push(q)),C[q].stops.push([V[0].value,V[1]])}const k=[];for(const F of z)k.push([C[F].zoom,Ba(C[F],t)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:Jn.interpolationFactor.bind(void 0,O),zoomStops:k.map((F=>F[0])),evaluate:({zoom:F},V)=>ic({stops:k,base:a.base},t,F).evaluate(F,V)}}if(o){const C=u==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:Jn.interpolationFactor.bind(void 0,C),zoomStops:a.stops.map((z=>z[0])),evaluate:({zoom:z})=>v(a,t,z,b,M)}}return{kind:"source",evaluate(C,z){const k=z&&z.properties?z.properties[a.property]:void 0;return k===void 0?Gr(a.default,t.default):v(a,t,k,b,M)}}}function Gr(a,t,n){return a!==void 0?a:t!==void 0?t:n!==void 0?n:void 0}function qr(a,t,n,o,u){return Gr(typeof n===u?o[n]:void 0,a.default,t.default)}function Uh(a,t,n){if(Zt(n)!=="number")return Gr(a.default,t.default);const o=a.stops.length;if(o===1||n<=a.stops[0][0])return a.stops[0][1];if(n>=a.stops[o-1][0])return a.stops[o-1][1];const u=So(a.stops.map((p=>p[0])),n);return a.stops[u][1]}function ic(a,t,n){const o=a.base!==void 0?a.base:1;if(Zt(n)!=="number")return Gr(a.default,t.default);const u=a.stops.length;if(u===1||n<=a.stops[0][0])return a.stops[0][1];if(n>=a.stops[u-1][0])return a.stops[u-1][1];const p=So(a.stops.map((C=>C[0])),n),_=(function(C,z,k,O){const F=O-k,V=C-k;return F===0?0:z===1?V/F:(Math.pow(z,V)-1)/(Math.pow(z,F)-1)})(n,o,a.stops[p][0],a.stops[p+1][0]),v=a.stops[p][1],b=a.stops[p+1][1],M=Fr[t.type]||Ld;return typeof v.evaluate=="function"?{evaluate(...C){const z=v.evaluate.apply(void 0,C),k=b.evaluate.apply(void 0,C);if(z!==void 0&&k!==void 0)return M(z,k,_,a.colorSpace)}}:M(v,b,_,a.colorSpace)}function Do(a,t,n){switch(t.type){case"color":n=Ht.parse(n);break;case"formatted":n=oa.fromString(n.toString());break;case"resolvedImage":n=vn.fromString(n.toString());break;case"padding":n=on.parse(n);break;case"colorArray":n=yn.parse(n);break;case"numberArray":n=Rn.parse(n);break;default:Zt(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return Gr(n,a.default,t.default)}sr.register(dl,{error:[{kind:"error"},[xt],(a,[t])=>{throw new _i(t.evaluate(a))}],typeof:[xt,[Rt],(a,[t])=>Ti(bt(t.evaluate(a)))],"to-rgba":[Ta(qe,4),[Nn],(a,[t])=>{const[n,o,u,p]=t.evaluate(a).rgb;return[255*n,255*o,255*u,p]}],rgb:[Nn,[qe,qe,qe],Fu],rgba:[Nn,[qe,qe,qe,qe],Fu],has:{type:Pt,overloads:[[[xt],(a,[t])=>Uu(t.evaluate(a),a.properties())],[[xt,Vs],(a,[t,n])=>Uu(t.evaluate(a),n.evaluate(a))]]},get:{type:Rt,overloads:[[[xt],(a,[t])=>ec(t.evaluate(a),a.properties())],[[xt,Vs],(a,[t,n])=>ec(t.evaluate(a),n.evaluate(a))]]},"feature-state":[Rt,[xt],(a,[t])=>ec(t.evaluate(a),a.featureState||{})],properties:[Vs,[],a=>a.properties()],"geometry-type":[xt,[],a=>a.geometryType()],id:[Rt,[],a=>a.id()],zoom:[qe,[],a=>a.globals.zoom],"heatmap-density":[qe,[],a=>a.globals.heatmapDensity||0],elevation:[qe,[],a=>a.globals.elevation||0],"line-progress":[qe,[],a=>a.globals.lineProgress||0],accumulated:[Rt,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[qe,la(qe),(a,t)=>{let n=0;for(const o of t)n+=o.evaluate(a);return n}],"*":[qe,la(qe),(a,t)=>{let n=1;for(const o of t)n*=o.evaluate(a);return n}],"-":{type:qe,overloads:[[[qe,qe],(a,[t,n])=>t.evaluate(a)-n.evaluate(a)],[[qe],(a,[t])=>-t.evaluate(a)]]},"/":[qe,[qe,qe],(a,[t,n])=>t.evaluate(a)/n.evaluate(a)],"%":[qe,[qe,qe],(a,[t,n])=>t.evaluate(a)%n.evaluate(a)],ln2:[qe,[],()=>Math.LN2],pi:[qe,[],()=>Math.PI],e:[qe,[],()=>Math.E],"^":[qe,[qe,qe],(a,[t,n])=>Math.pow(t.evaluate(a),n.evaluate(a))],sqrt:[qe,[qe],(a,[t])=>Math.sqrt(t.evaluate(a))],log10:[qe,[qe],(a,[t])=>Math.log(t.evaluate(a))/Math.LN10],ln:[qe,[qe],(a,[t])=>Math.log(t.evaluate(a))],log2:[qe,[qe],(a,[t])=>Math.log(t.evaluate(a))/Math.LN2],sin:[qe,[qe],(a,[t])=>Math.sin(t.evaluate(a))],cos:[qe,[qe],(a,[t])=>Math.cos(t.evaluate(a))],tan:[qe,[qe],(a,[t])=>Math.tan(t.evaluate(a))],asin:[qe,[qe],(a,[t])=>Math.asin(t.evaluate(a))],acos:[qe,[qe],(a,[t])=>Math.acos(t.evaluate(a))],atan:[qe,[qe],(a,[t])=>Math.atan(t.evaluate(a))],min:[qe,la(qe),(a,t)=>Math.min(...t.map((n=>n.evaluate(a))))],max:[qe,la(qe),(a,t)=>Math.max(...t.map((n=>n.evaluate(a))))],abs:[qe,[qe],(a,[t])=>Math.abs(t.evaluate(a))],round:[qe,[qe],(a,[t])=>{const n=t.evaluate(a);return n<0?-Math.round(-n):Math.round(n)}],floor:[qe,[qe],(a,[t])=>Math.floor(t.evaluate(a))],ceil:[qe,[qe],(a,[t])=>Math.ceil(t.evaluate(a))],"filter-==":[Pt,[xt,Rt],(a,[t,n])=>a.properties()[t.value]===n.value],"filter-id-==":[Pt,[Rt],(a,[t])=>a.id()===t.value],"filter-type-==":[Pt,[xt],(a,[t])=>a.geometryType()===t.value],"filter-<":[Pt,[xt,Rt],(a,[t,n])=>{const o=a.properties()[t.value],u=n.value;return typeof o==typeof u&&o<u}],"filter-id-<":[Pt,[Rt],(a,[t])=>{const n=a.id(),o=t.value;return typeof n==typeof o&&n<o}],"filter->":[Pt,[xt,Rt],(a,[t,n])=>{const o=a.properties()[t.value],u=n.value;return typeof o==typeof u&&o>u}],"filter-id->":[Pt,[Rt],(a,[t])=>{const n=a.id(),o=t.value;return typeof n==typeof o&&n>o}],"filter-<=":[Pt,[xt,Rt],(a,[t,n])=>{const o=a.properties()[t.value],u=n.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[Pt,[Rt],(a,[t])=>{const n=a.id(),o=t.value;return typeof n==typeof o&&n<=o}],"filter->=":[Pt,[xt,Rt],(a,[t,n])=>{const o=a.properties()[t.value],u=n.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[Pt,[Rt],(a,[t])=>{const n=a.id(),o=t.value;return typeof n==typeof o&&n>=o}],"filter-has":[Pt,[Rt],(a,[t])=>t.value in a.properties()],"filter-has-id":[Pt,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Pt,[Ta(xt)],(a,[t])=>t.value.indexOf(a.geometryType())>=0],"filter-id-in":[Pt,[Ta(Rt)],(a,[t])=>t.value.indexOf(a.id())>=0],"filter-in-small":[Pt,[xt,Ta(Rt)],(a,[t,n])=>n.value.indexOf(a.properties()[t.value])>=0],"filter-in-large":[Pt,[xt,Ta(Rt)],(a,[t,n])=>(function(o,u,p,_){for(;p<=_;){const v=p+_>>1;if(u[v]===o)return!0;u[v]>o?_=v-1:p=v+1}return!1})(a.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Pt,overloads:[[[Pt,Pt],(a,[t,n])=>t.evaluate(a)&&n.evaluate(a)],[la(Pt),(a,t)=>{for(const n of t)if(!n.evaluate(a))return!1;return!0}]]},any:{type:Pt,overloads:[[[Pt,Pt],(a,[t,n])=>t.evaluate(a)||n.evaluate(a)],[la(Pt),(a,t)=>{for(const n of t)if(n.evaluate(a))return!0;return!1}]]},"!":[Pt,[Pt],(a,[t])=>!t.evaluate(a)],"is-supported-script":[Pt,[xt],(a,[t])=>{const n=a.globals&&a.globals.isSupportedScript;return!n||n(t.evaluate(a))}],upcase:[xt,[xt],(a,[t])=>t.evaluate(a).toUpperCase()],downcase:[xt,[xt],(a,[t])=>t.evaluate(a).toLowerCase()],concat:[xt,la(Rt),(a,t)=>t.map((n=>zt(n.evaluate(a)))).join("")],"resolved-locale":[xt,[Zs],(a,[t])=>t.evaluate(a).resolvedLocale()]});class nc{constructor(t,n,o){this.expression=t,this._warningHistory={},this._evaluator=new nl,this._defaultValue=n?(function(u){if(u.type==="color"&&Zr(u.default))return new Ht(0,0,0,0);switch(u.type){case"color":return Ht.parse(u.default)||null;case"padding":return on.parse(u.default)||null;case"numberArray":return Rn.parse(u.default)||null;case"colorArray":return yn.parse(u.default)||null;case"variableAnchorOffsetCollection":return Vn.parse(u.default)||null;case"projectionDefinition":return Wn.parse(u.default)||null;default:return u.default===void 0?null:u.default}})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this._globalState=o}evaluateWithoutErrorHandling(t,n,o,u,p,_){return this._globalState&&(t=ea(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(t,n,o,u,p,_){this._globalState&&(t=ea(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new _i(`Expected value to be one of ${Object.keys(this._enumValues).map((b=>JSON.stringify(b))).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function ac(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in dl}function Io(a,t,n){const o=new Or(dl,Po,[],t?(function(p){const _={color:Nn,string:xt,number:qe,enum:xt,boolean:Pt,formatted:Dr,padding:hs,numberArray:Ir,colorArray:wa,projectionDefinition:bo,resolvedImage:Ii,variableAnchorOffsetCollection:_n};return p.type==="array"?Ta(_[p.value]||Rt,p.length):_[p.type]})(t):void 0),u=o.parse(a,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?tc(new nc(u,t,n)):gs(o.errors)}class pl{constructor(t,n,o){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!Nr(n.expression),this.globalStateRefs=_s(n.expression),this._globalState=o}evaluateWithoutErrorHandling(t,n,o,u,p,_){return this._globalState&&(t=ea(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,n,o,u,p,_)}evaluate(t,n,o,u,p,_){return this._globalState&&(t=ea(t,this._globalState)),this._styleExpression.evaluate(t,n,o,u,p,_)}}class Oa{constructor(t,n,o,u,p){this.kind=t,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!Nr(n.expression),this.globalStateRefs=_s(n.expression),this.interpolationType=u,this._globalState=p}evaluateWithoutErrorHandling(t,n,o,u,p,_){return this._globalState&&(t=ea(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,n,o,u,p,_)}evaluate(t,n,o,u,p,_){return this._globalState&&(t=ea(t,this._globalState)),this._styleExpression.evaluate(t,n,o,u,p,_)}interpolationFactor(t,n,o){return this.interpolationType?Jn.interpolationFactor(this.interpolationType,t,n,o):0}}function Ro(a,t,n){const o=Io(a,t,n);if(o.result==="error")return o;const u=o.value.expression,p=Sa(u);if(!p&&!Vr(t))return gs([new Da("","data expressions not supported")]);const _=fl(u,["zoom"]);if(!_&&!eo(t))return gs([new Da("","zoom expressions not supported")]);const v=to(u);return v||_?v instanceof Da?gs([v]):v instanceof Jn&&!Uc(t)?gs([new Da("",'"interpolate" expressions cannot be used with this property')]):tc(v?new Oa(p?"camera":"composite",o.value,v.labels,v instanceof Jn?v.interpolation:void 0,n):new pl(p?"constant":"source",o.value,n)):gs([new Da("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Hr{constructor(t,n){this._parameters=t,this._specification=n,rn(this,Ba(this._parameters,this._specification))}static deserialize(t){return new Hr(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function to(a){let t=null;if(a instanceof Nl)t=to(a.result);else if(a instanceof ql){for(const n of a.args)if(t=to(n),t)break}else(a instanceof Wi||a instanceof Jn)&&a.input instanceof sr&&a.input.name==="zoom"&&(t=a);return t instanceof Da||a.eachChild((n=>{const o=to(n);o instanceof Da?t=o:!t&&o?t=new Da("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new Da("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function _s(a,t=new Set){return a instanceof Jl&&t.add(a.key),a.eachChild((n=>{_s(n,t)})),t}function ea(a,t){const{zoom:n,heatmapDensity:o,elevation:u,lineProgress:p,isSupportedScript:_,accumulated:v}=a??{};return{zoom:n,heatmapDensity:o,elevation:u,lineProgress:p,isSupportedScript:_,accumulated:v,globalState:t}}function ga(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const t of a.slice(1))if(!ga(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const $r={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function _a(a,t){if(a==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};ga(a)||(a=rc(a));const n=Io(a,$r,t);if(n.result==="error")throw new Error(n.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,u,p)=>n.value.evaluate(o,u,{},p),needGeometry:Ka(a),getGlobalStateRefs:()=>_s(n.value.expression)}}function or(a,t){return a<t?-1:a>t?1:0}function Ka(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let t=1;t<a.length;t++)if(Ka(a[t]))return!0;return!1}function rc(a){if(!a)return!0;const t=a[0];return a.length<=1?t!=="any":t==="=="?sc(a[1],a[2],"=="):t==="!="?Ln(sc(a[1],a[2],"==")):t==="<"||t===">"||t==="<="||t===">="?sc(a[1],a[2],t):t==="any"?(n=a.slice(1),["any"].concat(n.map(rc))):t==="all"?["all"].concat(a.slice(1).map(rc)):t==="none"?["all"].concat(a.slice(1).map(rc).map(Ln)):t==="in"?jc(a[1],a.slice(2)):t==="!in"?Ln(jc(a[1],a.slice(2))):t==="has"?ju(a[1]):t!=="!has"||Ln(ju(a[1]));var n}function sc(a,t,n){switch(a){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,a,t]}}function jc(a,t){if(t.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((n=>typeof n!=typeof t[0]))?["filter-in-large",a,["literal",t.sort(or)]]:["filter-in-small",a,["literal",t]]}}function ju(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Ln(a){return["!",a]}function Ri(a){const t=typeof a;if(t==="number"||t==="boolean"||t==="string"||a==null)return JSON.stringify(a);if(Array.isArray(a)){let u="[";for(const p of a)u+=`${Ri(p)},`;return`${u}]`}const n=Object.keys(a).sort();let o="{";for(let u=0;u<n.length;u++)o+=`${JSON.stringify(n[u])}:${Ri(a[n[u]])},`;return`${o}}`}function Jt(a){let t="";for(const n of wt)t+=`/${Ri(a[n])}`;return t}function Xr(a){const t=a.value;return t?[new Ue(a.key,t,"constants have been deprecated as of v8")]:[]}function ei(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function ys(a){if(Array.isArray(a))return a.map(ys);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const t={};for(const n in a)t[n]=ys(a[n]);return t}return ei(a)}function kn(a){const t=a.key,n=a.value,o=a.valueSpec||{},u=a.objectElementValidators||{},p=a.style,_=a.styleSpec,v=a.validateSpec;let b=[];const M=Zt(n);if(M!=="object")return[new Ue(t,n,`object expected, ${M} found`)];for(const C in n){const z=C.split(".")[0],k=wo(o,z)||o["*"];let O;if(wo(u,z))O=u[z];else if(wo(o,z))O=v;else if(u["*"])O=u["*"];else{if(!o["*"]){b.push(new Ue(t,n[C],`unknown property "${C}"`));continue}O=v}b=b.concat(O({key:(t&&`${t}.`)+C,value:n[C],valueSpec:k,style:p,styleSpec:_,object:n,objectKey:C,validateSpec:v},n))}for(const C in o)u[C]||o[C].required&&o[C].default===void 0&&n[C]===void 0&&b.push(new Ue(t,n,`missing required property "${C}"`));return b}function oc(a){const t=a.value,n=a.valueSpec,o=a.style,u=a.styleSpec,p=a.key,_=a.arrayElementValidator||a.validateSpec;if(Zt(t)!=="array")return[new Ue(p,t,`array expected, ${Zt(t)} found`)];if(n.length&&t.length!==n.length)return[new Ue(p,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Ue(p,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let v={type:n.value,values:n.values};u.$version<7&&(v.function=n.function),Zt(n.value)==="object"&&(v=n.value);let b=[];for(let M=0;M<t.length;M++)b=b.concat(_({array:t,arrayIndex:M,value:t[M],valueSpec:v,validateSpec:a.validateSpec,style:o,styleSpec:u,key:`${p}[${M}]`}));return b}function lc(a){const t=a.key,n=a.value,o=a.valueSpec;let u=Zt(n);return u==="number"&&n!=n&&(u="NaN"),u!=="number"?[new Ue(t,n,`number expected, ${u} found`)]:"minimum"in o&&n<o.minimum?[new Ue(t,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new Ue(t,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function io(a){const t=a.valueSpec,n=ei(a.value.type);let o,u,p,_={};const v=n!=="categorical"&&a.value.property===void 0,b=!v,M=Zt(a.value.stops)==="array"&&Zt(a.value.stops[0])==="array"&&Zt(a.value.stops[0][0])==="object",C=kn({key:a.key,value:a.value,valueSpec:a.styleSpec.function,validateSpec:a.validateSpec,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(O){if(n==="identity")return[new Ue(O.key,O.value,'identity function may not have a "stops" property')];let F=[];const V=O.value;return F=F.concat(oc({key:O.key,value:V,valueSpec:O.valueSpec,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:z})),Zt(V)==="array"&&V.length===0&&F.push(new Ue(O.key,V,"array must have at least one stop")),F},default:function(O){return O.validateSpec({key:O.key,value:O.value,valueSpec:t,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec})}}});return n==="identity"&&v&&C.push(new Ue(a.key,a.value,'missing required property "property"')),n==="identity"||a.value.stops||C.push(new Ue(a.key,a.value,'missing required property "stops"')),n==="exponential"&&a.valueSpec.expression&&!Uc(a.valueSpec)&&C.push(new Ue(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(b&&!Vr(a.valueSpec)?C.push(new Ue(a.key,a.value,"property functions not supported")):v&&!eo(a.valueSpec)&&C.push(new Ue(a.key,a.value,"zoom functions not supported"))),n!=="categorical"&&!M||a.value.property!==void 0||C.push(new Ue(a.key,a.value,'"property" property is required')),C;function z(O){let F=[];const V=O.value,q=O.key;if(Zt(V)!=="array")return[new Ue(q,V,`array expected, ${Zt(V)} found`)];if(V.length!==2)return[new Ue(q,V,`array length 2 expected, length ${V.length} found`)];if(M){if(Zt(V[0])!=="object")return[new Ue(q,V,`object expected, ${Zt(V[0])} found`)];if(V[0].zoom===void 0)return[new Ue(q,V,"object stop key must have zoom")];if(V[0].value===void 0)return[new Ue(q,V,"object stop key must have value")];if(p&&p>ei(V[0].zoom))return[new Ue(q,V[0].zoom,"stop zoom values must appear in ascending order")];ei(V[0].zoom)!==p&&(p=ei(V[0].zoom),u=void 0,_={}),F=F.concat(kn({key:`${q}[0]`,value:V[0],valueSpec:{zoom:{}},validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:lc,value:k}}))}else F=F.concat(k({key:`${q}[0]`,value:V[0],validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec},V));return ac(ys(V[1]))?F.concat([new Ue(`${q}[1]`,V[1],"expressions are not allowed in function stops.")]):F.concat(O.validateSpec({key:`${q}[1]`,value:V[1],valueSpec:t,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec}))}function k(O,F){const V=Zt(O.value),q=ei(O.value),W=O.value!==null?O.value:F;if(o){if(V!==o)return[new Ue(O.key,W,`${V} stop domain type must match previous stop domain type ${o}`)]}else o=V;if(V!=="number"&&V!=="string"&&V!=="boolean")return[new Ue(O.key,W,"stop domain value must be a number, string, or boolean")];if(V!=="number"&&n!=="categorical"){let ge=`number expected, ${V} found`;return Vr(t)&&n===void 0&&(ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ue(O.key,W,ge)]}return n!=="categorical"||V!=="number"||isFinite(q)&&Math.floor(q)===q?n!=="categorical"&&V==="number"&&u!==void 0&&q<u?[new Ue(O.key,W,"stop domain values must appear in ascending order")]:(u=q,n==="categorical"&&q in _?[new Ue(O.key,W,"stop domain values must be unique")]:(_[q]=!0,[])):[new Ue(O.key,W,`integer expected, found ${q}`)]}}function Qa(a){const t=(a.expressionContext==="property"?Ro:Io)(ys(a.value),a.valueSpec);if(t.result==="error")return t.value.map((o=>new Ue(`${a.key}${o.key}`,a.value,o.message)));const n=t.value.expression||t.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!n.outputDefined())return[new Ue(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Nr(n))return[new Ue(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Nr(n))return[new Ue(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!fl(n,["zoom","feature-state"]))return[new Ue(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Sa(n))return[new Ue(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function vs(a){const t=a.key,n=a.value,o=Zt(n);return o!=="string"?[new Ue(t,n,`color expected, ${o} found`)]:Ht.parse(String(n))?[]:[new Ue(t,n,`color expected, "${n}" found`)]}function xs(a){const t=a.key,n=a.value,o=a.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(ei(n))===-1&&u.push(new Ue(t,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(ei(n))===-1&&u.push(new Ue(t,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),u}function cc(a){return ga(ys(a.value))?Qa(rn({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):no(a)}function no(a){const t=a.value,n=a.key;if(Zt(t)!=="array")return[new Ue(n,t,`array expected, ${Zt(t)} found`)];const o=a.styleSpec;let u,p=[];if(t.length<1)return[new Ue(n,t,"filter array must have at least 1 element")];switch(p=p.concat(xs({key:`${n}[0]`,value:t[0],valueSpec:o.filter_operator,style:a.style,styleSpec:a.styleSpec})),ei(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&ei(t[1])==="$type"&&p.push(new Ue(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&p.push(new Ue(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(u=Zt(t[1]),u!=="string"&&p.push(new Ue(`${n}[1]`,t[1],`string expected, ${u} found`)));for(let _=2;_<t.length;_++)u=Zt(t[_]),ei(t[1])==="$type"?p=p.concat(xs({key:`${n}[${_}]`,value:t[_],valueSpec:o.geometry_type,style:a.style,styleSpec:a.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&p.push(new Ue(`${n}[${_}]`,t[_],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)p=p.concat(no({key:`${n}[${_}]`,value:t[_],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":u=Zt(t[1]),t.length!==2?p.push(new Ue(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):u!=="string"&&p.push(new Ue(`${n}[1]`,t[1],`string expected, ${u} found`))}return p}function Yr(a,t){const n=a.key,o=a.validateSpec,u=a.style,p=a.styleSpec,_=a.value,v=a.objectKey,b=p[`${t}_${a.layerType}`];if(!b)return[];const M=v.match(/^(.*)-transition$/);if(t==="paint"&&M&&b[M[1]]&&b[M[1]].transition)return o({key:n,value:_,valueSpec:p.transition,style:u,styleSpec:p});const C=a.valueSpec||b[v];if(!C)return[new Ue(n,_,`unknown property "${v}"`)];let z;if(Zt(_)==="string"&&Vr(C)&&!C.tokens&&(z=/^{([^}]+)}$/.exec(_)))return[new Ue(n,_,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const k=[];return a.layerType==="symbol"&&(v==="text-field"&&u&&!u.glyphs&&k.push(new Ue(n,_,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&Zr(ys(_))&&ei(_.type)==="identity"&&k.push(new Ue(n,_,'"text-font" does not support identity functions'))),k.concat(o({key:a.key,value:_,valueSpec:C,style:u,styleSpec:p,expressionContext:"property",propertyType:t,propertyKey:v}))}function bs(a){return Yr(a,"paint")}function Kr(a){return Yr(a,"layout")}function ao(a){let t=[];const n=a.value,o=a.key,u=a.style,p=a.styleSpec;if(Zt(n)!=="object")return[new Ue(o,n,`object expected, ${Zt(n)} found`)];n.type||n.ref||t.push(new Ue(o,n,'either "type" or "ref" is required'));let _=ei(n.type);const v=ei(n.ref);if(n.id){const b=ei(n.id);for(let M=0;M<a.arrayIndex;M++){const C=u.layers[M];ei(C.id)===b&&t.push(new Ue(o,n.id,`duplicate layer id "${n.id}", previously used at line ${C.id.__line__}`))}}if("ref"in n){let b;["type","source","source-layer","filter","layout"].forEach((M=>{M in n&&t.push(new Ue(o,n[M],`"${M}" is prohibited for ref layers`))})),u.layers.forEach((M=>{ei(M.id)===v&&(b=M)})),b?b.ref?t.push(new Ue(o,n.ref,"ref cannot reference another ref layer")):_=ei(b.type):t.push(new Ue(o,n.ref,`ref layer "${v}" not found`))}else if(_!=="background")if(n.source){const b=u.sources&&u.sources[n.source],M=b&&ei(b.type);b?M==="vector"&&_==="raster"?t.push(new Ue(o,n.source,`layer "${n.id}" requires a raster source`)):M!=="raster-dem"&&_==="hillshade"||M!=="raster-dem"&&_==="color-relief"?t.push(new Ue(o,n.source,`layer "${n.id}" requires a raster-dem source`)):M==="raster"&&_!=="raster"?t.push(new Ue(o,n.source,`layer "${n.id}" requires a vector source`)):M!=="vector"||n["source-layer"]?M==="raster-dem"&&_!=="hillshade"&&_!=="color-relief"?t.push(new Ue(o,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):_!=="line"||!n.paint||!n.paint["line-gradient"]||M==="geojson"&&b.lineMetrics||t.push(new Ue(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ue(o,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Ue(o,n.source,`source "${n.source}" not found`))}else t.push(new Ue(o,n,'missing required property "source"'));return t=t.concat(kn({key:o,value:n,valueSpec:p.layer,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,objectElementValidators:{"*":()=>[],type:()=>a.validateSpec({key:`${o}.type`,value:n.type,valueSpec:p.layer.type,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,object:n,objectKey:"type"}),filter:cc,layout:b=>kn({layer:n,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":M=>Kr(rn({layerType:_},M))}}),paint:b=>kn({layer:n,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":M=>bs(rn({layerType:_},M))}})}})),t}function Wa(a){const t=a.value,n=a.key,o=Zt(t);return o!=="string"?[new Ue(n,t,`string expected, ${o} found`)]:[]}const Gn={promoteId:function({key:a,value:t}){if(Zt(t)==="string")return Wa({key:a,value:t});{const n=[];for(const o in t)n.push(...Wa({key:`${a}.${o}`,value:t[o]}));return n}}};function ws(a){const t=a.value,n=a.key,o=a.styleSpec,u=a.style,p=a.validateSpec;if(!t.type)return[new Ue(n,t,'"type" is required')];const _=ei(t.type);let v;switch(_){case"vector":case"raster":return v=kn({key:n,value:t,valueSpec:o[`source_${_.replace("-","_")}`],style:a.style,styleSpec:o,objectElementValidators:Gn,validateSpec:p}),v;case"raster-dem":return v=(function(b){var M;const C=(M=b.sourceName)!==null&&M!==void 0?M:"",z=b.value,k=b.styleSpec,O=k.source_raster_dem,F=b.style;let V=[];const q=Zt(z);if(z===void 0)return V;if(q!=="object")return V.push(new Ue("source_raster_dem",z,`object expected, ${q} found`)),V;const W=ei(z.encoding)==="custom",ge=["redFactor","greenFactor","blueFactor","baseShift"],ne=b.value.encoding?`"${b.value.encoding}"`:"Default";for(const le in z)!W&&ge.includes(le)?V.push(new Ue(le,z[le],`In "${C}": "${le}" is only valid when "encoding" is set to "custom". ${ne} encoding found`)):O[le]?V=V.concat(b.validateSpec({key:le,value:z[le],valueSpec:O[le],validateSpec:b.validateSpec,style:F,styleSpec:k})):V.push(new Ue(le,z[le],`unknown property "${le}"`));return V})({sourceName:n,value:t,style:a.style,styleSpec:o,validateSpec:p}),v;case"geojson":if(v=kn({key:n,value:t,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:p,objectElementValidators:Gn}),t.cluster)for(const b in t.clusterProperties){const[M,C]=t.clusterProperties[b],z=typeof M=="string"?[M,["accumulated"],["get",b]]:M;v.push(...Qa({key:`${n}.${b}.map`,value:C,expressionContext:"cluster-map"})),v.push(...Qa({key:`${n}.${b}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return v;case"video":return kn({key:n,value:t,valueSpec:o.source_video,style:u,validateSpec:p,styleSpec:o});case"image":return kn({key:n,value:t,valueSpec:o.source_image,style:u,validateSpec:p,styleSpec:o});case"canvas":return[new Ue(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return xs({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Ts(a){const t=a.value,n=a.styleSpec,o=n.light,u=a.style;let p=[];const _=Zt(t);if(t===void 0)return p;if(_!=="object")return p=p.concat([new Ue("light",t,`object expected, ${_} found`)]),p;for(const v in t){const b=v.match(/^(.*)-transition$/);p=p.concat(b&&o[b[1]]&&o[b[1]].transition?a.validateSpec({key:v,value:t[v],valueSpec:n.transition,validateSpec:a.validateSpec,style:u,styleSpec:n}):o[v]?a.validateSpec({key:v,value:t[v],valueSpec:o[v],validateSpec:a.validateSpec,style:u,styleSpec:n}):[new Ue(v,t[v],`unknown property "${v}"`)])}return p}function ta(a){const t=a.value,n=a.styleSpec,o=n.sky,u=a.style,p=Zt(t);if(t===void 0)return[];if(p!=="object")return[new Ue("sky",t,`object expected, ${p} found`)];let _=[];for(const v in t)_=_.concat(o[v]?a.validateSpec({key:v,value:t[v],valueSpec:o[v],style:u,styleSpec:n}):[new Ue(v,t[v],`unknown property "${v}"`)]);return _}function uc(a){const t=a.value,n=a.styleSpec,o=n.terrain,u=a.style;let p=[];const _=Zt(t);if(t===void 0)return p;if(_!=="object")return p=p.concat([new Ue("terrain",t,`object expected, ${_} found`)]),p;for(const v in t)p=p.concat(o[v]?a.validateSpec({key:v,value:t[v],valueSpec:o[v],validateSpec:a.validateSpec,style:u,styleSpec:n}):[new Ue(v,t[v],`unknown property "${v}"`)]);return p}function Lo(a){let t=[];const n=a.value,o=a.key;if(Array.isArray(n)){const u=[],p=[];for(const _ in n)n[_].id&&u.includes(n[_].id)&&t.push(new Ue(o,n,`all the sprites' ids must be unique, but ${n[_].id} is duplicated`)),u.push(n[_].id),n[_].url&&p.includes(n[_].url)&&t.push(new Ue(o,n,`all the sprites' URLs must be unique, but ${n[_].url} is duplicated`)),p.push(n[_].url),t=t.concat(kn({key:`${o}[${_}]`,value:n[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:a.validateSpec}));return t}return Wa({key:o,value:n})}function Nu(a){return t=a.value,t&&t.constructor===Object?[]:[new Ue(a.key,a.value,`object expected, ${Zt(a.value)} found`)];var t}const Nc={"*":()=>[],array:oc,boolean:function(a){const t=a.value,n=a.key,o=Zt(t);return o!=="boolean"?[new Ue(n,t,`boolean expected, ${o} found`)]:[]},number:lc,color:vs,constants:Xr,enum:xs,filter:cc,function:io,layer:ao,object:kn,source:ws,light:Ts,sky:ta,terrain:uc,projection:function(a){const t=a.value,n=a.styleSpec,o=n.projection,u=a.style,p=Zt(t);if(t===void 0)return[];if(p!=="object")return[new Ue("projection",t,`object expected, ${p} found`)];let _=[];for(const v in t)_=_.concat(o[v]?a.validateSpec({key:v,value:t[v],valueSpec:o[v],style:u,styleSpec:n}):[new Ue(v,t[v],`unknown property "${v}"`)]);return _},projectionDefinition:function(a){const t=a.key;let n=a.value;n=n instanceof String?n.valueOf():n;const o=Zt(n);return o!=="array"||(function(u){return Array.isArray(u)&&u.length===3&&typeof u[0]=="string"&&typeof u[1]=="string"&&typeof u[2]=="number"})(n)||(function(u){return!!["interpolate","step","literal"].includes(u[0])})(n)?["array","string"].includes(o)?[]:[new Ue(t,n,`projection expected, invalid type "${o}" found`)]:[new Ue(t,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:Wa,formatted:function(a){return Wa(a).length===0?[]:Qa(a)},resolvedImage:function(a){return Wa(a).length===0?[]:Qa(a)},padding:function(a){const t=a.key,n=a.value;if(Zt(n)==="array"){if(n.length<1||n.length>4)return[new Ue(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let u=[];for(let p=0;p<n.length;p++)u=u.concat(a.validateSpec({key:`${t}[${p}]`,value:n[p],validateSpec:a.validateSpec,valueSpec:o}));return u}return lc({key:t,value:n,valueSpec:{}})},numberArray:function(a){const t=a.key,n=a.value;if(Zt(n)==="array"){const o={type:"number"};if(n.length<1)return[new Ue(t,n,"array length at least 1 expected, length 0 found")];let u=[];for(let p=0;p<n.length;p++)u=u.concat(a.validateSpec({key:`${t}[${p}]`,value:n[p],validateSpec:a.validateSpec,valueSpec:o}));return u}return lc({key:t,value:n,valueSpec:{}})},colorArray:function(a){const t=a.key,n=a.value;if(Zt(n)==="array"){if(n.length<1)return[new Ue(t,n,"array length at least 1 expected, length 0 found")];let o=[];for(let u=0;u<n.length;u++)o=o.concat(vs({key:`${t}[${u}]`,value:n[u]}));return o}return vs({key:t,value:n})},variableAnchorOffsetCollection:function(a){const t=a.key,n=a.value,o=Zt(n),u=a.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new Ue(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let p=[];for(let _=0;_<n.length;_+=2)p=p.concat(xs({key:`${t}[${_}]`,value:n[_],valueSpec:u.layout_symbol["text-anchor"]})),p=p.concat(oc({key:`${t}[${_+1}]`,value:n[_+1],valueSpec:{length:2,value:"number"},validateSpec:a.validateSpec,style:a.style,styleSpec:u}));return p},sprite:Lo,state:Nu};function Vc(a){const t=a.value,n=a.valueSpec,o=a.styleSpec;return a.validateSpec=Vc,n.expression&&Zr(ei(t))?io(a):n.expression&&ac(ys(t))?Qa(a):n.type&&Nc[n.type]?Nc[n.type](a):kn(rn({},a,{valueSpec:n.type?o[n.type]:n}))}function cn(a){const t=a.value,n=a.key,o=Wa(a);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new Ue(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new Ue(n,t,'"glyphs" url must include a "{range}" token'))),o}function Fa(a,t=_e){let n=[];return n=n.concat(Vc({key:"",value:a,valueSpec:t.$root,styleSpec:t,style:a,validateSpec:Vc,objectElementValidators:{glyphs:cn,"*":()=>[]}})),a.constants&&(n=n.concat(Xr({key:"constants",value:a.constants}))),ml(n)}function qn(a){return function(t){return a(Object.assign({},t,{validateSpec:Vc}))}}function ml(a){return[].concat(a).sort(((t,n)=>t.line-n.line))}function Ja(a){return function(...t){return ml(a.apply(this,t))}}Fa.source=Ja(qn(ws)),Fa.sprite=Ja(qn(Lo)),Fa.glyphs=Ja(qn(cn)),Fa.light=Ja(qn(Ts)),Fa.sky=Ja(qn(ta)),Fa.terrain=Ja(qn(uc)),Fa.state=Ja(qn(Nu)),Fa.layer=Ja(qn(ao)),Fa.filter=Ja(qn(cc)),Fa.paintProperty=Ja(qn(bs)),Fa.layoutProperty=Ja(qn(Kr));const Tr=Fa,Qr=Tr.light,kd=Tr.sky,jh=Tr.paintProperty,Zc=Tr.layoutProperty;function Vu(a,t){let n=!1;if(t&&t.length)for(const o of t)a.fire(new Oe(new Error(o.message))),n=!0;return n}class er{constructor(t,n,o){const u=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const _=new Int32Array(this.arrayBuffer);t=_[0],this.d=(n=_[1])+2*(o=_[2]);for(let b=0;b<this.d*this.d;b++){const M=_[3+b],C=_[3+b+1];u.push(M===C?null:_.subarray(M,C))}const v=_[3+u.length+1];this.keys=_.subarray(_[3+u.length],v),this.bboxes=_.subarray(v),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let _=0;_<this.d*this.d;_++)u.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=o,this.scale=n/t,this.uid=0;const p=o/n*t;this.min=-p,this.max=t+p}insert(t,n,o,u,p){this._forEachCell(n,o,u,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,o,u,p,_){this.cells[p].push(_)}query(t,n,o,u,p){const _=this.min,v=this.max;if(t<=_&&n<=_&&v<=o&&v<=u&&!p)return Array.prototype.slice.call(this.keys);{const b=[];return this._forEachCell(t,n,o,u,this._queryCell,b,{},p),b}}_queryCell(t,n,o,u,p,_,v,b){const M=this.cells[p];if(M!==null){const C=this.keys,z=this.bboxes;for(let k=0;k<M.length;k++){const O=M[k];if(v[O]===void 0){const F=4*O;(b?b(z[F+0],z[F+1],z[F+2],z[F+3]):t<=z[F+2]&&n<=z[F+3]&&o>=z[F+0]&&u>=z[F+1])?(v[O]=!0,_.push(C[O])):v[O]=!1}}}}_forEachCell(t,n,o,u,p,_,v,b){const M=this._convertToCellCoord(t),C=this._convertToCellCoord(n),z=this._convertToCellCoord(o),k=this._convertToCellCoord(u);for(let O=M;O<=z;O++)for(let F=C;F<=k;F++){const V=this.d*F+O;if((!b||b(this._convertFromCellCoord(O),this._convertFromCellCoord(F),this._convertFromCellCoord(O+1),this._convertFromCellCoord(F+1)))&&p.call(this,t,n,o,u,V,_,v,b))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let o=0;for(let _=0;_<this.cells.length;_++)o+=this.cells[_].length;const u=new Int32Array(n+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let p=n;for(let _=0;_<t.length;_++){const v=t[_];u[3+_]=p,u.set(v,p),p+=v.length}return u[3+t.length]=p,u.set(this.keys,p),p+=this.keys.length,u[3+t.length+1]=p,u.set(this.bboxes,p),p+=this.bboxes.length,u.buffer}static serialize(t,n){const o=t.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(t){return new er(t.buffer)}}const Ua={};function st(a,t,n={}){if(Ua[a])throw new Error(`${a} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:a,writeable:!1}),Ua[a]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}st("Object",Object),st("Set",Set),st("TransferableGridIndex",er),st("Color",Ht),st("Error",Error),st("AJAXError",ie),st("ResolvedImage",vn),st("StylePropertyFunction",Hr),st("StyleExpression",nc,{omit:["_evaluator"]}),st("ZoomDependentExpression",Oa),st("ZoomConstantExpression",pl),st("CompoundExpression",sr,{omit:["_evaluate"]});for(const a in dl)dl[a]._classRegistryKey||st(`Expression_${a}`,dl[a]);function Gc(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Ss(a){return a.$name||a.constructor._classRegistryKey}function hc(a){return!(function(t){if(t===null||typeof t!="object")return!1;const n=Ss(t);return!(!n||n==="Object")})(a)&&(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||a instanceof Error||Gc(a)||vr(a)||ArrayBuffer.isView(a)||a instanceof ImageData)}function Wr(a,t){if(hc(a))return(Gc(a)||vr(a))&&t&&t.push(a),ArrayBuffer.isView(a)&&t&&t.push(a.buffer),a instanceof ImageData&&t&&t.push(a.data.buffer),a;if(Array.isArray(a)){const p=[];for(const _ of a)p.push(Wr(_,t));return p}if(typeof a!="object")throw new Error("can't serialize object of type "+typeof a);const n=Ss(a);if(!n)throw new Error(`can't serialize object of unregistered class ${a.constructor.name}`);if(!Ua[n])throw new Error(`${n} is not registered.`);const{klass:o}=Ua[n],u=o.serialize?o.serialize(a,t):{};if(o.serialize){if(t&&u===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in a){if(!a.hasOwnProperty(p)||Ua[n].omit.indexOf(p)>=0)continue;const _=a[p];u[p]=Ua[n].shallow.indexOf(p)>=0?_:Wr(_,t)}a instanceof Error&&(u.message=a.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(u.$name=n),u}function Ms(a){if(hc(a))return a;if(Array.isArray(a))return a.map(Ms);if(typeof a!="object")throw new Error("can't deserialize object of type "+typeof a);const t=Ss(a)||"Object";if(!Ua[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=Ua[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(a);const o=Object.create(n.prototype);for(const u of Object.keys(a)){if(u==="$name")continue;const p=a[u];o[u]=Ua[t].shallow.indexOf(u)>=0?p:Ms(p)}return o}class qc{constructor(){this.first=!0}update(t,n){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const $t={"Latin-1 Supplement":a=>a>=128&&a<=255,"Hangul Jamo":a=>a>=4352&&a<=4607,Khmer:a=>a>=6016&&a<=6143,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Kanbun:a=>a>=12688&&a<=12703,"CJK Strokes":a=>a>=12736&&a<=12783,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Hangul Syllables":a=>a>=44032&&a<=55215,"Private Use Area":a=>a>=57344&&a<=63743,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function Cs(a){for(const t of a)if(_l(t.charCodeAt(0)))return!0;return!1}function ro(a){for(const t of a)if(!ko(t.charCodeAt(0)))return!1;return!0}function Hc(a){const t=a.map((n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}})).filter((n=>n));return new RegExp(t.join("|"),"u")}const Zu=Hc(["Arab","Dupl","Mong","Ougr","Syrc"]);function ko(a){return!Zu.test(String.fromCodePoint(a))}const gl=Hc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function _l(a){return!(a!==746&&a!==747&&(a<4352||!($t["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||$t["CJK Compatibility"](a)||$t["CJK Strokes"](a)||!(!$t["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||$t["Enclosed CJK Letters and Months"](a)||$t["Ideographic Description Characters"](a)||$t.Kanbun(a)||$t.Katakana(a)&&a!==12540||!(!$t["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!$t["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||$t["Vertical Forms"](a)||$t["Yijing Hexagram Symbols"](a)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(a))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(a))||gl.test(String.fromCodePoint(a)))))}function Bo(a){return!(_l(a)||(function(t){return!!($t["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||$t["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||$t["Letterlike Symbols"](t)||$t["Number Forms"](t)||$t["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||$t["Control Pictures"](t)&&t!==9251||$t["Optical Character Recognition"](t)||$t["Enclosed Alphanumerics"](t)||$t["Geometric Shapes"](t)||$t["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||$t["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||$t["CJK Symbols and Punctuation"](t)||$t.Katakana(t)||$t["Private Use Area"](t)||$t["CJK Compatibility Forms"](t)||$t["Small Form Variants"](t)||$t["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(a))}const dc=Hc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function $c(a){return dc.test(String.fromCodePoint(a))}function so(a,t){return!(!t&&$c(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||$t.Khmer(a))}function fc(a){for(const t of a)if($c(t.charCodeAt(0)))return!0;return!1}const Ma=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(a){this.pluginStatus=a.pluginStatus,this.pluginURL=a.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(a){if(Ma.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=a.applyArabicShaping,this.processBidirectionalText=a.processBidirectionalText,this.processStyledBidirectionalText=a.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(a,t){return d(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(a.pluginStatus!=="loading")return this.setState(a),a;const n=a.pluginURL,o=new Promise((p=>{this.loadScriptResolve=p}));t(n);const u=new Promise((p=>setTimeout((()=>p()),this.TIMEOUT)));if(yield Promise.race([o,u]),this.isParsed()){const p={pluginStatus:"loaded",pluginURL:n};return this.setState(p),p}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)}))}};class ui{constructor(t,n){this.isSupportedScript=Gu,this.zoom=t,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new qc,this.transition=n.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new qc,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}function Gu(a){return(function(t,n){for(const o of t)if(!so(o.charCodeAt(0),n))return!1;return!0})(a,Ma.getRTLTextPluginStatus()==="loaded")}class Sr{constructor(t,n,o){this.property=t,this.value=n,this.expression=(function(u,p,_){if(Zr(u))return new Hr(u,p);if(ac(u)){const v=Ro(u,p,_);if(v.result==="error")throw new Error(v.value.map((b=>`${b.key}: ${b.message}`)).join(", "));return v.value}{let v=u;return p.type==="color"&&typeof u=="string"?v=Ht.parse(u):p.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?p.type!=="numberArray"||typeof u!="number"&&!Array.isArray(u)?p.type!=="colorArray"||typeof u!="string"&&!Array.isArray(u)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(u)?v=Vn.parse(u):p.type==="projectionDefinition"&&typeof u=="string"&&(v=Wn.parse(u)):v=yn.parse(u):v=Rn.parse(u):v=on.parse(u),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>v}}})(n===void 0?t.specification.default:n,t.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,n,o){return this.property.possiblyEvaluate(this,t,n,o)}}class Mr{constructor(t,n){this.property=t,this.value=new Sr(t,void 0,n)}transitioned(t,n){return new pc(this.property,this.value,n,wi({},t.transition,this.transition),t.now)}untransitioned(){return new pc(this.property,this.value,null,{},0)}}class Oo{constructor(t,n){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._globalState=n}getValue(t){return Qn(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Mr(this._values[t].property,this._globalState)),this._values[t].value=new Sr(this._values[t].property,n===null?void 0:Qn(n),this._globalState)}getTransition(t){return Qn(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Mr(this._values[t].property,this._globalState)),this._values[t].transition=Qn(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o);const u=this.getTransition(n);u!==void 0&&(t[`${n}-transition`]=u)}return t}transitioned(t,n){const o=new Xc(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(t,n._values[u]);return o}untransitioned(){const t=new Xc(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class pc{constructor(t,n,o,u,p){this.property=t,this.value=n,this.begin=p+u.delay||0,this.end=this.begin+u.duration||0,t.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(t,n,o){const u=t.now||0,p=this.value.possiblyEvaluate(t,n,o),_=this.prior;if(_){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return _.possiblyEvaluate(t,n,o);{const v=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,n,o),p,at(v))}}return p}}class Xc{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,o){const u=new gc(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(t,n,o);return u}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class mc{constructor(t,n){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._globalState=n}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Qn(this._values[t].value)}setValue(t,n){this._values[t]=new Sr(this._values[t].property,n===null?void 0:Qn(n),this._globalState)}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o)}return t}possiblyEvaluate(t,n,o){const u=new gc(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(t,n,o);return u}}class ja{constructor(t,n,o){this.property=t,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,o,u){return this.property.evaluate(this.value,this.parameters,t,n,o,u)}}class gc{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class dt{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,o){const u=Fr[this.specification.type];return u?u(t,n,o):t}}class mt{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,o,u){return new ja(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},o,u)}:t.expression,n)}interpolate(t,n,o){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new ja(this,{kind:"constant",value:void 0},t.parameters);const u=Fr[this.specification.type];if(u){const p=u(t.value.value,n.value.value,o);return new ja(this,{kind:"constant",value:p},t.parameters)}return t}evaluate(t,n,o,u,p,_){return t.kind==="constant"?t.value:t.evaluate(n,o,u,p,_)}}class oo extends mt{possiblyEvaluate(t,n,o,u){if(t.value===void 0)return new ja(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const p=t.expression.evaluate(n,null,{},o,u),_=t.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,v=this._calculate(_,_,_,n);return new ja(this,{kind:"constant",value:v},n)}if(t.expression.kind==="camera"){const p=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new ja(this,{kind:"constant",value:p},n)}return new ja(this,t.expression,n)}evaluate(t,n,o,u,p,_){if(t.kind==="source"){const v=t.evaluate(n,o,u,p,_);return this._calculate(v,v,v,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},o,u),t.evaluate({zoom:Math.floor(n.zoom)},o,u),t.evaluate({zoom:Math.floor(n.zoom)+1},o,u),n):t.value}_calculate(t,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class qu{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,u){if(t.value!==void 0){if(t.expression.kind==="constant"){const p=t.expression.evaluate(n,null,{},o,u);return this._calculate(p,p,p,n)}return this._calculate(t.expression.evaluate(new ui(Math.floor(n.zoom-1),n)),t.expression.evaluate(new ui(Math.floor(n.zoom),n)),t.expression.evaluate(new ui(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class yl{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,u){return!!t.expression.evaluate(n,null,{},o,u)}interpolate(){return!1}}class ia{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const o=t[n];o.specification.overridable&&this.overridableProperties.push(n);const u=this.defaultPropertyValues[n]=new Sr(o,void 0,void 0),p=this.defaultTransitionablePropertyValues[n]=new Mr(o,void 0);this.defaultTransitioningPropertyValues[n]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=u.possiblyEvaluate({})}}}st("DataDrivenProperty",mt),st("DataConstantProperty",dt),st("CrossFadedDataDrivenProperty",oo),st("CrossFadedProperty",qu),st("ColorRampProperty",yl);const Na="-transition";class pn extends ct{constructor(t,n,o){if(super(),this.id=t.id,this.type=t.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=_a(t.filter,o)),n.layout&&(this._unevaluatedLayout=new mc(n.layout,o)),n.paint)){this._transitionablePaint=new Oo(n.paint,o);for(const u in t.paint)this.setPaintProperty(u,t.paint[u],{validate:!1});for(const u in t.layout)this.setLayoutProperty(u,t.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new gc(n.paint)}}setFilter(t){this.filter=t,this._featureFilter=_a(t,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const n in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[n];for(const u of o.getGlobalStateRefs())t.add(u)}for(const n of this._featureFilter.getGlobalStateRefs())t.add(n);return t}getPaintAffectingGlobalStateRefs(){var t;const n=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const u=this._transitionablePaint._values[o].value;for(const p of u.getGlobalStateRefs()){const _=(t=n.get(p))!==null&&t!==void 0?t:[];_.push({name:o,value:u.value}),n.set(p,_)}}return n}setLayoutProperty(t,n,o={}){n!=null&&this._validate(Zc,`layers.${this.id}.layout.${t}`,t,n,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(Na)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,o={}){if(n!=null&&this._validate(jh,`layers.${this.id}.paint.${t}`,t,n,o))return!1;if(t.endsWith(Na))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const u=this._transitionablePaint._values[t],p=u.property.specification["property-type"]==="cross-faded-data-driven",_=u.value.isDataDriven(),v=u.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const b=this._transitionablePaint._values[t].value;return b.isDataDriven()||_||p||this._handleOverridablePaintPropertyUpdate(t,v,b)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),ir(t,((n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length)))}_validate(t,n,o,u,p={}){return(!p||p.validate!==!1)&&Vu(this,t.call(Tr,{key:n,layerType:this.type,objectKey:o,value:u,styleSpec:_e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof ja&&Vr(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const Va={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class lo{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Li{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function vi(a,t=1){let n=0,o=0;return{members:a.map((u=>{const p=Va[u.type].BYTES_PER_ELEMENT,_=n=ya(n,Math.max(t,p)),v=u.components||1;return o=Math.max(o,p),n+=p*v,{name:u.name,type:u.type,components:v,offset:_}})),size:ya(n,Math.max(o,t)),alignment:t}}function ya(a,t){return Math.ceil(a/t)*t}class Yi extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.int16[u+0]=n,this.int16[u+1]=o,t}}Yi.prototype.bytesPerElement=4,st("StructArrayLayout2i4",Yi);class Jr extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const p=3*t;return this.int16[p+0]=n,this.int16[p+1]=o,this.int16[p+2]=u,t}}Jr.prototype.bytesPerElement=6,st("StructArrayLayout3i6",Jr);class Ca extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,t,n,o,u)}emplace(t,n,o,u,p){const _=4*t;return this.int16[_+0]=n,this.int16[_+1]=o,this.int16[_+2]=u,this.int16[_+3]=p,t}}Ca.prototype.bytesPerElement=8,st("StructArrayLayout4i8",Ca);class Ut extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,p,_)}emplace(t,n,o,u,p,_,v){const b=6*t;return this.int16[b+0]=n,this.int16[b+1]=o,this.int16[b+2]=u,this.int16[b+3]=p,this.int16[b+4]=_,this.int16[b+5]=v,t}}Ut.prototype.bytesPerElement=12,st("StructArrayLayout2i4i12",Ut);class di extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,p,_)}emplace(t,n,o,u,p,_,v){const b=4*t,M=8*t;return this.int16[b+0]=n,this.int16[b+1]=o,this.uint8[M+4]=u,this.uint8[M+5]=p,this.uint8[M+6]=_,this.uint8[M+7]=v,t}}di.prototype.bytesPerElement=8,st("StructArrayLayout2i4ub8",di);class Ei extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.float32[u+0]=n,this.float32[u+1]=o,t}}Ei.prototype.bytesPerElement=8,st("StructArrayLayout2f8",Ei);class vl extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,_,v,b,M,C){const z=this.length;return this.resize(z+1),this.emplace(z,t,n,o,u,p,_,v,b,M,C)}emplace(t,n,o,u,p,_,v,b,M,C,z){const k=10*t;return this.uint16[k+0]=n,this.uint16[k+1]=o,this.uint16[k+2]=u,this.uint16[k+3]=p,this.uint16[k+4]=_,this.uint16[k+5]=v,this.uint16[k+6]=b,this.uint16[k+7]=M,this.uint16[k+8]=C,this.uint16[k+9]=z,t}}vl.prototype.bytesPerElement=20,st("StructArrayLayout10ui20",vl);class co extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,_,v,b){const M=this.length;return this.resize(M+1),this.emplace(M,t,n,o,u,p,_,v,b)}emplace(t,n,o,u,p,_,v,b,M){const C=8*t;return this.uint16[C+0]=n,this.uint16[C+1]=o,this.uint16[C+2]=u,this.uint16[C+3]=p,this.uint16[C+4]=_,this.uint16[C+5]=v,this.uint16[C+6]=b,this.uint16[C+7]=M,t}}co.prototype.bytesPerElement=16,st("StructArrayLayout8ui16",co);class es extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,_,v,b,M,C,z,k){const O=this.length;return this.resize(O+1),this.emplace(O,t,n,o,u,p,_,v,b,M,C,z,k)}emplace(t,n,o,u,p,_,v,b,M,C,z,k,O){const F=12*t;return this.int16[F+0]=n,this.int16[F+1]=o,this.int16[F+2]=u,this.int16[F+3]=p,this.uint16[F+4]=_,this.uint16[F+5]=v,this.uint16[F+6]=b,this.uint16[F+7]=M,this.int16[F+8]=C,this.int16[F+9]=z,this.int16[F+10]=k,this.int16[F+11]=O,t}}es.prototype.bytesPerElement=24,st("StructArrayLayout4i4ui4i24",es);class xl extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const p=3*t;return this.float32[p+0]=n,this.float32[p+1]=o,this.float32[p+2]=u,t}}xl.prototype.bytesPerElement=12,st("StructArrayLayout3f12",xl);class m extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}m.prototype.bytesPerElement=4,st("StructArrayLayout1ul4",m);class e extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,_,v,b,M){const C=this.length;return this.resize(C+1),this.emplace(C,t,n,o,u,p,_,v,b,M)}emplace(t,n,o,u,p,_,v,b,M,C){const z=10*t,k=5*t;return this.int16[z+0]=n,this.int16[z+1]=o,this.int16[z+2]=u,this.int16[z+3]=p,this.int16[z+4]=_,this.int16[z+5]=v,this.uint32[k+3]=b,this.uint16[z+8]=M,this.uint16[z+9]=C,t}}e.prototype.bytesPerElement=20,st("StructArrayLayout6i1ul2ui20",e);class r extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,p,_)}emplace(t,n,o,u,p,_,v){const b=6*t;return this.int16[b+0]=n,this.int16[b+1]=o,this.int16[b+2]=u,this.int16[b+3]=p,this.int16[b+4]=_,this.int16[b+5]=v,t}}r.prototype.bytesPerElement=12,st("StructArrayLayout2i2i2i12",r);class l extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,o,u,p)}emplace(t,n,o,u,p,_){const v=4*t,b=8*t;return this.float32[v+0]=n,this.float32[v+1]=o,this.float32[v+2]=u,this.int16[b+6]=p,this.int16[b+7]=_,t}}l.prototype.bytesPerElement=16,st("StructArrayLayout2f1f2i16",l);class h extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,p,_)}emplace(t,n,o,u,p,_,v){const b=16*t,M=4*t,C=8*t;return this.uint8[b+0]=n,this.uint8[b+1]=o,this.float32[M+1]=u,this.float32[M+2]=p,this.int16[C+6]=_,this.int16[C+7]=v,t}}h.prototype.bytesPerElement=16,st("StructArrayLayout2ub2f2i16",h);class g extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const p=3*t;return this.uint16[p+0]=n,this.uint16[p+1]=o,this.uint16[p+2]=u,t}}g.prototype.bytesPerElement=6,st("StructArrayLayout3ui6",g);class y extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,_,v,b,M,C,z,k,O,F,V,q,W){const ge=this.length;return this.resize(ge+1),this.emplace(ge,t,n,o,u,p,_,v,b,M,C,z,k,O,F,V,q,W)}emplace(t,n,o,u,p,_,v,b,M,C,z,k,O,F,V,q,W,ge){const ne=24*t,le=12*t,we=48*t;return this.int16[ne+0]=n,this.int16[ne+1]=o,this.uint16[ne+2]=u,this.uint16[ne+3]=p,this.uint32[le+2]=_,this.uint32[le+3]=v,this.uint32[le+4]=b,this.uint16[ne+10]=M,this.uint16[ne+11]=C,this.uint16[ne+12]=z,this.float32[le+7]=k,this.float32[le+8]=O,this.uint8[we+36]=F,this.uint8[we+37]=V,this.uint8[we+38]=q,this.uint32[le+10]=W,this.int16[ne+22]=ge,t}}y.prototype.bytesPerElement=48,st("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",y);class w extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,_,v,b,M,C,z,k,O,F,V,q,W,ge,ne,le,we,Re,Ze,nt,Je,it,gt,et){const tt=this.length;return this.resize(tt+1),this.emplace(tt,t,n,o,u,p,_,v,b,M,C,z,k,O,F,V,q,W,ge,ne,le,we,Re,Ze,nt,Je,it,gt,et)}emplace(t,n,o,u,p,_,v,b,M,C,z,k,O,F,V,q,W,ge,ne,le,we,Re,Ze,nt,Je,it,gt,et,tt){const Fe=32*t,Tt=16*t;return this.int16[Fe+0]=n,this.int16[Fe+1]=o,this.int16[Fe+2]=u,this.int16[Fe+3]=p,this.int16[Fe+4]=_,this.int16[Fe+5]=v,this.int16[Fe+6]=b,this.int16[Fe+7]=M,this.uint16[Fe+8]=C,this.uint16[Fe+9]=z,this.uint16[Fe+10]=k,this.uint16[Fe+11]=O,this.uint16[Fe+12]=F,this.uint16[Fe+13]=V,this.uint16[Fe+14]=q,this.uint16[Fe+15]=W,this.uint16[Fe+16]=ge,this.uint16[Fe+17]=ne,this.uint16[Fe+18]=le,this.uint16[Fe+19]=we,this.uint16[Fe+20]=Re,this.uint16[Fe+21]=Ze,this.uint16[Fe+22]=nt,this.uint32[Tt+12]=Je,this.float32[Tt+13]=it,this.float32[Tt+14]=gt,this.uint16[Fe+30]=et,this.uint16[Fe+31]=tt,t}}w.prototype.bytesPerElement=64,st("StructArrayLayout8i15ui1ul2f2ui64",w);class T extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}T.prototype.bytesPerElement=4,st("StructArrayLayout1f4",T);class E extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const p=3*t;return this.uint16[6*t+0]=n,this.float32[p+1]=o,this.float32[p+2]=u,t}}E.prototype.bytesPerElement=12,st("StructArrayLayout1ui2f12",E);class A extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const p=4*t;return this.uint32[2*t+0]=n,this.uint16[p+2]=o,this.uint16[p+3]=u,t}}A.prototype.bytesPerElement=8,st("StructArrayLayout1ul2ui8",A);class D extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.uint16[u+0]=n,this.uint16[u+1]=o,t}}D.prototype.bytesPerElement=4,st("StructArrayLayout2ui4",D);class P extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}P.prototype.bytesPerElement=2,st("StructArrayLayout1ui2",P);class B extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,t,n,o,u)}emplace(t,n,o,u,p){const _=4*t;return this.float32[_+0]=n,this.float32[_+1]=o,this.float32[_+2]=u,this.float32[_+3]=p,t}}B.prototype.bytesPerElement=16,st("StructArrayLayout4f16",B);class N extends lo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ze(this.anchorPointX,this.anchorPointY)}}N.prototype.size=20;class $ extends e{get(t){return new N(this,t)}}st("CollisionBoxArray",$);class X extends lo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}X.prototype.size=48;class Y extends y{get(t){return new X(this,t)}}st("PlacedSymbolArray",Y);class Q extends lo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Q.prototype.size=64;class ee extends w{get(t){return new Q(this,t)}}st("SymbolInstanceArray",ee);class J extends T{getoffsetX(t){return this.float32[1*t+0]}}st("GlyphOffsetArray",J);class se extends Jr{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}st("SymbolLineVertexArray",se);class ue extends lo{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ue.prototype.size=12;class te extends E{get(t){return new ue(this,t)}}st("TextAnchorOffsetArray",te);class de extends lo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}de.prototype.size=8;class Ce extends A{get(t){return new de(this,t)}}st("FeatureIndexArray",Ce);class Te extends Yi{}class Se extends Yi{}class Ee extends Yi{}class We extends Ut{}class Qe extends di{}class Ve extends Ei{}class lt extends vl{}class Lt extends co{}class li extends es{}class ki extends xl{}class Ai extends m{}class Vi extends r{}class Bi extends h{}class Bn extends g{}class Zi extends D{}const xi=vi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Si}=xi;class Gt{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,n,o,u){const p=this.segments[this.segments.length-1];return t>Gt.MAX_VERTEX_ARRAY_LENGTH&&zi(`Max vertices per segment is ${Gt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Gt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!p||p.vertexLength+t>Gt.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u?this.createNewSegment(n,o,u):p}createNewSegment(t,n,o){const u={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(u.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(u),u}getOrCreateLatestSegment(t,n,o){return this.prepareSegment(0,t,n,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,o,u){return new Gt([{vertexOffset:t,primitiveOffset:n,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function On(a,t){return 256*(a=Ct(Math.floor(a),0,255))+Ct(Math.floor(t),0,255)}Gt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,st("SegmentVector",Gt);const lr=vi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),uo=vi([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var ts,Fo,bl,Es={exports:{}},ho={exports:{}},Za={exports:{}},As=(function(){if(bl)return Es.exports;bl=1;var a=(ts||(ts=1,ho.exports=function(n,o){var u,p,_,v,b,M,C,z;for(p=n.length-(u=3&n.length),_=o,b=3432918353,M=461845907,z=0;z<p;)C=255&n.charCodeAt(z)|(255&n.charCodeAt(++z))<<8|(255&n.charCodeAt(++z))<<16|(255&n.charCodeAt(++z))<<24,++z,_=27492+(65535&(v=5*(65535&(_=(_^=C=(65535&(C=(C=(65535&C)*b+(((C>>>16)*b&65535)<<16)&4294967295)<<15|C>>>17))*M+(((C>>>16)*M&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(C=0,u){case 3:C^=(255&n.charCodeAt(z+2))<<16;case 2:C^=(255&n.charCodeAt(z+1))<<8;case 1:_^=C=(65535&(C=(C=(65535&(C^=255&n.charCodeAt(z)))*b+(((C>>>16)*b&65535)<<16)&4294967295)<<15|C>>>17))*M+(((C>>>16)*M&65535)<<16)&4294967295}return _^=n.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),ho.exports),t=(Fo||(Fo=1,Za.exports=function(n,o){for(var u,p=n.length,_=o^p,v=0;p>=4;)u=1540483477*(65535&(u=255&n.charCodeAt(v)|(255&n.charCodeAt(++v))<<8|(255&n.charCodeAt(++v))<<16|(255&n.charCodeAt(++v))<<24))+((1540483477*(u>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),p-=4,++v;switch(p){case 3:_^=(255&n.charCodeAt(v+2))<<16;case 2:_^=(255&n.charCodeAt(v+1))<<8;case 1:_=1540483477*(65535&(_^=255&n.charCodeAt(v)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Za.exports);return Es.exports=a,Es.exports.murmur3=a,Es.exports.murmur2=t,Es.exports})(),Cr=Ie(As);class zs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,o,u){this.ids.push(xn(t)),this.positions.push(n,o,u)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=xn(t);let o=0,u=this.ids.length-1;for(;o<u;){const _=o+u>>1;this.ids[_]>=n?u=_:o=_+1}const p=[];for(;this.ids[o]===n;)p.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return p}static serialize(t,n){const o=new Float64Array(t.ids),u=new Uint32Array(t.positions);return mn(o,u,0,o.length-1),n&&n.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(t){const n=new zs;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function xn(a){const t=+a;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Cr(String(a))}function mn(a,t,n,o){for(;n<o;){const u=a[n+o>>1];let p=n-1,_=o+1;for(;;){do p++;while(a[p]<u);do _--;while(a[_]>u);if(p>=_)break;va(a,p,_),va(t,3*p,3*_),va(t,3*p+1,3*_+1),va(t,3*p+2,3*_+2)}_-n<o-_?(mn(a,t,n,_),n=_+1):(mn(a,t,_+1,o),o=_)}}function va(a,t,n){const o=a[t];a[t]=a[n],a[n]=o}st("FeaturePositionMap",zs);class Oi{constructor(t,n){this.gl=t.gl,this.location=n}}class Yc extends Oi{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Kc extends Oi{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Hu extends Oi{constructor(t,n){super(t,n),this.current=Ht.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Nh=new Float32Array(16);function _c(a){return[On(255*a.r,255*a.g),On(255*a.b,255*a.a)]}class wl{constructor(t,n,o){this.value=t,this.uniformNames=n.map((u=>`u_${u}`)),this.type=o}setUniform(t,n,o){t.set(o.constantOr(this.value))}getBinding(t,n,o){return this.type==="color"?new Hu(t,n):new Yc(t,n)}}class Ga{constructor(t,n){this.uniformNames=n.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setConstantDashPositions(t,n){this.dashTo=[0,t.y,t.height,t.width],this.dashFrom=[0,n.y,n.height,n.width]}setUniform(t,n,o,u){let p=null;u==="u_pattern_to"?p=this.patternTo:u==="u_pattern_from"?p=this.patternFrom:u==="u_dasharray_to"?p=this.dashTo:u==="u_dasharray_from"?p=this.dashFrom:u==="u_pixel_ratio_to"?p=this.pixelRatioTo:u==="u_pixel_ratio_from"&&(p=this.pixelRatioFrom),p!==null&&t.set(p)}getBinding(t,n,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new Kc(t,n):new Yc(t,n)}}class is{constructor(t,n,o,u){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map((p=>({name:`a_${p}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new u}populatePaintArray(t,n,o){const u=this.paintVertexArray.length,p=this.expression.evaluate(new ui(0,o),n,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(t),this._setPaintValue(u,t,p)}updatePaintArray(t,n,o,u,p){const _=this.expression.evaluate(new ui(0,p),o,u);this._setPaintValue(t,n,_)}_setPaintValue(t,n,o){if(this.type==="color"){const u=_c(o);for(let p=t;p<n;p++)this.paintVertexArray.emplace(p,u[0],u[1])}else{for(let u=t;u<n;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cr{constructor(t,n,o,u,p,_){this.expression=t,this.uniformNames=n.map((v=>`u_${v}_t`)),this.type=o,this.useIntegerZoom=u,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=n.map((v=>({name:`a_${v}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new _}populatePaintArray(t,n,o){const u=this.expression.evaluate(new ui(this.zoom,o),n,{},o.canonical,[],o.formattedSection),p=this.expression.evaluate(new ui(this.zoom+1,o),n,{},o.canonical,[],o.formattedSection),_=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(_,t,u,p)}updatePaintArray(t,n,o,u,p){const _=this.expression.evaluate(new ui(this.zoom,p),o,u),v=this.expression.evaluate(new ui(this.zoom+1,p),o,u);this._setPaintValue(t,n,_,v)}_setPaintValue(t,n,o,u){if(this.type==="color"){const p=_c(o),_=_c(u);for(let v=t;v<n;v++)this.paintVertexArray.emplace(v,p[0],p[1],_[0],_[1])}else{for(let p=t;p<n;p++)this.paintVertexArray.emplace(p,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,u=Ct(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(u)}getBinding(t,n,o){return new Yc(t,n)}}class ns{constructor(t,n,o,u,p,_){this.expression=t,this.type=n,this.useIntegerZoom=o,this.zoom=u,this.layerId=_,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(t,n,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(u,t,this.getPositionIds(n),o)}updatePaintArray(t,n,o,u,p){this._setPaintValues(t,n,this.getPositionIds(o),p)}_setPaintValues(t,n,o,u){const p=this.getPositions(u);if(!p||!o)return;const _=p[o.min],v=p[o.mid],b=p[o.max];if(_&&v&&b)for(let M=t;M<n;M++)this.emplace(this.zoomInPaintVertexArray,M,v,_),this.emplace(this.zoomOutPaintVertexArray,M,v,b)}upload(t){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const n=this.getVertexAttributes();this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,n,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,n,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class fo extends ns{getPositions(t){return t.imagePositions}getPositionIds(t){return t.patterns&&t.patterns[this.layerId]}getVertexAttributes(){return lr.members}emplace(t,n,o,u){t.emplace(n,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],u.tlbr[0],u.tlbr[1],u.tlbr[2],u.tlbr[3],o.pixelRatio,u.pixelRatio)}}class yc extends ns{getPositions(t){return t.dashPositions}getPositionIds(t){return t.dashes&&t.dashes[this.layerId]}getVertexAttributes(){return uo.members}emplace(t,n,o,u){t.emplace(n,0,o.y,o.height,o.width,0,u.y,u.height,u.width)}}class Uo{constructor(t,n,o){this.binders={},this._buffers=[];const u=[];for(const p in t.paint._values){if(!o(p))continue;const _=t.paint.get(p);if(!(_ instanceof ja&&Vr(_.property.specification)))continue;const v=Uf(p,t.type),b=_.value,M=_.property.specification.type,C=_.property.useIntegerZoom,z=_.property.specification["property-type"],k=z==="cross-faded"||z==="cross-faded-data-driven";if(b.kind==="constant")this.binders[p]=k?new Ga(b.value,v):new wl(b.value,v,M),u.push(`/u_${p}`);else if(b.kind==="source"||k){const O=Qc(p,M,"source");this.binders[p]=k?p==="line-dasharray"?new yc(b,M,C,n,O,t.id):new fo(b,M,C,n,O,t.id):new is(b,v,M,O),u.push(`/a_${p}`)}else{const O=Qc(p,M,"composite");this.binders[p]=new cr(b,v,M,C,n,O),u.push(`/z_${p}`)}}this.cacheKey=u.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof is||n instanceof cr?n.maxValue:0}populatePaintArrays(t,n,o){for(const u in this.binders){const p=this.binders[u];(p instanceof is||p instanceof cr||p instanceof ns)&&p.populatePaintArray(t,n,o)}}setConstantPatternPositions(t,n){for(const o in this.binders){const u=this.binders[o];u instanceof Ga&&u.setConstantPatternPositions(t,n)}}setConstantDashPositions(t,n){for(const o in this.binders){const u=this.binders[o];u instanceof Ga&&u.setConstantDashPositions(t,n)}}updatePaintArrays(t,n,o,u,p){let _=!1;for(const v in t){const b=n.getPositions(v);for(const M of b){const C=o.feature(M.index);for(const z in this.binders){const k=this.binders[z];if((k instanceof is||k instanceof cr||k instanceof ns)&&k.expression.isStateDependent===!0){const O=u.paint.get(z);k.expression=O.value,k.updatePaintArray(M.start,M.end,C,t[v],p),_=!0}}}}return _}defines(){const t=[];for(const n in this.binders){const o=this.binders[n];(o instanceof wl||o instanceof Ga)&&t.push(...o.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof is||o instanceof cr)for(let u=0;u<o.paintVertexAttributes.length;u++)t.push(o.paintVertexAttributes[u].name);else if(o instanceof ns){const u=o.getVertexAttributes();for(const p of u)t.push(p.name)}}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof wl||o instanceof Ga||o instanceof cr)for(const u of o.uniformNames)t.push(u)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const o=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof wl||p instanceof Ga||p instanceof cr){for(const _ of p.uniformNames)if(n[_]){const v=p.getBinding(t,n[_],_);o.push({name:_,property:u,binding:v})}}}return o}setUniforms(t,n,o,u){for(const{name:p,property:_,binding:v}of n)this.binders[_].setUniform(v,u,o.get(_),p)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(t&&o instanceof ns){const u=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof is||o instanceof cr)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const n in this.binders){const o=this.binders[n];(o instanceof is||o instanceof cr||o instanceof ns)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof is||n instanceof cr||n instanceof ns)&&n.destroy()}}}class Tl{constructor(t,n,o=()=>!0){this.programConfigurations={};for(const u of t)this.programConfigurations[u.id]=new Uo(u,n,o);this.needsUpload=!1,this._featureMap=new zs,this._bufferOffset=0}populatePaintArrays(t,n,o,u){for(const p in this.programConfigurations)this.programConfigurations[p].populatePaintArrays(t,n,u);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,o,u){for(const p of o)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(t,this._featureMap,n,p,u)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Uf(a,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${t}-`,"").replace(/-/g,"_")]}function Qc(a,t,n){const o={color:{source:Ei,composite:B},number:{source:T,composite:Ei}},u=(function(p){return{"line-pattern":{source:lt,composite:lt},"fill-pattern":{source:lt,composite:lt},"fill-extrusion-pattern":{source:lt,composite:lt},"line-dasharray":{source:Lt,composite:Lt}}[p]})(a);return u&&u[n]||o[t][n]}st("ConstantBinder",wl),st("CrossFadedConstantBinder",Ga),st("SourceExpressionBinder",is),st("CrossFadedPatternBinder",fo),st("CrossFadedDasharrayBinder",yc),st("CompositeExpressionBinder",cr),st("ProgramConfiguration",Uo,{omit:["_buffers"]}),st("ProgramConfigurationSet",Tl);const Vh=Math.pow(2,14)-1,Zh=-Vh-1;function Sl(a){const t=_t/a.extent,n=a.loadGeometry();for(let o=0;o<n.length;o++){const u=n[o];for(let p=0;p<u.length;p++){const _=u[p],v=Math.round(_.x*t),b=Math.round(_.y*t);_.x=Ct(v,Zh,Vh),_.y=Ct(b,Zh,Vh),(v<_.x||v>_.x+1||b<_.y||b>_.y+1)&&zi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function jo(a,t){return{type:a.type,id:a.id,properties:a.properties,geometry:t?Sl(a):[]}}const Gh=-32768;function jf(a,t,n,o,u){a.emplaceBack(Gh+8*t+o,Gh+8*n+u)}class qh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new Se,this.indexArray=new Bn,this.segments=new Gt,this.programConfigurations=new Tl(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,o){const u=this.layers[0],p=[];let _=null,v=!1,b=u.type==="heatmap";if(u.type==="circle"){const C=u;_=C.layout.get("circle-sort-key"),v=!_.isConstant(),b=b||C.paint.get("circle-pitch-alignment")==="map"}const M=b?n.subdivisionGranularity.circle:1;for(const{feature:C,id:z,index:k,sourceLayerIndex:O}of t){const F=this.layers[0]._featureFilter.needGeometry,V=jo(C,F);if(!this.layers[0]._featureFilter.filter(new ui(this.zoom),V,o))continue;const q=v?_.evaluate(V,{},o):void 0,W={id:z,properties:C.properties,type:C.type,sourceLayerIndex:O,index:k,geometry:F?V.geometry:Sl(C),patterns:{},sortKey:q};p.push(W)}v&&p.sort(((C,z)=>C.sortKey-z.sortKey));for(const C of p){const{geometry:z,index:k,sourceLayerIndex:O}=C,F=t[k].feature;this.addFeature(C,z,k,o,M),n.featureIndex.insert(F,z,k,O,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Si),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,o,u,p=1){let _;switch(p){case 1:_=[0,7];break;case 3:_=[0,2,5,7];break;case 5:_=[0,1,3,4,6,7];break;case 7:_=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${p}; valid values are 1, 3, 5, 7.`)}const v=_.length;for(const b of n)for(const M of b){const C=M.x,z=M.y;if(C<0||C>=_t||z<0||z>=_t)continue;const k=this.segments.prepareSegment(v*v,this.layoutVertexArray,this.indexArray,t.sortKey),O=k.vertexLength;for(let F=0;F<v;F++)for(let V=0;V<v;V++)jf(this.layoutVertexArray,C,z,_[V],_[F]);for(let F=0;F<v-1;F++)for(let V=0;V<v-1;V++){const q=O+F*v+V,W=O+(F+1)*v+V;this.indexArray.emplaceBack(q,W+1,q+1),this.indexArray.emplaceBack(q,W,W+1)}k.vertexLength+=v*v,k.primitiveLength+=(v-1)*(v-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:{},canonical:u})}}function Ml(a,t){for(let n=0;n<a.length;n++)if(Jc(t,a[n]))return!0;for(let n=0;n<t.length;n++)if(Jc(a,t[n]))return!0;return!!Wc(a,t)}function $u(a,t,n){return!!Jc(a,t)||!!Xu(t,a,n)}function Bd(a,t){if(a.length===1)return Fd(t,a[0]);for(let n=0;n<t.length;n++){const o=t[n];for(let u=0;u<o.length;u++)if(Jc(a,o[u]))return!0}for(let n=0;n<a.length;n++)if(Fd(t,a[n]))return!0;for(let n=0;n<t.length;n++)if(Wc(a,t[n]))return!0;return!1}function Nf(a,t,n){if(a.length>1){if(Wc(a,t))return!0;for(let o=0;o<t.length;o++)if(Xu(t[o],a,n))return!0}for(let o=0;o<a.length;o++)if(Xu(a[o],t,n))return!0;return!1}function Wc(a,t){if(a.length===0||t.length===0)return!1;for(let n=0;n<a.length-1;n++){const o=a[n],u=a[n+1];for(let p=0;p<t.length-1;p++)if(Vf(o,u,t[p],t[p+1]))return!0}return!1}function Vf(a,t,n,o){return $a(a,n,o)!==$a(t,n,o)&&$a(a,t,n)!==$a(a,t,o)}function Xu(a,t,n){const o=n*n;if(t.length===1)return a.distSqr(t[0])<o;for(let u=1;u<t.length;u++)if(Od(a,t[u-1],t[u])<o)return!0;return!1}function Od(a,t,n){const o=t.distSqr(n);if(o===0)return a.distSqr(t);const u=((a.x-t.x)*(n.x-t.x)+(a.y-t.y)*(n.y-t.y))/o;return a.distSqr(u<0?t:u>1?n:n.sub(t)._mult(u)._add(t))}function Fd(a,t){let n,o,u,p=!1;for(let _=0;_<a.length;_++){n=a[_];for(let v=0,b=n.length-1;v<n.length;b=v++)o=n[v],u=n[b],o.y>t.y!=u.y>t.y&&t.x<(u.x-o.x)*(t.y-o.y)/(u.y-o.y)+o.x&&(p=!p)}return p}function Jc(a,t){let n=!1;for(let o=0,u=a.length-1;o<a.length;u=o++){const p=a[o],_=a[u];p.y>t.y!=_.y>t.y&&t.x<(_.x-p.x)*(t.y-p.y)/(_.y-p.y)+p.x&&(n=!n)}return n}function Ud(a,t,n){const o=n[0],u=n[2];if(a.x<o.x&&t.x<o.x||a.x>u.x&&t.x>u.x||a.y<o.y&&t.y<o.y||a.y>u.y&&t.y>u.y)return!1;const p=$a(a,t,n[0]);return p!==$a(a,t,n[1])||p!==$a(a,t,n[2])||p!==$a(a,t,n[3])}function un(a,t,n){const o=t.paint.get(a).value;return o.kind==="constant"?o.value:n.programConfigurations.get(t.id).getMaxValue(a)}function na(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Yu(a,t,n,o,u){if(!t[0]&&!t[1])return a;const p=ze.convert(t)._mult(u);n==="viewport"&&p._rotate(-o);const _=[];for(let v=0;v<a.length;v++)_.push(a[v].sub(p));return _}function Zf({queryGeometry:a,size:t},n){return $u(a,n,t)}function Gf({queryGeometry:a,size:t,transform:n,unwrappedTileID:o,getElevation:u},p){return $u(a,p,t*(n.projectTileCoordinates(p.x,p.y,o,u).signedDistanceFromCamera/n.cameraToCenterDistance))}function qf({queryGeometry:a,size:t,transform:n,unwrappedTileID:o,getElevation:u},p){const _=n.projectTileCoordinates(p.x,p.y,o,u).signedDistanceFromCamera,v=t*(n.cameraToCenterDistance/_);return $u(a,eu(p,n,o,u),v)}function Ku({queryGeometry:a,size:t,transform:n,unwrappedTileID:o,getElevation:u},p){return $u(a,eu(p,n,o,u),t)}function jd({queryGeometry:a,size:t,transform:n,unwrappedTileID:o,getElevation:u,pitchAlignment:p="map",pitchScale:_="map"},v){const b=p==="map"?_==="map"?Zf:Gf:_==="map"?qf:Ku,M={queryGeometry:a,size:t,transform:n,unwrappedTileID:o,getElevation:u};for(const C of v)for(const z of C)if(b(M,z))return!0;return!1}function eu(a,t,n,o){const u=t.projectTileCoordinates(a.x,a.y,n,o).point;return new ze((.5*u.x+.5)*t.width,(.5*-u.y+.5)*t.height)}let Nd,Hf;st("CircleBucket",qh,{omit:["layers"]});var Hh={get paint(){return Hf=Hf||new ia({"circle-radius":new mt(_e.paint_circle["circle-radius"]),"circle-color":new mt(_e.paint_circle["circle-color"]),"circle-blur":new mt(_e.paint_circle["circle-blur"]),"circle-opacity":new mt(_e.paint_circle["circle-opacity"]),"circle-translate":new dt(_e.paint_circle["circle-translate"]),"circle-translate-anchor":new dt(_e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new dt(_e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new dt(_e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new mt(_e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new mt(_e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new mt(_e.paint_circle["circle-stroke-opacity"])})},get layout(){return Nd=Nd||new ia({"circle-sort-key":new mt(_e.layout_circle["circle-sort-key"])})}};class Vd extends pn{constructor(t,n){super(t,Hh,n)}createBucket(t){return new qh(t)}queryRadius(t){const n=t;return un("circle-radius",this,n)+un("circle-stroke-width",this,n)+na(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:_,unwrappedTileID:v,getElevation:b}){const M=Yu(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-p.bearingInRadians,_),C=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),z=this.paint.get("circle-pitch-scale"),k=this.paint.get("circle-pitch-alignment");let O,F;return k==="map"?(O=M,F=C*_):(O=(function(V,q,W,ge){return V.map((ne=>eu(ne,q,W,ge)))})(M,p,v,b),F=C),jd({queryGeometry:O,size:F,transform:p,unwrappedTileID:v,getElevation:b,pitchAlignment:k,pitchScale:z},u)}}class Zd extends qh{}let Gd;st("HeatmapBucket",Zd,{omit:["layers"]});var $f={get paint(){return Gd=Gd||new ia({"heatmap-radius":new mt(_e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new mt(_e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new dt(_e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new yl(_e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new dt(_e.paint_heatmap["heatmap-opacity"])})}};function Qu(a,{width:t,height:n},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==t*n*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${t*n*o}`)}else u=new Uint8Array(t*n*o);return a.width=t,a.height=n,a.data=u,a}function $h(a,{width:t,height:n},o){if(t===a.width&&n===a.height)return;const u=Qu({},{width:t,height:n},o);Wu(a,u,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,t),height:Math.min(a.height,n)},o),a.width=t,a.height=n,a.data=u.data}function Wu(a,t,n,o,u,p){if(u.width===0||u.height===0)return t;if(u.width>a.width||u.height>a.height||n.x>a.width-u.width||n.y>a.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>t.width||u.height>t.height||o.x>t.width-u.width||o.y>t.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const _=a.data,v=t.data;if(_===v)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<u.height;b++){const M=((n.y+b)*a.width+n.x)*p,C=((o.y+b)*t.width+o.x)*p;for(let z=0;z<u.width*p;z++)v[C+z]=_[M+z]}return t}class tu{constructor(t,n){Qu(this,t,1,n)}resize(t){$h(this,t,1)}clone(){return new tu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,u,p){Wu(t,n,o,u,p,1)}}class Ea{constructor(t,n){Qu(this,t,4,n)}resize(t){$h(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Ea({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,u,p){Wu(t,n,o,u,p,4)}setPixel(t,n,o){const u=4*(t*this.width+n);this.data[u+0]=Math.round(255*o.r/o.a),this.data[u+1]=Math.round(255*o.g/o.a),this.data[u+2]=Math.round(255*o.b/o.a),this.data[u+3]=Math.round(255*o.a)}}function Ju(a){const t={},n=a.resolution||256,o=a.clips?a.clips.length:1,u=a.image||new Ea({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const p=(_,v,b)=>{t[a.evaluationKey]=b;const M=a.expression.evaluate(t);u.setPixel(_/4/n,v/4,M)};if(a.clips)for(let _=0,v=0;_<o;++_,v+=4*n)for(let b=0,M=0;b<n;b++,M+=4){const C=b/(n-1),{start:z,end:k}=a.clips[_];p(v,M,z*(1-C)+k*C)}else for(let _=0,v=0;_<n;_++,v+=4)p(0,v,_/(n-1));return u}st("AlphaImage",tu),st("RGBAImage",Ea);const eh="big-fb";class Xf extends pn{createBucket(t){return new Zd(t)}constructor(t,n){super(t,$f,n),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ju({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(eh)&&this.heatmapFbos.delete(eh)}queryRadius(t){return un("heatmap-radius",this,t)}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:_,unwrappedTileID:v,getElevation:b}){return jd({queryGeometry:t,size:this.paint.get("heatmap-radius").evaluate(n,o)*_,transform:p,unwrappedTileID:v,getElevation:b},u)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Xh;var Yf={get paint(){return Xh=Xh||new ia({"hillshade-illumination-direction":new dt(_e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new dt(_e.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new dt(_e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new dt(_e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new dt(_e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new dt(_e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new dt(_e.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new dt(_e.paint_hillshade["hillshade-method"])})}};class No extends pn{constructor(t,n){super(t,Yf,n),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,u=this.paint.get("hillshade-shadow-color").values;const p=Math.max(t.length,n.length,o.length,u.length);t=t.concat(Array(p-t.length).fill(t.at(-1))),n=n.concat(Array(p-n.length).fill(n.at(-1))),o=o.concat(Array(p-o.length).fill(o.at(-1))),u=u.concat(Array(p-u.length).fill(u.at(-1)));const _=n.map(Un);return{directionRadians:t.map(Un),altitudeRadians:_,shadowColor:u,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Yh;var Ip={get paint(){return Yh=Yh||new ia({"color-relief-opacity":new dt(_e["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new yl(_e["paint_color-relief"]["color-relief-color"])})}};class Kh{constructor(t,n,o,u){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(n,u)}update(t,n,o){const{width:u,height:p}=t,_=!(this.size&&this.size[0]===u&&this.size[1]===p||o),{context:v}=this,{gl:b}=v;if(this.useMipmap=!!(n&&n.useMipmap),b.bindTexture(b.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!n||n.premultiply!==!1)),_)this.size=[u,p],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||vr(t)?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,t):b.texImage2D(b.TEXTURE_2D,0,this.format,u,p,0,this.format,b.UNSIGNED_BYTE,t.data);else{const{x:M,y:C}=o||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||vr(t)?b.texSubImage2D(b.TEXTURE_2D,0,M,C,b.RGBA,b.UNSIGNED_BYTE,t):b.texSubImage2D(b.TEXTURE_2D,0,M,C,u,p,b.RGBA,b.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&b.generateMipmap(b.TEXTURE_2D),v.pixelStoreUnpackFlipY.setDefault(),v.pixelStoreUnpack.setDefault(),v.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,n,o){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),o!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=p.LINEAR),t!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,o||t),this.filter=t),n!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class po{constructor(t,n,o,u=1,p=1,_=1,v=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void zi(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const b=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=p,this.blueFactor=_,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let M=0;M<b;M++)this.data[this._idx(-1,M)]=this.data[this._idx(0,M)],this.data[this._idx(b,M)]=this.data[this._idx(b-1,M)],this.data[this._idx(M,-1)]=this.data[this._idx(M,0)],this.data[this._idx(M,b)]=this.data[this._idx(M,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let M=0;M<b;M++)for(let C=0;C<b;C++){const z=this.get(M,C);z>this.max&&(this.max=z),z<this.min&&(this.min=z)}}get(t,n){const o=new Uint8Array(this.data.buffer),u=4*this._idx(t,n);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,o){return t*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}pack(t){return Qh(t,this.getUnpackVector())}getPixels(){return new Ea({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,p=n*this.dim+this.dim,_=o*this.dim,v=o*this.dim+this.dim;switch(n){case-1:u=p-1;break;case 1:p=u+1}switch(o){case-1:_=v-1;break;case 1:v=_+1}const b=-n*this.dim,M=-o*this.dim;for(let C=_;C<v;C++)for(let z=u;z<p;z++)this.data[this._idx(z,C)]=t.data[this._idx(z+b,C+M)]}}function Qh(a,t){const n=t[0],o=t[1],u=t[2],p=t[3],_=Math.min(n,o,u),v=Math.round((a+p)/_);return{r:Math.floor(v*_/n)%256,g:Math.floor(v*_/o)%256,b:Math.floor(v*_/u)%256}}st("DEMData",po);class Kf extends pn{constructor(t,n){super(t,Ip,n)}_createColorRamp(t){const n={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof pl&&o._styleExpression.expression instanceof Jn){this.colorRampExpression=o;const _=o._styleExpression.expression;n.elevationStops=_.labels,n.colorStops=[];for(const v of n.elevationStops)n.colorStops.push(_.evaluate({globals:{elevation:v}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[Ht.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=t)return n;const u={elevationStops:[],colorStops:[]},p=(n.elevationStops.length-1)/(t-1);for(let _=0;_<n.elevationStops.length-.5;_+=p)u.elevationStops.push(n.elevationStops[Math.round(_)]),u.colorStops.push(n.colorStops[Math.round(_)]);return zi(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),u}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,n,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const u=this._createColorRamp(n),p=new Ea({width:u.colorStops.length,height:1}),_=new Ea({width:u.colorStops.length,height:1});for(let v=0;v<u.elevationStops.length;v++){const b=Qh(u.elevationStops[v],o);_.setPixel(0,v,new Ht(b.r/255,b.g/255,b.b/255,1)),p.setPixel(0,v,u.colorStops[v])}return this.colorRampTextures={elevationTexture:new Kh(t,_,t.gl.RGBA),colorTexture:new Kh(t,p,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const Wh=vi([{name:"a_pos",components:2,type:"Int16"}],4),{members:th}=Wh;function Gi(a,t,n){const o=n.patternDependencies;let u=!1;for(const p of t){const _=p.paint.get(`${a}-pattern`);_.isConstant()||(u=!0);const v=_.constantOr(null);v&&(u=!0,o[v.to]=!0,o[v.from]=!0)}return u}function qd(a,t,n,o,u){const{zoom:p}=o,_=u.patternDependencies;for(const v of t){const b=v.paint.get(`${a}-pattern`).value;if(b.kind!=="constant"){let M=b.evaluate({zoom:p-1},n,{},u.availableImages),C=b.evaluate({zoom:p},n,{},u.availableImages),z=b.evaluate({zoom:p+1},n,{},u.availableImages);M=M&&M.name?M.name:M,C=C&&C.name?C.name:C,z=z&&z.name?z.name:z,_[M]=!0,_[C]=!0,_[z]=!0,n.patterns[v.id]={min:M,mid:C,max:z}}}return n}function Qf(a,t,n,o,u){let p;if(u===(function(_,v,b,M){let C=0;for(let z=v,k=b-M;z<b;z+=M)C+=(_[k]-_[z])*(_[z+1]+_[k+1]),k=z;return C})(a,t,n,o)>0)for(let _=t;_<n;_+=o)p=Yd(_/o|0,a[_],a[_+1],p);else for(let _=n-o;_>=t;_-=o)p=Yd(_/o|0,a[_],a[_+1],p);return p&&hn(p,p.next)&&(qi(p),p=p.next),p}function Cl(a,t){if(!a)return a;t||(t=a);let n,o=a;do if(n=!1,o.steiner||!hn(o,o.next)&&Mi(o.prev,o,o.next)!==0)o=o.next;else{if(qi(o),o=t=o.prev,o===o.next)break;n=!0}while(n||o!==t);return t}function Vo(a,t,n,o,u,p,_){if(!a)return;!_&&p&&(function(b,M,C,z){let k=b;do k.z===0&&(k.z=Jh(k.x,k.y,M,C,z)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next;while(k!==b);k.prevZ.nextZ=null,k.prevZ=null,(function(O){let F,V=1;do{let q,W=O;O=null;let ge=null;for(F=0;W;){F++;let ne=W,le=0;for(let Re=0;Re<V&&(le++,ne=ne.nextZ,ne);Re++);let we=V;for(;le>0||we>0&&ne;)le!==0&&(we===0||!ne||W.z<=ne.z)?(q=W,W=W.nextZ,le--):(q=ne,ne=ne.nextZ,we--),ge?ge.nextZ=q:O=q,q.prevZ=ge,ge=q;W=ne}ge.nextZ=null,V*=2}while(F>1)})(k)})(a,o,u,p);let v=a;for(;a.prev!==a.next;){const b=a.prev,M=a.next;if(p?Wf(a,o,u,p):El(a))t.push(b.i,a.i,M.i),qi(a),a=M.next,v=M.next;else if((a=M)===v){_?_===1?Vo(a=Jf(Cl(a),t),t,n,o,u,p,2):_===2&&ih(a,t,n,o,u,p):Vo(Cl(a),t,n,o,u,p,1);break}}}function El(a){const t=a.prev,n=a,o=a.next;if(Mi(t,n,o)>=0)return!1;const u=t.x,p=n.x,_=o.x,v=t.y,b=n.y,M=o.y,C=Math.min(u,p,_),z=Math.min(v,b,M),k=Math.max(u,p,_),O=Math.max(v,b,M);let F=o.next;for(;F!==t;){if(F.x>=C&&F.x<=k&&F.y>=z&&F.y<=O&&Al(u,v,p,b,_,M,F.x,F.y)&&Mi(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function Wf(a,t,n,o){const u=a.prev,p=a,_=a.next;if(Mi(u,p,_)>=0)return!1;const v=u.x,b=p.x,M=_.x,C=u.y,z=p.y,k=_.y,O=Math.min(v,b,M),F=Math.min(C,z,k),V=Math.max(v,b,M),q=Math.max(C,z,k),W=Jh(O,F,t,n,o),ge=Jh(V,q,t,n,o);let ne=a.prevZ,le=a.nextZ;for(;ne&&ne.z>=W&&le&&le.z<=ge;){if(ne.x>=O&&ne.x<=V&&ne.y>=F&&ne.y<=q&&ne!==u&&ne!==_&&Al(v,C,b,z,M,k,ne.x,ne.y)&&Mi(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,le.x>=O&&le.x<=V&&le.y>=F&&le.y<=q&&le!==u&&le!==_&&Al(v,C,b,z,M,k,le.x,le.y)&&Mi(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;ne&&ne.z>=W;){if(ne.x>=O&&ne.x<=V&&ne.y>=F&&ne.y<=q&&ne!==u&&ne!==_&&Al(v,C,b,z,M,k,ne.x,ne.y)&&Mi(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;le&&le.z<=ge;){if(le.x>=O&&le.x<=V&&le.y>=F&&le.y<=q&&le!==u&&le!==_&&Al(v,C,b,z,M,k,le.x,le.y)&&Mi(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function Jf(a,t){let n=a;do{const o=n.prev,u=n.next.next;!hn(o,u)&&td(o,n,n.next,u)&&ah(o,u)&&ah(u,o)&&(t.push(o.i,n.i,u.i),qi(n),qi(n.next),n=a=u),n=n.next}while(n!==a);return Cl(n)}function ih(a,t,n,o,u,p){let _=a;do{let v=_.next.next;for(;v!==_.prev;){if(_.i!==v.i&&tp(_,v)){let b=Xd(_,v);return _=Cl(_,_.next),b=Cl(b,b.next),Vo(_,t,n,o,u,p,0),void Vo(b,t,n,o,u,p,0)}v=v.next}_=_.next}while(_!==a)}function mo(a,t){let n=a.x-t.x;return n===0&&(n=a.y-t.y,n===0)&&(n=(a.next.y-a.y)/(a.next.x-a.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function ep(a,t){const n=(function(u,p){let _=p;const v=u.x,b=u.y;let M,C=-1/0;if(hn(u,_))return _;do{if(hn(u,_.next))return _.next;if(b<=_.y&&b>=_.next.y&&_.next.y!==_.y){const V=_.x+(b-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(V<=v&&V>C&&(C=V,M=_.x<_.next.x?_:_.next,V===v))return M}_=_.next}while(_!==p);if(!M)return null;const z=M,k=M.x,O=M.y;let F=1/0;_=M;do{if(v>=_.x&&_.x>=k&&v!==_.x&&ed(b<O?v:C,b,k,O,b<O?C:v,b,_.x,_.y)){const V=Math.abs(b-_.y)/(v-_.x);ah(_,u)&&(V<F||V===F&&(_.x>M.x||_.x===M.x&&Hd(M,_)))&&(M=_,F=V)}_=_.next}while(_!==z);return M})(a,t);if(!n)return t;const o=Xd(n,a);return Cl(o,o.next),Cl(n,n.next)}function Hd(a,t){return Mi(a.prev,a,t.prev)<0&&Mi(t.next,a,a.next)<0}function Jh(a,t,n,o,u){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-n)*u|0)|a<<8))|a<<4))|a<<2))|a<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function $d(a){let t=a,n=a;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==a);return n}function ed(a,t,n,o,u,p,_,v){return(u-_)*(t-v)>=(a-_)*(p-v)&&(a-_)*(o-v)>=(n-_)*(t-v)&&(n-_)*(p-v)>=(u-_)*(o-v)}function Al(a,t,n,o,u,p,_,v){return!(a===_&&t===v)&&ed(a,t,n,o,u,p,_,v)}function tp(a,t){return a.next.i!==t.i&&a.prev.i!==t.i&&!(function(n,o){let u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==o.i&&u.next.i!==o.i&&td(u,u.next,n,o))return!0;u=u.next}while(u!==n);return!1})(a,t)&&(ah(a,t)&&ah(t,a)&&(function(n,o){let u=n,p=!1;const _=(n.x+o.x)/2,v=(n.y+o.y)/2;do u.y>v!=u.next.y>v&&u.next.y!==u.y&&_<(u.next.x-u.x)*(v-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next;while(u!==n);return p})(a,t)&&(Mi(a.prev,a,t.prev)||Mi(a,t.prev,t))||hn(a,t)&&Mi(a.prev,a,a.next)>0&&Mi(t.prev,t,t.next)>0)}function Mi(a,t,n){return(t.y-a.y)*(n.x-t.x)-(t.x-a.x)*(n.y-t.y)}function hn(a,t){return a.x===t.x&&a.y===t.y}function td(a,t,n,o){const u=Hn(Mi(a,t,n)),p=Hn(Mi(a,t,o)),_=Hn(Mi(n,o,a)),v=Hn(Mi(n,o,t));return u!==p&&_!==v||!(u!==0||!nh(a,n,t))||!(p!==0||!nh(a,o,t))||!(_!==0||!nh(n,a,o))||!(v!==0||!nh(n,t,o))}function nh(a,t,n){return t.x<=Math.max(a.x,n.x)&&t.x>=Math.min(a.x,n.x)&&t.y<=Math.max(a.y,n.y)&&t.y>=Math.min(a.y,n.y)}function Hn(a){return a>0?1:a<0?-1:0}function ah(a,t){return Mi(a.prev,a,a.next)<0?Mi(a,t,a.next)>=0&&Mi(a,a.prev,t)>=0:Mi(a,t,a.prev)<0||Mi(a,a.next,t)<0}function Xd(a,t){const n=qa(a.i,a.x,a.y),o=qa(t.i,t.x,t.y),u=a.next,p=t.prev;return a.next=t,t.prev=a,n.next=u,u.prev=n,o.next=n,n.prev=o,p.next=o,o.prev=p,o}function Yd(a,t,n,o){const u=qa(a,t,n);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function qi(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function qa(a,t,n){return{i:a,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class ur{constructor(t,n){if(n>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=n}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class rh{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}rh.noSubdivision=new rh({fill:new ur(0,0),line:new ur(0,0),tile:new ur(0,0),stencil:new ur(0,0),circle:1}),st("SubdivisionGranularityExpression",ur),st("SubdivisionGranularitySetting",rh);const vc=-32768,iu=32767;class Rp{constructor(t,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=_t/t,this._canonical=n}_getKey(t,n){return(t+=32768)<<16|n+32768}_vertexToIndex(t,n){if(t<-32768||n<-32768||t>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(t),u=0|Math.round(n),p=this._getKey(o,u);if(this._vertexDictionary.has(p))return this._vertexDictionary.get(p);const _=this._vertexBuffer.length/2;return this._vertexDictionary.set(p,_),this._vertexBuffer.push(o,u),_}_subdivideTrianglesScanline(t){if(this._granularity<2)return(function(u,p){const _=[];for(let v=0;v<p.length;v+=3){const b=p[v],M=p[v+1],C=p[v+2],z=u[2*b],k=u[2*b+1];(u[2*M]-z)*(u[2*C+1]-k)-(u[2*M+1]-k)*(u[2*C]-z)>0?(_.push(b),_.push(C),_.push(M)):(_.push(b),_.push(M),_.push(C))}return _})(this._vertexBuffer,t);const n=[],o=t.length;for(let u=0;u<o;u+=3){const p=[t[u+0],t[u+1],t[u+2]],_=[this._vertexBuffer[2*t[u+0]+0],this._vertexBuffer[2*t[u+0]+1],this._vertexBuffer[2*t[u+1]+0],this._vertexBuffer[2*t[u+1]+1],this._vertexBuffer[2*t[u+2]+0],this._vertexBuffer[2*t[u+2]+1]];let v=1/0,b=1/0,M=-1/0,C=-1/0;for(let V=0;V<3;V++){const q=_[2*V],W=_[2*V+1];v=Math.min(v,q),M=Math.max(M,q),b=Math.min(b,W),C=Math.max(C,W)}if(v===M||b===C)continue;const z=Math.floor(v/this._granularityCellSize),k=Math.ceil(M/this._granularityCellSize),O=Math.floor(b/this._granularityCellSize),F=Math.ceil(C/this._granularityCellSize);if(z!==k||O!==F)for(let V=O;V<F;V++){const q=this._scanlineGenerateVertexRingForCellRow(V,_,p);Ps(this._vertexBuffer,q,n)}else n.push(...p)}return n}_scanlineGenerateVertexRingForCellRow(t,n,o){const u=t*this._granularityCellSize,p=u+this._granularityCellSize,_=[];for(let v=0;v<3;v++){const b=n[2*v],M=n[2*v+1],C=n[2*(v+1)%6],z=n[(2*(v+1)+1)%6],k=n[2*(v+2)%6],O=n[(2*(v+2)+1)%6],F=C-b,V=z-M,q=F===0,W=V===0,ge=(u-M)/V,ne=(p-M)/V,le=Math.min(ge,ne),we=Math.max(ge,ne);if(!W&&(le>=1||we<=0)||W&&(M<u||M>p)){z>=u&&z<=p&&_.push(o[(v+1)%3]);continue}!W&&le>0&&_.push(this._vertexToIndex(b+F*le,M+V*le));const Re=b+F*Math.max(le,0),Ze=b+F*Math.min(we,1);q||this._generateIntraEdgeVertices(_,b,M,C,z,Re,Ze),!W&&we<1&&_.push(this._vertexToIndex(b+F*we,M+V*we)),(W||z>=u&&z<=p)&&_.push(o[(v+1)%3]),!W&&(z<=u||z>=p)&&this._generateInterEdgeVertices(_,b,M,C,z,k,O,Ze,u,p)}return _}_generateIntraEdgeVertices(t,n,o,u,p,_,v){const b=u-n,M=p-o,C=M===0,z=C?Math.min(n,u):Math.min(_,v),k=C?Math.max(n,u):Math.max(_,v),O=Math.floor(z/this._granularityCellSize)+1,F=Math.ceil(k/this._granularityCellSize)-1;if(C?n<u:_<v)for(let V=O;V<=F;V++){const q=V*this._granularityCellSize;t.push(this._vertexToIndex(q,o+M*(q-n)/b))}else for(let V=F;V>=O;V--){const q=V*this._granularityCellSize;t.push(this._vertexToIndex(q,o+M*(q-n)/b))}}_generateInterEdgeVertices(t,n,o,u,p,_,v,b,M,C){const z=p-o,k=_-u,O=v-p,F=(M-p)/O,V=(C-p)/O,q=Math.min(F,V),W=Math.max(F,V),ge=u+k*q;let ne=Math.floor(Math.min(ge,b)/this._granularityCellSize)+1,le=Math.ceil(Math.max(ge,b)/this._granularityCellSize)-1,we=b<ge;const Re=O===0;if(Re&&(v===M||v===C))return;if(Re||q>=1||W<=0){const nt=o-v,Je=_+(n-_)*Math.min((M-v)/nt,(C-v)/nt);ne=Math.floor(Math.min(Je,b)/this._granularityCellSize)+1,le=Math.ceil(Math.max(Je,b)/this._granularityCellSize)-1,we=b<Je}const Ze=z>0?C:M;if(we)for(let nt=ne;nt<=le;nt++)t.push(this._vertexToIndex(nt*this._granularityCellSize,Ze));else for(let nt=le;nt>=ne;nt--)t.push(this._vertexToIndex(nt*this._granularityCellSize,Ze))}_generateOutline(t){const n=[];for(const o of t){const u=aa(o,this._granularity,!0),p=this._pointArrayToIndices(u),_=[];for(let v=1;v<p.length;v++)_.push(p[v-1]),_.push(p[v]);n.push(_)}return n}_handlePoles(t){let n=!1,o=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(n||o)&&this._fillPoles(t,n,o)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let n=0;n<t.length;n+=2){const o=t[n+1];o===vc&&(t[n+1]=-32767),o===iu&&(t[n+1]=32766)}}_generatePoleQuad(t,n,o,u,p,_){u>p!=(_===vc)?(t.push(n),t.push(o),t.push(this._vertexToIndex(u,_)),t.push(o),t.push(this._vertexToIndex(p,_)),t.push(this._vertexToIndex(u,_))):(t.push(o),t.push(n),t.push(this._vertexToIndex(u,_)),t.push(this._vertexToIndex(p,_)),t.push(o),t.push(this._vertexToIndex(u,_)))}_fillPoles(t,n,o){const u=this._vertexBuffer,p=_t,_=t.length;for(let v=2;v<_;v+=3){const b=t[v-2],M=t[v-1],C=t[v],z=u[2*b],k=u[2*b+1],O=u[2*M],F=u[2*M+1],V=u[2*C],q=u[2*C+1];n&&(k===0&&F===0&&this._generatePoleQuad(t,b,M,z,O,vc),F===0&&q===0&&this._generatePoleQuad(t,M,C,O,V,vc),q===0&&k===0&&this._generatePoleQuad(t,C,b,V,z,vc)),o&&(k===p&&F===p&&this._generatePoleQuad(t,b,M,z,O,iu),F===p&&q===p&&this._generatePoleQuad(t,M,C,O,V,iu),q===p&&k===p&&this._generatePoleQuad(t,C,b,V,z,iu))}}_initializeVertices(t){for(let n=0;n<t.length;n+=2)this._vertexToIndex(t[n],t[n+1])}subdividePolygonInternal(t,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:u}=(function(v){const b=[],M=[];for(const C of v)if(C.length!==0){C!==v[0]&&b.push(M.length/2);for(let z=0;z<C.length;z++)M.push(C[z].x),M.push(C[z].y)}return{flattened:M,holeIndices:b}})(t);let p;this._initializeVertices(o);try{const v=(function(M,C,z=2){const k=C&&C.length,O=k?C[0]*z:M.length;let F=Qf(M,0,O,z,!0);const V=[];if(!F||F.next===F.prev)return V;let q,W,ge;if(k&&(F=(function(ne,le,we,Re){const Ze=[];for(let nt=0,Je=le.length;nt<Je;nt++){const it=Qf(ne,le[nt]*Re,nt<Je-1?le[nt+1]*Re:ne.length,Re,!1);it===it.next&&(it.steiner=!0),Ze.push($d(it))}Ze.sort(mo);for(let nt=0;nt<Ze.length;nt++)we=ep(Ze[nt],we);return we})(M,C,F,z)),M.length>80*z){q=M[0],W=M[1];let ne=q,le=W;for(let we=z;we<O;we+=z){const Re=M[we],Ze=M[we+1];Re<q&&(q=Re),Ze<W&&(W=Ze),Re>ne&&(ne=Re),Ze>le&&(le=Ze)}ge=Math.max(ne-q,le-W),ge=ge!==0?32767/ge:0}return Vo(F,V,z,q,W,ge,0),V})(o,u),b=this._convertIndices(o,v);p=this._subdivideTrianglesScanline(b)}catch(v){console.error(v)}let _=[];return n&&(_=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(p),{verticesFlattened:this._vertexBuffer,indicesTriangles:p,indicesLineList:_}}_convertIndices(t,n){const o=[];for(let u=0;u<n.length;u++)o.push(this._vertexToIndex(t[2*n[u]],t[2*n[u]+1]));return o}_pointArrayToIndices(t){const n=[];for(let o=0;o<t.length;o++){const u=t[o];n.push(this._vertexToIndex(u.x,u.y))}return n}}function sh(a,t,n,o=!0){return new Rp(n,t).subdividePolygonInternal(a,o)}function aa(a,t,n=!1){if(!a||a.length<1)return[];if(a.length<2)return[];const o=a[0],u=a[a.length-1],p=n&&(o.x!==u.x||o.y!==u.y);if(t<2)return p?[...a,a[0]]:[...a];const _=Math.floor(_t/t),v=[];v.push(new ze(a[0].x,a[0].y));const b=a.length,M=p?b:b-1;for(let C=0;C<M;C++){const z=a[C],k=C<b-1?a[C+1]:a[0],O=z.x,F=z.y,V=k.x,q=k.y,W=O!==V,ge=F!==q;if(!W&&!ge)continue;const ne=V-O,le=q-F,we=Math.abs(ne),Re=Math.abs(le);let Ze=O,nt=F;for(;;){const it=ne>0?(Math.floor(Ze/_)+1)*_:(Math.ceil(Ze/_)-1)*_,gt=le>0?(Math.floor(nt/_)+1)*_:(Math.ceil(nt/_)-1)*_,et=Math.abs(Ze-it),tt=Math.abs(nt-gt),Fe=Math.abs(Ze-V),Tt=Math.abs(nt-q),Et=W?et/we:Number.POSITIVE_INFINITY,vt=ge?tt/Re:Number.POSITIVE_INFINITY;if((Fe<=et||!W)&&(Tt<=tt||!ge))break;if(Et<vt&&W||!ge){Ze=it,nt+=le*Et;const ft=new ze(Ze,Math.round(nt));v[v.length-1].x===ft.x&&v[v.length-1].y===ft.y||v.push(ft)}else{Ze+=ne*vt,nt=gt;const ft=new ze(Math.round(Ze),nt);v[v.length-1].x===ft.x&&v[v.length-1].y===ft.y||v.push(ft)}}const Je=new ze(V,q);v[v.length-1].x===Je.x&&v[v.length-1].y===Je.y||v.push(Je)}return v}function Ps(a,t,n){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,u=a[2*t[0]];for(let b=1;b<t.length;b++){const M=a[2*t[b]];M<u&&(u=M,o=b)}const p=t.length;let _=o,v=(_+1)%p;for(;;){const b=_-1>=0?_-1:p-1,M=(v+1)%p,C=a[2*t[b]],z=a[2*t[M]],k=a[2*t[_]],O=a[2*t[_]+1],F=a[2*t[v]+1];let V=!1;if(C<z)V=!0;else if(C>z)V=!1;else{const q=F-O,W=-(a[2*t[v]]-k),ge=O<F?1:-1;((C-k)*q+(a[2*t[b]+1]-O)*W)*ge>((z-k)*q+(a[2*t[M]+1]-O)*W)*ge&&(V=!0)}if(V){const q=t[b],W=t[_],ge=t[v];q!==W&&q!==ge&&W!==ge&&n.push(ge,W,q),_--,_<0&&(_=p-1)}else{const q=t[M],W=t[_],ge=t[v];q!==W&&q!==ge&&W!==ge&&n.push(ge,W,q),v++,v>=p&&(v=0)}if(b===M)break}}function Kd(a,t,n,o,u,p,_,v,b){const M=u.length/2,C=_&&v&&b;if(M<Gt.MAX_VERTEX_ARRAY_LENGTH){const z=t.prepareSegment(M,n,o),k=z.vertexLength;for(let V=0;V<p.length;V+=3)o.emplaceBack(k+p[V],k+p[V+1],k+p[V+2]);let O,F;z.vertexLength+=M,z.primitiveLength+=p.length/3,C&&(F=_.prepareSegment(M,n,v),O=F.vertexLength,F.vertexLength+=M);for(let V=0;V<u.length;V+=2)a(u[V],u[V+1]);if(C)for(let V=0;V<b.length;V++){const q=b[V];for(let W=1;W<q.length;W+=2)v.emplaceBack(O+q[W-1],O+q[W]);F.primitiveLength+=q.length/2}}else(function(z,k,O,F,V,q){const W=[];for(let Re=0;Re<F.length/2;Re++)W.push(-1);const ge={count:0};let ne=0,le=z.getOrCreateLatestSegment(k,O),we=le.vertexLength;for(let Re=2;Re<V.length;Re+=3){const Ze=V[Re-2],nt=V[Re-1],Je=V[Re];let it=W[Ze]<ne,gt=W[nt]<ne,et=W[Je]<ne;le.vertexLength+((it?1:0)+(gt?1:0)+(et?1:0))>Gt.MAX_VERTEX_ARRAY_LENGTH&&(le=z.createNewSegment(k,O),ne=ge.count,it=!0,gt=!0,et=!0,we=0);const tt=xa(W,F,q,ge,Ze,it,le),Fe=xa(W,F,q,ge,nt,gt,le),Tt=xa(W,F,q,ge,Je,et,le);O.emplaceBack(we+tt-ne,we+Fe-ne,we+Tt-ne),le.primitiveLength++}})(t,n,o,u,p,a),C&&(function(z,k,O,F,V,q){const W=[];for(let Re=0;Re<F.length/2;Re++)W.push(-1);const ge={count:0};let ne=0,le=z.getOrCreateLatestSegment(k,O),we=le.vertexLength;for(let Re=0;Re<V.length;Re++){const Ze=V[Re];for(let nt=1;nt<V[Re].length;nt+=2){const Je=Ze[nt-1],it=Ze[nt];let gt=W[Je]<ne,et=W[it]<ne;le.vertexLength+((gt?1:0)+(et?1:0))>Gt.MAX_VERTEX_ARRAY_LENGTH&&(le=z.createNewSegment(k,O),ne=ge.count,gt=!0,et=!0,we=0);const tt=xa(W,F,q,ge,Je,gt,le),Fe=xa(W,F,q,ge,it,et,le);O.emplaceBack(we+tt-ne,we+Fe-ne),le.primitiveLength++}}})(_,n,v,u,b,a),t.forceNewSegmentOnNextPrepare(),_?.forceNewSegmentOnNextPrepare()}function xa(a,t,n,o,u,p,_){if(p){const v=o.count;return n(t[2*u],t[2*u+1]),a[u]=o.count,o.count++,_.vertexLength++,v}return a[u]}class id{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new Ee,this.indexArray=new Bn,this.indexArray2=new Zi,this.programConfigurations=new Tl(t.layers,t.zoom),this.segments=new Gt,this.segments2=new Gt,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,o){this.hasDependencies=Gi("fill",this.layers,n);const u=this.layers[0].layout.get("fill-sort-key"),p=!u.isConstant(),_=[];for(const{feature:v,id:b,index:M,sourceLayerIndex:C}of t){const z=this.layers[0]._featureFilter.needGeometry,k=jo(v,z);if(!this.layers[0]._featureFilter.filter(new ui(this.zoom),k,o))continue;const O=p?u.evaluate(k,{},o,n.availableImages):void 0,F={id:b,properties:v.properties,type:v.type,sourceLayerIndex:C,index:M,geometry:z?k.geometry:Sl(v),patterns:{},sortKey:O};_.push(F)}p&&_.sort(((v,b)=>v.sortKey-b.sortKey));for(const v of _){const{geometry:b,index:M,sourceLayerIndex:C}=v;if(this.hasDependencies){const z=qd("fill",this.layers,v,{zoom:this.zoom},n);this.patternFeatures.push(z)}else this.addFeature(v,b,M,o,{},n.subdivisionGranularity);n.featureIndex.insert(t[M].feature,b,M,C,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:o})}addFeatures(t,n,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,n,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,th),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,o,u,p,_){for(const v of ul(n,500)){const b=sh(v,u,_.fill.getGranularityForZoomLevel(u.z)),M=this.layoutVertexArray;Kd(((C,z)=>{M.emplaceBack(C,z)}),this.segments,this.layoutVertexArray,this.indexArray,b.verticesFlattened,b.indicesTriangles,this.segments2,this.indexArray2,b.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:p,canonical:u})}}let go,zl;st("FillBucket",id,{omit:["layers","patternFeatures"]});var Zo={get paint(){return zl=zl||new ia({"fill-antialias":new dt(_e.paint_fill["fill-antialias"]),"fill-opacity":new mt(_e.paint_fill["fill-opacity"]),"fill-color":new mt(_e.paint_fill["fill-color"]),"fill-outline-color":new mt(_e.paint_fill["fill-outline-color"]),"fill-translate":new dt(_e.paint_fill["fill-translate"]),"fill-translate-anchor":new dt(_e.paint_fill["fill-translate-anchor"]),"fill-pattern":new oo(_e.paint_fill["fill-pattern"])})},get layout(){return go=go||new ia({"fill-sort-key":new mt(_e.layout_fill["fill-sort-key"])})}};class Qd extends pn{constructor(t,n){super(t,Zo,n)}recalculate(t,n){super.recalculate(t,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new id(t)}queryRadius(){return na(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:n,transform:o,pixelsToTileUnits:u}){return Bd(Yu(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,u),n)}isTileClipped(){return!0}}const Wd=vi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ds=vi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:ip}=Wd;class Is{constructor(t,n,o,u,p){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=u,this._values=p,t.readFields(oh,this,n)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const n=t.readVarint()+t.pos,o=[];let u,p=1,_=0,v=0,b=0;for(;t.pos<n;){if(_<=0){const M=t.readVarint();p=7&M,_=M>>3}if(_--,p===1||p===2)v+=t.readSVarint(),b+=t.readSVarint(),p===1&&(u&&o.push(u),u=[]),u&&u.push(new ze(v,b));else{if(p!==7)throw new Error(`unknown command ${p}`);u&&u.push(u[0].clone())}}return u&&o.push(u),o}bbox(){const t=this._pbf;t.pos=this._geometry;const n=t.readVarint()+t.pos;let o=1,u=0,p=0,_=0,v=1/0,b=-1/0,M=1/0,C=-1/0;for(;t.pos<n;){if(u<=0){const z=t.readVarint();o=7&z,u=z>>3}if(u--,o===1||o===2)p+=t.readSVarint(),_+=t.readSVarint(),p<v&&(v=p),p>b&&(b=p),_<M&&(M=_),_>C&&(C=_);else if(o!==7)throw new Error(`unknown command ${o}`)}return[v,M,b,C]}toGeoJSON(t,n,o){const u=this.extent*Math.pow(2,o),p=this.extent*t,_=this.extent*n,v=this.loadGeometry();function b(k){return[360*(k.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(k.y+_)/u)*Math.PI))-90]}function M(k){return k.map(b)}let C;if(this.type===1){const k=[];for(const F of v)k.push(F[0]);const O=M(k);C=k.length===1?{type:"Point",coordinates:O[0]}:{type:"MultiPoint",coordinates:O}}else if(this.type===2){const k=v.map(M);C=k.length===1?{type:"LineString",coordinates:k[0]}:{type:"MultiLineString",coordinates:k}}else{if(this.type!==3)throw new Error("unknown feature type");{const k=(function(F){const V=F.length;if(V<=1)return[F];const q=[];let W,ge;for(let ne=0;ne<V;ne++){const le=lh(F[ne]);le!==0&&(ge===void 0&&(ge=le<0),ge===le<0?(W&&q.push(W),W=[F[ne]]):W&&W.push(F[ne]))}return W&&q.push(W),q})(v),O=[];for(const F of k)O.push(F.map(M));C=O.length===1?{type:"Polygon",coordinates:O[0]}:{type:"MultiPolygon",coordinates:O}}}const z={type:"Feature",geometry:C,properties:this.properties};return this.id!=null&&(z.id=this.id),z}}function oh(a,t,n){a===1?t.id=n.readVarint():a===2?(function(o,u){const p=o.readVarint()+o.pos;for(;o.pos<p;){const _=u._keys[o.readVarint()],v=u._values[o.readVarint()];u.properties[_]=v}})(n,t):a===3?t.type=n.readVarint():a===4&&(t._geometry=n.pos)}function lh(a){let t=0;for(let n,o,u=0,p=a.length,_=p-1;u<p;_=u++)n=a[u],o=a[_],t+=(o.x-n.x)*(n.y+o.y);return t}Is.types=["Unknown","Point","LineString","Polygon"];class xc{constructor(t,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(np,this,n),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const n=this._pbf.readVarint()+this._pbf.pos;return new Is(this._pbf,n,this.extent,this._keys,this._values)}}function np(a,t,n){a===15?t.version=n.readVarint():a===1?t.name=n.readString():a===5?t.extent=n.readVarint():a===2?t._features.push(n.pos):a===3?t._keys.push(n.readString()):a===4&&t._values.push((function(o){let u=null;const p=o.readVarint()+o.pos;for(;o.pos<p;){const _=o.readVarint()>>3;u=_===1?o.readString():_===2?o.readFloat():_===3?o.readDouble():_===4?o.readVarint64():_===5?o.readVarint():_===6?o.readSVarint():_===7?o.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u})(n))}class Jd{constructor(t,n){this.layers=t.readFields(ch,{},n)}}function ch(a,t,n){if(a===3){const o=new xc(n,n.readVarint()+n.pos);o.length&&(t[o.name]=o)}}const nd=Math.pow(2,13);function Pl(a,t,n,o,u,p,_,v){a.emplaceBack(t,n,2*Math.floor(o*nd)+_,u*nd*2,p*nd*2,Math.round(v))}class ad{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new We,this.centroidVertexArray=new Te,this.indexArray=new Bn,this.programConfigurations=new Tl(t.layers,t.zoom),this.segments=new Gt,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,o){this.features=[],this.hasDependencies=Gi("fill-extrusion",this.layers,n);for(const{feature:u,id:p,index:_,sourceLayerIndex:v}of t){const b=this.layers[0]._featureFilter.needGeometry,M=jo(u,b);if(!this.layers[0]._featureFilter.filter(new ui(this.zoom),M,o))continue;const C={id:p,sourceLayerIndex:v,index:_,geometry:b?M.geometry:Sl(u),properties:u.properties,type:u.type,patterns:{}};this.hasDependencies?this.features.push(qd("fill-extrusion",this.layers,C,{zoom:this.zoom},n)):this.addFeature(C,C.geometry,_,o,{},n.subdivisionGranularity),n.featureIndex.insert(u,C.geometry,_,v,this.index,!0)}}addFeatures(t,n,o){for(const u of this.features){const{geometry:p}=u;this.addFeature(u,p,u.index,n,o,t.subdivisionGranularity)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ip),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Ds.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,o,u,p,_){for(const v of ul(n,500)){const b={x:0,y:0,sampleCount:0},M=this.layoutVertexArray.length;this.processPolygon(b,u,t,v,_);const C=this.layoutVertexArray.length-M,z=Math.floor(b.x/b.sampleCount),k=Math.floor(b.y/b.sampleCount);for(let O=0;O<C;O++)this.centroidVertexArray.emplaceBack(z,k)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:p,canonical:u})}processPolygon(t,n,o,u,p){if(u.length<1||bi(u[0]))return;for(const z of u)z.length!==0&&Lp(t,z);const _={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},v=p.fill.getGranularityForZoomLevel(n.z),b=Is.types[o.type]==="Polygon";for(const z of u){if(z.length===0||bi(z))continue;const k=aa(z,v,b);this._generateSideFaces(k,_)}if(!b)return;const M=sh(u,n,v,!1),C=this.layoutVertexArray;Kd(((z,k)=>{Pl(C,z,k,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,M.verticesFlattened,M.indicesTriangles)}_generateSideFaces(t,n){let o=0;for(let u=1;u<t.length;u++){const p=t[u],_=t[u-1];if(kp(p,_))continue;n.segment.vertexLength+4>Gt.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const v=p.sub(_)._perp()._unit(),b=_.dist(p);o+b>32768&&(o=0),Pl(this.layoutVertexArray,p.x,p.y,v.x,v.y,0,0,o),Pl(this.layoutVertexArray,p.x,p.y,v.x,v.y,0,1,o),o+=b,Pl(this.layoutVertexArray,_.x,_.y,v.x,v.y,0,0,o),Pl(this.layoutVertexArray,_.x,_.y,v.x,v.y,0,1,o);const M=n.segment.vertexLength;this.indexArray.emplaceBack(M,M+2,M+1),this.indexArray.emplaceBack(M+1,M+2,M+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function Lp(a,t){for(let n=0;n<t.length;n++){const o=t[n];n===t.length-1&&t[0].x===o.x&&t[0].y===o.y||(a.x+=o.x,a.y+=o.y,a.sampleCount++)}}function kp(a,t){return a.x===t.x&&(a.x<0||a.x>_t)||a.y===t.y&&(a.y<0||a.y>_t)}function bi(a){return a.every((t=>t.x<0))||a.every((t=>t.x>_t))||a.every((t=>t.y<0))||a.every((t=>t.y>_t))}let Hi;st("FillExtrusionBucket",ad,{omit:["layers","features"]});var ri={get paint(){return Hi=Hi||new ia({"fill-extrusion-opacity":new dt(_e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new mt(_e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new dt(_e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new dt(_e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new oo(_e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new mt(_e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new mt(_e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new dt(_e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class oi extends pn{constructor(t,n){super(t,ri,n)}createBucket(t){return new ad(t)}queryRadius(){return na(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:_,pixelPosMatrix:v}){const b=Yu(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-p.bearingInRadians,_),M=this.paint.get("fill-extrusion-height").evaluate(n,o),C=this.paint.get("fill-extrusion-base").evaluate(n,o),z=(function(O,F){const V=[];for(const q of O){const W=[q.x,q.y,0,1];ba(W,W,F),V.push(new ze(W[0]/W[3],W[1]/W[3]))}return V})(b,v),k=(function(O,F,V,q){const W=[],ge=[],ne=q[8]*F,le=q[9]*F,we=q[10]*F,Re=q[11]*F,Ze=q[8]*V,nt=q[9]*V,Je=q[10]*V,it=q[11]*V;for(const gt of O){const et=[],tt=[];for(const Fe of gt){const Tt=Fe.x,Et=Fe.y,vt=q[0]*Tt+q[4]*Et+q[12],ft=q[1]*Tt+q[5]*Et+q[13],Xt=q[2]*Tt+q[6]*Et+q[14],Ki=q[3]*Tt+q[7]*Et+q[15],gn=Xt+we,sa=Ki+Re,gr=vt+Ze,za=ft+nt,Ji=Xt+Je,mi=Ki+it,Qi=new ze((vt+ne)/sa,(ft+le)/sa);Qi.z=gn/sa,et.push(Qi);const wn=new ze(gr/mi,za/mi);wn.z=Ji/mi,tt.push(wn)}W.push(et),ge.push(tt)}return[W,ge]})(u,C,M,v);return(function(O,F,V){let q=1/0;Bd(V,F)&&(q=hr(V,F[0]));for(let W=0;W<F.length;W++){const ge=F[W],ne=O[W];for(let le=0;le<ge.length-1;le++){const we=ge[le],Re=[we,ge[le+1],ne[le+1],ne[le],we];Ml(V,Re)&&(q=Math.min(q,hr(V,Re)))}}return q!==1/0&&q})(k[0],k[1],z)}}function fi(a,t){return a.x*t.x+a.y*t.y}function hr(a,t){if(a.length===1){let n=0;const o=t[n++];let u;for(;!u||o.equals(u);)if(u=t[n++],!u)return 1/0;for(;n<t.length;n++){const p=t[n],_=a[0],v=u.sub(o),b=p.sub(o),M=_.sub(o),C=fi(v,v),z=fi(v,b),k=fi(b,b),O=fi(M,v),F=fi(M,b),V=C*k-z*z,q=(k*O-z*F)/V,W=(C*F-z*O)/V,ge=o.z*(1-q-W)+u.z*q+p.z*W;if(isFinite(ge))return ge}return 1/0}{let n=1/0;for(const o of t)n=Math.min(n,o.z);return n}}const Dl=vi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:nu}=Dl,ef=vi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Go}=ef,Fn=Math.cos(Math.PI/180*37.5),qo=Math.pow(2,14)/.5;class Ho{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new Qe,this.layoutVertexArray2=new Ve,this.indexArray=new Bn,this.programConfigurations=new Tl(t.layers,t.zoom),this.segments=new Gt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,o){this.hasDependencies=Gi("line",this.layers,n)||this.hasLineDasharray(this.layers);const u=this.layers[0].layout.get("line-sort-key"),p=!u.isConstant(),_=[];for(const{feature:v,id:b,index:M,sourceLayerIndex:C}of t){const z=this.layers[0]._featureFilter.needGeometry,k=jo(v,z);if(!this.layers[0]._featureFilter.filter(new ui(this.zoom),k,o))continue;const O=p?u.evaluate(k,{},o):void 0,F={id:b,properties:v.properties,type:v.type,sourceLayerIndex:C,index:M,geometry:z?k.geometry:Sl(v),patterns:{},dashes:{},sortKey:O};_.push(F)}p&&_.sort(((v,b)=>v.sortKey-b.sortKey));for(const v of _){const{geometry:b,index:M,sourceLayerIndex:C}=v;this.hasDependencies?(Gi("line",this.layers,n)?qd("line",this.layers,v,{zoom:this.zoom},n):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,v,this.zoom,n),this.patternFeatures.push(v)):this.addFeature(v,b,M,o,{},{},n.subdivisionGranularity),n.featureIndex.insert(t[M].feature,b,M,C,this.index)}}update(t,n,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:o,dashPositions:u})}addFeatures(t,n,o,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,n,o,u,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Go)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,nu),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,o,u,p,_,v){const b=this.layers[0].layout,M=b.get("line-join").evaluate(t,{}),C=b.get("line-cap"),z=b.get("line-miter-limit"),k=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const O of n)this.addLine(O,t,M,C,z,k,u,v);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:p,dashPositions:_,canonical:u})}addLine(t,n,o,u,p,_,v,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=aa(t,v?b.line.getGranularityForZoomLevel(v.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ne=0;ne<t.length-1;ne++)this.totalDistance+=t[ne].dist(t[ne+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=Is.types[n.type]==="Polygon";let C=t.length;for(;C>=2&&t[C-1].equals(t[C-2]);)C--;let z=0;for(;z<C-1&&t[z].equals(t[z+1]);)z++;if(C<(M?3:2))return;o==="bevel"&&(p=1.05);const k=this.overscaling<=16?122880/(512*this.overscaling):0,O=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let F,V,q,W,ge;this.e1=this.e2=-1,M&&(F=t[C-2],ge=t[z].sub(F)._unit()._perp());for(let ne=z;ne<C;ne++){if(q=ne===C-1?M?t[z+1]:void 0:t[ne+1],q&&t[ne].equals(q))continue;ge&&(W=ge),F&&(V=F),F=t[ne],ge=q?q.sub(F)._unit()._perp():W,W=W||ge;let le=W.add(ge);le.x===0&&le.y===0||le._unit();const we=W.x*ge.x+W.y*ge.y,Re=le.x*ge.x+le.y*ge.y,Ze=Re!==0?1/Re:1/0,nt=2*Math.sqrt(2-2*Re),Je=Re<Fn&&V&&q,it=W.x*ge.y-W.y*ge.x>0;if(Je&&ne>z){const tt=F.dist(V);if(tt>2*k){const Fe=F.sub(F.sub(V)._mult(k/tt)._round());this.updateDistance(V,Fe),this.addCurrentVertex(Fe,W,0,0,O),V=Fe}}const gt=V&&q;let et=gt?o:M?"butt":u;if(gt&&et==="round"&&(Ze<_?et="miter":Ze<=2&&(et="fakeround")),et==="miter"&&Ze>p&&(et="bevel"),et==="bevel"&&(Ze>2&&(et="flipbevel"),Ze<p&&(et="miter")),V&&this.updateDistance(V,F),et==="miter")le._mult(Ze),this.addCurrentVertex(F,le,0,0,O);else if(et==="flipbevel"){if(Ze>100)le=ge.mult(-1);else{const tt=Ze*W.add(ge).mag()/W.sub(ge).mag();le._perp()._mult(tt*(it?-1:1))}this.addCurrentVertex(F,le,0,0,O),this.addCurrentVertex(F,le.mult(-1),0,0,O)}else if(et==="bevel"||et==="fakeround"){const tt=-Math.sqrt(Ze*Ze-1),Fe=it?tt:0,Tt=it?0:tt;if(V&&this.addCurrentVertex(F,W,Fe,Tt,O),et==="fakeround"){const Et=Math.round(180*nt/Math.PI/20);for(let vt=1;vt<Et;vt++){let ft=vt/Et;if(ft!==.5){const Ki=ft-.5;ft+=ft*Ki*(ft-1)*((1.0904+we*(we*(3.55645-1.43519*we)-3.2452))*Ki*Ki+(.848013+we*(.215638*we-1.06021)))}const Xt=ge.sub(W)._mult(ft)._add(W)._unit()._mult(it?-1:1);this.addHalfVertex(F,Xt.x,Xt.y,!1,it,0,O)}}q&&this.addCurrentVertex(F,ge,-Fe,-Tt,O)}else if(et==="butt")this.addCurrentVertex(F,le,0,0,O);else if(et==="square"){const tt=V?1:-1;this.addCurrentVertex(F,le,tt,tt,O)}else et==="round"&&(V&&(this.addCurrentVertex(F,W,0,0,O),this.addCurrentVertex(F,W,1,1,O,!0)),q&&(this.addCurrentVertex(F,ge,-1,-1,O,!0),this.addCurrentVertex(F,ge,0,0,O)));if(Je&&ne<C-1){const tt=F.dist(q);if(tt>2*k){const Fe=F.add(q.sub(F)._mult(k/tt)._round());this.updateDistance(F,Fe),this.addCurrentVertex(Fe,ge,0,0,O),F=Fe}}}}addCurrentVertex(t,n,o,u,p,_=!1){const v=n.y*u-n.x,b=-n.y-n.x*u;this.addHalfVertex(t,n.x+n.y*o,n.y-n.x*o,_,!1,o,p),this.addHalfVertex(t,v,b,_,!0,-u,p),this.distance>qo/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,o,u,p,_))}addHalfVertex({x:t,y:n},o,u,p,_,v,b){const M=.5*(this.lineClips?this.scaledDistance*(qo-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(p?1:0),(n<<1)+(_?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(v===0?0:v<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const C=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,C,this.e2),b.primitiveLength++),_?this.e2=C:this.e1=C}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}hasLineDasharray(t){for(const n of t){const o=n.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(t,n,o,u){for(const p of t){const _=p.paint.get("line-dasharray");if(!_||_.value.kind==="constant")continue;const v=p.layout.get("line-cap")==="round",b={dasharray:_.value.evaluate({zoom:o-1},n,{}),round:v},M={dasharray:_.value.evaluate({zoom:o},n,{}),round:v},C={dasharray:_.value.evaluate({zoom:o+1},n,{}),round:v},z=`${b.dasharray.join(",")},${b.round}`,k=`${M.dasharray.join(",")},${M.round}`,O=`${C.dasharray.join(",")},${C.round}`;u.dashDependencies[z]=b,u.dashDependencies[k]=M,u.dashDependencies[O]=C,n.dashes[p.id]={min:z,mid:k,max:O}}}}let rd,dr;st("LineBucket",Ho,{omit:["layers","patternFeatures"]});var bc={get paint(){return dr=dr||new ia({"line-opacity":new mt(_e.paint_line["line-opacity"]),"line-color":new mt(_e.paint_line["line-color"]),"line-translate":new dt(_e.paint_line["line-translate"]),"line-translate-anchor":new dt(_e.paint_line["line-translate-anchor"]),"line-width":new mt(_e.paint_line["line-width"]),"line-gap-width":new mt(_e.paint_line["line-gap-width"]),"line-offset":new mt(_e.paint_line["line-offset"]),"line-blur":new mt(_e.paint_line["line-blur"]),"line-dasharray":new oo(_e.paint_line["line-dasharray"]),"line-pattern":new oo(_e.paint_line["line-pattern"]),"line-gradient":new yl(_e.paint_line["line-gradient"])})},get layout(){return rd=rd||new ia({"line-cap":new dt(_e.layout_line["line-cap"]),"line-join":new mt(_e.layout_line["line-join"]),"line-miter-limit":new dt(_e.layout_line["line-miter-limit"]),"line-round-limit":new dt(_e.layout_line["line-round-limit"]),"line-sort-key":new mt(_e.layout_line["line-sort-key"])})}};class uh extends mt{possiblyEvaluate(t,n){return n=new ui(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,o,u){return n=wi({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,o,u)}}let Aa;class tf extends pn{constructor(t,n){super(t,bc,n),this.gradientVersion=0,Aa||(Aa=new uh(bc.paint.properties["line-width"].specification),Aa.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(n)&&n._styleExpression.expression instanceof Wi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=Aa.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Ho(t)}queryRadius(t){const n=t,o=hh(un("line-width",this,n),un("line-gap-width",this,n)),u=un("line-offset",this,n);return o/2+Math.abs(u)+na(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:_}){const v=Yu(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-p.bearingInRadians,_),b=_/2*hh(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),M=this.paint.get("line-offset").evaluate(n,o);return M&&(u=(function(C,z){const k=[];for(let O=0;O<C.length;O++){const F=C[O],V=[];for(let q=0;q<F.length;q++){const W=F[q-1],ge=F[q],ne=F[q+1],le=q===0?new ze(0,0):ge.sub(W)._unit()._perp(),we=q===F.length-1?new ze(0,0):ne.sub(ge)._unit()._perp(),Re=le._add(we)._unit(),Ze=Re.x*we.x+Re.y*we.y;Ze!==0&&Re._mult(1/Ze),V.push(Re._mult(z)._add(ge))}k.push(V)}return k})(u,M*_)),(function(C,z,k){for(let O=0;O<z.length;O++){const F=z[O];if(C.length>=3){for(let V=0;V<F.length;V++)if(Jc(C,F[V]))return!0}if(Nf(C,F,k))return!0}return!1})(v,u,b)}isTileClipped(){return!0}}function hh(a,t){return t>0?t+2*a:a}const ap=vi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),sd=vi([{name:"a_projected_pos",components:3,type:"Float32"}],4);vi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const od=vi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);vi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const $o=vi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ca=vi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Il(a,t,n){return a.sections.forEach((o=>{o.text=(function(u,p,_){const v=p.layout.get("text-transform").evaluate(_,{});return v==="uppercase"?u=u.toLocaleUpperCase():v==="lowercase"&&(u=u.toLocaleLowerCase()),Ma.applyArabicShaping&&(u=Ma.applyArabicShaping(u)),u})(o.text,t,n)})),a}vi([{name:"triangle",components:3,type:"Uint16"}]),vi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),vi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),vi([{type:"Float32",name:"offsetX"}]),vi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),vi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const _o={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var $i=24;const dh=4294967296,ld=1/dh,nf=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class wc{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,n,o=this.length){for(;this.pos<o;){const u=this.readVarint(),p=u>>3,_=this.pos;this.type=7&u,t(p,n,this),this.pos===_&&this.skip(u)}return n}readMessage(t,n){return this.readFields(t,n,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*dh;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*dh;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const n=this.buf;let o,u;return u=n[this.pos++],o=127&u,u<128?o:(u=n[this.pos++],o|=(127&u)<<7,u<128?o:(u=n[this.pos++],o|=(127&u)<<14,u<128?o:(u=n[this.pos++],o|=(127&u)<<21,u<128?o:(u=n[this.pos],o|=(15&u)<<28,(function(p,_,v){const b=v.buf;let M,C;if(C=b[v.pos++],M=(112&C)>>4,C<128||(C=b[v.pos++],M|=(127&C)<<3,C<128)||(C=b[v.pos++],M|=(127&C)<<10,C<128)||(C=b[v.pos++],M|=(127&C)<<17,C<128)||(C=b[v.pos++],M|=(127&C)<<24,C<128)||(C=b[v.pos++],M|=(1&C)<<31,C<128))return Rl(p,M,_);throw new Error("Expected varint not more than 10 bytes")})(o,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){const t=this.readVarint()+this.pos,n=this.pos;return this.pos=t,t-n>=12&&nf?nf.decode(this.buf.subarray(n,t)):(function(o,u,p){let _="",v=u;for(;v<p;){const b=o[v];let M,C,z,k=null,O=b>239?4:b>223?3:b>191?2:1;if(v+O>p)break;O===1?b<128&&(k=b):O===2?(M=o[v+1],(192&M)==128&&(k=(31&b)<<6|63&M,k<=127&&(k=null))):O===3?(M=o[v+1],C=o[v+2],(192&M)==128&&(192&C)==128&&(k=(15&b)<<12|(63&M)<<6|63&C,(k<=2047||k>=55296&&k<=57343)&&(k=null))):O===4&&(M=o[v+1],C=o[v+2],z=o[v+3],(192&M)==128&&(192&C)==128&&(192&z)==128&&(k=(15&b)<<18|(63&M)<<12|(63&C)<<6|63&z,(k<=65535||k>=1114112)&&(k=null))),k===null?(k=65533,O=1):k>65535&&(k-=65536,_+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),_+=String.fromCharCode(k),v+=O}return _})(this.buf,n,t)}readBytes(){const t=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,t);return this.pos=t,n}readPackedVarint(t=[],n){const o=this.readPackedEnd();for(;this.pos<o;)t.push(this.readVarint(n));return t}readPackedSVarint(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFloat());return t}readPackedDouble(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){const n=7&t;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(t,n){this.writeVarint(t<<3|n)}realloc(t){let n=this.length||16;for(;n<this.pos+t;)n*=2;if(n!==this.length){const o=new Uint8Array(n);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*ld),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*ld),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?(function(n,o){let u,p;if(n>=0?(u=n%4294967296|0,p=n/4294967296|0):(u=~(-n%4294967296),p=~(-n/4294967296),4294967295^u?u=u+1|0:(u=0,p=p+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(_,v,b){b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,b.buf[b.pos]=127&(_>>>=7)})(u,0,o),(function(_,v){const b=(7&_)<<4;v.buf[v.pos++]|=b|((_>>>=3)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_)))))})(p,o)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;const n=this.pos;this.pos=(function(u,p,_){for(let v,b,M=0;M<p.length;M++){if(v=p.charCodeAt(M),v>55295&&v<57344){if(!b){v>56319||M+1===p.length?(u[_++]=239,u[_++]=191,u[_++]=189):b=v;continue}if(v<56320){u[_++]=239,u[_++]=191,u[_++]=189,b=v;continue}v=b-55296<<10|v-56320|65536,b=null}else b&&(u[_++]=239,u[_++]=191,u[_++]=189,b=null);v<128?u[_++]=v:(v<2048?u[_++]=v>>6|192:(v<65536?u[_++]=v>>12|224:(u[_++]=v>>18|240,u[_++]=v>>12&63|128),u[_++]=v>>6&63|128),u[_++]=63&v|128)}return _})(this.buf,t,this.pos);const o=this.pos-n;o>=128&&fr(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const n=t.length;this.writeVarint(n),this.realloc(n);for(let o=0;o<n;o++)this.buf[this.pos++]=t[o]}writeRawMessage(t,n){this.pos++;const o=this.pos;t(n,this);const u=this.pos-o;u>=128&&fr(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u}writeMessage(t,n,o){this.writeTag(t,2),this.writeRawMessage(n,o)}writePackedVarint(t,n){n.length&&this.writeMessage(t,rp,n)}writePackedSVarint(t,n){n.length&&this.writeMessage(t,pr,n)}writePackedBoolean(t,n){n.length&&this.writeMessage(t,Bp,n)}writePackedFloat(t,n){n.length&&this.writeMessage(t,sp,n)}writePackedDouble(t,n){n.length&&this.writeMessage(t,op,n)}writePackedFixed32(t,n){n.length&&this.writeMessage(t,Ll,n)}writePackedSFixed32(t,n){n.length&&this.writeMessage(t,cd,n)}writePackedFixed64(t,n){n.length&&this.writeMessage(t,af,n)}writePackedSFixed64(t,n){n.length&&this.writeMessage(t,au,n)}writeBytesField(t,n){this.writeTag(t,2),this.writeBytes(n)}writeFixed32Field(t,n){this.writeTag(t,5),this.writeFixed32(n)}writeSFixed32Field(t,n){this.writeTag(t,5),this.writeSFixed32(n)}writeFixed64Field(t,n){this.writeTag(t,1),this.writeFixed64(n)}writeSFixed64Field(t,n){this.writeTag(t,1),this.writeSFixed64(n)}writeVarintField(t,n){this.writeTag(t,0),this.writeVarint(n)}writeSVarintField(t,n){this.writeTag(t,0),this.writeSVarint(n)}writeStringField(t,n){this.writeTag(t,2),this.writeString(n)}writeFloatField(t,n){this.writeTag(t,5),this.writeFloat(n)}writeDoubleField(t,n){this.writeTag(t,1),this.writeDouble(n)}writeBooleanField(t,n){this.writeVarintField(t,+n)}}function Rl(a,t,n){return n?4294967296*t+(a>>>0):4294967296*(t>>>0)+(a>>>0)}function fr(a,t,n){const o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(o);for(let u=n.pos-1;u>=a;u--)n.buf[u+o]=n.buf[u]}function rp(a,t){for(let n=0;n<a.length;n++)t.writeVarint(a[n])}function pr(a,t){for(let n=0;n<a.length;n++)t.writeSVarint(a[n])}function sp(a,t){for(let n=0;n<a.length;n++)t.writeFloat(a[n])}function op(a,t){for(let n=0;n<a.length;n++)t.writeDouble(a[n])}function Bp(a,t){for(let n=0;n<a.length;n++)t.writeBoolean(a[n])}function Ll(a,t){for(let n=0;n<a.length;n++)t.writeFixed32(a[n])}function cd(a,t){for(let n=0;n<a.length;n++)t.writeSFixed32(a[n])}function af(a,t){for(let n=0;n<a.length;n++)t.writeFixed64(a[n])}function au(a,t){for(let n=0;n<a.length;n++)t.writeSFixed64(a[n])}function lp(a,t,n){a===1&&n.readMessage(cp,t)}function cp(a,t,n){if(a===3){const{id:o,bitmap:u,width:p,height:_,left:v,top:b,advance:M}=n.readMessage(up,{});t.push({id:o,bitmap:new tu({width:p+6,height:_+6},u),metrics:{width:p,height:_,left:v,top:b,advance:M}})}}function up(a,t,n){a===1?t.id=n.readVarint():a===2?t.bitmap=n.readBytes():a===3?t.width=n.readVarint():a===4?t.height=n.readVarint():a===5?t.left=n.readSVarint():a===6?t.top=n.readSVarint():a===7&&(t.advance=n.readVarint())}function rf(a){let t=0,n=0;for(const _ of a)t+=_.w*_.h,n=Math.max(n,_.w);a.sort(((_,v)=>v.h-_.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let u=0,p=0;for(const _ of a)for(let v=o.length-1;v>=0;v--){const b=o[v];if(!(_.w>b.w||_.h>b.h)){if(_.x=b.x,_.y=b.y,p=Math.max(p,_.y+_.h),u=Math.max(u,_.x+_.w),_.w===b.w&&_.h===b.h){const M=o.pop();M&&v<o.length&&(o[v]=M)}else _.h===b.h?(b.x+=_.w,b.w-=_.w):_.w===b.w?(b.y+=_.h,b.h-=_.h):(o.push({x:b.x+_.w,y:b.y,w:b.w-_.w,h:_.h}),b.y+=_.h,b.h-=_.h);break}}return{w:u,h:p,fill:t/(u*p)||0}}class ru{constructor(t,{pixelRatio:n,version:o,stretchX:u,stretchY:p,content:_,textFitWidth:v,textFitHeight:b}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=u,this.stretchY=p,this.content=_,this.version=o,this.textFitWidth=v,this.textFitHeight=b}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class ud{constructor(t,n){const o={},u={};this.haveRenderCallbacks=[];const p=[];this.addImages(t,o,p),this.addImages(n,u,p);const{w:_,h:v}=rf(p),b=new Ea({width:_||1,height:v||1});for(const M in t){const C=t[M],z=o[M].paddedRect;Ea.copy(C.data,b,{x:0,y:0},{x:z.x+1,y:z.y+1},C.data)}for(const M in n){const C=n[M],z=u[M].paddedRect,k=z.x+1,O=z.y+1,F=C.data.width,V=C.data.height;Ea.copy(C.data,b,{x:0,y:0},{x:k,y:O},C.data),Ea.copy(C.data,b,{x:0,y:V-1},{x:k,y:O-1},{width:F,height:1}),Ea.copy(C.data,b,{x:0,y:0},{x:k,y:O+V},{width:F,height:1}),Ea.copy(C.data,b,{x:F-1,y:0},{x:k-1,y:O},{width:1,height:V}),Ea.copy(C.data,b,{x:0,y:0},{x:k+F,y:O},{width:1,height:V})}this.image=b,this.iconPositions=o,this.patternPositions=u}addImages(t,n,o){for(const u in t){const p=t[u],_={x:0,y:0,w:p.data.width+2,h:p.data.height+2};o.push(_),n[u]=new ru(_,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),n)}patchUpdatedImage(t,n,o){if(!t||!n||t.version===n.version)return;t.version=n.version;const[u,p]=t.tl;o.update(n.data,void 0,{x:u,y:p})}}var kl;st("ImagePosition",ru),st("ImageAtlas",ud),I.ao=void 0,(kl=I.ao||(I.ao={}))[kl.none=0]="none",kl[kl.horizontal=1]="horizontal",kl[kl.vertical=2]="vertical",kl[kl.horizontalOnly=3]="horizontalOnly";class fh{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,n,o){const u=new fh;return u.scale=t||1,u.fontStack=n,u.verticalAlign=o||"bottom",u}static forImage(t,n){const o=new fh;return o.imageName=t,o.verticalAlign=n||"bottom",o}}class su{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const o=new su;for(let u=0;u<t.sections.length;u++){const p=t.sections[u];p.image?o.addImageSection(p):o.addTextSection(p,n)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=(function(t){let n="";for(let o=0;o<t.length;o++){const u=t.charCodeAt(o+1)||null,p=t.charCodeAt(o-1)||null;n+=u&&Bo(u)&&!_o[t[o+1]]||p&&Bo(p)&&!_o[t[o-1]]||!_o[t[o]]?t[o]:_o[t[o]]}return n})(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&mh[this.text.charCodeAt(o)];o++)t++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&mh[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const o=new su;return o.text=this.text.substring(t,n),o.sectionIndex=this.sectionIndex.slice(t,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,n)=>Math.max(t,this.sections[n].scale)),0)}getMaxImageSize(t){let n=0,o=0;for(let u=0;u<this.length();u++){const p=this.getSection(u);if(p.imageName){const _=t[p.imageName];if(!_)continue;const v=_.displaySize;n=Math.max(n,v[0]),o=Math.max(o,v[1])}}return{maxImageWidth:n,maxImageHeight:o}}addTextSection(t,n){this.text+=t.text,this.sections.push(fh.forText(t.scale,t.fontStack||n,t.verticalAlign));const o=this.sections.length-1;for(let u=0;u<t.text.length;++u)this.sectionIndex.push(o)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void zi("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(fh.forImage(n,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):zi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ph(a,t,n,o,u,p,_,v,b,M,C,z,k,O,F){const V=su.fromFeature(a,u);let q;z===I.ao.vertical&&V.verticalizePunctuation();const{processBidirectionalText:W,processStyledBidirectionalText:ge}=Ma;if(W&&V.sections.length===1){q=[];const we=W(V.toString(),dd(V,M,p,t,o,O));for(const Re of we){const Ze=new su;Ze.text=Re,Ze.sections=V.sections;for(let nt=0;nt<Re.length;nt++)Ze.sectionIndex.push(0);q.push(Ze)}}else if(ge){q=[];const we=ge(V.text,V.sectionIndex,dd(V,M,p,t,o,O));for(const Re of we){const Ze=new su;Ze.text=Re[0],Ze.sectionIndex=Re[1],Ze.sections=V.sections,q.push(Ze)}}else q=(function(we,Re){const Ze=[],nt=we.text;let Je=0;for(const it of Re)Ze.push(we.substring(Je,it)),Je=it;return Je<nt.length&&Ze.push(we.substring(Je,nt.length)),Ze})(V,dd(V,M,p,t,o,O));const ne=[],le={positionedLines:ne,text:V.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:z,iconsInText:!1,verticalizable:!1};return(function(we,Re,Ze,nt,Je,it,gt,et,tt,Fe,Tt,Et){let vt=0,ft=0,Xt=0,Ki=0;const gn=et==="right"?1:et==="left"?0:.5,sa=$i/Et;let gr=0;for(const mi of Je){mi.trim();const Qi=mi.getMaxScale(),wn={positionedGlyphs:[],lineOffset:0};we.positionedLines[gr]=wn;const Tn=wn.positionedGlyphs;let Sn=0;if(!mi.length()){ft+=it,++gr;continue}const zr=dp(nt,mi,sa);for(let ua=0;ua<mi.length();ua++){const Xn=mi.getSection(ua),Yn=mi.getSectionIndex(ua),Mn=mi.getCharCode(ua),Cn=Fi(tt,Tt,Mn);let Xi;if(Xn.imageName){if(we.iconsInText=!0,Xn.scale=Xn.scale*sa,Xi=Op(Xn,Cn,Qi,zr,nt),!Xi)continue;Sn=Math.max(Sn,Xi.imageOffset)}else if(Xi=hf(Xn,Mn,Cn,zr,Re,Ze),!Xi)continue;const{rect:_r,metrics:Ko,baselineOffset:os}=Xi;Tn.push({glyph:Mn,imageName:Xn.imageName,x:vt,y:ft+os+-17,vertical:Cn,scale:Xn.scale,fontStack:Xn.fontStack,sectionIndex:Yn,metrics:Ko,rect:_r}),Cn?(we.verticalizable=!0,vt+=(Xn.imageName?Ko.advance:$i)*Xn.scale+Fe):vt+=Ko.advance*Xn.scale+Fe}Tn.length!==0&&(Xt=Math.max(vt-Fe,Xt),fp(Tn,0,Tn.length-1,gn)),vt=0,wn.lineOffset=Math.max(Sn,(Qi-1)*$i);const $n=it*Qi+Sn;ft+=$n,Ki=Math.max($n,Ki),++gr}const{horizontalAlign:za,verticalAlign:Ji}=lu(gt);(function(mi,Qi,wn,Tn,Sn,zr,$n,ua,Xn){const Yn=(Qi-wn)*Sn;let Mn=0;Mn=zr!==$n?-ua*Tn- -17:-Tn*Xn*$n+.5*$n;for(const Cn of mi)for(const Xi of Cn.positionedGlyphs)Xi.x+=Yn,Xi.y+=Mn})(we.positionedLines,gn,za,Ji,Xt,Ki,it,ft,Je.length),we.top+=-Ji*ft,we.bottom=we.top+ft,we.left+=-za*Xt,we.right=we.left+Xt})(le,t,n,o,q,_,v,b,z,M,k,F),!(function(we){for(const Re of we)if(Re.positionedGlyphs.length!==0)return!1;return!0})(ne)&&le}const mh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ou={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},hd={40:!0};function sf(a,t,n,o,u,p){if(t.imageName){const _=o[t.imageName];return _?_.displaySize[0]*t.scale*$i/p+u:0}{const _=n[t.fontStack],v=_&&_[a];return v?v.metrics.advance*t.scale+u:0}}function of(a,t,n,o){const u=Math.pow(a-t,2);return o?a<t?u/2:2*u:u+Math.abs(n)*n}function hp(a,t,n){let o=0;return a===10&&(o-=1e4),n&&(o+=150),a!==40&&a!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function lf(a,t,n,o,u,p){let _=null,v=of(t,n,u,p);for(const b of o){const M=of(t-b.x,n,u,p)+b.badness;M<=v&&(_=b,v=M)}return{index:a,x:t,priorBreak:_,badness:v}}function cf(a){return a?cf(a.priorBreak).concat(a.index):[]}function dd(a,t,n,o,u,p){if(!a)return[];const _=[],v=(function(z,k,O,F,V,q){let W=0;for(let ge=0;ge<z.length();ge++){const ne=z.getSection(ge);W+=sf(z.getCharCode(ge),ne,F,V,k,q)}return W/Math.max(1,Math.ceil(W/O))})(a,t,n,o,u,p),b=a.text.indexOf("")>=0;let M=0;for(let z=0;z<a.length();z++){const k=a.getSection(z),O=a.getCharCode(z);if(mh[O]||(M+=sf(O,k,o,u,t,p)),z<a.length()-1){const F=!((C=O)<11904)&&(!!$t["CJK Compatibility Forms"](C)||!!$t["CJK Compatibility"](C)||!!$t["CJK Strokes"](C)||!!$t["CJK Symbols and Punctuation"](C)||!!$t["Enclosed CJK Letters and Months"](C)||!!$t["Halfwidth and Fullwidth Forms"](C)||!!$t["Ideographic Description Characters"](C)||!!$t["Vertical Forms"](C)||gl.test(String.fromCodePoint(C)));(ou[O]||F||k.imageName||z!==a.length()-2&&hd[a.getCharCode(z+1)])&&_.push(lf(z+1,M,v,_,hp(O,a.getCharCode(z+1),F&&b),!1))}}var C;return cf(lf(a.length(),M,v,_,0,!0))}function lu(a){let t=.5,n=.5;switch(a){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function dp(a,t,n){const o=t.getMaxScale()*$i,{maxImageWidth:u,maxImageHeight:p}=t.getMaxImageSize(a),_=Math.max(o,p*n);return{verticalLineContentWidth:Math.max(o,u*n),horizontalLineContentHeight:_}}function uf(a){switch(a){case"top":return 0;case"center":return .5;default:return 1}}function Fi(a,t,n){return!(a===I.ao.horizontal||!t&&!_l(n)||t&&(mh[n]||(o=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function hf(a,t,n,o,u,p){const _=p[a.fontStack],v=(function(M,C,z,k){if(M&&M.rect)return M;const O=C[z.fontStack],F=O&&O[k];return F?{rect:null,metrics:F.metrics}:null})(_&&_[t],u,a,t);if(v===null)return null;let b;if(n)b=o.verticalLineContentWidth-a.scale*$i;else{const M=uf(a.verticalAlign);b=(o.horizontalLineContentHeight-a.scale*$i)*M}return{rect:v.rect,metrics:v.metrics,baselineOffset:b}}function Op(a,t,n,o,u){const p=u[a.imageName];if(!p)return null;const _=p.paddedRect,v=p.displaySize,b={width:v[0],height:v[1],left:1,top:-3,advance:t?v[1]:v[0]};let M;if(t)M=o.verticalLineContentWidth-v[1]*a.scale;else{const C=uf(a.verticalAlign);M=(o.horizontalLineContentHeight-v[1]*a.scale)*C}return{rect:_,metrics:b,baselineOffset:M,imageOffset:(t?v[0]:v[1])*a.scale-$i*n}}function fp(a,t,n,o){if(o===0)return;const u=a[n],p=(a[n].x+u.metrics.advance*u.scale)*o;for(let _=t;_<=n;_++)a[_].x-=p}function Fp(a,t,n){const{horizontalAlign:o,verticalAlign:u}=lu(n),p=t[0]-a.displaySize[0]*o,_=t[1]-a.displaySize[1]*u;return{image:a,top:_,bottom:_+a.displaySize[1],left:p,right:p+a.displaySize[0]}}function pp(a){var t,n;let o=a.left,u=a.top,p=a.right-o,_=a.bottom-u;const v=(t=a.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",b=(n=a.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",M=(a.image.content[2]-a.image.content[0])/(a.image.content[3]-a.image.content[1]);if(b==="proportional"){if(v==="stretchOnly"&&p/_<M||v==="proportional"){const C=Math.ceil(_*M);o*=C/p,p=C}}else if(v==="proportional"&&b==="stretchOnly"&&M!==0&&p/_>M){const C=Math.ceil(p/M);u*=C/_,_=C}return{x1:o,y1:u,x2:o+p,y2:u+_}}function mp(a,t,n,o,u,p){const _=a.image;let v;if(_.content){const q=_.content,W=_.pixelRatio||1;v=[q[0]/W,q[1]/W,_.displaySize[0]-q[2]/W,_.displaySize[1]-q[3]/W]}const b=t.left*p,M=t.right*p;let C,z,k,O;n==="width"||n==="both"?(O=u[0]+b-o[3],z=u[0]+M+o[1]):(O=u[0]+(b+M-_.displaySize[0])/2,z=O+_.displaySize[0]);const F=t.top*p,V=t.bottom*p;return n==="height"||n==="both"?(C=u[1]+F-o[0],k=u[1]+V+o[2]):(C=u[1]+(F+V-_.displaySize[1])/2,k=C+_.displaySize[1]),{image:_,top:C,right:z,bottom:k,left:O,collisionPadding:v}}const as=128,Er=32640;function fd(a,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new ui(a+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=n;let p=0;for(;p<o.length&&o[p]<=a;)p++;p=Math.max(0,p-1);let _=p;for(;_<o.length&&o[_]<a+1;)_++;_=Math.min(o.length-1,_);const v=o[p],b=o[_];return n.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:b,interpolationType:u}:{kind:"camera",minZoom:v,maxZoom:b,minSize:n.evaluate(new ui(v)),maxSize:n.evaluate(new ui(b)),interpolationType:u}}}function cu(a,t,n){let o="never";const u=a.get(t);return u?o=u:a.get(n)&&(o="always"),o}const df=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Rs(a,t,n,o,u,p,_,v,b,M,C,z,k){const O=v?Math.min(Er,Math.round(v[0])):0,F=v?Math.min(Er,Math.round(v[1])):0;a.emplaceBack(t,n,Math.round(32*o),Math.round(32*u),p,_,(O<<1)+(b?1:0),F,16*M,16*C,256*z,256*k)}function rs(a,t,n){a.emplaceBack(t.x,t.y,n),a.emplaceBack(t.x,t.y,n),a.emplaceBack(t.x,t.y,n),a.emplaceBack(t.x,t.y,n)}function gh(a){for(const t of a.sections)if(fc(t.text))return!0;return!1}class ff{constructor(t){this.layoutVertexArray=new li,this.indexArray=new Bn,this.programConfigurations=t,this.segments=new Gt,this.dynamicLayoutVertexArray=new ki,this.opacityVertexArray=new Ai,this.hasVisibleVertices=!1,this.placedSymbolArray=new Y}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ap.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,sd.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,df,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}st("SymbolBuffers",ff);class pd{constructor(t,n,o){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new o,this.segments=new Gt,this.collisionVertexArray=new Bi}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,od.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}st("CollisionBuffers",pd);class Tc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((_=>_.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=fd(this.zoom,n["text-size"]),this.iconSizeData=fd(this.zoom,n["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),p=o.get("symbol-z-order");this.canOverlap=cu(o,"text-overlap","text-allow-overlap")!=="never"||cu(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((_=>I.ao[_]))),this.stateDependentLayerIds=this.layers.filter((_=>_.isStateDependent())).map((_=>_.id)),this.sourceID=t.sourceID}createArrays(){this.text=new ff(new Tl(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new ff(new Tl(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new J,this.lineVertexArray=new se,this.symbolInstances=new ee,this.textAnchorOffsets=new te}calculateGlyphDependencies(t,n,o,u,p){for(let _=0;_<t.length;_++)if(n[t.charCodeAt(_)]=!0,(o||u)&&p){const v=_o[t.charAt(_)];v&&(n[v.charCodeAt(0)]=!0)}}populate(t,n,o){const u=this.layers[0],p=u.layout,_=p.get("text-font"),v=p.get("text-field"),b=p.get("icon-image"),M=(v.value.kind!=="constant"||v.value.value instanceof oa&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),C=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,z=p.get("symbol-sort-key");if(this.features=[],!M&&!C)return;const k=n.iconDependencies,O=n.glyphDependencies,F=n.availableImages,V=new ui(this.zoom);for(const{feature:q,id:W,index:ge,sourceLayerIndex:ne}of t){const le=u._featureFilter.needGeometry,we=jo(q,le);if(!u._featureFilter.filter(V,we,o))continue;let Re,Ze;if(le||(we.geometry=Sl(q)),M){const Je=u.getValueAndResolveTokens("text-field",we,o,F),it=oa.factory(Je),gt=this.hasRTLText=this.hasRTLText||gh(it);(!gt||Ma.getRTLTextPluginStatus()==="unavailable"||gt&&Ma.isParsed())&&(Re=Il(it,u,we))}if(C){const Je=u.getValueAndResolveTokens("icon-image",we,o,F);Ze=Je instanceof vn?Je:vn.fromString(Je)}if(!Re&&!Ze)continue;const nt=this.sortFeaturesByKey?z.evaluate(we,{},o):void 0;if(this.features.push({id:W,text:Re,icon:Ze,index:ge,sourceLayerIndex:ne,geometry:we.geometry,properties:q.properties,type:Is.types[q.type],sortKey:nt}),Ze&&(k[Ze.name]=!0),Re){const Je=_.evaluate(we,{},o).join(","),it=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(I.ao.vertical)>=0;for(const gt of Re.sections)if(gt.image)k[gt.image.name]=!0;else{const et=Cs(Re.toString()),tt=gt.fontStack||Je,Fe=O[tt]=O[tt]||{};this.calculateGlyphDependencies(gt.text,Fe,it,this.allowVerticalPlacement,et)}}}p.get("symbol-placement")==="line"&&(this.features=(function(q){const W={},ge={},ne=[];let le=0;function we(Je){ne.push(q[Je]),le++}function Re(Je,it,gt){const et=ge[Je];return delete ge[Je],ge[it]=et,ne[et].geometry[0].pop(),ne[et].geometry[0]=ne[et].geometry[0].concat(gt[0]),et}function Ze(Je,it,gt){const et=W[it];return delete W[it],W[Je]=et,ne[et].geometry[0].shift(),ne[et].geometry[0]=gt[0].concat(ne[et].geometry[0]),et}function nt(Je,it,gt){const et=gt?it[0][it[0].length-1]:it[0][0];return`${Je}:${et.x}:${et.y}`}for(let Je=0;Je<q.length;Je++){const it=q[Je],gt=it.geometry,et=it.text?it.text.toString():null;if(!et){we(Je);continue}const tt=nt(et,gt),Fe=nt(et,gt,!0);if(tt in ge&&Fe in W&&ge[tt]!==W[Fe]){const Tt=Ze(tt,Fe,gt),Et=Re(tt,Fe,ne[Tt].geometry);delete W[tt],delete ge[Fe],ge[nt(et,ne[Et].geometry,!0)]=Et,ne[Tt].geometry=null}else tt in ge?Re(tt,Fe,gt):Fe in W?Ze(tt,Fe,gt):(we(Je),W[tt]=le-1,ge[Fe]=le-1)}return ne.filter((Je=>Je.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((q,W)=>q.sortKey-W.sortKey))}update(t,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const o=this.lineVertexArray.length;if(t.segment!==void 0){let u=t.dist(n[t.segment+1]),p=t.dist(n[t.segment]);const _={};for(let v=t.segment+1;v<n.length;v++)_[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:u},v<n.length-1&&(u+=n[v+1].dist(n[v]));for(let v=t.segment||0;v>=0;v--)_[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:p},v>0&&(p+=n[v-1].dist(n[v]));for(let v=0;v<n.length;v++){const b=_[v];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,n,o,u,p,_,v,b,M,C,z,k){const O=t.indexArray,F=t.layoutVertexArray,V=t.segments.prepareSegment(4*n.length,F,O,this.canOverlap?_.sortKey:void 0),q=this.glyphOffsetArray.length,W=V.vertexLength,ge=this.allowVerticalPlacement&&v===I.ao.vertical?Math.PI/2:0,ne=_.text&&_.text.sections;for(let le=0;le<n.length;le++){const{tl:we,tr:Re,bl:Ze,br:nt,tex:Je,pixelOffsetTL:it,pixelOffsetBR:gt,minFontScaleX:et,minFontScaleY:tt,glyphOffset:Fe,isSDF:Tt,sectionIndex:Et}=n[le],vt=V.vertexLength,ft=Fe[1];Rs(F,b.x,b.y,we.x,ft+we.y,Je.x,Je.y,o,Tt,it.x,it.y,et,tt),Rs(F,b.x,b.y,Re.x,ft+Re.y,Je.x+Je.w,Je.y,o,Tt,gt.x,it.y,et,tt),Rs(F,b.x,b.y,Ze.x,ft+Ze.y,Je.x,Je.y+Je.h,o,Tt,it.x,gt.y,et,tt),Rs(F,b.x,b.y,nt.x,ft+nt.y,Je.x+Je.w,Je.y+Je.h,o,Tt,gt.x,gt.y,et,tt),rs(t.dynamicLayoutVertexArray,b,ge),O.emplaceBack(vt,vt+2,vt+1),O.emplaceBack(vt+1,vt+2,vt+3),V.vertexLength+=4,V.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Fe[0]),le!==n.length-1&&Et===n[le+1].sectionIndex||t.programConfigurations.populatePaintArrays(F.length,_,_.index,{imagePositions:{},canonical:k,formattedSection:ne&&ne[Et]})}t.placedSymbolArray.emplaceBack(b.x,b.y,q,this.glyphOffsetArray.length-q,W,M,C,b.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],v,0,!1,0,z)}_addCollisionDebugVertex(t,n,o,u,p,_){return n.emplaceBack(0,0),t.emplaceBack(o.x,o.y,u,p,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(t,n,o,u,p,_,v){const b=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),M=b.vertexLength,C=p.layoutVertexArray,z=p.collisionVertexArray,k=v.anchorX,O=v.anchorY;this._addCollisionDebugVertex(C,z,_,k,O,new ze(t,n)),this._addCollisionDebugVertex(C,z,_,k,O,new ze(o,n)),this._addCollisionDebugVertex(C,z,_,k,O,new ze(o,u)),this._addCollisionDebugVertex(C,z,_,k,O,new ze(t,u)),b.vertexLength+=4;const F=p.indexArray;F.emplaceBack(M,M+1),F.emplaceBack(M+1,M+2),F.emplaceBack(M+2,M+3),F.emplaceBack(M+3,M),b.primitiveLength+=4}addDebugCollisionBoxes(t,n,o,u){for(let p=t;p<n;p++){const _=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,u?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new pd(Vi,$o.members,Zi),this.iconCollisionBox=new pd(Vi,$o.members,Zi);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,o,u,p,_,v,b,M){const C={};for(let z=n;z<o;z++){const k=t.get(z);C.textBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},C.textFeatureIndex=k.featureIndex;break}for(let z=u;z<p;z++){const k=t.get(z);C.verticalTextBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},C.verticalTextFeatureIndex=k.featureIndex;break}for(let z=_;z<v;z++){const k=t.get(z);C.iconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},C.iconFeatureIndex=k.featureIndex;break}for(let z=b;z<M;z++){const k=t.get(z);C.verticalIconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},C.verticalIconFeatureIndex=k.featureIndex;break}return C}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const o=t.placedSymbolArray.get(n),u=o.vertexStartIndex+4*o.numGlyphs;for(let p=o.vertexStartIndex;p<u;p+=4)t.indexArray.emplaceBack(p,p+2,p+1),t.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),o=Math.cos(t),u=[],p=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const b=this.symbolInstances.get(v);u.push(0|Math.round(n*b.anchorX+o*b.anchorY)),p.push(b.featureIndex)}return _.sort(((v,b)=>u[v]-u[b]||p[b]-p[v])),_}addToSortKeyRanges(t,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((u,p,_)=>{u>=0&&_.indexOf(u)===p&&this.addIndicesForPlacedSymbol(this.text,u)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let pf,mf;st("SymbolBucket",Tc,{omit:["layers","collisionBoxArray","features","compareText"]}),Tc.MAX_GLYPHS=65535,Tc.addDynamicAttributes=rs;var gf={get paint(){return mf=mf||new ia({"icon-opacity":new mt(_e.paint_symbol["icon-opacity"]),"icon-color":new mt(_e.paint_symbol["icon-color"]),"icon-halo-color":new mt(_e.paint_symbol["icon-halo-color"]),"icon-halo-width":new mt(_e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new mt(_e.paint_symbol["icon-halo-blur"]),"icon-translate":new dt(_e.paint_symbol["icon-translate"]),"icon-translate-anchor":new dt(_e.paint_symbol["icon-translate-anchor"]),"text-opacity":new mt(_e.paint_symbol["text-opacity"]),"text-color":new mt(_e.paint_symbol["text-color"],{runtimeType:Nn,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new mt(_e.paint_symbol["text-halo-color"]),"text-halo-width":new mt(_e.paint_symbol["text-halo-width"]),"text-halo-blur":new mt(_e.paint_symbol["text-halo-blur"]),"text-translate":new dt(_e.paint_symbol["text-translate"]),"text-translate-anchor":new dt(_e.paint_symbol["text-translate-anchor"])})},get layout(){return pf=pf||new ia({"symbol-placement":new dt(_e.layout_symbol["symbol-placement"]),"symbol-spacing":new dt(_e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new dt(_e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new mt(_e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new dt(_e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new dt(_e.layout_symbol["icon-allow-overlap"]),"icon-overlap":new dt(_e.layout_symbol["icon-overlap"]),"icon-ignore-placement":new dt(_e.layout_symbol["icon-ignore-placement"]),"icon-optional":new dt(_e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new dt(_e.layout_symbol["icon-rotation-alignment"]),"icon-size":new mt(_e.layout_symbol["icon-size"]),"icon-text-fit":new dt(_e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new dt(_e.layout_symbol["icon-text-fit-padding"]),"icon-image":new mt(_e.layout_symbol["icon-image"]),"icon-rotate":new mt(_e.layout_symbol["icon-rotate"]),"icon-padding":new mt(_e.layout_symbol["icon-padding"]),"icon-keep-upright":new dt(_e.layout_symbol["icon-keep-upright"]),"icon-offset":new mt(_e.layout_symbol["icon-offset"]),"icon-anchor":new mt(_e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new dt(_e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new dt(_e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new dt(_e.layout_symbol["text-rotation-alignment"]),"text-field":new mt(_e.layout_symbol["text-field"]),"text-font":new mt(_e.layout_symbol["text-font"]),"text-size":new mt(_e.layout_symbol["text-size"]),"text-max-width":new mt(_e.layout_symbol["text-max-width"]),"text-line-height":new dt(_e.layout_symbol["text-line-height"]),"text-letter-spacing":new mt(_e.layout_symbol["text-letter-spacing"]),"text-justify":new mt(_e.layout_symbol["text-justify"]),"text-radial-offset":new mt(_e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new dt(_e.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new mt(_e.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new mt(_e.layout_symbol["text-anchor"]),"text-max-angle":new dt(_e.layout_symbol["text-max-angle"]),"text-writing-mode":new dt(_e.layout_symbol["text-writing-mode"]),"text-rotate":new mt(_e.layout_symbol["text-rotate"]),"text-padding":new dt(_e.layout_symbol["text-padding"]),"text-keep-upright":new dt(_e.layout_symbol["text-keep-upright"]),"text-transform":new mt(_e.layout_symbol["text-transform"]),"text-offset":new mt(_e.layout_symbol["text-offset"]),"text-allow-overlap":new dt(_e.layout_symbol["text-allow-overlap"]),"text-overlap":new dt(_e.layout_symbol["text-overlap"]),"text-ignore-placement":new dt(_e.layout_symbol["text-ignore-placement"]),"text-optional":new dt(_e.layout_symbol["text-optional"])})}};class md{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:sn,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}st("FormatSectionOverride",md,{omit:["defaultValue"]});class _h extends pn{constructor(t,n){super(t,gf,n)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const p of o)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,o,u){const p=this.layout.get(t).evaluate(n,{},o,u),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||ac(_.value)||!p?p:(function(v,b){return b.replace(/{([^{}]+)}/g,((M,C)=>v&&C in v?String(v[C]):""))})(n.properties,p)}createBucket(t){return new Tc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of gf.paint.overridableProperties){if(!_h.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),o=new md(n),u=new nc(o,n.property.specification);let p=null;p=n.value.kind==="constant"||n.value.kind==="source"?new pl("source",u):new Oa("composite",u,n.value.zoomStops),this.paint._values[t]=new ja(n.property,p,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&_h.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const o=t.get("text-field"),u=gf.paint.properties[n];let p=!1;const _=v=>{for(const b of v)if(u.overrides&&u.overrides.hasOverride(b))return void(p=!0)};if(o.value.kind==="constant"&&o.value.value instanceof oa)_(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const v=M=>{p||(M instanceof kr&&bt(M.value)===Dr?_(M.value.sections):M instanceof Co?_(M.sections):M.eachChild(v))},b=o.value;b._styleExpression&&v(b._styleExpression.expression)}return p}}let _f;var Up={get paint(){return _f=_f||new ia({"background-color":new dt(_e.paint_background["background-color"]),"background-pattern":new qu(_e.paint_background["background-pattern"]),"background-opacity":new dt(_e.paint_background["background-opacity"])})}};class yf extends pn{constructor(t,n){super(t,Up,n)}}let gd;var jp={get paint(){return gd=gd||new ia({"raster-opacity":new dt(_e.paint_raster["raster-opacity"]),"raster-hue-rotate":new dt(_e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new dt(_e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new dt(_e.paint_raster["raster-brightness-max"]),"raster-saturation":new dt(_e.paint_raster["raster-saturation"]),"raster-contrast":new dt(_e.paint_raster["raster-contrast"]),"raster-resampling":new dt(_e.paint_raster["raster-resampling"]),"raster-fade-duration":new dt(_e.paint_raster["raster-fade-duration"])})}};class Np extends pn{constructor(t,n){super(t,jp,n)}}class yh extends pn{constructor(t,n){super(t,{},n),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Vp{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const gp={once:!0},Wt=63710088e-1;class yo{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new yo(Qt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,o=this.lat*n,u=t.lat*n,p=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((t.lng-this.lng)*n);return Wt*Math.acos(Math.min(p,1))}static convert(t){if(t instanceof yo)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new yo(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new yo(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const vh=2*Math.PI*Wt;function _d(a){return vh*Math.cos(a*Math.PI/180)}function vf(a){return(180+a)/360}function yd(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function uu(a,t){return a/_d(t)}function hu(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function _p(a,t){return a*_d(hu(t))}class du{constructor(t,n,o=0){this.x=+t,this.y=+n,this.z=+o}static fromLngLat(t,n=0){const o=yo.convert(t);return new du(vf(o.lng),yd(o.lat),uu(n,o.lat))}toLngLat(){return new yo(360*this.x-180,hu(this.y))}toAltitude(){return _p(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/vh*(t=hu(this.y),1/Math.cos(t*Math.PI/180));var t}}function yp(a,t,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[a*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class xf{constructor(t,n,o){if(!(function(u,p,_){return!(u<0||u>25||_<0||_>=Math.pow(2,u)||p<0||p>=Math.pow(2,u))})(t,n,o))throw new Error(`x=${n}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=o,this.key=pi(0,t,t,n,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,o){const u=(_=this.y,v=this.z,b=yp(256*(p=this.x),256*(_=Math.pow(2,v)-_-1),v),M=yp(256*(p+1),256*(_+1),v),b[0]+","+b[1]+","+M[0]+","+M[1]);var p,_,v,b,M;const C=(function(z,k,O){let F,V="";for(let q=z;q>0;q--)F=1<<q-1,V+=(k&F?1:0)+(O&F?2:0);return V})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,C).replace(/{bbox-epsg-3857}/g,u)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new ze((t.x*n-this.x)*_t,(t.y*n-this.y)*_t)}toString(){return`${this.z}/${this.x}/${this.y}`}}class bf{constructor(t,n){this.wrap=t,this.canonical=n,this.key=pi(t,n.z,n.z,n.x,n.y)}}class mr{constructor(t,n,o,u,p){if(this.terrainRttPosMatrix32f=null,t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=n,this.canonical=new xf(o,+u,+p),this.key=pi(n,t,o,u,p)}clone(){return new mr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new mr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new mr(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?pi(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):pi(this.wrap*+n,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap||this.overscaledZ-t.overscaledZ<=0)return!1;if(t.overscaledZ===0)return this.overscaledZ>0;const n=this.canonical.z-t.canonical.z;return!(n<0)&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new mr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new mr(n,this.wrap,n,o,u),new mr(n,this.wrap,n,o+1,u),new mr(n,this.wrap,n,o,u+1),new mr(n,this.wrap,n,o+1,u+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new mr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new mr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new bf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new du(t.x-this.wrap,t.y))}}function pi(a,t,n,o,u){(a*=2)<0&&(a=-1*a-1);const p=1<<n;return(p*p*a+p*u+o).toString(36)+n.toString(36)+t.toString(36)}function Sc(a,t){return t?a.properties[t]:a.id}st("CanonicalTileID",xf),st("OverscaledTileID",mr,{omit:["terrainRttPosMatrix32f"]});class bn{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const n=new bn;return n.extend(t(new ze(this.minX,this.minY))),n.extend(t(new ze(this.maxX,this.minY))),n.extend(t(new ze(this.minX,this.maxY))),n.extend(t(new ze(this.maxX,this.maxY))),n}static fromPoints(t){const n=new bn;for(const o of t)n.extend(o);return n}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class vp{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const o=t[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class wf{constructor(t,n,o,u,p){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=o,t._y=u,this.properties=t.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class xp{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new er(_t,16,0),this.grid3D=new er(_t,16,0),this.featureIndexArray=new Ce,this.promoteId=n}insert(t,n,o,u,p,_){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,p);const b=_?this.grid3D:this.grid;for(let M=0;M<n.length;M++){const C=n[M],z=[1/0,1/0,-1/0,-1/0];for(let k=0;k<C.length;k++){const O=C[k];z[0]=Math.min(z[0],O.x),z[1]=Math.min(z[1],O.y),z[2]=Math.max(z[2],O.x),z[3]=Math.max(z[3],O.y)}z[0]<_t&&z[1]<_t&&z[2]>=0&&z[3]>=0&&b.insert(v,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Jd(new wc(this.rawTileData)).layers,this.sourceLayerCoder=new vp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,o,u){this.loadVTLayers();const p=t.params,_=_t/t.tileSize/t.scale,v=_a(p.filter,p.globalState),b=t.queryGeometry,M=t.queryPadding*_,C=bn.fromPoints(b),z=this.grid.query(C.minX-M,C.minY-M,C.maxX+M,C.maxY+M),k=bn.fromPoints(t.cameraQueryGeometry).expandBy(M),O=this.grid3D.query(k.minX,k.minY,k.maxX,k.maxY,((q,W,ge,ne)=>(function(le,we,Re,Ze,nt){for(const it of le)if(we<=it.x&&Re<=it.y&&Ze>=it.x&&nt>=it.y)return!0;const Je=[new ze(we,Re),new ze(we,nt),new ze(Ze,nt),new ze(Ze,Re)];if(le.length>2){for(const it of Je)if(Jc(le,it))return!0}for(let it=0;it<le.length-1;it++)if(Ud(le[it],le[it+1],Je))return!0;return!1})(t.cameraQueryGeometry,q-M,W-M,ge+M,ne+M)));for(const q of O)z.push(q);z.sort(Tf);const F={};let V;for(let q=0;q<z.length;q++){const W=z[q];if(W===V)continue;V=W;const ge=this.featureIndexArray.get(W);let ne=null;this.loadMatchingFeature(F,ge.bucketIndex,ge.sourceLayerIndex,ge.featureIndex,v,p.layers,p.availableImages,n,o,u,((le,we,Re)=>(ne||(ne=Sl(le)),we.queryIntersectsFeature({queryGeometry:b,feature:le,featureState:Re,geometry:ne,zoom:this.z,transform:t.transform,pixelsToTileUnits:_,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation}))))}return F}loadMatchingFeature(t,n,o,u,p,_,v,b,M,C,z){const k=this.bucketLayerIDs[n];if(_&&!k.some((q=>_.has(q))))return;const O=this.sourceLayerCoder.decode(o),F=this.vtLayers[O].feature(u);if(p.needGeometry){const q=jo(F,!0);if(!p.filter(new ui(this.tileID.overscaledZ),q,this.tileID.canonical))return}else if(!p.filter(new ui(this.tileID.overscaledZ),F))return;const V=this.getId(F,O);for(let q=0;q<k.length;q++){const W=k[q];if(_&&!_.has(W))continue;const ge=b[W];if(!ge)continue;let ne={};V&&C&&(ne=C.getState(ge.sourceLayer||"_geojsonTileLayer",V));const le=wi({},M[W]);le.paint=vd(le.paint,ge.paint,F,ne,v),le.layout=vd(le.layout,ge.layout,F,ne,v);const we=!z||z(F,ge,ne);if(!we)continue;const Re=new wf(F,this.z,this.x,this.y,V);Re.layer=le;let Ze=t[W];Ze===void 0&&(Ze=t[W]=[]),Ze.push({featureIndex:u,feature:Re,intersectionZ:we})}}lookupSymbolFeatures(t,n,o,u,p,_,v,b){const M={};this.loadVTLayers();const C=_a(p.filterSpec,p.globalState);for(const z of t)this.loadMatchingFeature(M,o,u,z,C,_,v,b,n);return M}hasLayer(t){for(const n of this.bucketLayerIDs)for(const o of n)if(t===o)return!0;return!1}getId(t,n){var o;let u=t.id;return this.promoteId&&(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof u=="boolean"&&(u=Number(u)),u===void 0&&(!((o=t.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(u=Number(t.properties.cluster_id))),u}}function vd(a,t,n,o,u){return tr(a,((p,_)=>{const v=t instanceof gc?t.get(_):null;return v&&v.evaluate?v.evaluate(n,o,u):v}))}function Tf(a,t){return t-a}function xh(a,t,n,o,u){const p=[];for(let _=0;_<a.length;_++){const v=a[_];let b;for(let M=0;M<v.length-1;M++){let C=v[M],z=v[M+1];C.x<t&&z.x<t||(C.x<t?C=new ze(t,C.y+(t-C.x)/(z.x-C.x)*(z.y-C.y))._round():z.x<t&&(z=new ze(t,C.y+(t-C.x)/(z.x-C.x)*(z.y-C.y))._round()),C.y<n&&z.y<n||(C.y<n?C=new ze(C.x+(n-C.y)/(z.y-C.y)*(z.x-C.x),n)._round():z.y<n&&(z=new ze(C.x+(n-C.y)/(z.y-C.y)*(z.x-C.x),n)._round()),C.x>=o&&z.x>=o||(C.x>=o?C=new ze(o,C.y+(o-C.x)/(z.x-C.x)*(z.y-C.y))._round():z.x>=o&&(z=new ze(o,C.y+(o-C.x)/(z.x-C.x)*(z.y-C.y))._round()),C.y>=u&&z.y>=u||(C.y>=u?C=new ze(C.x+(u-C.y)/(z.y-C.y)*(z.x-C.x),u)._round():z.y>=u&&(z=new ze(C.x+(u-C.y)/(z.y-C.y)*(z.x-C.x),u)._round()),b&&C.equals(b[b.length-1])||(b=[C],p.push(b)),b.push(z)))))}}return p}st("FeatureIndex",xp,{omit:["rawTileData","sourceLayerCoder"]});class Xo extends ze{constructor(t,n,o,u){super(t,n),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new Xo(this.x,this.y,this.angle,this.segment)}}function Sf(a,t,n,o,u){if(t.segment===void 0||n===0)return!0;let p=t,_=t.segment+1,v=0;for(;v>-n/2;){if(_--,_<0)return!1;v-=a[_].dist(p),p=a[_]}v+=a[_].dist(a[_+1]),_++;const b=[];let M=0;for(;v<n/2;){const C=a[_],z=a[_+1];if(!z)return!1;let k=a[_-1].angleTo(C)-C.angleTo(z);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:v,angleDelta:k}),M+=k;v-b[0].distance>o;)M-=b.shift().angleDelta;if(M>u)return!1;_++,v+=C.dist(z)}return!0}function xd(a){let t=0;for(let n=0;n<a.length-1;n++)t+=a[n].dist(a[n+1]);return t}function bd(a,t,n){return a?.6*t*n:0}function bp(a,t){return Math.max(a?a.right-a.left:0,t?t.right-t.left:0)}function wp(a,t,n,o,u,p){const _=bd(n,u,p),v=bp(n,o)*p;let b=0;const M=xd(a)/2;for(let C=0;C<a.length-1;C++){const z=a[C],k=a[C+1],O=z.dist(k);if(b+O>M){const F=(M-b)/O,V=Fr.number(z.x,k.x,F),q=Fr.number(z.y,k.y,F),W=new Xo(V,q,k.angleTo(z),C);return W._round(),!_||Sf(a,W,v,_,t)?W:void 0}b+=O}}function Zp(a,t,n,o,u,p,_,v,b){const M=bd(o,p,_),C=bp(o,u),z=C*_,k=a[0].x===0||a[0].x===b||a[0].y===0||a[0].y===b;return t-z<t/4&&(t=z+t/4),Mf(a,k?t/2*v%t:(C/2+2*p)*_*v%t,t,M,n,z,k,!1,b)}function Mf(a,t,n,o,u,p,_,v,b){const M=p/2,C=xd(a);let z=0,k=t-n,O=[];for(let F=0;F<a.length-1;F++){const V=a[F],q=a[F+1],W=V.dist(q),ge=q.angleTo(V);for(;k+n<z+W;){k+=n;const ne=(k-z)/W,le=Fr.number(V.x,q.x,ne),we=Fr.number(V.y,q.y,ne);if(le>=0&&le<b&&we>=0&&we<b&&k-M>=0&&k+M<=C){const Re=new Xo(le,we,ge,F);Re._round(),o&&!Sf(a,Re,p,o,u)||O.push(Re)}}z+=W}return v||O.length||_||(O=Mf(a,z/2,n,o,u,p,_,!0,b)),O}function Tp(a,t,n,o){const u=[],p=a.image,_=p.pixelRatio,v=p.paddedRect.w-2,b=p.paddedRect.h-2;let M={x1:a.left,y1:a.top,x2:a.right,y2:a.bottom};const C=p.stretchX||[[0,v]],z=p.stretchY||[[0,b]],k=(Fe,Tt)=>Fe+Tt[1]-Tt[0],O=C.reduce(k,0),F=z.reduce(k,0),V=v-O,q=b-F;let W=0,ge=O,ne=0,le=F,we=0,Re=V,Ze=0,nt=q;if(p.content&&o){const Fe=p.content,Tt=Fe[2]-Fe[0],Et=Fe[3]-Fe[1];(p.textFitWidth||p.textFitHeight)&&(M=pp(a)),W=wd(C,0,Fe[0]),ne=wd(z,0,Fe[1]),ge=wd(C,Fe[0],Fe[2]),le=wd(z,Fe[1],Fe[3]),we=Fe[0]-W,Ze=Fe[1]-ne,Re=Tt-ge,nt=Et-le}const Je=M.x1,it=M.y1,gt=M.x2-Je,et=M.y2-it,tt=(Fe,Tt,Et,vt)=>{const ft=bh(Fe.stretch-W,ge,gt,Je),Xt=wh(Fe.fixed-we,Re,Fe.stretch,O),Ki=bh(Tt.stretch-ne,le,et,it),gn=wh(Tt.fixed-Ze,nt,Tt.stretch,F),sa=bh(Et.stretch-W,ge,gt,Je),gr=wh(Et.fixed-we,Re,Et.stretch,O),za=bh(vt.stretch-ne,le,et,it),Ji=wh(vt.fixed-Ze,nt,vt.stretch,F),mi=new ze(ft,Ki),Qi=new ze(sa,Ki),wn=new ze(sa,za),Tn=new ze(ft,za),Sn=new ze(Xt/_,gn/_),zr=new ze(gr/_,Ji/_),$n=t*Math.PI/180;if($n){const Yn=Math.sin($n),Mn=Math.cos($n),Cn=[Mn,-Yn,Yn,Mn];mi._matMult(Cn),Qi._matMult(Cn),Tn._matMult(Cn),wn._matMult(Cn)}const ua=Fe.stretch+Fe.fixed,Xn=Tt.stretch+Tt.fixed;return{tl:mi,tr:Qi,bl:Tn,br:wn,tex:{x:p.paddedRect.x+1+ua,y:p.paddedRect.y+1+Xn,w:Et.stretch+Et.fixed-ua,h:vt.stretch+vt.fixed-Xn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Sn,pixelOffsetBR:zr,minFontScaleX:Re/_/gt,minFontScaleY:nt/_/et,isSDF:n}};if(o&&(p.stretchX||p.stretchY)){const Fe=Yo(C,V,O),Tt=Yo(z,q,F);for(let Et=0;Et<Fe.length-1;Et++){const vt=Fe[Et],ft=Fe[Et+1];for(let Xt=0;Xt<Tt.length-1;Xt++)u.push(tt(vt,Tt[Xt],ft,Tt[Xt+1]))}}else u.push(tt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:b+1}));return u}function wd(a,t,n){let o=0;for(const u of a)o+=Math.max(t,Math.min(n,u[1]))-Math.max(t,Math.min(n,u[0]));return o}function Yo(a,t,n){const o=[{fixed:-1,stretch:0}];for(const[u,p]of a){const _=o[o.length-1];o.push({fixed:u-_.stretch,stretch:_.stretch}),o.push({fixed:u-_.stretch,stretch:_.stretch+(p-u)})}return o.push({fixed:t+1,stretch:n}),o}function bh(a,t,n,o){return a/t*n+o}function wh(a,t,n,o){return a-t*n/o}st("Anchor",Xo);class fu{constructor(t,n,o,u,p,_,v,b,M,C){var z;if(this.boxStartIndex=t.length,M){let k=_.top,O=_.bottom;const F=_.collisionPadding;F&&(k-=F[1],O+=F[3]);let V=O-k;V>0&&(V=Math.max(10,V),this.circleDiameter=V)}else{const k=!((z=_.image)===null||z===void 0)&&z.content&&(_.image.textFitWidth||_.image.textFitHeight)?pp(_):{x1:_.left,y1:_.top,x2:_.right,y2:_.bottom};k.y1=k.y1*v-b[0],k.y2=k.y2*v+b[2],k.x1=k.x1*v-b[3],k.x2=k.x2*v+b[1];const O=_.collisionPadding;if(O&&(k.x1-=O[0]*v,k.y1-=O[1]*v,k.x2+=O[2]*v,k.y2+=O[3]*v),C){const F=new ze(k.x1,k.y1),V=new ze(k.x2,k.y1),q=new ze(k.x1,k.y2),W=new ze(k.x2,k.y2),ge=C*Math.PI/180;F._rotate(ge),V._rotate(ge),q._rotate(ge),W._rotate(ge),k.x1=Math.min(F.x,V.x,q.x,W.x),k.x2=Math.max(F.x,V.x,q.x,W.x),k.y1=Math.min(F.y,V.y,q.y,W.y),k.y2=Math.max(F.y,V.y,q.y,W.y)}t.emplaceBack(n.x,n.y,k.x1,k.y1,k.x2,k.y2,o,u,p)}this.boxEndIndex=t.length}}class Gp{constructor(t=[],n=(o,u)=>o<u?-1:o>u?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:o}=this,u=n[t];for(;t>0;){const p=t-1>>1,_=n[p];if(o(u,_)>=0)break;n[t]=_,t=p}n[t]=u}_down(t){const{data:n,compare:o}=this,u=this.length>>1,p=n[t];for(;t<u;){let _=1+(t<<1);const v=_+1;if(v<this.length&&o(n[v],n[_])<0&&(_=v),o(n[_],p)>=0)break;n[t]=n[_],t=_}n[t]=p}}function qp(a,t=1,n=!1){const o=bn.fromPoints(a[0]),u=Math.min(o.width(),o.height());let p=u/2;const _=new Gp([],Sp),{minX:v,minY:b,maxX:M,maxY:C}=o;if(u===0)return new ze(v,b);for(let O=v;O<M;O+=u)for(let F=b;F<C;F+=u)_.push(new Bl(O+p,F+p,p,a));let z=(function(O){let F=0,V=0,q=0;const W=O[0];for(let ge=0,ne=W.length,le=ne-1;ge<ne;le=ge++){const we=W[ge],Re=W[le],Ze=we.x*Re.y-Re.x*we.y;V+=(we.x+Re.x)*Ze,q+=(we.y+Re.y)*Ze,F+=3*Ze}return new Bl(V/F,q/F,0,O)})(a),k=_.length;for(;_.length;){const O=_.pop();(O.d>z.d||!z.d)&&(z=O,n&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,k)),O.max-z.d<=t||(p=O.h/2,_.push(new Bl(O.p.x-p,O.p.y-p,p,a)),_.push(new Bl(O.p.x+p,O.p.y-p,p,a)),_.push(new Bl(O.p.x-p,O.p.y+p,p,a)),_.push(new Bl(O.p.x+p,O.p.y+p,p,a)),k+=4)}return n&&(console.log(`num probes: ${k}`),console.log(`best distance: ${z.d}`)),z.p}function Sp(a,t){return t.max-a.max}function Bl(a,t,n,o){this.p=new ze(a,t),this.h=n,this.d=(function(u,p){let _=!1,v=1/0;for(let b=0;b<p.length;b++){const M=p[b];for(let C=0,z=M.length,k=z-1;C<z;k=C++){const O=M[C],F=M[k];O.y>u.y!=F.y>u.y&&u.x<(F.x-O.x)*(u.y-O.y)/(F.y-O.y)+O.x&&(_=!_),v=Math.min(v,Od(u,O,F))}}return(_?1:-1)*Math.sqrt(v)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var ra;I.aE=void 0,(ra=I.aE||(I.aE={}))[ra.center=1]="center",ra[ra.left=2]="left",ra[ra.right=3]="right",ra[ra.top=4]="top",ra[ra.bottom=5]="bottom",ra[ra["top-left"]=6]="top-left",ra[ra["top-right"]=7]="top-right",ra[ra["bottom-left"]=8]="bottom-left",ra[ra["bottom-right"]=9]="bottom-right";const Cf=Number.POSITIVE_INFINITY;function Ar(a,t){return t[1]!==Cf?(function(n,o,u){let p=0,_=0;switch(o=Math.abs(o),u=Math.abs(u),n){case"top-right":case"top-left":case"top":_=u-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-u}switch(n){case"top-right":case"bottom-right":case"right":p=-o;break;case"top-left":case"bottom-left":case"left":p=o}return[p,_]})(a,t[0],t[1]):(function(n,o){let u=0,p=0;o<0&&(o=0);const _=o/Math.SQRT2;switch(n){case"top-right":case"top-left":p=_-7;break;case"bottom-right":case"bottom-left":p=7-_;break;case"bottom":p=7-o;break;case"top":p=o-7}switch(n){case"top-right":case"bottom-right":u=-_;break;case"top-left":case"bottom-left":u=_;break;case"left":u=o;break;case"right":u=-o}return[u,p]})(a,t[0])}function Td(a,t,n){var o;const u=a.layout,p=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},n);if(p){const v=p.values,b=[];for(let M=0;M<v.length;M+=2){const C=b[M]=v[M],z=v[M+1].map((k=>k*$i));C.startsWith("top")?z[1]-=7:C.startsWith("bottom")&&(z[1]+=7),b[M+1]=z}return new Vn(b)}const _=u.get("text-variable-anchor");if(_){let v;v=a._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(t,{},n)*$i,Cf]:u.get("text-offset").evaluate(t,{},n).map((M=>M*$i));const b=[];for(const M of _)b.push(M,Ar(M,v));return new Vn(b)}return null}function Sd(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Mp(a,t,n,o,u,p,_,v,b,M,C,z){let k=p.textMaxSize.evaluate(t,{});k===void 0&&(k=_);const O=a.layers[0].layout,F=O.get("icon-offset").evaluate(t,{},C),V=pu(n.horizontal),q=_/24,W=a.tilePixelRatio*q,ge=a.tilePixelRatio*k/24,ne=a.tilePixelRatio*v,le=a.tilePixelRatio*O.get("symbol-spacing"),we=O.get("text-padding")*a.tilePixelRatio,Re=(function(Et,vt,ft,Xt=1){const Ki=Et.get("icon-padding").evaluate(vt,{},ft),gn=Ki&&Ki.values;return[gn[0]*Xt,gn[1]*Xt,gn[2]*Xt,gn[3]*Xt]})(O,t,C,a.tilePixelRatio),Ze=O.get("text-max-angle")/180*Math.PI,nt=O.get("text-rotation-alignment")!=="viewport"&&O.get("symbol-placement")!=="point",Je=O.get("icon-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",it=O.get("symbol-placement"),gt=le/2,et=O.get("icon-text-fit");let tt;o&&et!=="none"&&(a.allowVerticalPlacement&&n.vertical&&(tt=mp(o,n.vertical,et,O.get("icon-text-fit-padding"),F,q)),V&&(o=mp(o,V,et,O.get("icon-text-fit-padding"),F,q)));const Fe=C?z.line.getGranularityForZoomLevel(C.z):1,Tt=(Et,vt)=>{vt.x<0||vt.x>=_t||vt.y<0||vt.y>=_t||(function(ft,Xt,Ki,gn,sa,gr,za,Ji,mi,Qi,wn,Tn,Sn,zr,$n,ua,Xn,Yn,Mn,Cn,Xi,_r,Ko,os,gu){const Mc=ft.addToLineVertexArray(Xt,Ki);let Qo,Wo,Cc,_u,Mh=0,i=0,s=0,c=0,f=-1,x=-1;const S={};let R=Cr("");if(ft.allowVerticalPlacement&&gn.vertical){const kt=Ji.layout.get("text-rotate").evaluate(Xi,{},os)+90;Cc=new fu(mi,Xt,Qi,wn,Tn,gn.vertical,Sn,zr,$n,kt),za&&(_u=new fu(mi,Xt,Qi,wn,Tn,za,Xn,Yn,$n,kt))}if(sa){const kt=Ji.layout.get("icon-rotate").evaluate(Xi,{}),ht=Ji.layout.get("icon-text-fit")!=="none",Ft=Tp(sa,kt,Ko,ht),jt=za?Tp(za,kt,Ko,ht):void 0;Wo=new fu(mi,Xt,Qi,wn,Tn,sa,Xn,Yn,!1,kt),Mh=4*Ft.length;const ii=ft.iconSizeData;let Pa=null;ii.kind==="source"?(Pa=[as*Ji.layout.get("icon-size").evaluate(Xi,{})],Pa[0]>Er&&zi(`${ft.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):ii.kind==="composite"&&(Pa=[as*_r.compositeIconSizes[0].evaluate(Xi,{},os),as*_r.compositeIconSizes[1].evaluate(Xi,{},os)],(Pa[0]>Er||Pa[1]>Er)&&zi(`${ft.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ft.addSymbols(ft.icon,Ft,Pa,Cn,Mn,Xi,I.ao.none,Xt,Mc.lineStartIndex,Mc.lineLength,-1,os),f=ft.icon.placedSymbolArray.length-1,jt&&(i=4*jt.length,ft.addSymbols(ft.icon,jt,Pa,Cn,Mn,Xi,I.ao.vertical,Xt,Mc.lineStartIndex,Mc.lineLength,-1,os),x=ft.icon.placedSymbolArray.length-1)}const Z=Object.keys(gn.horizontal);for(const kt of Z){const ht=gn.horizontal[kt];if(!Qo){R=Cr(ht.text);const jt=Ji.layout.get("text-rotate").evaluate(Xi,{},os);Qo=new fu(mi,Xt,Qi,wn,Tn,ht,Sn,zr,$n,jt)}const Ft=ht.positionedLines.length===1;if(s+=Ef(ft,Xt,ht,gr,Ji,$n,Xi,ua,Mc,gn.vertical?I.ao.horizontal:I.ao.horizontalOnly,Ft?Z:[kt],S,f,_r,os),Ft)break}gn.vertical&&(c+=Ef(ft,Xt,gn.vertical,gr,Ji,$n,Xi,ua,Mc,I.ao.vertical,["vertical"],S,x,_r,os));const ce=Qo?Qo.boxStartIndex:ft.collisionBoxArray.length,Pe=Qo?Qo.boxEndIndex:ft.collisionBoxArray.length,je=Cc?Cc.boxStartIndex:ft.collisionBoxArray.length,He=Cc?Cc.boxEndIndex:ft.collisionBoxArray.length,De=Wo?Wo.boxStartIndex:ft.collisionBoxArray.length,ke=Wo?Wo.boxEndIndex:ft.collisionBoxArray.length,yt=_u?_u.boxStartIndex:ft.collisionBoxArray.length,Dt=_u?_u.boxEndIndex:ft.collisionBoxArray.length;let ti=-1;const ve=(kt,ht)=>kt&&kt.circleDiameter?Math.max(kt.circleDiameter,ht):ht;ti=ve(Qo,ti),ti=ve(Cc,ti),ti=ve(Wo,ti),ti=ve(_u,ti);const me=ti>-1?1:0;me&&(ti*=gu/$i),ft.glyphOffsetArray.length>=Tc.MAX_GLYPHS&&zi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Xi.sortKey!==void 0&&ft.addToSortKeyRanges(ft.symbolInstances.length,Xi.sortKey);const Ae=Td(Ji,Xi,os),[Ge,At]=(function(kt,ht){const Ft=kt.length,jt=ht?.values;if(jt?.length>0)for(let ii=0;ii<jt.length;ii+=2){const Pa=jt[ii+1];kt.emplaceBack(I.aE[jt[ii]],Pa[0],Pa[1])}return[Ft,kt.length]})(ft.textAnchorOffsets,Ae);ft.symbolInstances.emplaceBack(Xt.x,Xt.y,S.right>=0?S.right:-1,S.center>=0?S.center:-1,S.left>=0?S.left:-1,S.vertical||-1,f,x,R,ce,Pe,je,He,De,ke,yt,Dt,Qi,s,c,Mh,i,me,0,Sn,ti,Ge,At)})(a,vt,Et,n,o,u,tt,a.layers[0],a.collisionBoxArray,t.index,t.sourceLayerIndex,a.index,W,[we,we,we,we],nt,b,ne,Re,Je,F,t,p,M,C,_)};if(it==="line")for(const Et of xh(t.geometry,0,0,_t,_t)){const vt=aa(Et,Fe),ft=Zp(vt,le,Ze,n.vertical||V,o,24,ge,a.overscaling,_t);for(const Xt of ft)V&&ss(a,V.text,gt,Xt)||Tt(vt,Xt)}else if(it==="line-center"){for(const Et of t.geometry)if(Et.length>1){const vt=aa(Et,Fe),ft=wp(vt,Ze,n.vertical||V,o,24,ge);ft&&Tt(vt,ft)}}else if(t.type==="Polygon")for(const Et of ul(t.geometry,0)){const vt=qp(Et,16);Tt(aa(Et[0],Fe,!0),new Xo(vt.x,vt.y,0))}else if(t.type==="LineString")for(const Et of t.geometry){const vt=aa(Et,Fe);Tt(vt,new Xo(vt[0].x,vt[0].y,0))}else if(t.type==="Point")for(const Et of t.geometry)for(const vt of Et)Tt([vt],new Xo(vt.x,vt.y,0))}function Ef(a,t,n,o,u,p,_,v,b,M,C,z,k,O,F){const V=(function(ge,ne,le,we,Re,Ze,nt,Je){const it=we.layout.get("text-rotate").evaluate(Ze,{})*Math.PI/180,gt=[];for(const et of ne.positionedLines)for(const tt of et.positionedGlyphs){if(!tt.rect)continue;const Fe=tt.rect||{};let Tt=4,Et=!0,vt=1,ft=0;const Xt=(Re||Je)&&tt.vertical,Ki=tt.metrics.advance*tt.scale/2;if(Je&&ne.verticalizable&&(ft=et.lineOffset/2-(tt.imageName?-($i-tt.metrics.width*tt.scale)/2:(tt.scale-1)*$i)),tt.imageName){const Yn=nt[tt.imageName];Et=Yn.sdf,vt=Yn.pixelRatio,Tt=1/vt}const gn=Re?[tt.x+Ki,tt.y]:[0,0];let sa=Re?[0,0]:[tt.x+Ki+le[0],tt.y+le[1]-ft],gr=[0,0];Xt&&(gr=sa,sa=[0,0]);const za=tt.metrics.isDoubleResolution?2:1,Ji=(tt.metrics.left-Tt)*tt.scale-Ki+sa[0],mi=(-tt.metrics.top-Tt)*tt.scale+sa[1],Qi=Ji+Fe.w/za*tt.scale/vt,wn=mi+Fe.h/za*tt.scale/vt,Tn=new ze(Ji,mi),Sn=new ze(Qi,mi),zr=new ze(Ji,wn),$n=new ze(Qi,wn);if(Xt){const Yn=new ze(-Ki,Ki- -17),Mn=-Math.PI/2,Cn=12-Ki,Xi=new ze(22-Cn,-(tt.imageName?Cn:0)),_r=new ze(...gr);Tn._rotateAround(Mn,Yn)._add(Xi)._add(_r),Sn._rotateAround(Mn,Yn)._add(Xi)._add(_r),zr._rotateAround(Mn,Yn)._add(Xi)._add(_r),$n._rotateAround(Mn,Yn)._add(Xi)._add(_r)}if(it){const Yn=Math.sin(it),Mn=Math.cos(it),Cn=[Mn,-Yn,Yn,Mn];Tn._matMult(Cn),Sn._matMult(Cn),zr._matMult(Cn),$n._matMult(Cn)}const ua=new ze(0,0),Xn=new ze(0,0);gt.push({tl:Tn,tr:Sn,bl:zr,br:$n,tex:Fe,writingMode:ne.writingMode,glyphOffset:gn,sectionIndex:tt.sectionIndex,isSDF:Et,pixelOffsetTL:ua,pixelOffsetBR:Xn,minFontScaleX:0,minFontScaleY:0})}return gt})(0,n,v,u,p,_,o,a.allowVerticalPlacement),q=a.textSizeData;let W=null;q.kind==="source"?(W=[as*u.layout.get("text-size").evaluate(_,{})],W[0]>Er&&zi(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):q.kind==="composite"&&(W=[as*O.compositeTextSizes[0].evaluate(_,{},F),as*O.compositeTextSizes[1].evaluate(_,{},F)],(W[0]>Er||W[1]>Er)&&zi(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,V,W,v,p,_,M,t,b.lineStartIndex,b.lineLength,k,F);for(const ge of C)z[ge]=a.text.placedSymbolArray.length-1;return 4*V.length}function pu(a){for(const t in a)return a[t];return null}function ss(a,t,n,o){const u=a.compareText;if(t in u){const p=u[t];for(let _=p.length-1;_>=0;_--)if(o.dist(p[_])<n)return!0}else u[t]=[];return u[t].push(o),!1}const Af=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class mu{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const p=Af[15&o];if(!p)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new mu(v,_,p,t)}constructor(t,n=64,o=Float64Array,u){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const p=Af.indexOf(this.ArrayType),_=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-v%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+_+v+b),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=n,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Ls(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:_,nodeSize:v}=this,b=[0,p.length-1,0],M=[];for(;b.length;){const C=b.pop()||0,z=b.pop()||0,k=b.pop()||0;if(z-k<=v){for(let q=k;q<=z;q++){const W=_[2*q],ge=_[2*q+1];W>=t&&W<=o&&ge>=n&&ge<=u&&M.push(p[q])}continue}const O=k+z>>1,F=_[2*O],V=_[2*O+1];F>=t&&F<=o&&V>=n&&V<=u&&M.push(p[O]),(C===0?t<=F:n<=V)&&(b.push(k),b.push(O-1),b.push(1-C)),(C===0?o>=F:u>=V)&&(b.push(O+1),b.push(z),b.push(1-C))}return M}within(t,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:p,nodeSize:_}=this,v=[0,u.length-1,0],b=[],M=o*o;for(;v.length;){const C=v.pop()||0,z=v.pop()||0,k=v.pop()||0;if(z-k<=_){for(let q=k;q<=z;q++)zf(p[2*q],p[2*q+1],t,n)<=M&&b.push(u[q]);continue}const O=k+z>>1,F=p[2*O],V=p[2*O+1];zf(F,V,t,n)<=M&&b.push(u[O]),(C===0?t-o<=F:n-o<=V)&&(v.push(k),v.push(O-1),v.push(1-C)),(C===0?t+o>=F:n+o>=V)&&(v.push(O+1),v.push(z),v.push(1-C))}return b}}function Ls(a,t,n,o,u,p){if(u-o<=n)return;const _=o+u>>1;Cp(a,t,_,o,u,p),Ls(a,t,n,o,_-1,1-p),Ls(a,t,n,_+1,u,1-p)}function Cp(a,t,n,o,u,p){for(;u>o;){if(u-o>600){const M=u-o+1,C=n-o+1,z=Math.log(M),k=.5*Math.exp(2*z/3),O=.5*Math.sqrt(z*k*(M-k)/M)*(C-M/2<0?-1:1);Cp(a,t,n,Math.max(o,Math.floor(n-C*k/M+O)),Math.min(u,Math.floor(n+(M-C)*k/M+O)),p)}const _=t[2*n+p];let v=o,b=u;for(Th(a,t,o,n),t[2*u+p]>_&&Th(a,t,o,u);v<b;){for(Th(a,t,v,b),v++,b--;t[2*v+p]<_;)v++;for(;t[2*b+p]>_;)b--}t[2*o+p]===_?Th(a,t,o,b):(b++,Th(a,t,b,u)),b<=n&&(o=b+1),n<=b&&(u=b-1)}}function Th(a,t,n,o){Ol(a,n,o),Ol(t,2*n,2*o),Ol(t,2*n+1,2*o+1)}function Ol(a,t,n){const o=a[t];a[t]=a[n],a[n]=o}function zf(a,t,n,o){const u=a-n,p=t-o;return u*u+p*p}var Pf;I.cx=void 0,(Pf=I.cx||(I.cx={})).create="create",Pf.load="load",Pf.fullLoad="fullLoad";let Md=null,Sh=[];const Df=1e3/60,If="loadTime",Rf="fullLoadTime",Hp={mark(a){performance.mark(a)},frame(a){const t=a;Md!=null&&Sh.push(t-Md),Md=t},clearMetrics(){Md=null,Sh=[],performance.clearMeasures(If),performance.clearMeasures(Rf);for(const a in I.cx)performance.clearMarks(I.cx[a])},getPerformanceMetrics(){performance.measure(If,I.cx.create,I.cx.load),performance.measure(Rf,I.cx.create,I.cx.fullLoad);const a=performance.getEntriesByName(If)[0].duration,t=performance.getEntriesByName(Rf)[0].duration,n=Sh.length,o=1/(Sh.reduce(((p,_)=>p+_),0)/n/1e3),u=Sh.filter((p=>p>Df)).reduce(((p,_)=>p+(_-Df)/Df),0);return{loadTime:a,fullLoadTime:t,fps:o,percentDroppedFrames:u/(n+u)*100,totalFrames:n}}};I.$=_t,I.A=It,I.B=function([a,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:a*Math.cos(t)*Math.sin(n),y:a*Math.sin(t)*Math.sin(n),z:a*Math.cos(n)}},I.C=Fr,I.D=dt,I.E=ct,I.F=ui,I.G=kd,I.H=function(a){if(xo==null){const t=a.navigator?a.navigator.userAgent:null;xo=!!a.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return xo},I.I=ru,I.J=class{constructor(a,t){this.target=a,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Vp((()=>this.process())),this.subscription=Us(this.target,"message",(n=>this.receive(n)),!1),this.globalScope=nr(self)?a:window}registerMessageHandler(a,t){this.messageHandlers[a]=t}sendAsync(a,t){return new Promise(((n,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10),p=t?Us(t.signal,"abort",(()=>{p?.unsubscribe(),delete this.resolveRejects[u];const b={id:u,type:"<cancel>",origin:location.origin,targetMapId:a.targetMapId,sourceMapId:this.mapId};this.target.postMessage(b)}),gp):null;this.resolveRejects[u]={resolve:b=>{p?.unsubscribe(),n(b)},reject:b=>{p?.unsubscribe(),o(b)}};const _=[],v=Object.assign(Object.assign({},a),{id:u,sourceMapId:this.mapId,origin:location.origin,data:Wr(a.data,_)});this.target.postMessage(v,{transfer:_})}))}receive(a){const t=a.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if(nr(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const a=this.taskQueue.shift(),t=this.tasks[a];delete this.tasks[a],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(a,t)}processTask(a,t){return d(this,void 0,void 0,(function*(){if(t.type==="<response>"){const u=this.resolveRejects[a];return delete this.resolveRejects[a],u?void(t.error?u.reject(Ms(t.error)):u.resolve(Ms(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(a,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=Ms(t.data),o=new AbortController;this.abortControllers[a]=o;try{const u=yield this.messageHandlers[t.type](t.sourceMapId,n,o);this.completeTask(a,null,u)}catch(u){this.completeTask(a,u)}}))}completeTask(a,t,n){const o=[];delete this.abortControllers[a];const u={id:a,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Wr(t):null,data:Wr(n,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},I.K=G,I.L=function(){var a=new It(16);return It!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},I.M=function(a,t,n){var o,u,p,_,v,b,M,C,z,k,O,F,V=n[0],q=n[1],W=n[2];return t===a?(a[12]=t[0]*V+t[4]*q+t[8]*W+t[12],a[13]=t[1]*V+t[5]*q+t[9]*W+t[13],a[14]=t[2]*V+t[6]*q+t[10]*W+t[14],a[15]=t[3]*V+t[7]*q+t[11]*W+t[15]):(u=t[1],p=t[2],_=t[3],v=t[4],b=t[5],M=t[6],C=t[7],z=t[8],k=t[9],O=t[10],F=t[11],a[0]=o=t[0],a[1]=u,a[2]=p,a[3]=_,a[4]=v,a[5]=b,a[6]=M,a[7]=C,a[8]=z,a[9]=k,a[10]=O,a[11]=F,a[12]=o*V+v*q+z*W+t[12],a[13]=u*V+b*q+k*W+t[13],a[14]=p*V+M*q+O*W+t[14],a[15]=_*V+C*q+F*W+t[15]),a},I.N=function(a,t,n){var o=n[0],u=n[1],p=n[2];return a[0]=t[0]*o,a[1]=t[1]*o,a[2]=t[2]*o,a[3]=t[3]*o,a[4]=t[4]*u,a[5]=t[5]*u,a[6]=t[6]*u,a[7]=t[7]*u,a[8]=t[8]*p,a[9]=t[9]*p,a[10]=t[10]*p,a[11]=t[11]*p,a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},I.O=function(a,t,n){var o=t[0],u=t[1],p=t[2],_=t[3],v=t[4],b=t[5],M=t[6],C=t[7],z=t[8],k=t[9],O=t[10],F=t[11],V=t[12],q=t[13],W=t[14],ge=t[15],ne=n[0],le=n[1],we=n[2],Re=n[3];return a[0]=ne*o+le*v+we*z+Re*V,a[1]=ne*u+le*b+we*k+Re*q,a[2]=ne*p+le*M+we*O+Re*W,a[3]=ne*_+le*C+we*F+Re*ge,a[4]=(ne=n[4])*o+(le=n[5])*v+(we=n[6])*z+(Re=n[7])*V,a[5]=ne*u+le*b+we*k+Re*q,a[6]=ne*p+le*M+we*O+Re*W,a[7]=ne*_+le*C+we*F+Re*ge,a[8]=(ne=n[8])*o+(le=n[9])*v+(we=n[10])*z+(Re=n[11])*V,a[9]=ne*u+le*b+we*k+Re*q,a[10]=ne*p+le*M+we*O+Re*W,a[11]=ne*_+le*C+we*F+Re*ge,a[12]=(ne=n[12])*o+(le=n[13])*v+(we=n[14])*z+(Re=n[15])*V,a[13]=ne*u+le*b+we*k+Re*q,a[14]=ne*p+le*M+we*O+Re*W,a[15]=ne*_+le*C+we*F+Re*ge,a},I.P=ze,I.Q=function(a,t){const n={};for(let o=0;o<t.length;o++){const u=t[o];u in a&&(n[u]=a[u])}return n},I.R=Ea,I.S=yo,I.T=Kh,I.U=yd,I.V=vf,I.W=tn,I.X=dn,I.Y=Os,I.Z=mr,I._=d,I.a=U,I.a$=ha,I.a0=function(a,t){var n,o,u,p,_;if(!a)return t??{};if(!t)return a;let v=Object.assign({},a);if(t.removeAll&&(v={removeAll:!0}),t.remove){const b=new Set(t.remove);v.add&&(v.add=v.add.filter((C=>!b.has(C.id)))),v.update&&(v.update=v.update.filter((C=>!b.has(C.id))));const M=new Set(((n=a.add)!==null&&n!==void 0?n:[]).map((C=>C.id)));t.remove=t.remove.filter((C=>!M.has(C)))}if(t.remove){const b=new Set(v.remove?v.remove.concat(t.remove):t.remove);v.remove=Array.from(b.values())}if(t.add){const b=v.add?v.add.concat(t.add):t.add,M=new Map(b.map((C=>[C.id,C])));v.add=Array.from(M.values())}if(t.update){const b=new Map((o=v.update)===null||o===void 0?void 0:o.map((M=>[M.id,M])));for(const M of t.update){const C=(u=b.get(M.id))!==null&&u!==void 0?u:{id:M.id};M.newGeometry&&(C.newGeometry=M.newGeometry),M.addOrUpdateProperties&&(C.addOrUpdateProperties=((p=C.addOrUpdateProperties)!==null&&p!==void 0?p:[]).concat(M.addOrUpdateProperties)),M.removeProperties&&(C.removeProperties=((_=C.removeProperties)!==null&&_!==void 0?_:[]).concat(M.removeProperties)),M.removeAllProperties&&(C.removeAllProperties=!0),b.set(M.id,C)}v.update=Array.from(b.values())}return v.remove&&v.add&&(v.remove=v.remove.filter((b=>v.add.findIndex((M=>M.id===b))===-1))),v},I.a1=du,I.a2=bn,I.a3=25,I.a4=xf,I.a5=a=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((n=>{t.onloadstart=()=>{n(t)};for(const o of a){const u=window.document.createElement("source");xe(o)||(t.crossOrigin="Anonymous"),u.src=o,t.appendChild(u)}}))},I.a6=Ue,I.a7=function(){return si++},I.a8=$,I.a9=Tc,I.aA=function(a){let t=1/0,n=1/0,o=-1/0,u=-1/0;for(const p of a)t=Math.min(t,p.x),n=Math.min(n,p.y),o=Math.max(o,p.x),u=Math.max(u,p.y);return[t,n,o,u]},I.aB=$i,I.aC=ni,I.aD=function(a,t,n,o,u=!1){if(!n[0]&&!n[1])return[0,0];const p=u?o==="map"?-a.bearingInRadians:0:o==="viewport"?a.bearingInRadians:0;if(p){const _=Math.sin(p),v=Math.cos(p);n=[n[0]*v-n[1]*_,n[0]*_+n[1]*v]}return[u?n[0]:ni(t,n[0],a.zoom),u?n[1]:ni(t,n[1],a.zoom)]},I.aF=cu,I.aG=Sd,I.aH=lu,I.aI=mu,I.aJ=vi,I.aK=rh,I.aL=Te,I.aM=Gt,I.aN=Bn,I.aO=Qt,I.aP=js,I.aQ=_p,I.aR=Pn,I.aS=zn,I.aT=function(a){var t=new It(3);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t},I.aU=function(a,t,n){return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],a},I.aV=function(a,t){var n=t[0],o=t[1],u=t[2],p=n*n+o*o+u*u;return p>0&&(p=1/Math.sqrt(p)),a[0]=t[0]*p,a[1]=t[1]*p,a[2]=t[2]*p,a},I.aW=gi,I.aX=function(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]},I.aY=function(a,t,n){return a[0]=t[0]*n[0],a[1]=t[1]*n[1],a[2]=t[2]*n[2],a[3]=t[3]*n[3],a},I.aZ=Nt,I.a_=function(a,t,n){const o=t[0]*n[0]+t[1]*n[1]+t[2]*n[2];return o===0?null:(-(a[0]*n[0]+a[1]*n[1]+a[2]*n[2])-n[3])/o},I.aa=_a,I.ab=jo,I.ac=wf,I.ad=function(a){const t={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,o,u,p)=>{const _=u||p;return t[o]=!_||_.toLowerCase(),""})),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},I.ae=Un,I.af=function(a){return Math.pow(2,a)},I.ag=Kn,I.ah=Ct,I.ai=85.051129,I.aj=uu,I.ak=function(a){return Math.log(a)/Math.LN2},I.al=function(a){var t=a[0],n=a[1];return t*t+n*n},I.am=function(a,t){const n=[];for(const o in a)o in t||n.push(o);return n},I.an=function(a,t){let n=0,o=0;if(a.kind==="constant")o=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:u,minZoom:p,maxZoom:_}=a,v=u?Ct(Jn.interpolationFactor(u,t,p,_),0,1):0;a.kind==="camera"?o=Fr.number(a.minSize,a.maxSize,v):n=v}return{uSizeT:n,uSize:o}},I.ap=function(a,{uSize:t,uSizeT:n},{lowerSize:o,upperSize:u}){return a.kind==="source"?o/as:a.kind==="composite"?Fr.number(o/as,u/as,n):t},I.aq=function(a,t){var n=t[0],o=t[1],u=t[2],p=t[3],_=t[4],v=t[5],b=t[6],M=t[7],C=t[8],z=t[9],k=t[10],O=t[11],F=t[12],V=t[13],q=t[14],W=t[15],ge=n*v-o*_,ne=n*b-u*_,le=n*M-p*_,we=o*b-u*v,Re=o*M-p*v,Ze=u*M-p*b,nt=C*V-z*F,Je=C*q-k*F,it=C*W-O*F,gt=z*q-k*V,et=z*W-O*V,tt=k*W-O*q,Fe=ge*tt-ne*et+le*gt+we*it-Re*Je+Ze*nt;return Fe?(a[0]=(v*tt-b*et+M*gt)*(Fe=1/Fe),a[1]=(u*et-o*tt-p*gt)*Fe,a[2]=(V*Ze-q*Re+W*we)*Fe,a[3]=(k*Re-z*Ze-O*we)*Fe,a[4]=(b*it-_*tt-M*Je)*Fe,a[5]=(n*tt-u*it+p*Je)*Fe,a[6]=(q*le-F*Ze-W*ne)*Fe,a[7]=(C*Ze-k*le+O*ne)*Fe,a[8]=(_*et-v*it+M*nt)*Fe,a[9]=(o*it-n*et-p*nt)*Fe,a[10]=(F*Re-V*le+W*ge)*Fe,a[11]=(z*le-C*Re-O*ge)*Fe,a[12]=(v*Je-_*gt-b*nt)*Fe,a[13]=(n*gt-o*Je+u*nt)*Fe,a[14]=(V*ne-F*we-q*ge)*Fe,a[15]=(C*we-z*ne+k*ge)*Fe,a):null},I.ar=rt,I.as=function(a){var t=a[0],n=a[1];return Math.sqrt(t*t+n*n)},I.at=function(a){return a[0]=0,a[1]=0,a},I.au=function(a,t,n){return a[0]=t[0]*n,a[1]=t[1]*n,a},I.av=rs,I.aw=ba,I.ax=function(a,t,n,o){const u=t.y-a.y,p=t.x-a.x,_=o.y-n.y,v=o.x-n.x,b=_*p-v*u;if(b===0)return null;const M=(v*(a.y-n.y)-_*(a.x-n.x))/b;return new ze(a.x+M*p,a.y+M*u)},I.ay=xh,I.az=Ml,I.b=vr,I.b$=class extends l{},I.b0=function(a,t,n){return a[0]=t[0]*n,a[1]=t[1]*n,a[2]=t[2]*n,a[3]=t[3]*n,a},I.b1=function(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]},I.b2=bf,I.b3=pi,I.b4=function(a,t,n,o,u){var p=1/Math.tan(t/2);if(a[0]=p/n,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=p,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,u!=null&&u!==1/0){var _=1/(o-u);a[10]=(u+o)*_,a[14]=2*u*o*_}else a[10]=-1,a[14]=-2*o;return a},I.b5=function(a){var t=new It(16);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},I.b6=function(a,t,n){var o=Math.sin(n),u=Math.cos(n),p=t[0],_=t[1],v=t[2],b=t[3],M=t[4],C=t[5],z=t[6],k=t[7];return t!==a&&(a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=p*u+M*o,a[1]=_*u+C*o,a[2]=v*u+z*o,a[3]=b*u+k*o,a[4]=M*u-p*o,a[5]=C*u-_*o,a[6]=z*u-v*o,a[7]=k*u-b*o,a},I.b7=function(a,t,n){var o=Math.sin(n),u=Math.cos(n),p=t[4],_=t[5],v=t[6],b=t[7],M=t[8],C=t[9],z=t[10],k=t[11];return t!==a&&(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[4]=p*u+M*o,a[5]=_*u+C*o,a[6]=v*u+z*o,a[7]=b*u+k*o,a[8]=M*u-p*o,a[9]=C*u-_*o,a[10]=z*u-v*o,a[11]=k*u-b*o,a},I.b8=function(){const a=new Float32Array(16);return Kn(a),a},I.b9=function(){const a=new Float64Array(16);return Kn(a),a},I.bA=function(a,t){const n=he(a,360),o=he(t,360),u=o-n,p=o>n?u-360:u+360;return Math.abs(u)<Math.abs(p)?u:p},I.bB=function(a){return a[0]=0,a[1]=0,a[2]=0,a},I.bC=function(a,t,n,o){const u=Math.sqrt(a*a+t*t),p=Math.sqrt(n*n+o*o);a/=u,t/=u,n/=p,o/=p;const _=Math.acos(a*n+t*o);return-t*n+a*o>0?_:-_},I.bD=function(a,t){const n=he(a,2*Math.PI),o=he(t,2*Math.PI);return Math.min(Math.abs(n-o),Math.abs(n-o+2*Math.PI),Math.abs(n-o-2*Math.PI))},I.bE=function(){const a={},t=_e.$version;for(const n in _e.$root){const o=_e.$root[n];if(o.required){let u=null;u=n==="version"?t:o.type==="array"?[]:{},u!=null&&(a[n]=u)}}return a},I.bF=qc,I.bG=oe,I.bH=function a(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let o=0;o<t.length;o++)if(!a(t[o],n[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const o in t)if(!a(t[o],n[o]))return!1;return!0}return t===n},I.bI=function(a){a=a.slice();const t=Object.create(null);for(let n=0;n<a.length;n++)t[a[n].id]=a[n];for(let n=0;n<a.length;n++)"ref"in a[n]&&(a[n]=Vt(a[n],t[a[n].ref]));return a},I.bJ=function(a,t){if(a.type==="custom")return new yh(a,t);switch(a.type){case"background":return new yf(a,t);case"circle":return new Vd(a,t);case"color-relief":return new Kf(a,t);case"fill":return new Qd(a,t);case"fill-extrusion":return new oi(a,t);case"heatmap":return new Xf(a,t);case"hillshade":return new No(a,t);case"line":return new tf(a,t);case"raster":return new Np(a,t);case"symbol":return new _h(a,t)}},I.bK=Qn,I.bL=function(a,t){if(!a)return[{command:"setStyle",args:[t]}];let n=[];try{if(!pt(a.version,t.version))return[{command:"setStyle",args:[t]}];pt(a.center,t.center)||n.push({command:"setCenter",args:[t.center]}),pt(a.state,t.state)||n.push({command:"setGlobalState",args:[t.state]}),pt(a.centerAltitude,t.centerAltitude)||n.push({command:"setCenterAltitude",args:[t.centerAltitude]}),pt(a.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),pt(a.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),pt(a.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),pt(a.roll,t.roll)||n.push({command:"setRoll",args:[t.roll]}),pt(a.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),pt(a.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),pt(a.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),pt(a.light,t.light)||n.push({command:"setLight",args:[t.light]}),pt(a.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),pt(a.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),pt(a.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const o={},u=[];(function(_,v,b,M){let C;for(C in v=v||{},_=_||{})Object.prototype.hasOwnProperty.call(_,C)&&(Object.prototype.hasOwnProperty.call(v,C)||nn(C,b,M));for(C in v)Object.prototype.hasOwnProperty.call(v,C)&&(Object.prototype.hasOwnProperty.call(_,C)?pt(_[C],v[C])||(_[C].type==="geojson"&&v[C].type==="geojson"&&jn(_,v,C)?Ot(b,{command:"setGeoJSONSourceData",args:[C,v[C].data]}):an(C,v,b,M)):Pi(C,v,b))})(a.sources,t.sources,u,o);const p=[];a.layers&&a.layers.forEach((_=>{"source"in _&&o[_.source]?n.push({command:"removeLayer",args:[_.id]}):p.push(_)})),n=n.concat(u),(function(_,v,b){v=v||[];const M=(_=_||[]).map(Di),C=v.map(Di),z=_.reduce(fn,{}),k=v.reduce(fn,{}),O=M.slice(),F=Object.create(null);let V,q,W,ge,ne;for(let le=0,we=0;le<M.length;le++)V=M[le],Object.prototype.hasOwnProperty.call(k,V)?we++:(Ot(b,{command:"removeLayer",args:[V]}),O.splice(O.indexOf(V,we),1));for(let le=0,we=0;le<C.length;le++)V=C[C.length-1-le],O[O.length-1-le]!==V&&(Object.prototype.hasOwnProperty.call(z,V)?(Ot(b,{command:"removeLayer",args:[V]}),O.splice(O.lastIndexOf(V,O.length-we),1)):we++,ge=O[O.length-le],Ot(b,{command:"addLayer",args:[k[V],ge]}),O.splice(O.length-le,0,V),F[V]=!0);for(let le=0;le<C.length;le++)if(V=C[le],q=z[V],W=k[V],!F[V]&&!pt(q,W))if(pt(q.source,W.source)&&pt(q["source-layer"],W["source-layer"])&&pt(q.type,W.type)){for(ne in In(q.layout,W.layout,b,V,null,"setLayoutProperty"),In(q.paint,W.paint,b,V,null,"setPaintProperty"),pt(q.filter,W.filter)||Ot(b,{command:"setFilter",args:[V,W.filter]}),pt(q.minzoom,W.minzoom)&&pt(q.maxzoom,W.maxzoom)||Ot(b,{command:"setLayerZoomRange",args:[V,W.minzoom,W.maxzoom]}),q)Object.prototype.hasOwnProperty.call(q,ne)&&ne!=="layout"&&ne!=="paint"&&ne!=="filter"&&ne!=="metadata"&&ne!=="minzoom"&&ne!=="maxzoom"&&(ne.indexOf("paint.")===0?In(q[ne],W[ne],b,V,ne.slice(6),"setPaintProperty"):pt(q[ne],W[ne])||Ot(b,{command:"setLayerProperty",args:[V,ne,W[ne]]}));for(ne in W)Object.prototype.hasOwnProperty.call(W,ne)&&!Object.prototype.hasOwnProperty.call(q,ne)&&ne!=="layout"&&ne!=="paint"&&ne!=="filter"&&ne!=="metadata"&&ne!=="minzoom"&&ne!=="maxzoom"&&(ne.indexOf("paint.")===0?In(q[ne],W[ne],b,V,ne.slice(6),"setPaintProperty"):pt(q[ne],W[ne])||Ot(b,{command:"setLayerProperty",args:[V,ne,W[ne]]}))}else Ot(b,{command:"removeLayer",args:[V]}),ge=O[O.lastIndexOf(V)+1],Ot(b,{command:"addLayer",args:[W,ge]})})(p,t.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[t]}]}return n},I.bM=function(a){const t=[],n=a.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),a.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},I.bN=tr,I.bO=ir,I.bP=class extends Oi{constructor(a,t){super(a,t),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},I.bQ=Hu,I.bR=class extends Oi{constructor(a,t){super(a,t),this.current=Nh}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let t=1;t<16;t++)if(a[t]!==this.current[t]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},I.bS=Kc,I.bT=class extends Oi{constructor(a,t){super(a,t),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},I.bU=class extends Oi{constructor(a,t){super(a,t),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},I.bV=Ci,I.bW=function(a,t){var n=Math.sin(t),o=Math.cos(t);return a[0]=o,a[1]=n,a[2]=0,a[3]=-n,a[4]=o,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},I.bX=function(a,t,n){var o=t[0],u=t[1],p=t[2];return a[0]=o*n[0]+u*n[3]+p*n[6],a[1]=o*n[1]+u*n[4]+p*n[7],a[2]=o*n[2]+u*n[5]+p*n[8],a},I.bY=function(a,t,n,o,u,p,_){var v=1/(t-n),b=1/(o-u),M=1/(p-_);return a[0]=-2*v,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*b,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*M,a[11]=0,a[12]=(t+n)*v,a[13]=(u+o)*b,a[14]=(_+p)*M,a[15]=1,a},I.bZ=class extends Oi{constructor(a,t){super(a,t),this.current=new Array}set(a){if(a!=this.current){this.current=a;const t=new Float32Array(4*a.length);for(let n=0;n<a.length;n++)t[4*n]=a[n].r,t[4*n+1]=a[n].g,t[4*n+2]=a[n].b,t[4*n+3]=a[n].a;this.gl.uniform4fv(this.location,t)}}},I.b_=class extends Oi{constructor(a,t){super(a,t),this.current=new Array}set(a){if(a!=this.current){this.current=a;const t=new Float32Array(a);this.gl.uniform1fv(this.location,t)}}},I.ba=function(){return new Float64Array(16)},I.bb=function(a,t,n){const o=new Float64Array(4);return Be(o,a,t-90,n),o},I.bc=function(a,t,n,o){var u,p,_,v,b,M=t[0],C=t[1],z=t[2],k=t[3],O=n[0],F=n[1],V=n[2],q=n[3];return(p=M*O+C*F+z*V+k*q)<0&&(p=-p,O=-O,F=-F,V=-V,q=-q),1-p>hi?(u=Math.acos(p),_=Math.sin(u),v=Math.sin((1-o)*u)/_,b=Math.sin(o*u)/_):(v=1-o,b=o),a[0]=v*M+b*O,a[1]=v*C+b*F,a[2]=v*z+b*V,a[3]=v*k+b*q,a},I.bd=function(a){const t=new Float64Array(9);var n,o,u,p,_,v,b,M,C,z,k,O,F,V,q,W,ge,ne;z=(u=(o=a)[0])*(b=u+u),k=(p=o[1])*b,F=(_=o[2])*b,V=_*(M=p+p),W=(v=o[3])*b,ge=v*M,ne=v*(C=_+_),(n=t)[0]=1-(O=p*M)-(q=_*C),n[3]=k-ne,n[6]=F+ge,n[1]=k+ne,n[4]=1-z-q,n[7]=V-W,n[2]=F-ge,n[5]=V+W,n[8]=1-z-O;const le=js(-Math.asin(Ct(t[2],-1,1)));let we,Re;return Math.hypot(t[5],t[8])<.001?(we=0,Re=-js(Math.atan2(t[3],t[4]))):(we=js(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),Re=js(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:we,pitch:le+90,bearing:Re}},I.be=function(a,t){return a.roll==t.roll&&a.pitch==t.pitch&&a.bearing==t.bearing},I.bf=Ht,I.bg=Yc,I.bh=vc,I.bi=iu,I.bj=ur,I.bk=Ne,I.bl=at,I.bm=Wn,I.bn=function(a,t,n,o,u){return Ne(o,u,Ct((a-t)/(n-t),0,1))},I.bo=he,I.bp=function(){return new Float64Array(3)},I.bq=function(a,t,n,o){return a[0]=t[0]+n[0]*o,a[1]=t[1]+n[1]*o,a[2]=t[2]+n[2]*o,a},I.br=Be,I.bs=function(a,t,n){var o=n[0],u=n[1],p=n[2],_=n[3],v=t[0],b=t[1],M=t[2],C=u*M-p*b,z=p*v-o*M,k=o*b-u*v;return a[0]=v+_*(C+=C)+u*(k+=k)-p*(z+=z),a[1]=b+_*z+p*C-o*k,a[2]=M+_*k+o*z-u*C,a},I.bt=function(a,t,n){const o=(u=[a[0],a[1],a[2],t[0],t[1],t[2],n[0],n[1],n[2]])[0]*((C=u[8])*(_=u[4])-(v=u[5])*(M=u[7]))+u[1]*(-C*(p=u[3])+v*(b=u[6]))+u[2]*(M*p-_*b);var u,p,_,v,b,M,C;if(o===0)return null;const z=gi([],[t[0],t[1],t[2]],[n[0],n[1],n[2]]),k=gi([],[n[0],n[1],n[2]],[a[0],a[1],a[2]]),O=gi([],[a[0],a[1],a[2]],[t[0],t[1],t[2]]),F=Pn([],z,-a[3]);return zn(F,F,Pn([],k,-t[3])),zn(F,F,Pn([],O,-n[3])),Pn(F,F,1/o),F},I.bu=Wt,I.bv=function(){return new Float64Array(4)},I.bw=function(a,t,n,o){var u=[],p=[];return u[0]=t[0]-n[0],u[1]=t[1]-n[1],u[2]=t[2]-n[2],p[0]=u[0]*Math.cos(o)-u[1]*Math.sin(o),p[1]=u[0]*Math.sin(o)+u[1]*Math.cos(o),p[2]=u[2],a[0]=p[0]+n[0],a[1]=p[1]+n[1],a[2]=p[2]+n[2],a},I.bx=function(a,t,n,o){var u=[],p=[];return u[0]=t[0]-n[0],u[1]=t[1]-n[1],u[2]=t[2]-n[2],p[0]=u[0],p[1]=u[1]*Math.cos(o)-u[2]*Math.sin(o),p[2]=u[1]*Math.sin(o)+u[2]*Math.cos(o),a[0]=p[0]+n[0],a[1]=p[1]+n[1],a[2]=p[2]+n[2],a},I.by=function(a,t,n,o){var u=[],p=[];return u[0]=t[0]-n[0],u[1]=t[1]-n[1],u[2]=t[2]-n[2],p[0]=u[2]*Math.sin(o)+u[0]*Math.cos(o),p[1]=u[1],p[2]=u[2]*Math.cos(o)-u[0]*Math.sin(o),a[0]=p[0]+n[0],a[1]=p[1]+n[1],a[2]=p[2]+n[2],a},I.bz=function(a,t,n){var o=Math.sin(n),u=Math.cos(n),p=t[0],_=t[1],v=t[2],b=t[3],M=t[8],C=t[9],z=t[10],k=t[11];return t!==a&&(a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=p*u-M*o,a[1]=_*u-C*o,a[2]=v*u-z*o,a[3]=b*u-k*o,a[8]=p*o+M*u,a[9]=_*o+C*u,a[10]=v*o+z*u,a[11]=b*o+k*u,a},I.c=pe,I.c0=ca,I.c1=class extends g{},I.c2=eh,I.c3=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},I.c4=Ju,I.c5=function(a,t,n){var o=t[0],u=t[1],p=t[2],_=n[3]*o+n[7]*u+n[11]*p+n[15];return a[0]=(n[0]*o+n[4]*u+n[8]*p+n[12])/(_=_||1),a[1]=(n[1]*o+n[5]*u+n[9]*p+n[13])/_,a[2]=(n[2]*o+n[6]*u+n[10]*p+n[14])/_,a},I.c6=class extends Ca{},I.c7=class extends P{},I.c8=function(a,t){return a[0]===t[0]&&a[1]===t[1]&&a[2]===t[2]&&a[3]===t[3]&&a[4]===t[4]&&a[5]===t[5]&&a[6]===t[6]&&a[7]===t[7]&&a[8]===t[8]&&a[9]===t[9]&&a[10]===t[10]&&a[11]===t[11]&&a[12]===t[12]&&a[13]===t[13]&&a[14]===t[14]&&a[15]===t[15]},I.c9=function(a,t){var n=a[0],o=a[1],u=a[2],p=a[3],_=a[4],v=a[5],b=a[6],M=a[7],C=a[8],z=a[9],k=a[10],O=a[11],F=a[12],V=a[13],q=a[14],W=a[15],ge=t[0],ne=t[1],le=t[2],we=t[3],Re=t[4],Ze=t[5],nt=t[6],Je=t[7],it=t[8],gt=t[9],et=t[10],tt=t[11],Fe=t[12],Tt=t[13],Et=t[14],vt=t[15];return Math.abs(n-ge)<=hi*Math.max(1,Math.abs(n),Math.abs(ge))&&Math.abs(o-ne)<=hi*Math.max(1,Math.abs(o),Math.abs(ne))&&Math.abs(u-le)<=hi*Math.max(1,Math.abs(u),Math.abs(le))&&Math.abs(p-we)<=hi*Math.max(1,Math.abs(p),Math.abs(we))&&Math.abs(_-Re)<=hi*Math.max(1,Math.abs(_),Math.abs(Re))&&Math.abs(v-Ze)<=hi*Math.max(1,Math.abs(v),Math.abs(Ze))&&Math.abs(b-nt)<=hi*Math.max(1,Math.abs(b),Math.abs(nt))&&Math.abs(M-Je)<=hi*Math.max(1,Math.abs(M),Math.abs(Je))&&Math.abs(C-it)<=hi*Math.max(1,Math.abs(C),Math.abs(it))&&Math.abs(z-gt)<=hi*Math.max(1,Math.abs(z),Math.abs(gt))&&Math.abs(k-et)<=hi*Math.max(1,Math.abs(k),Math.abs(et))&&Math.abs(O-tt)<=hi*Math.max(1,Math.abs(O),Math.abs(tt))&&Math.abs(F-Fe)<=hi*Math.max(1,Math.abs(F),Math.abs(Fe))&&Math.abs(V-Tt)<=hi*Math.max(1,Math.abs(V),Math.abs(Tt))&&Math.abs(q-Et)<=hi*Math.max(1,Math.abs(q),Math.abs(Et))&&Math.abs(W-vt)<=hi*Math.max(1,Math.abs(W),Math.abs(vt))},I.cA=function(a,t){U.REGISTERED_PROTOCOLS[a]=t},I.cB=function(a){delete U.REGISTERED_PROTOCOLS[a]},I.cC=function(a,t){const n={};for(let u=0;u<a.length;u++){const p=t&&t[a[u].id]||Jt(a[u]);t&&(t[a[u].id]=p);let _=n[p];_||(_=n[p]=[]),_.push(a[u])}const o=[];for(const u in n)o.push(n[u]);return o},I.cD=st,I.cE=vp,I.cF=xp,I.cG=ud,I.cH=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=_t/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const t=a.bucket.layers[0],n=t.layout,o=t._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new ui(a.bucket.zoom+1),a.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new ui(a.bucket.zoom+1),a.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new ui(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:M,maxZoom:C}=a.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new ui(M),a.canonical),o["text-size"].possiblyEvaluate(new ui(C),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:M,maxZoom:C}=a.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new ui(M),a.canonical),o["icon-size"].possiblyEvaluate(new ui(C),a.canonical)]}const p=n.get("text-line-height")*$i,_=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",v=n.get("text-keep-upright"),b=n.get("text-size");for(const M of a.bucket.features){const C=n.get("text-font").evaluate(M,{},a.canonical).join(","),z=b.evaluate(M,{},a.canonical),k=u.layoutTextSize.evaluate(M,{},a.canonical),O=u.layoutIconSize.evaluate(M,{},a.canonical),F={horizontal:{},vertical:void 0},V=M.text;let q,W=[0,0];if(V){const le=V.toString(),we=n.get("text-letter-spacing").evaluate(M,{},a.canonical)*$i,Re=ro(le)?we:0,Ze=n.get("text-anchor").evaluate(M,{},a.canonical),nt=Td(t,M,a.canonical);if(!nt){const et=n.get("text-radial-offset").evaluate(M,{},a.canonical);W=et?Ar(Ze,[et*$i,Cf]):n.get("text-offset").evaluate(M,{},a.canonical).map((tt=>tt*$i))}let Je=_?"center":n.get("text-justify").evaluate(M,{},a.canonical);const it=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(M,{},a.canonical)*$i:1/0,gt=()=>{a.bucket.allowVerticalPlacement&&Cs(le)&&(F.vertical=ph(V,a.glyphMap,a.glyphPositions,a.imagePositions,C,it,p,Ze,"left",Re,W,I.ao.vertical,!0,k,z))};if(!_&&nt){const et=new Set;if(Je==="auto")for(let Fe=0;Fe<nt.values.length;Fe+=2)et.add(Sd(nt.values[Fe]));else et.add(Je);let tt=!1;for(const Fe of et)if(!F.horizontal[Fe])if(tt)F.horizontal[Fe]=F.horizontal[0];else{const Tt=ph(V,a.glyphMap,a.glyphPositions,a.imagePositions,C,it,p,"center",Fe,Re,W,I.ao.horizontal,!1,k,z);Tt&&(F.horizontal[Fe]=Tt,tt=Tt.positionedLines.length===1)}gt()}else{Je==="auto"&&(Je=Sd(Ze));const et=ph(V,a.glyphMap,a.glyphPositions,a.imagePositions,C,it,p,Ze,Je,Re,W,I.ao.horizontal,!1,k,z);et&&(F.horizontal[Je]=et),gt(),Cs(le)&&_&&v&&(F.vertical=ph(V,a.glyphMap,a.glyphPositions,a.imagePositions,C,it,p,Ze,Je,Re,W,I.ao.vertical,!1,k,z))}}let ge=!1;if(M.icon&&M.icon.name){const le=a.imageMap[M.icon.name];le&&(q=Fp(a.imagePositions[M.icon.name],n.get("icon-offset").evaluate(M,{},a.canonical),n.get("icon-anchor").evaluate(M,{},a.canonical)),ge=!!le.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=ge:a.bucket.sdfIcons!==ge&&zi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(le.pixelRatio!==a.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const ne=pu(F.horizontal)||F.vertical;a.bucket.iconsInText=!!ne&&ne.iconsInText,(ne||q)&&Mp(a.bucket,M,F,q,a.imageMap,u,k,O,W,ge,a.canonical,a.subdivisionGranularity)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},I.cI=id,I.cJ=ad,I.cK=Ho,I.cL=Jd,I.cM=wc,I.cN=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},I.cO=function(a,t,n,o,u){return d(this,void 0,void 0,(function*(){if(dn())try{return yield Os(a,t,n,o,u)}catch{}return(function(p,_,v,b,M){const C=p.width,z=p.height;Pr&&Fs||(Pr=new OffscreenCanvas(C,z),Fs=Pr.getContext("2d",{willReadFrequently:!0})),Pr.width=C,Pr.height=z,Fs.drawImage(p,0,0,C,z);const k=Fs.getImageData(_,v,b,M);return Fs.clearRect(0,0,C,z),k.data})(a,t,n,o,u)}))},I.cP=po,I.cQ=Ie,I.cR=xc,I.cS=Is,I.cT=Io,I.cU=function(a,t){const n=new Map;if(a!=null)if(a.type==="Feature")n.set(Sc(a,t),a);else for(const o of a.features)n.set(Sc(o,t),o);return n},I.cV=function(a,t){if(a==null)return!0;if(a.type==="Feature")return Sc(a,t)!=null;if(a.type==="FeatureCollection"){const n=new Set;for(const o of a.features){const u=Sc(o,t);if(u==null||n.has(u))return!1;n.add(u)}return!0}return!1},I.cW=function(a,t,n){var o,u,p,_;if(t.removeAll&&a.clear(),t.remove)for(const v of t.remove)a.delete(v);if(t.add)for(const v of t.add){const b=Sc(v,n);b!=null&&a.set(b,v)}if(t.update)for(const v of t.update){let b=a.get(v.id);if(b==null)continue;const M=!v.removeAllProperties&&(((o=v.removeProperties)===null||o===void 0?void 0:o.length)>0||((u=v.addOrUpdateProperties)===null||u===void 0?void 0:u.length)>0);if((v.newGeometry||v.removeAllProperties||M)&&(b=Object.assign({},b),a.set(v.id,b),M&&(b.properties=Object.assign({},b.properties))),v.newGeometry&&(b.geometry=v.newGeometry),v.removeAllProperties)b.properties={};else if(((p=v.removeProperties)===null||p===void 0?void 0:p.length)>0)for(const C of v.removeProperties)Object.prototype.hasOwnProperty.call(b.properties,C)&&delete b.properties[C];if(((_=v.addOrUpdateProperties)===null||_===void 0?void 0:_.length)>0)for(const{key:C,value:z}of v.addOrUpdateProperties)b.properties[C]=z}},I.cX=Ma,I.ca=function(a,t){return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},I.cb=a=>a.type==="symbol",I.cc=a=>a.type==="circle",I.cd=a=>a.type==="heatmap",I.ce=a=>a.type==="line",I.cf=a=>a.type==="fill",I.cg=a=>a.type==="fill-extrusion",I.ch=a=>a.type==="hillshade",I.ci=a=>a.type==="color-relief",I.cj=a=>a.type==="raster",I.ck=a=>a.type==="background",I.cl=a=>a.type==="custom",I.cm=ut,I.cn=function(a,t,n){const o=St(t.x-n.x,t.y-n.y),u=St(a.x-n.x,a.y-n.y);var p,_;return js(Math.atan2(o[0]*u[1]-o[1]*u[0],(p=o)[0]*(_=u)[0]+p[1]*_[1]))},I.co=Mt,I.cp=function(a,t){return cs[t]&&(a instanceof MouseEvent||a instanceof WheelEvent)},I.cq=function(a,t){return ls[t]&&"touches"in a},I.cr=function(a){return ls[a]||cs[a]},I.cs=function(a,t,n){var o=t[0],u=t[1];return a[0]=n[0]*o+n[4]*u+n[12],a[1]=n[1]*o+n[5]*u+n[13],a},I.ct=function(a,t){const{x:n,y:o}=du.fromLngLat(t);return!(a<0||a>25||o<0||o>=1||n<0||n>=1)},I.cu=function(a,t){return a[0]=t[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=t[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=t[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},I.cv=class extends Jr{},I.cw=Hp,I.cy=function(a){return a.message===us},I.cz=ie,I.d=xe,I.e=wi,I.f=a=>d(void 0,void 0,void 0,(function*(){if(a.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(a)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),I.g=j,I.h=a=>new Promise(((t,n)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=ar}))},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(a)],{type:"image/png"});o.src=a.byteLength?URL.createObjectURL(u):ar})),I.i=nr,I.j=(a,t)=>fe(wi(a,{type:"json"}),t),I.k=Oe,I.l=Xe,I.m=fe,I.n=(a,t)=>fe(wi(a,{type:"arrayBuffer"}),t),I.o=function(a){return new wc(a).readFields(lp,[])},I.p=rf,I.q=tu,I.r=ia,I.s=Us,I.t=Oo,I.u=$t,I.v=_e,I.w=zi,I.x=Qr,I.y=Vu,I.z=Tr})),Me("worker",["./shared"],(function(I){class d{constructor(U,j){this.keyCache={},U&&this.replace(U,j)}replace(U,j){this._layerConfigs={},this._layers={},this.update(U,[],j)}update(U,j,G){for(const oe of U){this._layerConfigs[oe.id]=oe;const fe=this._layers[oe.id]=I.bJ(oe,G);fe._featureFilter=I.aa(fe.filter,G),this.keyCache[oe.id]&&delete this.keyCache[oe.id]}for(const oe of j)delete this.keyCache[oe],delete this._layerConfigs[oe],delete this._layers[oe];this.familiesBySource={};const ie=I.cC(Object.values(this._layerConfigs),this.keyCache);for(const oe of ie){const fe=oe.map((ct=>this._layers[ct.id])),xe=fe[0];if(xe.visibility==="none")continue;const ye=xe.source||"";let Le=this.familiesBySource[ye];Le||(Le=this.familiesBySource[ye]={});const Xe=xe.sourceLayer||"_geojsonTileLayer";let Oe=Le[Xe];Oe||(Oe=Le[Xe]=[]),Oe.push(fe)}}}class ze{constructor(U){const j={},G=[];for(const xe in U){const ye=U[xe],Le=j[xe]={};for(const Xe in ye){const Oe=ye[+Xe];if(!Oe||Oe.bitmap.width===0||Oe.bitmap.height===0)continue;const ct={x:0,y:0,w:Oe.bitmap.width+2,h:Oe.bitmap.height+2};G.push(ct),Le[Xe]={rect:ct,metrics:Oe.metrics}}}const{w:ie,h:oe}=I.p(G),fe=new I.q({width:ie||1,height:oe||1});for(const xe in U){const ye=U[xe];for(const Le in ye){const Xe=ye[+Le];if(!Xe||Xe.bitmap.width===0||Xe.bitmap.height===0)continue;const Oe=j[xe][Le].rect;I.q.copy(Xe.bitmap,fe,{x:0,y:0},{x:Oe.x+1,y:Oe.y+1},Xe.bitmap)}}this.image=fe,this.positions=j}}I.cD("GlyphAtlas",ze);class Ie{constructor(U){this.tileID=new I.Z(U.tileID.overscaledZ,U.tileID.wrap,U.tileID.canonical.z,U.tileID.canonical.x,U.tileID.canonical.y),this.uid=U.uid,this.zoom=U.zoom,this.pixelRatio=U.pixelRatio,this.tileSize=U.tileSize,this.source=U.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=U.showCollisionBoxes,this.collectResourceTiming=!!U.collectResourceTiming,this.returnDependencies=!!U.returnDependencies,this.promoteId=U.promoteId,this.inFlightDependencies=[]}parse(U,j,G,ie,oe){return I._(this,void 0,void 0,(function*(){this.status="parsing",this.data=U,this.collisionBoxArray=new I.a8;const fe=new I.cE(Object.keys(U.layers).sort()),xe=new I.cF(this.tileID,this.promoteId);xe.bucketLayerIDs=[];const ye={},Le={featureIndex:xe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:G,subdivisionGranularity:oe},Xe=j.familiesBySource[this.source];for(const Ue in Xe){const rn=U.layers[Ue];if(!rn)continue;rn.version===1&&I.w(`Vector tile source "${this.source}" layer "${Ue}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Da=fe.encode(Ue),Ns=[];for(let sn=0;sn<rn.length;sn++){const qe=rn.feature(sn),xt=xe.getId(qe,Ue);Ns.push({feature:qe,id:xt,index:sn,sourceLayerIndex:Da})}for(const sn of Xe[Ue]){const qe=sn[0];qe.source!==this.source&&I.w(`layer.source = ${qe.source} does not equal this.source = ${this.source}`),qe.minzoom&&this.zoom<Math.floor(qe.minzoom)||qe.maxzoom&&this.zoom>=qe.maxzoom||qe.visibility!=="none"&&(ot(sn,this.zoom,G),(ye[qe.id]=qe.createBucket({index:xe.bucketLayerIDs.length,layers:sn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Da,sourceID:this.source})).populate(Ns,Le,this.tileID.canonical),xe.bucketLayerIDs.push(sn.map((xt=>xt.id))))}}const Oe=I.bN(Le.glyphDependencies,(Ue=>Object.keys(Ue).map(Number)));this.inFlightDependencies.forEach((Ue=>Ue?.abort())),this.inFlightDependencies=[];let ct=Promise.resolve({});if(Object.keys(Oe).length){const Ue=new AbortController;this.inFlightDependencies.push(Ue),ct=ie.sendAsync({type:"GG",data:{stacks:Oe,source:this.source,tileID:this.tileID,type:"glyphs"}},Ue)}const _e=Object.keys(Le.iconDependencies);let wt=Promise.resolve({});if(_e.length){const Ue=new AbortController;this.inFlightDependencies.push(Ue),wt=ie.sendAsync({type:"GI",data:{icons:_e,source:this.source,tileID:this.tileID,type:"icons"}},Ue)}const Vt=Object.keys(Le.patternDependencies);let pt=Promise.resolve({});if(Vt.length){const Ue=new AbortController;this.inFlightDependencies.push(Ue),pt=ie.sendAsync({type:"GI",data:{icons:Vt,source:this.source,tileID:this.tileID,type:"patterns"}},Ue)}const Ot=Le.dashDependencies;let Pi=Promise.resolve({});if(Object.keys(Ot).length){const Ue=new AbortController;this.inFlightDependencies.push(Ue),Pi=ie.sendAsync({type:"GDA",data:{dashes:Ot}},Ue)}const[nn,an,jn,In]=yield Promise.all([ct,wt,pt,Pi]),Di=new ze(nn),fn=new I.cG(an,jn);for(const Ue in ye){const rn=ye[Ue];rn instanceof I.a9?(ot(rn.layers,this.zoom,G),I.cH({bucket:rn,glyphMap:nn,glyphPositions:Di.positions,imageMap:an,imagePositions:fn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Le.subdivisionGranularity})):rn.hasDependencies&&(rn instanceof I.cI||rn instanceof I.cJ||rn instanceof I.cK)&&(ot(rn.layers,this.zoom,G),rn.addFeatures(Le,this.tileID.canonical,fn.patternPositions,In))}return this.status="done",{buckets:Object.values(ye).filter((Ue=>!Ue.isEmpty())),featureIndex:xe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Di.image,imageAtlas:fn,dashPositions:In,glyphMap:this.returnDependencies?nn:null,iconMap:this.returnDependencies?an:null,glyphPositions:this.returnDependencies?Di.positions:null}}))}}function ot(pe,U,j){const G=new I.F(U);for(const ie of pe)ie.recalculate(G,j)}class Ye{constructor(U,j,G){this.actor=U,this.layerIndex=j,this.availableImages=G,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(U,j){return I._(this,void 0,void 0,(function*(){const G=yield I.n(U.request,j);try{return{vectorTile:new I.cL(new I.cM(G.data)),rawData:G.data,cacheControl:G.cacheControl,expires:G.expires}}catch(ie){const oe=new Uint8Array(G.data);let fe=`Unable to parse the tile at ${U.request.url}, `;throw fe+=oe[0]===31&&oe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ie.message}`,new Error(fe)}}))}loadTile(U){return I._(this,void 0,void 0,(function*(){const j=U.uid,G=!!(U&&U.request&&U.request.collectResourceTiming)&&new I.cN(U.request),ie=new Ie(U);this.loading[j]=ie;const oe=new AbortController;ie.abort=oe;try{const fe=yield this.loadVectorTile(U,oe);if(delete this.loading[j],!fe)return null;const xe=fe.rawData,ye={};fe.expires&&(ye.expires=fe.expires),fe.cacheControl&&(ye.cacheControl=fe.cacheControl);const Le={};if(G){const Oe=G.finish();Oe&&(Le.resourceTiming=JSON.parse(JSON.stringify(Oe)))}ie.vectorTile=fe.vectorTile;const Xe=ie.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,U.subdivisionGranularity);this.loaded[j]=ie,this.fetching[j]={rawTileData:xe,cacheControl:ye,resourceTiming:Le};try{const Oe=yield Xe;return I.e({rawTileData:xe.slice(0)},Oe,ye,Le)}finally{delete this.fetching[j]}}catch(fe){throw delete this.loading[j],ie.status="done",this.loaded[j]=ie,fe}}))}reloadTile(U){return I._(this,void 0,void 0,(function*(){const j=U.uid;if(!this.loaded||!this.loaded[j])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const G=this.loaded[j];if(G.showCollisionBoxes=U.showCollisionBoxes,G.status==="parsing"){const ie=yield G.parse(G.vectorTile,this.layerIndex,this.availableImages,this.actor,U.subdivisionGranularity);let oe;if(this.fetching[j]){const{rawTileData:fe,cacheControl:xe,resourceTiming:ye}=this.fetching[j];delete this.fetching[j],oe=I.e({rawTileData:fe.slice(0)},ie,xe,ye)}else oe=ie;return oe}if(G.status==="done"&&G.vectorTile)return G.parse(G.vectorTile,this.layerIndex,this.availableImages,this.actor,U.subdivisionGranularity)}))}abortTile(U){return I._(this,void 0,void 0,(function*(){const j=this.loading,G=U.uid;j&&j[G]&&j[G].abort&&(j[G].abort.abort(),delete j[G])}))}removeTile(U){return I._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[U.uid]&&delete this.loaded[U.uid]}))}}class Ke{constructor(){this.loaded={}}loadTile(U){return I._(this,void 0,void 0,(function*(){const{uid:j,encoding:G,rawImageData:ie,redFactor:oe,greenFactor:fe,blueFactor:xe,baseShift:ye}=U,Le=ie.width+2,Xe=ie.height+2,Oe=I.b(ie)?new I.R({width:Le,height:Xe},yield I.cO(ie,-1,-1,Le,Xe)):ie,ct=new I.cP(j,Oe,G,oe,fe,xe,ye);return this.loaded=this.loaded||{},this.loaded[j]=ct,ct}))}removeTile(U){const j=this.loaded,G=U.uid;j&&j[G]&&delete j[G]}}var be,ci,Bt=(function(){if(ci)return be;function pe(j,G){if(j.length!==0){U(j[0],G);for(var ie=1;ie<j.length;ie++)U(j[ie],!G)}}function U(j,G){for(var ie=0,oe=0,fe=0,xe=j.length,ye=xe-1;fe<xe;ye=fe++){var Le=(j[fe][0]-j[ye][0])*(j[ye][1]+j[fe][1]),Xe=ie+Le;oe+=Math.abs(ie)>=Math.abs(Le)?ie-Xe+Le:Le-Xe+ie,ie=Xe}ie+oe>=0!=!!G&&j.reverse()}return ci=1,be=function j(G,ie){var oe,fe=G&&G.type;if(fe==="FeatureCollection")for(oe=0;oe<G.features.length;oe++)j(G.features[oe],ie);else if(fe==="GeometryCollection")for(oe=0;oe<G.geometries.length;oe++)j(G.geometries[oe],ie);else if(fe==="Feature")j(G.geometry,ie);else if(fe==="Polygon")pe(G.coordinates,ie);else if(fe==="MultiPolygon")for(oe=0;oe<G.coordinates.length;oe++)pe(G.coordinates[oe],ie);return G}})(),tn=I.cQ(Bt);class dn extends I.cS{constructor(U,j){super(new I.cM,0,j,[],[]),this.feature=U,this.type=U.type,this.properties=U.tags?U.tags:{},"id"in U&&(typeof U.id=="string"?this.id=parseInt(U.id,10):typeof U.id!="number"||isNaN(U.id)||(this.id=U.id))}loadGeometry(){const U=[],j=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const G of j){const ie=[];for(const oe of G)ie.push(new I.P(oe[0],oe[1]));U.push(ie)}return U}}class hi extends I.cR{constructor(U,j){super(new I.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=j?j.version:1,this.extent=j?j.extent:4096,this.length=U.length,this.features=U}feature(U){return new dn(this.features[U],this.extent)}}function It(pe,U){U.writeVarintField(15,pe.version||1),U.writeStringField(1,pe.name||""),U.writeVarintField(5,pe.extent||4096);const j={keys:[],values:[],keycache:{},valuecache:{}};for(let oe=0;oe<pe.length;oe++)j.feature=pe.feature(oe),U.writeMessage(2,Ci,j);const G=j.keys;for(const oe of G)U.writeStringField(3,oe);const ie=j.values;for(const oe of ie)U.writeMessage(4,zn,oe)}function Ci(pe,U){if(!pe.feature)return;const j=pe.feature;j.id!==void 0&&U.writeVarintField(1,j.id),U.writeMessage(2,Kn,pe),U.writeVarintField(3,j.type),U.writeMessage(4,An,j)}function Kn(pe,U){for(const j in pe.feature?.properties){let G=pe.feature.properties[j],ie=pe.keycache[j];if(G===null)continue;ie===void 0&&(pe.keys.push(j),ie=pe.keys.length-1,pe.keycache[j]=ie),U.writeVarint(ie),typeof G!="string"&&typeof G!="boolean"&&typeof G!="number"&&(G=JSON.stringify(G));const oe=typeof G+":"+G;let fe=pe.valuecache[oe];fe===void 0&&(pe.values.push(G),fe=pe.values.length-1,pe.valuecache[oe]=fe),U.writeVarint(fe)}}function Ui(pe,U){return(U<<3)+(7&pe)}function Nt(pe){return pe<<1^pe>>31}function An(pe,U){const j=pe.loadGeometry(),G=pe.type;let ie=0,oe=0;for(const fe of j){let xe=1;G===1&&(xe=fe.length),U.writeVarint(Ui(1,xe));const ye=G===3?fe.length-1:fe.length;for(let Le=0;Le<ye;Le++){Le===1&&G!==1&&U.writeVarint(Ui(2,ye-1));const Xe=fe[Le].x-ie,Oe=fe[Le].y-oe;U.writeVarint(Nt(Xe)),U.writeVarint(Nt(Oe)),ie+=Xe,oe+=Oe}pe.type===3&&U.writeVarint(Ui(7,1))}}function zn(pe,U){const j=typeof pe;j==="string"?U.writeStringField(1,pe):j==="boolean"?U.writeBooleanField(7,pe):j==="number"&&(pe%1!=0?U.writeDoubleField(3,pe):pe<0?U.writeSVarintField(6,pe):U.writeVarintField(5,pe))}const Pn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:pe=>pe},gi=Math.fround||(ji=new Float32Array(1),pe=>(ji[0]=+pe,ji[0]));var ji;class ha{constructor(U){this.options=Object.assign(Object.create(Pn),U),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(U){const{log:j,minZoom:G,maxZoom:ie}=this.options;j&&console.time("total time");const oe=`prepare ${U.length} points`;j&&console.time(oe),this.points=U;const fe=[];for(let ye=0;ye<U.length;ye++){const Le=U[ye];if(!Le.geometry)continue;const[Xe,Oe]=Le.geometry.coordinates,ct=gi(Be(Xe)),_e=gi(rt(Oe));fe.push(ct,_e,1/0,ye,-1,1),this.options.reduce&&fe.push(0)}let xe=this.trees[ie+1]=this._createTree(fe);j&&console.timeEnd(oe);for(let ye=ie;ye>=G;ye--){const Le=+Date.now();xe=this.trees[ye]=this._createTree(this._cluster(xe,ye)),j&&console.log("z%d: %d clusters in %dms",ye,xe.numItems,+Date.now()-Le)}return j&&console.timeEnd("total time"),this}getClusters(U,j){let G=((U[0]+180)%360+360)%360-180;const ie=Math.max(-90,Math.min(90,U[1]));let oe=U[2]===180?180:((U[2]+180)%360+360)%360-180;const fe=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)G=-180,oe=180;else if(G>oe){const Oe=this.getClusters([G,ie,180,fe],j),ct=this.getClusters([-180,ie,oe,fe],j);return Oe.concat(ct)}const xe=this.trees[this._limitZoom(j)],ye=xe.range(Be(G),rt(fe),Be(oe),rt(ie)),Le=xe.data,Xe=[];for(const Oe of ye){const ct=this.stride*Oe;Xe.push(Le[ct+5]>1?ba(Le,ct,this.clusterProps):this.points[Le[ct+3]])}return Xe}getChildren(U){const j=this._getOriginId(U),G=this._getOriginZoom(U),ie="No cluster with the specified id.",oe=this.trees[G];if(!oe)throw new Error(ie);const fe=oe.data;if(j*this.stride>=fe.length)throw new Error(ie);const xe=this.options.radius/(this.options.extent*Math.pow(2,G-1)),ye=oe.within(fe[j*this.stride],fe[j*this.stride+1],xe),Le=[];for(const Xe of ye){const Oe=Xe*this.stride;fe[Oe+4]===U&&Le.push(fe[Oe+5]>1?ba(fe,Oe,this.clusterProps):this.points[fe[Oe+3]])}if(Le.length===0)throw new Error(ie);return Le}getLeaves(U,j,G){const ie=[];return this._appendLeaves(ie,U,j=j||10,G=G||0,0),ie}getTile(U,j,G){const ie=this.trees[this._limitZoom(U)],oe=Math.pow(2,U),{extent:fe,radius:xe}=this.options,ye=xe/fe,Le=(G-ye)/oe,Xe=(G+1+ye)/oe,Oe={features:[]};return this._addTileFeatures(ie.range((j-ye)/oe,Le,(j+1+ye)/oe,Xe),ie.data,j,G,oe,Oe),j===0&&this._addTileFeatures(ie.range(1-ye/oe,Le,1,Xe),ie.data,oe,G,oe,Oe),j===oe-1&&this._addTileFeatures(ie.range(0,Le,ye/oe,Xe),ie.data,-1,G,oe,Oe),Oe.features.length?Oe:null}getClusterExpansionZoom(U){let j=this._getOriginZoom(U)-1;for(;j<=this.options.maxZoom;){const G=this.getChildren(U);if(j++,G.length!==1)break;U=G[0].properties.cluster_id}return j}_appendLeaves(U,j,G,ie,oe){const fe=this.getChildren(j);for(const xe of fe){const ye=xe.properties;if(ye&&ye.cluster?oe+ye.point_count<=ie?oe+=ye.point_count:oe=this._appendLeaves(U,ye.cluster_id,G,ie,oe):oe<ie?oe++:U.push(xe),U.length===G)break}return oe}_createTree(U){const j=new I.aI(U.length/this.stride|0,this.options.nodeSize,Float32Array);for(let G=0;G<U.length;G+=this.stride)j.add(U[G],U[G+1]);return j.finish(),j.data=U,j}_addTileFeatures(U,j,G,ie,oe,fe){for(const xe of U){const ye=xe*this.stride,Le=j[ye+5]>1;let Xe,Oe,ct;if(Le)Xe=Dn(j,ye,this.clusterProps),Oe=j[ye],ct=j[ye+1];else{const Vt=this.points[j[ye+3]];Xe=Vt.properties;const[pt,Ot]=Vt.geometry.coordinates;Oe=Be(pt),ct=rt(Ot)}const _e={type:1,geometry:[[Math.round(this.options.extent*(Oe*oe-G)),Math.round(this.options.extent*(ct*oe-ie))]],tags:Xe};let wt;wt=Le||this.options.generateId?j[ye+3]:this.points[j[ye+3]].id,wt!==void 0&&(_e.id=wt),fe.features.push(_e)}}_limitZoom(U){return Math.max(this.options.minZoom,Math.min(Math.floor(+U),this.options.maxZoom+1))}_cluster(U,j){const{radius:G,extent:ie,reduce:oe,minPoints:fe}=this.options,xe=G/(ie*Math.pow(2,j)),ye=U.data,Le=[],Xe=this.stride;for(let Oe=0;Oe<ye.length;Oe+=Xe){if(ye[Oe+2]<=j)continue;ye[Oe+2]=j;const ct=ye[Oe],_e=ye[Oe+1],wt=U.within(ye[Oe],ye[Oe+1],xe),Vt=ye[Oe+5];let pt=Vt;for(const Ot of wt){const Pi=Ot*Xe;ye[Pi+2]>j&&(pt+=ye[Pi+5])}if(pt>Vt&&pt>=fe){let Ot,Pi=ct*Vt,nn=_e*Vt,an=-1;const jn=(Oe/Xe<<5)+(j+1)+this.points.length;for(const In of wt){const Di=In*Xe;if(ye[Di+2]<=j)continue;ye[Di+2]=j;const fn=ye[Di+5];Pi+=ye[Di]*fn,nn+=ye[Di+1]*fn,ye[Di+4]=jn,oe&&(Ot||(Ot=this._map(ye,Oe,!0),an=this.clusterProps.length,this.clusterProps.push(Ot)),oe(Ot,this._map(ye,Di)))}ye[Oe+4]=jn,Le.push(Pi/pt,nn/pt,1/0,jn,-1,pt),oe&&Le.push(an)}else{for(let Ot=0;Ot<Xe;Ot++)Le.push(ye[Oe+Ot]);if(pt>1)for(const Ot of wt){const Pi=Ot*Xe;if(!(ye[Pi+2]<=j)){ye[Pi+2]=j;for(let nn=0;nn<Xe;nn++)Le.push(ye[Pi+nn])}}}}return Le}_getOriginId(U){return U-this.points.length>>5}_getOriginZoom(U){return(U-this.points.length)%32}_map(U,j,G){if(U[j+5]>1){const fe=this.clusterProps[U[j+6]];return G?Object.assign({},fe):fe}const ie=this.points[U[j+3]].properties,oe=this.options.map(ie);return G&&oe===ie?Object.assign({},oe):oe}}function ba(pe,U,j){return{type:"Feature",id:pe[U+3],properties:Dn(pe,U,j),geometry:{type:"Point",coordinates:[(G=pe[U],360*(G-.5)),St(pe[U+1])]}};var G}function Dn(pe,U,j){const G=pe[U+5],ie=G>=1e4?`${Math.round(G/1e3)}k`:G>=1e3?Math.round(G/100)/10+"k":G,oe=pe[U+6],fe=oe===-1?{}:Object.assign({},j[oe]);return Object.assign(fe,{cluster:!0,cluster_id:pe[U+3],point_count:G,point_count_abbreviated:ie})}function Be(pe){return pe/360+.5}function rt(pe){const U=Math.sin(pe*Math.PI/180),j=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return j<0?0:j>1?1:j}function St(pe){const U=(180-360*pe)*Math.PI/180;return 360*Math.atan(Math.exp(U))/Math.PI-90}function _t(pe,U,j,G){let ie=G;const oe=U+(j-U>>1);let fe,xe=j-U;const ye=pe[U],Le=pe[U+1],Xe=pe[j],Oe=pe[j+1];for(let ct=U+3;ct<j;ct+=3){const _e=ni(pe[ct],pe[ct+1],ye,Le,Xe,Oe);if(_e>ie)fe=ct,ie=_e;else if(_e===ie){const wt=Math.abs(ct-oe);wt<xe&&(fe=ct,xe=wt)}}ie>G&&(fe-U>3&&_t(pe,U,fe,G),pe[fe+2]=ie,j-fe>3&&_t(pe,fe,j,G))}function ni(pe,U,j,G,ie,oe){let fe=ie-j,xe=oe-G;if(fe!==0||xe!==0){const ye=((pe-j)*fe+(U-G)*xe)/(fe*fe+xe*xe);ye>1?(j=ie,G=oe):ye>0&&(j+=fe*ye,G+=xe*ye)}return fe=pe-j,xe=U-G,fe*fe+xe*xe}function he(pe,U,j,G){const ie={id:pe??null,type:U,geometry:j,tags:G,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(U==="Point"||U==="MultiPoint"||U==="LineString")Ne(ie,j);else if(U==="Polygon")Ne(ie,j[0]);else if(U==="MultiLineString")for(const oe of j)Ne(ie,oe);else if(U==="MultiPolygon")for(const oe of j)Ne(ie,oe[0]);return ie}function Ne(pe,U){for(let j=0;j<U.length;j+=3)pe.minX=Math.min(pe.minX,U[j]),pe.minY=Math.min(pe.minY,U[j+1]),pe.maxX=Math.max(pe.maxX,U[j]),pe.maxY=Math.max(pe.maxY,U[j+1])}function at(pe,U,j,G){if(!U.geometry)return;const ie=U.geometry.coordinates;if(ie&&ie.length===0)return;const oe=U.geometry.type,fe=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2);let xe=[],ye=U.id;if(j.promoteId?ye=U.properties[j.promoteId]:j.generateId&&(ye=G||0),oe==="Point")ut(ie,xe);else if(oe==="MultiPoint")for(const Le of ie)ut(Le,xe);else if(oe==="LineString")Mt(ie,xe,fe,!1);else if(oe==="MultiLineString"){if(j.lineMetrics){for(const Le of ie)xe=[],Mt(Le,xe,fe,!1),pe.push(he(ye,"LineString",xe,U.properties));return}Ct(ie,xe,fe,!1)}else if(oe==="Polygon")Ct(ie,xe,fe,!0);else{if(oe!=="MultiPolygon"){if(oe==="GeometryCollection"){for(const Le of U.geometry.geometries)at(pe,{id:ye,geometry:Le,properties:U.properties},j,G);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Le of ie){const Xe=[];Ct(Le,Xe,fe,!0),xe.push(Xe)}}pe.push(he(ye,oe,xe,U.properties))}function ut(pe,U){U.push(Qt(pe[0]),wi(pe[1]),0)}function Mt(pe,U,j,G){let ie,oe,fe=0;for(let ye=0;ye<pe.length;ye++){const Le=Qt(pe[ye][0]),Xe=wi(pe[ye][1]);U.push(Le,Xe,0),ye>0&&(fe+=G?(ie*Xe-Le*oe)/2:Math.sqrt(Math.pow(Le-ie,2)+Math.pow(Xe-oe,2))),ie=Le,oe=Xe}const xe=U.length-3;U[2]=1,_t(U,0,xe,j),U[xe+2]=1,U.size=Math.abs(fe),U.start=0,U.end=U.size}function Ct(pe,U,j,G){for(let ie=0;ie<pe.length;ie++){const oe=[];Mt(pe[ie],oe,j,G),U.push(oe)}}function Qt(pe){return pe/360+.5}function wi(pe){const U=Math.sin(pe*Math.PI/180),j=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return j<0?0:j>1?1:j}function si(pe,U,j,G,ie,oe,fe,xe){if(G/=U,oe>=(j/=U)&&fe<G)return pe;if(fe<j||oe>=G)return null;const ye=[];for(const Le of pe){const Xe=Le.geometry;let Oe=Le.type;const ct=ie===0?Le.minX:Le.minY,_e=ie===0?Le.maxX:Le.maxY;if(ct>=j&&_e<G){ye.push(Le);continue}if(_e<j||ct>=G)continue;let wt=[];if(Oe==="Point"||Oe==="MultiPoint")tr(Xe,wt,j,G,ie);else if(Oe==="LineString")ir(Xe,wt,j,G,ie,!1,xe.lineMetrics);else if(Oe==="MultiLineString")Ni(Xe,wt,j,G,ie,!1);else if(Oe==="Polygon")Ni(Xe,wt,j,G,ie,!0);else if(Oe==="MultiPolygon")for(const Vt of Xe){const pt=[];Ni(Vt,pt,j,G,ie,!0),pt.length&&wt.push(pt)}if(wt.length){if(xe.lineMetrics&&Oe==="LineString"){for(const Vt of wt)ye.push(he(Le.id,Oe,Vt,Le.tags));continue}Oe!=="LineString"&&Oe!=="MultiLineString"||(wt.length===1?(Oe="LineString",wt=wt[0]):Oe="MultiLineString"),Oe!=="Point"&&Oe!=="MultiPoint"||(Oe=wt.length===3?"Point":"MultiPoint"),ye.push(he(Le.id,Oe,wt,Le.tags))}}return ye.length?ye:null}function tr(pe,U,j,G,ie){for(let oe=0;oe<pe.length;oe+=3){const fe=pe[oe+ie];fe>=j&&fe<=G&&zi(U,pe[oe],pe[oe+1],pe[oe+2])}}function ir(pe,U,j,G,ie,oe,fe){let xe=Qn(pe);const ye=ie===0?$a:nr;let Le,Xe,Oe=pe.start;for(let pt=0;pt<pe.length-3;pt+=3){const Ot=pe[pt],Pi=pe[pt+1],nn=pe[pt+2],an=pe[pt+3],jn=pe[pt+4],In=ie===0?Ot:Pi,Di=ie===0?an:jn;let fn=!1;fe&&(Le=Math.sqrt(Math.pow(Ot-an,2)+Math.pow(Pi-jn,2))),In<j?Di>j&&(Xe=ye(xe,Ot,Pi,an,jn,j),fe&&(xe.start=Oe+Le*Xe)):In>G?Di<G&&(Xe=ye(xe,Ot,Pi,an,jn,G),fe&&(xe.start=Oe+Le*Xe)):zi(xe,Ot,Pi,nn),Di<j&&In>=j&&(Xe=ye(xe,Ot,Pi,an,jn,j),fn=!0),Di>G&&In<=G&&(Xe=ye(xe,Ot,Pi,an,jn,G),fn=!0),!oe&&fn&&(fe&&(xe.end=Oe+Le*Xe),U.push(xe),xe=Qn(pe)),fe&&(Oe+=Le)}let ct=pe.length-3;const _e=pe[ct],wt=pe[ct+1],Vt=ie===0?_e:wt;Vt>=j&&Vt<=G&&zi(xe,_e,wt,pe[ct+2]),ct=xe.length-3,oe&&ct>=3&&(xe[ct]!==xe[0]||xe[ct+1]!==xe[1])&&zi(xe,xe[0],xe[1],xe[2]),xe.length&&U.push(xe)}function Qn(pe){const U=[];return U.size=pe.size,U.start=pe.start,U.end=pe.end,U}function Ni(pe,U,j,G,ie,oe){for(const fe of pe)ir(fe,U,j,G,ie,oe,!1)}function zi(pe,U,j,G){pe.push(U,j,G)}function $a(pe,U,j,G,ie,oe){const fe=(oe-U)/(G-U);return zi(pe,oe,j+(ie-j)*fe,1),fe}function nr(pe,U,j,G,ie,oe){const fe=(oe-j)/(ie-j);return zi(pe,U+(G-U)*fe,oe,1),fe}function xo(pe,U){const j=[];for(let G=0;G<pe.length;G++){const ie=pe[G],oe=ie.type;let fe;if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")fe=vr(ie.geometry,U);else if(oe==="MultiLineString"||oe==="Polygon"){fe=[];for(const xe of ie.geometry)fe.push(vr(xe,U))}else if(oe==="MultiPolygon"){fe=[];for(const xe of ie.geometry){const ye=[];for(const Le of xe)ye.push(vr(Le,U));fe.push(ye)}}j.push(he(ie.id,oe,fe,ie.tags))}return j}function vr(pe,U){const j=[];j.size=pe.size,pe.start!==void 0&&(j.start=pe.start,j.end=pe.end);for(let G=0;G<pe.length;G+=3)j.push(pe[G]+U,pe[G+1],pe[G+2]);return j}function ar(pe,U){if(pe.transformed)return pe;const j=1<<pe.z,G=pe.x,ie=pe.y;for(const oe of pe.features){const fe=oe.geometry,xe=oe.type;if(oe.geometry=[],xe===1)for(let ye=0;ye<fe.length;ye+=2)oe.geometry.push(Os(fe[ye],fe[ye+1],U,j,G,ie));else for(let ye=0;ye<fe.length;ye++){const Le=[];for(let Xe=0;Xe<fe[ye].length;Xe+=2)Le.push(Os(fe[ye][Xe],fe[ye][Xe+1],U,j,G,ie));oe.geometry.push(Le)}}return pe.transformed=!0,pe}function Os(pe,U,j,G,ie,oe){return[Math.round(j*(pe*G-ie)),Math.round(j*(U*G-oe))]}function Pr(pe,U,j,G,ie){const oe=U===ie.maxZoom?0:ie.tolerance/((1<<U)*ie.extent),fe={features:[],numPoints:0,numSimplified:0,numFeatures:pe.length,source:null,x:j,y:G,z:U,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const xe of pe)Fs(fe,xe,oe,ie);return fe}function Fs(pe,U,j,G){const ie=U.geometry,oe=U.type,fe=[];if(pe.minX=Math.min(pe.minX,U.minX),pe.minY=Math.min(pe.minY,U.minY),pe.maxX=Math.max(pe.maxX,U.maxX),pe.maxY=Math.max(pe.maxY,U.maxY),oe==="Point"||oe==="MultiPoint")for(let xe=0;xe<ie.length;xe+=3)fe.push(ie[xe],ie[xe+1]),pe.numPoints++,pe.numSimplified++;else if(oe==="LineString")Us(fe,ie,pe,j,!1,!1);else if(oe==="MultiLineString"||oe==="Polygon")for(let xe=0;xe<ie.length;xe++)Us(fe,ie[xe],pe,j,oe==="Polygon",xe===0);else if(oe==="MultiPolygon")for(let xe=0;xe<ie.length;xe++){const ye=ie[xe];for(let Le=0;Le<ye.length;Le++)Us(fe,ye[Le],pe,j,!0,Le===0)}if(fe.length){let xe=U.tags||null;if(oe==="LineString"&&G.lineMetrics){xe={};for(const Le in U.tags)xe[Le]=U.tags[Le];xe.mapbox_clip_start=ie.start/ie.size,xe.mapbox_clip_end=ie.end/ie.size}const ye={geometry:fe,type:oe==="Polygon"||oe==="MultiPolygon"?3:oe==="LineString"||oe==="MultiLineString"?2:1,tags:xe};U.id!==null&&(ye.id=U.id),pe.features.push(ye)}}function Us(pe,U,j,G,ie,oe){const fe=G*G;if(G>0&&U.size<(ie?fe:G))return void(j.numPoints+=U.length/3);const xe=[];for(let ye=0;ye<U.length;ye+=3)(G===0||U[ye+2]>fe)&&(j.numSimplified++,xe.push(U[ye],U[ye+1])),j.numPoints++;ie&&(function(ye,Le){let Xe=0;for(let Oe=0,ct=ye.length,_e=ct-2;Oe<ct;_e=Oe,Oe+=2)Xe+=(ye[Oe]-ye[_e])*(ye[Oe+1]+ye[_e+1]);if(Xe>0===Le)for(let Oe=0,ct=ye.length;Oe<ct/2;Oe+=2){const _e=ye[Oe],wt=ye[Oe+1];ye[Oe]=ye[ct-2-Oe],ye[Oe+1]=ye[ct-1-Oe],ye[ct-2-Oe]=_e,ye[ct-1-Oe]=wt}})(xe,oe),pe.push(xe)}const Un={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class js{constructor(U,j){const G=(j=this.options=(function(oe,fe){for(const xe in fe)oe[xe]=fe[xe];return oe})(Object.create(Un),j)).debug;if(G&&console.time("preprocess data"),j.maxZoom<0||j.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(j.promoteId&&j.generateId)throw new Error("promoteId and generateId cannot be used together.");let ie=(function(oe,fe){const xe=[];if(oe.type==="FeatureCollection")for(let ye=0;ye<oe.features.length;ye++)at(xe,oe.features[ye],fe,ye);else at(xe,oe.type==="Feature"?oe:{geometry:oe},fe);return xe})(U,j);this.tiles={},this.tileCoords=[],G&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",j.indexMaxZoom,j.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ie=(function(oe,fe){const xe=fe.buffer/fe.extent;let ye=oe;const Le=si(oe,1,-1-xe,xe,0,-1,2,fe),Xe=si(oe,1,1-xe,2+xe,0,-1,2,fe);return(Le||Xe)&&(ye=si(oe,1,-xe,1+xe,0,-1,2,fe)||[],Le&&(ye=xo(Le,1).concat(ye)),Xe&&(ye=ye.concat(xo(Xe,-1)))),ye})(ie,j),ie.length&&this.splitTile(ie,0,0,0),G&&(ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(U,j,G,ie,oe,fe,xe){const ye=[U,j,G,ie],Le=this.options,Xe=Le.debug;for(;ye.length;){ie=ye.pop(),G=ye.pop(),j=ye.pop(),U=ye.pop();const Oe=1<<j,ct=ls(j,G,ie);let _e=this.tiles[ct];if(!_e&&(Xe>1&&console.time("creation"),_e=this.tiles[ct]=Pr(U,j,G,ie,Le),this.tileCoords.push({z:j,x:G,y:ie}),Xe)){Xe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",j,G,ie,_e.numFeatures,_e.numPoints,_e.numSimplified),console.timeEnd("creation"));const fn=`z${j}`;this.stats[fn]=(this.stats[fn]||0)+1,this.total++}if(_e.source=U,oe==null){if(j===Le.indexMaxZoom||_e.numPoints<=Le.indexMaxPoints)continue}else{if(j===Le.maxZoom||j===oe)continue;if(oe!=null){const fn=oe-j;if(G!==fe>>fn||ie!==xe>>fn)continue}}if(_e.source=null,U.length===0)continue;Xe>1&&console.time("clipping");const wt=.5*Le.buffer/Le.extent,Vt=.5-wt,pt=.5+wt,Ot=1+wt;let Pi=null,nn=null,an=null,jn=null,In=si(U,Oe,G-wt,G+pt,0,_e.minX,_e.maxX,Le),Di=si(U,Oe,G+Vt,G+Ot,0,_e.minX,_e.maxX,Le);U=null,In&&(Pi=si(In,Oe,ie-wt,ie+pt,1,_e.minY,_e.maxY,Le),nn=si(In,Oe,ie+Vt,ie+Ot,1,_e.minY,_e.maxY,Le),In=null),Di&&(an=si(Di,Oe,ie-wt,ie+pt,1,_e.minY,_e.maxY,Le),jn=si(Di,Oe,ie+Vt,ie+Ot,1,_e.minY,_e.maxY,Le),Di=null),Xe>1&&console.timeEnd("clipping"),ye.push(Pi||[],j+1,2*G,2*ie),ye.push(nn||[],j+1,2*G,2*ie+1),ye.push(an||[],j+1,2*G+1,2*ie),ye.push(jn||[],j+1,2*G+1,2*ie+1)}}getTile(U,j,G){U=+U,j=+j,G=+G;const ie=this.options,{extent:oe,debug:fe}=ie;if(U<0||U>24)return null;const xe=1<<U,ye=ls(U,j=j+xe&xe-1,G);if(this.tiles[ye])return ar(this.tiles[ye],oe);fe>1&&console.log("drilling down to z%d-%d-%d",U,j,G);let Le,Xe=U,Oe=j,ct=G;for(;!Le&&Xe>0;)Xe--,Oe>>=1,ct>>=1,Le=this.tiles[ls(Xe,Oe,ct)];return Le&&Le.source?(fe>1&&(console.log("found parent tile z%d-%d-%d",Xe,Oe,ct),console.time("drilling down")),this.splitTile(Le.source,Xe,Oe,ct,U,j,G),fe>1&&console.timeEnd("drilling down"),this.tiles[ye]?ar(this.tiles[ye],oe):null):null}}function ls(pe,U,j){return 32*((1<<pe)*j+U)+pe}class cs extends Ye{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(U,j){return I._(this,void 0,void 0,(function*(){const G=U.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ie=this._geoJSONIndex.getTile(G.z,G.x,G.y);if(!ie)return null;const oe=new hi(ie.features,{version:2,extent:I.$});let fe=(function(xe){const ye=new I.cM;return(function(Le,Xe){for(const Oe in Le.layers)Xe.writeMessage(3,It,Le.layers[Oe])})(xe,ye),ye.finish()})(oe);return fe.byteOffset===0&&fe.byteLength===fe.buffer.byteLength||(fe=new Uint8Array(fe)),{vectorTile:oe,rawData:fe.buffer}}))}loadData(U){return I._(this,void 0,void 0,(function*(){var j;(j=this._pendingRequest)===null||j===void 0||j.abort();const G=!!(U&&U.request&&U.request.collectResourceTiming)&&new I.cN(U.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(U,this._pendingRequest);const ie=yield this._pendingData;this._geoJSONIndex=U.cluster?new ha((function({superclusterOptions:fe,clusterProperties:xe}){if(!xe||!fe)return fe;const ye={},Le={},Xe={accumulated:null,zoom:0},Oe={properties:null},ct=Object.keys(xe);for(const _e of ct){const[wt,Vt]=xe[_e],pt=I.cT(Vt),Ot=I.cT(typeof wt=="string"?[wt,["accumulated"],["get",_e]]:wt);ye[_e]=pt.value,Le[_e]=Ot.value}return fe.map=_e=>{Oe.properties=_e;const wt={};for(const Vt of ct)wt[Vt]=ye[Vt].evaluate(Xe,Oe);return wt},fe.reduce=(_e,wt)=>{Oe.properties=wt;for(const Vt of ct)Xe.accumulated=_e[Vt],_e[Vt]=Le[Vt].evaluate(Xe,Oe)},fe})(U)).load(ie.features):(function(fe,xe){return new js(fe,xe)})(ie,U.geojsonVtOptions),this.loaded={};const oe={data:ie};if(G){const fe=G.finish();fe&&(oe.resourceTiming={},oe.resourceTiming[U.source]=JSON.parse(JSON.stringify(fe)))}return oe}catch(ie){if(delete this._pendingRequest,I.cy(ie))return{abandoned:!0};throw ie}}))}getData(){return I._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(U){const j=this.loaded;return j&&j[U.uid]?super.reloadTile(U):this.loadTile(U)}loadAndProcessGeoJSON(U,j){return I._(this,void 0,void 0,(function*(){let G=yield this.loadGeoJSON(U,j);if(delete this._pendingRequest,typeof G!="object")throw new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`);if(tn(G,!0),U.filter){const ie=I.cT(U.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ie.result==="error")throw new Error(ie.value.map((fe=>`${fe.key}: ${fe.message}`)).join(", "));G={type:"FeatureCollection",features:G.features.filter((fe=>ie.value.evaluate({zoom:0},fe)))}}return G}))}loadGeoJSON(U,j){return I._(this,void 0,void 0,(function*(){const{promoteId:G}=U;if(U.request){const ie=yield I.j(U.request,j);return this._dataUpdateable=I.cV(ie.data,G)?I.cU(ie.data,G):void 0,ie.data}if(typeof U.data=="string")try{const ie=JSON.parse(U.data);return this._dataUpdateable=I.cV(ie,G)?I.cU(ie,G):void 0,ie}catch{throw new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`)}if(!U.dataDiff)throw new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${U.source}`);return I.cW(this._dataUpdateable,U.dataDiff,G),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(U){return I._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(U){return this._geoJSONIndex.getClusterExpansionZoom(U.clusterId)}getClusterChildren(U){return this._geoJSONIndex.getChildren(U.clusterId)}getClusterLeaves(U){return this._geoJSONIndex.getLeaves(U.clusterId,U.limit,U.offset)}}class us{constructor(U){this.self=U,this.actor=new I.J(U),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(j,G)=>{if(this.externalWorkerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.externalWorkerSourceTypes[j]=G},this.self.addProtocol=I.cA,this.self.removeProtocol=I.cB,this.self.registerRTLTextPlugin=j=>{I.cX.setMethods(j)},this.actor.registerMessageHandler("LDT",((j,G)=>this._getDEMWorkerSource(j,G.source).loadTile(G))),this.actor.registerMessageHandler("RDT",((j,G)=>I._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(j,G.source).removeTile(G)})))),this.actor.registerMessageHandler("GCEZ",((j,G)=>I._(this,void 0,void 0,(function*(){return this._getWorkerSource(j,G.type,G.source).getClusterExpansionZoom(G)})))),this.actor.registerMessageHandler("GCC",((j,G)=>I._(this,void 0,void 0,(function*(){return this._getWorkerSource(j,G.type,G.source).getClusterChildren(G)})))),this.actor.registerMessageHandler("GCL",((j,G)=>I._(this,void 0,void 0,(function*(){return this._getWorkerSource(j,G.type,G.source).getClusterLeaves(G)})))),this.actor.registerMessageHandler("LD",((j,G)=>this._getWorkerSource(j,G.type,G.source).loadData(G))),this.actor.registerMessageHandler("GD",((j,G)=>this._getWorkerSource(j,G.type,G.source).getData())),this.actor.registerMessageHandler("LT",((j,G)=>this._getWorkerSource(j,G.type,G.source).loadTile(G))),this.actor.registerMessageHandler("RT",((j,G)=>this._getWorkerSource(j,G.type,G.source).reloadTile(G))),this.actor.registerMessageHandler("AT",((j,G)=>this._getWorkerSource(j,G.type,G.source).abortTile(G))),this.actor.registerMessageHandler("RMT",((j,G)=>this._getWorkerSource(j,G.type,G.source).removeTile(G))),this.actor.registerMessageHandler("RS",((j,G)=>I._(this,void 0,void 0,(function*(){if(!this.workerSources[j]||!this.workerSources[j][G.type]||!this.workerSources[j][G.type][G.source])return;const ie=this.workerSources[j][G.type][G.source];delete this.workerSources[j][G.type][G.source],ie.removeSource!==void 0&&ie.removeSource(G)})))),this.actor.registerMessageHandler("RM",(j=>I._(this,void 0,void 0,(function*(){delete this.layerIndexes[j],delete this.availableImages[j],delete this.workerSources[j],delete this.demWorkerSources[j],this.globalStates.delete(j)})))),this.actor.registerMessageHandler("SR",((j,G)=>I._(this,void 0,void 0,(function*(){this.referrer=G})))),this.actor.registerMessageHandler("SRPS",((j,G)=>this._syncRTLPluginState(j,G))),this.actor.registerMessageHandler("IS",((j,G)=>I._(this,void 0,void 0,(function*(){this.self.importScripts(G)})))),this.actor.registerMessageHandler("SI",((j,G)=>this._setImages(j,G))),this.actor.registerMessageHandler("UL",((j,G)=>I._(this,void 0,void 0,(function*(){this._getLayerIndex(j).update(G.layers,G.removedIds,this._getGlobalState(j))})))),this.actor.registerMessageHandler("UGS",((j,G)=>I._(this,void 0,void 0,(function*(){const ie=this._getGlobalState(j);for(const oe in G)ie[oe]=G[oe]})))),this.actor.registerMessageHandler("SL",((j,G)=>I._(this,void 0,void 0,(function*(){this._getLayerIndex(j).replace(G,this._getGlobalState(j))}))))}_getGlobalState(U){let j=this.globalStates.get(U);return j||(j={},this.globalStates.set(U,j)),j}_setImages(U,j){return I._(this,void 0,void 0,(function*(){this.availableImages[U]=j;for(const G in this.workerSources[U]){const ie=this.workerSources[U][G];for(const oe in ie)ie[oe].availableImages=j}}))}_syncRTLPluginState(U,j){return I._(this,void 0,void 0,(function*(){return yield I.cX.syncState(j,this.self.importScripts)}))}_getAvailableImages(U){let j=this.availableImages[U];return j||(j=[]),j}_getLayerIndex(U){let j=this.layerIndexes[U];return j||(j=this.layerIndexes[U]=new d),j}_getWorkerSource(U,j,G){if(this.workerSources[U]||(this.workerSources[U]={}),this.workerSources[U][j]||(this.workerSources[U][j]={}),!this.workerSources[U][j][G]){const ie={sendAsync:(oe,fe)=>(oe.targetMapId=U,this.actor.sendAsync(oe,fe))};switch(j){case"vector":this.workerSources[U][j][G]=new Ye(ie,this._getLayerIndex(U),this._getAvailableImages(U));break;case"geojson":this.workerSources[U][j][G]=new cs(ie,this._getLayerIndex(U),this._getAvailableImages(U));break;default:this.workerSources[U][j][G]=new this.externalWorkerSourceTypes[j](ie,this._getLayerIndex(U),this._getAvailableImages(U))}}return this.workerSources[U][j][G]}_getDEMWorkerSource(U,j){return this.demWorkerSources[U]||(this.demWorkerSources[U]={}),this.demWorkerSources[U][j]||(this.demWorkerSources[U][j]=new Ke),this.demWorkerSources[U][j]}}return I.i(self)&&(self.worker=new us(self)),us})),Me("index",["exports","./shared"],(function(I,d){var ze="5.8.0";function Ie(){var m=new d.A(4);return d.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let ot,Ye;const Ke={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(m,e,r){const l=requestAnimationFrame((g=>{h(),e(g)})),{unsubscribe:h}=d.s(m.signal,"abort",(()=>{h(),cancelAnimationFrame(l),r(d.c())}),!1)},frameAsync(m){return new Promise(((e,r)=>{this.frame(m,e,r)}))},getImageData(m,e=0){return this.getImageCanvasContext(m).getImageData(-e,-e,m.width+2*e,m.height+2*e)},getImageCanvasContext(m){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=m.width,e.height=m.height,r.drawImage(m,0,0,m.width,m.height),r},resolveURL:m=>(ot||(ot=document.createElement("a")),ot.href=m,ot.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Ye==null&&(Ye=matchMedia("(prefers-reduced-motion: reduce)")),Ye.matches)}};class be{static testProp(e){if(!be.docStyle)return e[0];for(let r=0;r<e.length;r++)if(e[r]in be.docStyle)return e[r];return e[0]}static create(e,r,l){const h=window.document.createElement(e);return r!==void 0&&(h.className=r),l&&l.appendChild(h),h}static createNS(e,r){return window.document.createElementNS(e,r)}static disableDrag(){be.docStyle&&be.selectProp&&(be.userSelect=be.docStyle[be.selectProp],be.docStyle[be.selectProp]="none")}static enableDrag(){be.docStyle&&be.selectProp&&(be.docStyle[be.selectProp]=be.userSelect)}static setTransform(e,r){e.style[be.transformProp]=r}static addEventListener(e,r,l,h={}){e.addEventListener(r,l,"passive"in h?h:h.capture)}static removeEventListener(e,r,l,h={}){e.removeEventListener(r,l,"passive"in h?h:h.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",be.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",be.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",be.suppressClickInternal,!0)}),0)}static getScale(e){const r=e.getBoundingClientRect();return{x:r.width/e.offsetWidth||1,y:r.height/e.offsetHeight||1,boundingClientRect:r}}static getPoint(e,r,l){const h=r.boundingClientRect;return new d.P((l.clientX-h.left)/r.x-e.clientLeft,(l.clientY-h.top)/r.y-e.clientTop)}static mousePos(e,r){const l=be.getScale(e);return be.getPoint(e,l,r)}static touchPos(e,r){const l=[],h=be.getScale(e);for(let g=0;g<r.length;g++)l.push(be.getPoint(e,h,r[g]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const r=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),l=r.querySelectorAll("script");for(const h of l)h.remove();return be.clean(r),r.innerHTML}static isPossiblyDangerous(e,r){const l=r.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!l.includes("javascript:")&&!l.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const r=e.children;for(const l of r)be.removeAttributes(l),be.clean(l)}static removeAttributes(e){for(const{name:r,value:l}of e.attributes)be.isPossiblyDangerous(r,l)&&e.removeAttribute(r)}}be.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,be.selectProp=be.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),be.transformProp=be.testProp(["transform","WebkitTransform"]);const ci={supported:!1,testSupport:function(m){!dn&&tn&&(hi?It(m):Bt=m)}};let Bt,tn,dn=!1,hi=!1;function It(m){const e=m.createTexture();m.bindTexture(m.TEXTURE_2D,e);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,tn),m.isContextLost())return;ci.supported=!0}catch{}m.deleteTexture(e),dn=!0}var Ci;typeof document<"u"&&(tn=document.createElement("img"),tn.onload=()=>{Bt&&It(Bt),Bt=null,hi=!0},tn.onerror=()=>{dn=!0,Bt=null},tn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(m){let e,r,l,h;m.resetRequestQueue=()=>{e=[],r=0,l=0,h={}},m.addThrottleControl=T=>{const E=l++;return h[E]=T,E},m.removeThrottleControl=T=>{delete h[T],y()},m.getImage=(T,E,A=!0)=>new Promise(((D,P)=>{ci.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),d.e(T,{type:"image"}),e.push({abortController:E,requestParameters:T,supportImageRefresh:A,state:"queued",onError:B=>{P(B)},onSuccess:B=>{D(B)}}),y()}));const g=T=>d._(this,void 0,void 0,(function*(){T.state="running";const{requestParameters:E,supportImageRefresh:A,onError:D,onSuccess:P,abortController:B}=T,N=A===!1&&!d.i(self)&&!d.g(E.url)&&(!E.headers||Object.keys(E.headers).reduce(((Y,Q)=>Y&&Q==="accept"),!0));r++;const $=N?w(E,B):d.m(E,B);try{const Y=yield $;delete T.abortController,T.state="completed",Y.data instanceof HTMLImageElement||d.b(Y.data)?P(Y):Y.data&&P({data:yield(X=Y.data,typeof createImageBitmap=="function"?d.f(X):d.h(X)),cacheControl:Y.cacheControl,expires:Y.expires})}catch(Y){delete T.abortController,D(Y)}finally{r--,y()}var X})),y=()=>{const T=(()=>{for(const E of Object.keys(h))if(h[E]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let E=r;E<T&&e.length>0;E++){const A=e.shift();A.abortController.signal.aborted?E--:g(A)}},w=(T,E)=>new Promise(((A,D)=>{const P=new Image,B=T.url,N=T.credentials;N&&N==="include"?P.crossOrigin="use-credentials":(N&&N==="same-origin"||!d.d(B))&&(P.crossOrigin="anonymous"),E.signal.addEventListener("abort",(()=>{P.src="",D(d.c())})),P.fetchPriority="high",P.onload=()=>{P.onerror=P.onload=null,A({data:P})},P.onerror=()=>{P.onerror=P.onload=null,E.signal.aborted||D(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},P.src=B}))})(Ci||(Ci={})),Ci.resetRequestQueue();class Kn{constructor(e){this._transformRequestFn=e??null}transformRequest(e,r){return this._transformRequestFn&&this._transformRequestFn(e,r)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Ui(m){const e=[];if(typeof m=="string")e.push({id:"default",url:m});else if(m&&m.length>0){const r=[];for(const{id:l,url:h}of m){const g=`${l}${h}`;r.indexOf(g)===-1&&(r.push(g),e.push({id:l,url:h}))}}return e}function Nt(m,e,r){try{const l=new URL(m);return l.pathname+=`${e}${r}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function An(m){const{userImage:e}=m;return!!(e&&e.render&&e.render())&&(m.data.replace(new Uint8Array(e.data.buffer)),!0)}class zn extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:r,promiseResolve:l}of this.requestors)l(this._getImagesForIds(r));this.requestors=[]}}getImage(e){const r=this.images[e];if(r&&!r.data&&r.spriteData){const l=r.spriteData;r.data=new d.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),r.spriteData=null}return r}addImage(e,r){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,r)&&(this.images[e]=r)}_validate(e,r){let l=!0;const h=r.data||r.spriteData;return this._validateStretch(r.stretchX,h&&h.width)||(this.fire(new d.k(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(r.stretchY,h&&h.height)||(this.fire(new d.k(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(r.content,r)||(this.fire(new d.k(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,r){if(!e)return!0;let l=0;for(const h of e){if(h[0]<l||h[1]<h[0]||r<h[1])return!1;l=h[1]}return!0}_validateContent(e,r){if(!e)return!0;if(e.length!==4)return!1;const l=r.spriteData,h=l&&l.width||r.data.width,g=l&&l.height||r.data.height;return!(e[0]<0||h<e[0]||e[1]<0||g<e[1]||e[2]<0||h<e[2]||e[3]<0||g<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,r,l=!0){const h=this.getImage(e);if(l&&(h.data.width!==r.data.width||h.data.height!==r.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=h.version+1,this.images[e]=r,this.updatedImages[e]=!0}removeImage(e){const r=this.images[e];delete this.images[e],delete this.patterns[e],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((r,l)=>{let h=!0;if(!this.isLoaded())for(const g of e)this.images[g]||(h=!1);this.isLoaded()||h?r(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:r})}))}_getImagesForIds(e){const r={};for(const l of e){let h=this.getImage(l);h||(this.fire(new d.l("styleimagemissing",{id:l})),h=this.getImage(l)),h?r[l]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,textFitWidth:h.textFitWidth,textFitHeight:h.textFitHeight,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:d.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){const{width:e,height:r}=this.atlasImage;return{width:e,height:r}}getPattern(e){const r=this.patterns[e],l=this.getImage(e);if(!l)return null;if(r&&r.position.version===l.version)return r.position;if(r)r.position.version=l.version;else{const h={w:l.data.width+2,h:l.data.height+2,x:0,y:0},g=new d.I(h,l);this.patterns[e]={bin:h,position:g}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.T(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const g in this.patterns)e.push(this.patterns[g].bin);const{w:r,h:l}=d.p(e),h=this.atlasImage;h.resize({width:r||1,height:l||1});for(const g in this.patterns){const{bin:y}=this.patterns[g],w=y.x+1,T=y.y+1,E=this.getImage(g).data,A=E.width,D=E.height;d.R.copy(E,h,{x:0,y:0},{x:w,y:T},{width:A,height:D}),d.R.copy(E,h,{x:0,y:D-1},{x:w,y:T-1},{width:A,height:1}),d.R.copy(E,h,{x:0,y:0},{x:w,y:T+D},{width:A,height:1}),d.R.copy(E,h,{x:A-1,y:0},{x:w-1,y:T},{width:1,height:D}),d.R.copy(E,h,{x:0,y:0},{x:w+A,y:T},{width:1,height:D})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const r of e){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const l=this.getImage(r);l||d.w(`Image with ID: "${r}" was not found`),An(l)&&this.updateImage(r,l)}}}const Pn=1e20;function gi(m,e,r,l,h,g,y,w,T){for(let E=e;E<e+l;E++)ji(m,r*g+E,g,h,y,w,T);for(let E=r;E<r+h;E++)ji(m,E*g+e,1,l,y,w,T)}function ji(m,e,r,l,h,g,y){g[0]=0,y[0]=-Pn,y[1]=Pn,h[0]=m[e];for(let w=1,T=0,E=0;w<l;w++){h[w]=m[e+w*r];const A=w*w;do{const D=g[T];E=(h[w]-h[D]+A-D*D)/(w-D)/2}while(E<=y[T]&&--T>-1);T++,g[T]=w,y[T]=E,y[T+1]=Pn}for(let w=0,T=0;w<l;w++){for(;y[T+1]<w;)T++;const E=g[T],A=w-E;m[e+w*r]=h[E]+A*A}}class ha{constructor(e,r,l){this.requestManager=e,this.localIdeographFontFamily=r,this.entries={},this.lang=l}setURL(e){this.url=e}getGlyphs(e){return d._(this,void 0,void 0,(function*(){const r=[];for(const g in e)for(const y of e[g])r.push(this._getAndCacheGlyphsPromise(g,y));const l=yield Promise.all(r),h={};for(const{stack:g,id:y,glyph:w}of l)h[g]||(h[g]={}),h[g][y]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return h}))}_getAndCacheGlyphsPromise(e,r){return d._(this,void 0,void 0,(function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let h=l.glyphs[r];if(h!==void 0)return{stack:e,id:r,glyph:h};if(h=this._tinySDF(l,e,r),h)return l.glyphs[r]=h,{stack:e,id:r,glyph:h};const g=Math.floor(r/256);if(256*g>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[g])return{stack:e,id:r,glyph:h};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[g]){const w=ha.loadGlyphRange(e,g,this.url,this.requestManager);l.requests[g]=w}const y=yield l.requests[g];for(const w in y)this._doesCharSupportLocalGlyph(+w)||(l.glyphs[+w]=y[+w]);return l.ranges[g]=!0,{stack:e,id:r,glyph:y[r]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||d.u["CJK Unified Ideographs"](e)||d.u["Hangul Syllables"](e)||d.u.Hiragana(e)||d.u.Katakana(e)||d.u["CJK Symbols and Punctuation"](e)||d.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,r,l){const h=this.localIdeographFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let g=e.tinySDF;if(!g){let w="400";/bold/i.test(r)?w="900":/medium/i.test(r)?w="500":/light/i.test(r)&&(w="200"),g=e.tinySDF=new ha.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,lang:this.lang,fontFamily:h,fontWeight:w})}const y=g.draw(String.fromCharCode(l));return{id:l,bitmap:new d.q({width:y.width||60,height:y.height||60},y.data),metrics:{width:y.glyphWidth/2||24,height:y.glyphHeight/2||24,left:y.glyphLeft/2+.5||0,top:y.glyphTop/2-27.5||-8,advance:y.glyphAdvance/2||24,isDoubleResolution:!0}}}}ha.loadGlyphRange=function(m,e,r,l){return d._(this,void 0,void 0,(function*(){const h=256*e,g=h+255,y=l.transformRequest(r.replace("{fontstack}",m).replace("{range}",`${h}-${g}`),"Glyphs"),w=yield d.n(y,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${h}-${g}`);const T={};for(const E of d.o(w.data))T[E.id]=E;return T}))},ha.TinySDF=class{constructor({fontSize:m=24,buffer:e=3,radius:r=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:g="normal",fontStyle:y="normal",lang:w=null}={}){this.buffer=e,this.cutoff=l,this.radius=r,this.lang=w;const T=this.size=m+4*e,E=this._createCanvas(T),A=this.ctx=E.getContext("2d",{willReadFrequently:!0});A.font=`${y} ${g} ${m}px ${h}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(m){const e=document.createElement("canvas");return e.width=e.height=m,e}draw(m){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:g}=this.ctx.measureText(m),y=Math.ceil(r),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-h))),T=Math.min(this.size-this.buffer,y+Math.ceil(l)),E=w+2*this.buffer,A=T+2*this.buffer,D=Math.max(E*A,0),P=new Uint8ClampedArray(D),B={data:P,width:E,height:A,glyphWidth:w,glyphHeight:T,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(w===0||T===0)return B;const{ctx:N,buffer:$,gridInner:X,gridOuter:Y}=this;this.lang&&(N.lang=this.lang),N.clearRect($,$,w,T),N.fillText(m,$,$+y);const Q=N.getImageData($,$,w,T);Y.fill(Pn,0,D),X.fill(0,0,D);for(let ee=0;ee<T;ee++)for(let J=0;J<w;J++){const se=Q.data[4*(ee*w+J)+3]/255;if(se===0)continue;const ue=(ee+$)*E+J+$;if(se===1)Y[ue]=0,X[ue]=Pn;else{const te=.5-se;Y[ue]=te>0?te*te:0,X[ue]=te<0?te*te:0}}gi(Y,0,0,E,A,E,this.f,this.v,this.z),gi(X,$,$,w,T,E,this.f,this.v,this.z);for(let ee=0;ee<D;ee++){const J=Math.sqrt(Y[ee])-Math.sqrt(X[ee]);P[ee]=Math.round(255-255*(J/this.radius+this.cutoff))}return B}};class ba{constructor(){this.specification=d.v.light.position}possiblyEvaluate(e,r){return d.B(e.expression.evaluate(r))}interpolate(e,r,l){return{x:d.C.number(e.x,r.x,l),y:d.C.number(e.y,r.y,l),z:d.C.number(e.z,r.z,l)}}}let Dn;class Be extends d.E{constructor(e){super(),Dn=Dn||new d.r({anchor:new d.D(d.v.light.anchor),position:new ba,color:new d.D(d.v.light.color),intensity:new d.D(d.v.light.intensity)}),this._transitionable=new d.t(Dn,void 0),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,r={}){if(!this._validate(d.x,e,r))for(const l in e){const h=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),h):this._transitionable.setValue(l,h)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,l){return(!l||l.validate!==!1)&&d.y(this,e.call(d.z,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:d.v}))}}const rt=new d.r({"sky-color":new d.D(d.v.sky["sky-color"]),"horizon-color":new d.D(d.v.sky["horizon-color"]),"fog-color":new d.D(d.v.sky["fog-color"]),"fog-ground-blend":new d.D(d.v.sky["fog-ground-blend"]),"horizon-fog-blend":new d.D(d.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new d.D(d.v.sky["sky-horizon-blend"]),"atmosphere-blend":new d.D(d.v.sky["atmosphere-blend"])});class St extends d.E{constructor(e){super(),this._transitionable=new d.t(rt,void 0),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.F(0))}setSky(e,r={}){if(!this._validate(d.G,e,r)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const h=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),h):this._transitionable.setValue(l,h)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,l={}){return l?.validate!==!1&&d.y(this,e.call(d.z,d.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:d.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class _t{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,r){const l=e.join(",")+String(r);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,r)),this.dashEntry[l]}getDashRanges(e,r,l){const h=[];let g=e.length%2==1?-e[e.length-1]*l:0,y=e[0]*l,w=!0;h.push({left:g,right:y,isDash:w,zeroLength:e[0]===0});let T=e[0];for(let E=1;E<e.length;E++){w=!w;const A=e[E];g=T*l,T+=A,y=T*l,h.push({left:g,right:y,isDash:w,zeroLength:A===0})}return h}addRoundDash(e,r,l){const h=r/2;for(let g=-l;g<=l;g++){const y=this.width*(this.nextRow+l+g);let w=0,T=e[w];for(let E=0;E<this.width;E++){E/T.right>1&&(T=e[++w]);const A=Math.abs(E-T.left),D=Math.abs(E-T.right),P=Math.min(A,D);let B;const N=g/l*(h+1);if(T.isDash){const $=h-Math.abs(N);B=Math.sqrt(P*P+$*$)}else B=h-Math.sqrt(P*P+N*N);this.data[y+E]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){const T=e[w],E=e[w+1];T.zeroLength?e.splice(w,1):E&&E.isDash===T.isDash&&(E.left=T.left,e.splice(w,1))}const r=e[0],l=e[e.length-1];r.isDash===l.isDash&&(r.left=l.left-this.width,l.right=r.right+this.width);const h=this.width*this.nextRow;let g=0,y=e[g];for(let w=0;w<this.width;w++){w/y.right>1&&(y=e[++g]);const T=Math.abs(w-y.left),E=Math.abs(w-y.right),A=Math.min(T,E);this.data[h+w]=Math.max(0,Math.min(255,(y.isDash?A:-A)+128))}}addDash(e,r){const l=r?7:0,h=2*l+1;if(this.nextRow+h>this.height)return d.w("LineAtlas out of space"),null;let g=0;for(let w=0;w<e.length;w++)g+=e[w];if(g!==0){const w=this.width/g,T=this.getDashRanges(e,this.width,w);r?this.addRoundDash(T,w,l):this.addRegularDash(T)}const y={y:this.nextRow+l,height:2*l,width:g};return this.nextRow+=h,this.dirty=!0,y}bind(e){const r=e.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}const ni="maplibre_preloaded_worker_pool";class he{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<he.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((r=>{r.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[ni]}numActive(){return Object.keys(this.active).length}}const Ne=Math.floor(Ke.hardwareConcurrency/2);let at,ut;function Mt(){return at||(at=new he),at}he.workerCount=d.H(globalThis)?Math.max(Math.min(Ne,3),1):1;class Ct{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=r;const l=this.workerPool.acquire(r);for(let h=0;h<l.length;h++){const g=new d.J(l[h],r);g.name=`Worker ${h}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,r){const l=[];for(const h of this.actors)l.push(h.sendAsync({type:e,data:r}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((r=>{r.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,r){for(const l of this.actors)l.registerMessageHandler(e,r)}}function Qt(){return ut||(ut=new Ct(Mt(),d.K),ut.registerMessageHandler("GR",((m,e,r)=>d.m(e,r)))),ut}function wi(m,e){const r=d.L();return d.M(r,r,[1,1,0]),d.N(r,r,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?d.O(r,r,m.calculatePosMatrix(e.toUnwrapped())):r}function si(m,e,r,l,h,g,y){var w;const T=(function(P,B,N){if(P)for(const $ of P){const X=B[$];if(X&&X.source===N&&X.type==="fill-extrusion")return!0}else for(const $ in B){const X=B[$];if(X.source===N&&X.type==="fill-extrusion")return!0}return!1})((w=h?.layers)!==null&&w!==void 0?w:null,e,m.id),E=g.maxPitchScaleFactor(),A=m.tilesIn(l,E,T);A.sort(tr);const D=[];for(const P of A)D.push({wrappedTileID:P.tileID.wrapped().key,queryResults:P.tile.queryRenderedFeatures(e,r,m._state,P.queryGeometry,P.cameraQueryGeometry,P.scale,h,g,E,wi(m.transform,P.tileID),y?(B,N)=>y(P.tileID,B,N):void 0)});return(function(P,B){for(const N in P)for(const $ of P[N])ir($,B);return P})((function(P){const B={},N={};for(const $ of P){const X=$.queryResults,Y=$.wrappedTileID,Q=N[Y]=N[Y]||{};for(const ee in X){const J=X[ee],se=Q[ee]=Q[ee]||{},ue=B[ee]=B[ee]||[];for(const te of J)se[te.featureIndex]||(se[te.featureIndex]=!0,ue.push(te))}}return B})(D),m)}function tr(m,e){const r=m.tileID,l=e.tileID;return r.overscaledZ-l.overscaledZ||r.canonical.y-l.canonical.y||r.wrap-l.wrap||r.canonical.x-l.canonical.x}function ir(m,e){const r=m.feature,l=e.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=l}function Qn(m,e,r){return d._(this,void 0,void 0,(function*(){let l=m;if(m.url?l=(yield d.j(e.transformRequest(m.url,"Source"),r)).data:yield Ke.frameAsync(r),!l)return null;const h=d.Q(d.e(l,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(h.vectorLayerIds=l.vector_layers.map((g=>g.id))),h}))}class Ni{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof d.S?new d.S(e.lng,e.lat):d.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof d.S?new d.S(e.lng,e.lat):d.S.convert(e),this}extend(e){const r=this._sw,l=this._ne;let h,g;if(e instanceof d.S)h=e,g=e;else{if(!(e instanceof Ni))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ni.convert(e)):this.extend(d.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(d.S.convert(e)):this;if(h=e._sw,g=e._ne,!h||!g)return this}return r||l?(r.lng=Math.min(h.lng,r.lng),r.lat=Math.min(h.lat,r.lat),l.lng=Math.max(g.lng,l.lng),l.lat=Math.max(g.lat,l.lat)):(this._sw=new d.S(h.lng,h.lat),this._ne=new d.S(g.lng,g.lat)),this}getCenter(){return new d.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.S(this.getWest(),this.getNorth())}getSouthEast(){return new d.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:l}=d.S.convert(e);let h=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(e){return e instanceof Ni?e:e&&new Ni(e)}static fromLngLat(e,r=0){const l=360*r/40075017,h=l/Math.cos(Math.PI/180*e.lat);return new Ni(new d.S(e.lng-h,e.lat-l),new d.S(e.lng+h,e.lat+l))}adjustAntiMeridian(){const e=new d.S(this._sw.lng,this._sw.lat),r=new d.S(this._ne.lng,this._ne.lat);return new Ni(e,e.lng>r.lng?new d.S(r.lng+360,r.lat):r)}}class zi{constructor(e,r,l){this.bounds=Ni.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const r=Math.pow(2,e.z),l=Math.floor(d.V(this.bounds.getWest())*r),h=Math.floor(d.U(this.bounds.getNorth())*r),g=Math.ceil(d.V(this.bounds.getEast())*r),y=Math.ceil(d.U(this.bounds.getSouth())*r);return e.x>=l&&e.x<g&&e.y>=h&&e.y<y}}class $a extends d.E{constructor(e,r,l,h){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.Q(r,["url","scheme","tileSize","promoteId"])),this._options=d.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}load(){return d._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Qn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(d.e(this,e),e.bounds&&(this.tileBounds=new zi(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this._loaded=!0,this.fire(new d.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(e){return d._(this,void 0,void 0,(function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(r,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};l.request.collectResourceTiming=this._collectResourceTiming;let h="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((g,y)=>{e.reloadPromise={resolve:g,reject:y}}))}else e.actor=this.dispatcher.getActor(),h="LT";e.abortController=new AbortController;try{const g=yield e.actor.sendAsync({type:h,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,g)}catch(g){if(delete e.abortController,e.aborted)return;if(g&&g.status!==404)throw g;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,r){if(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return d._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return d._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class nr extends d.E{constructor(e,r,l,h){super(),this.id=e,this.dispatcher=l,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},r),d.e(this,d.Q(r,["url","scheme","tileSize"]))}load(){return d._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield Qn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(d.e(this,r),r.bounds&&(this.tileBounds=new zi(r.bounds,this.minzoom,this.maxzoom)),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(r){this._tileJSONRequest=null,this._loaded=!0,this.fire(new d.k(r))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return d.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return d._(this,void 0,void 0,(function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield Ci.getImage(this.map._requestManager.transformRequest(r,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const h=this.map.painter.context,g=h.gl,y=l.data;e.texture=this.map.painter.getTileTexture(y.width),e.texture?e.texture.update(y,{useMipmap:!0}):(e.texture=new d.T(h,y,g.RGBA,{useMipmap:!0}),e.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}}))}abortTile(e){return d._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return d._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class xo extends nr{constructor(e,r,l,h){super(e,r,l,h),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(e){return d._(this,void 0,void 0,(function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(r,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const h=yield Ci.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(h&&h.data){const g=h.data;this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&e.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const y=d.b(g)&&d.W()?g:yield this.readImageNow(g),w={type:this.type,uid:e.uid,source:this.id,rawImageData:y,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const T=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=T,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(h){if(delete e.abortController,e.aborted)e.state="unloaded";else if(h)throw e.state="errored",h}}))}readImageNow(e){return d._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&d.X()){const r=e.width+2,l=e.height+2;try{return new d.R({width:r,height:l},yield d.Y(e,-1,-1,r,l))}catch{}}return Ke.getImageData(e,1)}))}_getNeighboringTiles(e){const r=e.canonical,l=Math.pow(2,r.z),h=(r.x-1+l)%l,g=r.x===0?e.wrap-1:e.wrap,y=(r.x+1+l)%l,w=r.x+1===l?e.wrap+1:e.wrap,T={};return T[new d.Z(e.overscaledZ,g,r.z,h,r.y).key]={backfilled:!1},T[new d.Z(e.overscaledZ,w,r.z,y,r.y).key]={backfilled:!1},r.y>0&&(T[new d.Z(e.overscaledZ,g,r.z,h,r.y-1).key]={backfilled:!1},T[new d.Z(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},T[new d.Z(e.overscaledZ,w,r.z,y,r.y-1).key]={backfilled:!1}),r.y+1<l&&(T[new d.Z(e.overscaledZ,g,r.z,h,r.y+1).key]={backfilled:!1},T[new d.Z(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},T[new d.Z(e.overscaledZ,w,r.z,y,r.y+1).key]={backfilled:!1}),T}unloadTile(e){return d._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class vr extends d.E{constructor(e,r,l,h){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:r.data},this.actor=l.getActor(),this.setEventedParent(h),this._data=r.data,this._options=d.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId,r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&d.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=d.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(r.buffer!==void 0?r.buffer:128),tolerance:this._pixelsToTileUnits(r.tolerance!==void 0?r.tolerance:.375),extent:d.$,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(r.clusterMaxZoom),minPoints:Math.max(2,r.clusterMinPoints||2),extent:d.$,radius:this._pixelsToTileUnits(r.clusterRadius||50),log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(d.$/this.tileSize)}_getClusterMaxZoom(e){const r=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||d.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${r}"`),r}load(){return d._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._pendingWorkerUpdate={data:e},this._updateWorkerData(),this}updateData(e){return this._pendingWorkerUpdate.diff=d.a0(this._pendingWorkerUpdate.diff,e),this._updateWorkerData(),this}getData(){return d._(this,void 0,void 0,(function*(){const e=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map((r=>r.coordinates)).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return d._(this,void 0,void 0,(function*(){const e=new Ni,r=yield this.getData();let l;switch(r.type){case"FeatureCollection":l=r.features.map((h=>this.getCoordinatesFromGeometry(h.geometry))).flat(1/0);break;case"Feature":l=this.getCoordinatesFromGeometry(r.geometry);break;default:l=this.getCoordinatesFromGeometry(r)}if(l.length==0)return e;for(let h=0;h<l.length-1;h+=2)e.extend([l[h],l[h+1]]);return e}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,r,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:r,offset:l}})}_updateWorkerData(){return d._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;const{data:e,diff:r}=this._pendingWorkerUpdate;if(!e&&!r)return void d.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const l=d.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(l.request=this.map._requestManager.transformRequest(Ke.resolveURL(e),"Source"),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(e),this._pendingWorkerUpdate.data=void 0):r&&(l.dataDiff=r,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new d.l("dataloading",{dataType:"source"}));try{const h=yield this.actor.sendAsync({type:"LD",data:l});if(this._isUpdatingWorker=!1,this._removed||h.abandoned)return void this.fire(new d.l("dataabort",{dataType:"source"}));this._data=h.data;let g=null;h.resourceTiming&&h.resourceTiming[this.id]&&(g=h.resourceTiming[this.id].slice(0));const y={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&d.e(y,{resourceTiming:g}),this.fire(new d.l("data",Object.assign(Object.assign({},y),{sourceDataType:"metadata"}))),this.fire(new d.l("data",Object.assign(Object.assign({},y),{sourceDataType:"content"})))}catch(h){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new d.l("dataabort",{dataType:"source"}));this.fire(new d.k(h))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(e){return d._(this,void 0,void 0,(function*(){const r=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const h=yield this.actor.sendAsync({type:r,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(h,this.map.painter,r==="RT")}))}abortTile(e){return d._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return d._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class ar extends d.E{constructor(e,r,l,h){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=l,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=r}load(e){return d._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const r=yield Ci.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,e&&(this.coordinates=e),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,this.fire(new d.k(r))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const r=e.map(d.a1.fromLngLat);var l;return this.tileID=(function(h){const g=d.a2.fromPoints(h),y=g.width(),w=g.height(),T=Math.max(y,w),E=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),A=Math.pow(2,E);return new d.a4(E,Math.floor((g.minX+g.maxX)/2*A),Math.floor((g.minY+g.maxY)/2*A))})(r),this.terrainTileRanges=this._getOverlappingTileRanges(r),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=r.map((h=>this.tileID.getTilePoint(h)._round())),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new d.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,r=e.gl;this.texture||(this.texture=new d.T(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const g=this.tiles[h];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,l=!0)}l&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return d._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:r,minY:l,maxX:h,maxY:g}=d.a2.fromPoints(e),y={};for(let w=0;w<=d.a3;w++){const T=Math.pow(2,w),E=Math.floor(r*T),A=Math.floor(l*T),D=Math.floor(h*T),P=Math.floor(g*T);y[w]={minTileX:E,minTileY:A,maxTileX:D,maxTileY:P}}return y}}class Os extends ar{constructor(e,r,l,h){super(e,r,l,h),this.roundZoom=!0,this.type="video",this.options=r}load(){return d._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const r of e.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{const r=yield d.a5(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new d.k(r))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new d.k(new d.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,r=e.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new d.T(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const g=this.tiles[h];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,l=!0)}l&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Pr extends ar{constructor(e,r,l,h){super(e,r,l,h),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some((g=>!Array.isArray(g)||g.length!==2||g.some((y=>typeof y!="number"))))||this.fire(new d.k(new d.a6(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.k(new d.a6(`sources.${e}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new d.k(new d.a6(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new d.k(new d.a6(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.k(new d.a6(`sources.${e}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return d._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,l=r.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.T(r,this.canvas,l.RGBA,{premultiply:!0});let h=!1;for(const g in this.tiles){const y=this.tiles[g];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,h=!0)}h&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Fs={},Us=m=>{switch(m){case"geojson":return vr;case"image":return ar;case"raster":return nr;case"raster-dem":return xo;case"vector":return $a;case"video":return Os;case"canvas":return Pr}return Fs[m]},Un="RTLPluginLoaded";class js extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Qt()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((r=>{throw this.status="error",r}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return d._(this,arguments,void 0,(function*(r,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Ke.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return d._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.l(Un))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ls=null;function cs(){return ls||(ls=new js),ls}class us{constructor(e,r){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=d.a7(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const r=e+this.timeAdded;r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,r,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(h,g){const y={};if(!g)return y;for(const w of h){const T=w.layerIds.map((E=>g.getLayer(E))).filter(Boolean);if(T.length!==0){w.layers=T,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map((E=>T.filter((A=>A.id===E))[0])));for(const E of T)y[E.id]=w}}return y})(e.buckets,r?.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const g=this.buckets[h];if(g instanceof d.a9){if(this.hasSymbolBuckets=!0,!l)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const g=this.buckets[h];if(g instanceof d.a9&&g.hasRTLText){this.hasRTLText=!0,cs().lazyLoad();break}}this.queryPadding=0;for(const h in this.buckets){const g=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(h).queryRadius(g))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),this.dashPositions=e.dashPositions}else this.collisionBoxArray=new d.a8}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new d.T(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new d.T(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,l,h,g,y,w,T,E,A,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:g,scale:y,tileSize:this.tileSize,pixelPosMatrix:A,transform:T,params:w,queryPadding:this.queryPadding*E,getElevation:D},e,r,l):{}}querySourceFeatures(e,r){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),g=r&&r.sourceLayer?r.sourceLayer:"",y=h._geojsonTileLayer||h[g];if(!y)return;const w=d.aa(r?.filter,r?.globalState),{z:T,x:E,y:A}=this.tileID.canonical,D={z:T,x:E,y:A};for(let P=0;P<y.length;P++){const B=y.feature(P);if(w.needGeometry){const X=d.ab(B,!0);if(!w.filter(new d.F(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!w.filter(new d.F(this.tileID.overscaledZ),B))continue;const N=l.getId(B,g),$=new d.ac(B,T,E,A,N);$.tile=D,e.push($)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const l=d.ad(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(r)if(this.expirationTime<r)h=!0;else{const g=this.expirationTime-r;g?this.expirationTime=l+Math.max(g,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!r.style.hasLayer(h))continue;const g=this.buckets[h],y=g.layers[0].sourceLayer||"_geojsonTileLayer",w=l[y],T=e[y];if(!w||!T||Object.keys(T).length===0)continue;g.update(T,w,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const E=r&&r.style&&r.style.getLayer(h);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ke.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Ke.now()+e}setDependencies(e,r){const l={};for(const h of r)l[h]=!0;this.dependencies[e]=l}hasDependency(e,r){for(const l of e){const h=this.dependencies[l];if(h){for(const g of r)if(h[g])return!0}}return!1}}class pe{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,l){const h=e.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const g={value:r,timeout:void 0};if(l!==void 0&&(g.timeout=setTimeout((()=>{this.remove(e,g)}),l)),this.data[h].push(g),this.order.push(h),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const l=e.wrapped().key,h=r===void 0?0:this.data[l].indexOf(r),g=this.data[l][h];return this.data[l].splice(h,1),g.timeout&&clearTimeout(g.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(g.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const l in this.data)for(const h of this.data[l])e(h.value)||r.push(h);for(const l of r)this.remove(l.value.tileID,l)}}class U{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,l){const h=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},d.e(this.stateChanges[e][h],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const g in this.state[e])g!==h&&(this.deletedStates[e][g]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][h]===null){this.deletedStates[e][h]={};for(const g in this.state[e][h])l[g]||(this.deletedStates[e][h][g]=null)}else for(const g in l)this.deletedStates[e]&&this.deletedStates[e][h]&&this.deletedStates[e][h][g]===null&&delete this.deletedStates[e][h][g]}removeFeatureState(e,r,l){if(this.deletedStates[e]===null)return;const h=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&r!==void 0)this.deletedStates[e][h]!==null&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][l]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][h])for(l in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][l]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,r){const l=String(r),h=d.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const g=this.deletedStates[e][r];if(g===null)return{};for(const y in g)delete h[y]}return h}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const g={};for(const y in this.stateChanges[h])this.state[h][y]||(this.state[h][y]={}),d.e(this.state[h][y],this.stateChanges[h][y]),g[y]=this.state[h][y];l[h]=g}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const g={};if(this.deletedStates[h]===null)for(const y in this.state[h])g[y]={},this.state[h][y]={};else for(const y in this.deletedStates[h]){if(this.deletedStates[h][y]===null)this.state[h][y]={};else for(const w of Object.keys(this.deletedStates[h][y]))delete this.state[h][y][w];g[y]=this.state[h][y]}l[h]=l[h]||{},d.e(l[h],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const h in e)e[h].setFeatureState(l,r)}}const j=89.25;function G(m,e){const r=d.ah(e.lat,-d.ai,d.ai);return new d.P(d.V(e.lng)*m,d.U(r)*m)}function ie(m,e){return new d.a1(e.x/m,e.y/m).toLngLat()}function oe(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(d.ae(90-m.pitch)),Math.tan(d.ae(j-m.pitch)))}function fe(m,e){const r=m.canonical,l=e/d.af(r.z),h=r.x+Math.pow(2,r.z)*m.wrap,g=d.ag(new Float64Array(16));return d.M(g,g,[h*l,r.y*l,0]),d.N(g,g,[l/d.$,l/d.$,1]),g}function xe(m,e,r,l,h){const g=d.a1.fromLngLat(m,e),y=h*d.aj(1,m.lat),w=y*Math.cos(d.ae(r)),T=Math.sqrt(y*y-w*w),E=T*Math.sin(d.ae(-l)),A=T*Math.cos(d.ae(-l));return new d.a1(g.x+E,g.y+A,g.z+w)}function ye(m,e,r){const l=e.intersectsFrustum(m);if(!r||l===0)return l;const h=e.intersectsPlane(r);return h===0?0:l===2&&h===2?2:1}function Le(m,e,r){let l=0;const h=(r-e)/10;for(let g=0;g<10;g++)l+=h*Math.pow(Math.cos(e+(g+.5)/10*(r-e)),m);return l}function Xe(m,e){return function(r,l,h,g,y){const w=2*((m-1)/d.ak(Math.cos(d.ae(j-y))/Math.cos(d.ae(j)))-1),T=Math.acos(h/g),E=2*Le(w-1,0,d.ae(y/2)),A=Math.min(d.ae(j),T+d.ae(y/2)),D=Le(w-1,Math.min(A,T-d.ae(y/2)),A),P=Math.atan(l/h),B=Math.hypot(l,h);let N=r;return N+=d.ak(g/B/Math.max(.5,Math.cos(d.ae(y/2)))),N+=w*d.ak(Math.cos(P))/2,N-=d.ak(Math.max(1,D/E/e))/2,N}}const Oe=Xe(9.314,3);function ct(m,e){const r=(e.roundZoom?Math.round:Math.floor)(m.zoom+d.ak(m.tileSize/e.tileSize));return Math.max(0,r)}function _e(m,e){const r=m.getCameraFrustum(),l=m.getClippingPlane(),h=m.screenPointToMercatorCoordinate(m.getCameraPoint()),g=d.a1.fromLngLat(m.center,m.elevation);h.z=g.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;const y=m.getCoveringTilesDetailsProvider(),w=y.allowVariableZoom(m,e),T=ct(m,e),E=e.minzoom||0,A=e.maxzoom!==void 0?e.maxzoom:m.maxZoom,D=Math.min(Math.max(0,T),A),P=Math.pow(2,D),B=[P*h.x,P*h.y,0],N=[P*g.x,P*g.y,0],$=Math.hypot(g.x-h.x,g.y-h.y),X=Math.abs(g.z-h.z),Y=Math.hypot($,X),Q=se=>({zoom:0,x:0,y:0,wrap:se,fullyVisible:!1}),ee=[],J=[];if(m.renderWorldCopies&&y.allowWorldCopies())for(let se=1;se<=3;se++)ee.push(Q(-se)),ee.push(Q(se));for(ee.push(Q(0));ee.length>0;){const se=ee.pop(),ue=se.x,te=se.y;let de=se.fullyVisible;const Ce={x:ue,y:te,z:se.zoom},Te=y.getTileBoundingVolume(Ce,se.wrap,m.elevation,e);if(!de){const Qe=ye(r,Te,l);if(Qe===0)continue;de=Qe===2}const Se=y.distanceToTile2d(h.x,h.y,Ce,Te);let Ee=T;w&&(Ee=(e.calculateTileZoom||Oe)(m.zoom+d.ak(m.tileSize/e.tileSize),Se,X,Y,m.fov)),Ee=(e.roundZoom?Math.round:Math.floor)(Ee),Ee=Math.max(0,Ee);const We=Math.min(Ee,A);if(se.wrap=y.getWrap(g,Ce,se.wrap),se.zoom>=We){if(se.zoom<E)continue;const Qe=D-se.zoom,Ve=B[0]-.5-(ue<<Qe),lt=B[1]-.5-(te<<Qe),Lt=e.reparseOverscaled?Math.max(se.zoom,Ee):se.zoom;J.push({tileID:new d.Z(se.zoom===A?Lt:se.zoom,se.wrap,se.zoom,ue,te),distanceSq:d.al([N[0]-.5-ue,N[1]-.5-te]),tileDistanceToCamera:Math.sqrt(Ve*Ve+lt*lt)})}else for(let Qe=0;Qe<4;Qe++)ee.push({zoom:se.zoom+1,x:(ue<<1)+Qe%2,y:(te<<1)+(Qe>>1),wrap:se.wrap,fullyVisible:de})}return J.sort(((se,ue)=>se.distanceSq-ue.distanceSq)).map((se=>se.tileID))}const wt=d.a2.fromPoints([new d.P(0,0),new d.P(d.$,d.$)]);class Vt extends d.E{constructor(e,r,l){super(),this.id=e,this.dispatcher=l,this.on("data",(h=>this._dataHandler(h))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((h,g,y,w)=>{const T=new(Us(g.type))(h,g,y,w);if(T.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${T.id}`);return T})(e,r,l,this),this._tiles={},this._cache=new pe(0,(h=>this._unloadTile(h))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new U,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,r,l){return d._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,r,l)}catch(h){e.state="errored",h.status!==404?this._source.fire(new d.k(h,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new d.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const l=this._tiles[r];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(pt).map((e=>e.key))}getRenderableIds(e){const r=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&r.push(this._tiles[l]);return e?r.sort(((l,h)=>{const g=l.tileID,y=h.tileID,w=new d.P(g.canonical.x,g.canonical.y)._rotate(-this.transform.bearingInRadians),T=new d.P(y.canonical.x,y.canonical.y)._rotate(-this.transform.bearingInRadians);return g.overscaledZ-y.overscaledZ||T.y-w.y||T.x-w.x})).map((l=>l.tileID.key)):r.map((l=>l.tileID)).sort(pt).map((l=>l.key))}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)e?this._reloadTile(r,"expired"):this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(e,r){return d._(this,void 0,void 0,(function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=r),yield this._loadTile(l,e,r))}))}_tileLoaded(e,r,l){e.timeAdded=Ke.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new d.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const r=this.getRenderableIds();for(let h=0;h<r.length;h++){const g=r[h];if(e.neighboringTiles&&e.neighboringTiles[g]){const y=this.getTileByID(g);l(e,y),l(y,e)}}function l(h,g){h.needsHillshadePrepare=!0,h.needsTerrainPrepare=!0;let y=g.tileID.canonical.x-h.tileID.canonical.x;const w=g.tileID.canonical.y-h.tileID.canonical.y,T=Math.pow(2,h.tileID.canonical.z),E=g.tileID.key;y===0&&w===0||Math.abs(w)>1||(Math.abs(y)>1&&(Math.abs(y+T)===1?y+=T:Math.abs(y-T)===1&&(y-=T)),g.dem&&h.dem&&(h.dem.backfillBorder(g.dem,y,w),h.neighboringTiles&&h.neighboringTiles[E]&&(h.neighboringTiles[E].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r){const l=Object.values(e),h=this._getLoadedDescendents(l),g={};for(const y of l){const w=h[y.key];if(!w?.length){g[y.key]=y;continue}const T=y.overscaledZ+Vt.maxUnderzooming,E=w.filter((P=>P.tileID.overscaledZ<=T));if(!E.length){g[y.key]=y;continue}const A=Math.min(...E.map((P=>P.tileID.overscaledZ))),D=E.filter((P=>P.tileID.overscaledZ===A)).map((P=>P.tileID));for(const P of D)r[P.key]=P;this._areDescendentsComplete(D,A,y.overscaledZ)||(g[y.key]=y)}return g}_getLoadedDescendents(e){var r;const l={};for(const h in this._tiles){const g=this._tiles[h];if(g.hasData())for(const y of e)g.tileID.isChildOf(y)&&(l[r=y.key]||(l[r]=[])).push(g)}return l}_areDescendentsComplete(e,r,l){return e.length===1&&e[0].isOverscaled()?e[0].overscaledZ===r:Math.pow(4,r-l)===e.length}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=r?l:null}for(let l=e.overscaledZ-1;l>=r;l--){const h=e.scaledTo(l),g=this._getLoadedTile(h);if(g)return g}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const r=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,h=Math.floor(r*l*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(g)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const l={};for(const h in this._tiles){const g=this._tiles[h];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+r),l[g.tileID.key]=g}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(h,this._tiles[h])}}update(e,r){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=r,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((E=>new d.Z(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y))):(l=_e(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter((E=>this._source.hasTile(E))))):l=[],this.usedForTerrain&&(l=this._addTerrainIdealTiles(l));const h=ct(e,this._source),g=Math.max(h-Vt.maxOverzooming,this._source.minzoom),y=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,y&&this.fire(new d.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const w=this._updateRetainedTiles(l,h);Ot(this._source.type)&&!r&&this._updateFadingTiles(w,g);for(const E in w)this._tiles[E].clearFadeHold();const T=d.am(this._tiles,w);for(const E of T){const A=this._tiles[E];A.hasSymbolBuckets&&!A.holdingForFade()?A.setHoldDuration(this.map._fadeDuration):A.hasSymbolBuckets&&!A.symbolFadeFinished()||this._removeTile(E)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}_addTerrainIdealTiles(e){const r=[];for(const l of e)if(l.canonical.z>this._source.minzoom){const h=l.scaledTo(l.canonical.z-1);r.push(h);const g=l.scaledTo(Math.max(this._source.minzoom,Math.min(l.canonical.z,5)));r.push(g)}return e.concat(r)}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,r){var l;const h={},g={},y=Math.max(r-Vt.maxOverzooming,this._source.minzoom);let w={};for(const T of e){const E=this._addTile(T);h[T.key]=T,E.hasData()||(w[T.key]=T)}w=this._retainLoadedChildren(w,h);for(const T in w){const E=w[T];let A=this._tiles[T],D=A?.wasRequested();for(let P=E.overscaledZ-1;P>=y;--P){const B=E.scaledTo(P);if(g[B.key])break;if(g[B.key]=!0,A=this.getTile(B),!A&&D&&(A=this._addTile(B)),A){const N=A.hasData();if((N||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||D)&&(h[B.key]=B),D=A.wasRequested(),N)break}}}return h}_updateFadingTiles(e,r){const l={},h={},g=Object.keys(e),y=Ke.now();for(const w of g){const T=e[w],E=this._tiles[w];if(!E||E.fadeEndTime!==0&&E.fadeEndTime<=y)continue;const A=this.findLoadedParent(T,r),D=this.findLoadedSibling(T),P=A||D||null;P&&(this._addTile(P.tileID),l[P.tileID.key]=P.tileID),h[w]=T}this._retainLoadedChildren(h,e);for(const w in l)e[w]||(this._coveredTiles[w]=!0,e[w]=l[w])}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let l,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}r.push(h.key);const g=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(g),l)break;h=g}for(const g of r)this._loadedParentTiles[g]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const r=this._tiles[e].tileID,l=this._getLoadedTile(r);this._loadedSiblingTiles[r.key]=l}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const l=r;return r||(r=new us(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,e.key,r.state)),r.uses++,this._tiles[e.key]=r,l||this._source.fire(new d.l("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=r.getExpiryTimeout();l&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),l))}refreshTiles(e){for(const r in this._tiles)(this._isIdRenderable(r)||this._tiles[r].state=="errored")&&e.some((l=>l.equals(this._tiles[r].tileID.canonical)))&&this._reloadTile(r,"expired")}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(e){const r=e.sourceDataType;e.dataType==="source"&&r==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&r==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,r,l){const h=[],g=this.transform;if(!g)return h;const y=g.getCoveringTilesDetailsProvider().allowWorldCopies(),w=l?g.getCameraQueryGeometry(e):e,T=B=>g.screenPointToMercatorCoordinate(B,this.terrain),E=this.transformBbox(e,T,!y),A=this.transformBbox(w,T,!y),D=this.getIds(),P=d.a2.fromPoints(A);for(let B=0;B<D.length;B++){const N=this._tiles[D[B]];if(N.holdingForFade())continue;const $=y?[N.tileID]:[N.tileID.unwrapTo(-1),N.tileID.unwrapTo(0)],X=Math.pow(2,g.zoom-N.tileID.overscaledZ),Y=r*N.queryPadding*d.$/N.tileSize/X;for(const Q of $){const ee=P.map((J=>Q.getTilePoint(new d.a1(J.x,J.y))));if(ee.expandBy(Y),ee.intersects(wt)){const J=E.map((ue=>Q.getTilePoint(ue))),se=A.map((ue=>Q.getTilePoint(ue)));h.push({tile:N,tileID:y?Q:Q.unwrapTo(0),queryGeometry:J,cameraQueryGeometry:se,scale:X})}}}return h}transformBbox(e,r,l){let h=e.map(r);if(l){const g=d.a2.fromPoints(e);g.shrinkBy(.001*Math.min(g.width(),g.height()));const y=g.map(r);d.a2.fromPoints(h).covers(y)||(h=h.map((w=>w.x>.5?new d.a1(w.x-1,w.y,w.z):w)))}return h}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map((l=>this._tiles[l].tileID));return this.transform&&this.transform.populateCache(r),r}hasTransition(){if(this._source.hasTransition())return!0;if(Ot(this._source.type)){const e=Ke.now();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=e)return!0}return!1}setFeatureState(e,r,l){this._state.updateState(e=e||"_geojsonTileLayer",r,l)}removeFeatureState(e,r,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,l)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,l){const h=this._tiles[e];h&&h.setDependencies(r,l)}reloadTilesForDependencies(e,r){for(const l in this._tiles)this._tiles[l].hasDependency(e,r)&&this._reloadTile(l,"reloading");this._cache.filter((l=>!l.hasDependency(e,r)))}}function pt(m,e){const r=Math.abs(2*m.wrap)-+(m.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return m.overscaledZ-e.overscaledZ||l-r||e.canonical.y-m.canonical.y||e.canonical.x-m.canonical.x}function Ot(m){return m==="raster"||m==="image"||m==="video"}Vt.maxOverzooming=10,Vt.maxUnderzooming=3;class Pi{constructor(e,r){this.reset(e,r)}reset(e,r){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=d.ah(e,0,1);let r=1,l=this._distances[r];const h=e*this.paddedLength+this.padding;for(;l<h&&r<this._distances.length;)l=this._distances[++r];const g=r-1,y=this._distances[g],w=l-y,T=w>0?(h-y)/w:0;return this.points[g].mult(1-T).add(this.points[r].mult(T))}}function nn(m,e){let r=!0;return m==="always"||m!=="never"&&e!=="never"||(r=!1),r}class an{constructor(e,r,l){const h=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(r/l);for(let y=0;y<this.xCellCount*this.yCellCount;y++)h.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=r,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,r,l,h,g){this._forEachCell(r,l,h,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(g)}insertCircle(e,r,l,h){this._forEachCell(r-h,l-h,r+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(r),this.circles.push(l),this.circles.push(h)}_insertBoxCell(e,r,l,h,g,y){this.boxCells[g].push(y)}_insertCircleCell(e,r,l,h,g,y){this.circleCells[g].push(y)}_query(e,r,l,h,g,y,w){if(l<0||e>this.width||h<0||r>this.height)return[];const T=[];if(e<=0&&r<=0&&this.width<=l&&this.height<=h){if(g)return[{key:null,x1:e,y1:r,x2:l,y2:h}];for(let E=0;E<this.boxKeys.length;E++)T.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const A=this.circles[3*E],D=this.circles[3*E+1],P=this.circles[3*E+2];T.push({key:this.circleKeys[E],x1:A-P,y1:D-P,x2:A+P,y2:D+P})}}else this._forEachCell(e,r,l,h,this._queryCell,T,{hitTest:g,overlapMode:y,seenUids:{box:{},circle:{}}},w);return T}query(e,r,l,h){return this._query(e,r,l,h,!1,null)}hitTest(e,r,l,h,g,y){return this._query(e,r,l,h,!0,g,y).length>0}hitTestCircle(e,r,l,h,g){const y=e-l,w=e+l,T=r-l,E=r+l;if(w<0||y>this.width||E<0||T>this.height)return!1;const A=[];return this._forEachCell(y,T,w,E,this._queryCellCircle,A,{hitTest:!0,overlapMode:h,circle:{x:e,y:r,radius:l},seenUids:{box:{},circle:{}}},g),A.length>0}_queryCell(e,r,l,h,g,y,w,T){const{seenUids:E,hitTest:A,overlapMode:D}=w,P=this.boxCells[g];if(P!==null){const N=this.bboxes;for(const $ of P)if(!E.box[$]){E.box[$]=!0;const X=4*$,Y=this.boxKeys[$];if(e<=N[X+2]&&r<=N[X+3]&&l>=N[X+0]&&h>=N[X+1]&&(!T||T(Y))&&(!A||!nn(D,Y.overlapMode))&&(y.push({key:Y,x1:N[X],y1:N[X+1],x2:N[X+2],y2:N[X+3]}),A))return!0}}const B=this.circleCells[g];if(B!==null){const N=this.circles;for(const $ of B)if(!E.circle[$]){E.circle[$]=!0;const X=3*$,Y=this.circleKeys[$];if(this._circleAndRectCollide(N[X],N[X+1],N[X+2],e,r,l,h)&&(!T||T(Y))&&(!A||!nn(D,Y.overlapMode))){const Q=N[X],ee=N[X+1],J=N[X+2];if(y.push({key:Y,x1:Q-J,y1:ee-J,x2:Q+J,y2:ee+J}),A)return!0}}}return!1}_queryCellCircle(e,r,l,h,g,y,w,T){const{circle:E,seenUids:A,overlapMode:D}=w,P=this.boxCells[g];if(P!==null){const N=this.bboxes;for(const $ of P)if(!A.box[$]){A.box[$]=!0;const X=4*$,Y=this.boxKeys[$];if(this._circleAndRectCollide(E.x,E.y,E.radius,N[X+0],N[X+1],N[X+2],N[X+3])&&(!T||T(Y))&&!nn(D,Y.overlapMode))return y.push(!0),!0}}const B=this.circleCells[g];if(B!==null){const N=this.circles;for(const $ of B)if(!A.circle[$]){A.circle[$]=!0;const X=3*$,Y=this.circleKeys[$];if(this._circlesCollide(N[X],N[X+1],N[X+2],E.x,E.y,E.radius)&&(!T||T(Y))&&!nn(D,Y.overlapMode))return y.push(!0),!0}}}_forEachCell(e,r,l,h,g,y,w,T){const E=this._convertToXCellCoord(e),A=this._convertToYCellCoord(r),D=this._convertToXCellCoord(l),P=this._convertToYCellCoord(h);for(let B=E;B<=D;B++)for(let N=A;N<=P;N++)if(g.call(this,e,r,l,h,this.xCellCount*N+B,y,w,T))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,r,l,h,g,y){const w=h-e,T=g-r,E=l+y;return E*E>w*w+T*T}_circleAndRectCollide(e,r,l,h,g,y,w){const T=(y-h)/2,E=Math.abs(e-(h+T));if(E>T+l)return!1;const A=(w-g)/2,D=Math.abs(r-(g+A));if(D>A+l)return!1;if(E<=T||D<=A)return!0;const P=E-T,B=D-A;return P*P+B*B<=l*l}}function jn(m,e,r){const l=d.L();if(!m){const{vecSouth:D,vecEast:P}=Di(e),B=Ie();B[0]=P[0],B[1]=P[1],B[2]=D[0],B[3]=D[1],h=B,(A=(y=(g=B)[0])*(E=g[3])-(T=g[2])*(w=g[1]))&&(h[0]=E*(A=1/A),h[1]=-w*A,h[2]=-T*A,h[3]=y*A),l[0]=B[0],l[1]=B[1],l[4]=B[2],l[5]=B[3]}var h,g,y,w,T,E,A;return d.N(l,l,[1/r,1/r,1]),l}function In(m,e,r,l){if(m){const h=d.L();if(!e){const{vecSouth:g,vecEast:y}=Di(r);h[0]=y[0],h[1]=y[1],h[4]=g[0],h[5]=g[1]}return d.N(h,h,[l,l,1]),h}return r.pixelsToClipSpaceMatrix}function Di(m){const e=Math.cos(m.rollInRadians),r=Math.sin(m.rollInRadians),l=Math.cos(m.pitchInRadians),h=Math.cos(m.bearingInRadians),g=Math.sin(m.bearingInRadians),y=d.ar();y[0]=-h*l*r-g*e,y[1]=-g*l*r+h*e;const w=d.as(y);w<1e-9?d.at(y):d.au(y,y,1/w);const T=d.ar();T[0]=h*l*e-g*r,T[1]=g*l*e+h*r;const E=d.as(T);return E<1e-9?d.at(T):d.au(T,T,1/E),{vecEast:T,vecSouth:y}}function fn(m,e,r,l){let h;l?(h=[m,e,l(m,e),1],d.aw(h,h,r)):(h=[m,e,0,1],Ir(h,h,r));const g=h[3];return{point:new d.P(h[0]/g,h[1]/g),signedDistanceFromCamera:g,isOccluded:!1}}function Ue(m,e){return .5+m/e*.5}function rn(m,e){return m.x>=-e[0]&&m.x<=e[0]&&m.y>=-e[1]&&m.y<=e[1]}function Da(m,e,r,l,h,g,y,w,T,E,A,D,P){const B=r?m.textSizeData:m.iconSizeData,N=d.an(B,e.transform.zoom),$=[256/e.width*2+1,256/e.height*2+1],X=r?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;X.clear();const Y=m.lineVertexArray,Q=r?m.text.placedSymbolArray:m.icon.placedSymbolArray,ee=e.transform.width/e.transform.height;let J=!1;for(let se=0;se<Q.length;se++){const ue=Q.get(se);if(ue.hidden||ue.writingMode===d.ao.vertical&&!J){wa(ue.numGlyphs,X);continue}J=!1;const te=new d.P(ue.anchorX,ue.anchorY),de={getElevation:P,pitchedLabelPlaneMatrix:l,lineVertexArray:Y,pitchWithMap:g,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:te,unwrappedTileID:T,width:E,height:A,translation:D},Ce=Vs(ue.anchorX,ue.anchorY,de);if(!rn(Ce.point,$)){wa(ue.numGlyphs,X);continue}const Te=Ue(e.transform.cameraToCenterDistance,Ce.signedDistanceFromCamera),Se=d.ap(B,N,ue),Ee=g?Se*e.transform.getPitchedTextCorrection(ue.anchorX,ue.anchorY,T)/Te:Se*Te,We=qe({projectionContext:de,pitchedLabelPlaneMatrixInverse:h,symbol:ue,fontSize:Ee,flip:!1,keepUpright:y,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:X,aspectRatio:ee,rotateToLine:w});J=We.useVertical,(We.notEnoughRoom||J||We.needsFlipping&&qe({projectionContext:de,pitchedLabelPlaneMatrixInverse:h,symbol:ue,fontSize:Ee,flip:!0,keepUpright:y,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:X,aspectRatio:ee,rotateToLine:w}).notEnoughRoom)&&wa(ue.numGlyphs,X)}r?m.text.dynamicLayoutVertexBuffer.updateData(X):m.icon.dynamicLayoutVertexBuffer.updateData(X)}function Ns(m,e,r,l,h,g,y,w){const T=g.glyphStartIndex+g.numGlyphs,E=g.lineStartIndex,A=g.lineStartIndex+g.lineLength,D=e.getoffsetX(g.glyphStartIndex),P=e.getoffsetX(T-1),B=Dr(m*D,r,l,h,g.segment,E,A,w,y);if(!B)return null;const N=Dr(m*P,r,l,h,g.segment,E,A,w,y);return N?w.projectionCache.anyProjectionOccluded?null:{first:B,last:N}:null}function sn(m,e,r,l){return m===d.ao.horizontal&&Math.abs(r.y-e.y)>Math.abs(r.x-e.x)*l?{useVertical:!0}:(m===d.ao.vertical?e.y<r.y:e.x>r.x)?{needsFlipping:!0}:null}function qe(m){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:r,symbol:l,fontSize:h,flip:g,keepUpright:y,glyphOffsetArray:w,dynamicLayoutVertexArray:T,aspectRatio:E,rotateToLine:A}=m,D=h/24,P=l.lineOffsetX*D,B=l.lineOffsetY*D;let N;if(l.numGlyphs>1){const $=l.glyphStartIndex+l.numGlyphs,X=l.lineStartIndex,Y=l.lineStartIndex+l.lineLength,Q=Ns(D,w,P,B,g,l,A,e);if(!Q)return{notEnoughRoom:!0};const ee=bo(Q.first.point.x,Q.first.point.y,e,r),J=bo(Q.last.point.x,Q.last.point.y,e,r);if(y&&!g){const se=sn(l.writingMode,ee,J,E);if(se)return se}N=[Q.first];for(let se=l.glyphStartIndex+1;se<$-1;se++){const ue=Dr(D*w.getoffsetX(se),P,B,g,l.segment,X,Y,e,A);if(!ue)return{notEnoughRoom:!0};N.push(ue)}N.push(Q.last)}else{if(y&&!g){const X=Nn(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,Y=l.lineStartIndex+l.segment+1,Q=new d.P(e.lineVertexArray.getx(Y),e.lineVertexArray.gety(Y)),ee=Nn(Q.x,Q.y,e),J=ee.signedDistanceFromCamera>0?ee.point:xt(e.tileAnchorPoint,Q,X,1,e),se=bo(X.x,X.y,e,r),ue=bo(J.x,J.y,e,r),te=sn(l.writingMode,se,ue,E);if(te)return te}const $=Dr(D*w.getoffsetX(l.glyphStartIndex),P,B,g,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,e,A);if(!$||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};N=[$]}for(const $ of N)d.av(T,$.point,$.angle);return{}}function xt(m,e,r,l,h){const g=m.add(m.sub(e)._unit()),y=Nn(g.x,g.y,h).point,w=r.sub(y);return r.add(w._mult(l/w.mag()))}function Pt(m,e,r){const l=e.projectionCache;if(l.projections[m])return l.projections[m];const h=new d.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),g=Nn(h.x,h.y,e);if(g.signedDistanceFromCamera>0)return l.projections[m]=g.point,l.anyProjectionOccluded=l.anyProjectionOccluded||g.isOccluded,g.point;const y=m-r.direction;return xt(r.distanceFromAnchor===0?e.tileAnchorPoint:new d.P(e.lineVertexArray.getx(y),e.lineVertexArray.gety(y)),h,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,e)}function Nn(m,e,r){const l=m+r.translation[0],h=e+r.translation[1];let g;return r.pitchWithMap?(g=fn(l,h,r.pitchedLabelPlaneMatrix,r.getElevation),g.isOccluded=!1):(g=r.transform.projectTileCoordinates(l,h,r.unwrappedTileID,r.getElevation),g.point.x=(.5*g.point.x+.5)*r.width,g.point.y=(.5*-g.point.y+.5)*r.height),g}function bo(m,e,r,l){if(r.pitchWithMap){const h=[m,e,0,1];return d.aw(h,h,l),r.transform.projectTileCoordinates(h[0]/h[3],h[1]/h[3],r.unwrappedTileID,r.getElevation).point}return{x:m/r.width*2-1,y:1-e/r.height*2}}function Vs(m,e,r){return r.transform.projectTileCoordinates(m,e,r.unwrappedTileID,r.getElevation)}function Rt(m,e,r){return m._unit()._perp()._mult(e*r)}function Zs(m,e,r,l,h,g,y,w,T){if(w.projectionCache.offsets[m])return w.projectionCache.offsets[m];const E=r.add(e);if(m+T.direction<l||m+T.direction>=h)return w.projectionCache.offsets[m]=E,E;const A=Pt(m+T.direction,w,T),D=Rt(A.sub(r),y,T.direction),P=r.add(D),B=A.add(D);return w.projectionCache.offsets[m]=d.ax(g,E,P,B)||E,w.projectionCache.offsets[m]}function Dr(m,e,r,l,h,g,y,w,T){const E=l?m-e:m+e;let A=E>0?1:-1,D=0;l&&(A*=-1,D=Math.PI),A<0&&(D+=Math.PI);let P,B=A>0?g+h:g+h+1;w.projectionCache.cachedAnchorPoint?P=w.projectionCache.cachedAnchorPoint:(P=Nn(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=P);let N,$,X=P,Y=P,Q=0,ee=0;const J=Math.abs(E),se=[];let ue;for(;Q+ee<=J;){if(B+=A,B<g||B>=y)return null;Q+=ee,Y=X,$=N;const Ce={absOffsetX:J,direction:A,distanceFromAnchor:Q,previousVertex:Y};if(X=Pt(B,w,Ce),r===0)se.push(Y),ue=X.sub(Y);else{let Te;const Se=X.sub(Y);Te=Se.mag()===0?Rt(Pt(B+A,w,Ce).sub(X),r,A):Rt(Se,r,A),$||($=Y.add(Te)),N=Zs(B,Te,X,g,y,$,r,w,Ce),se.push($),ue=N.sub($)}ee=ue.mag()}const te=ue._mult((J-Q)/ee)._add($||Y),de=D+Math.atan2(X.y-Y.y,X.x-Y.x);return se.push(te),{point:te,angle:T?de:0,path:se}}const hs=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function wa(m,e){for(let r=0;r<m;r++){const l=e.length;e.resize(l+4),e.float32.set(hs,3*l)}}function Ir(m,e,r){const l=e[0],h=e[1];return m[0]=r[0]*l+r[4]*h+r[12],m[1]=r[1]*l+r[5]*h+r[13],m[3]=r[3]*l+r[7]*h+r[15],m}const Ii=100;class _n{constructor(e,r=new an(e.width+200,e.height+200,25),l=new an(e.width+200,e.height+200,25)){this.transform=e,this.grid=r,this.ignoredGrid=l,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Ii,this.screenBottomBoundary=e.height+Ii,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,r,l,h,g,y,w,T,E,A,D,P){const B=this.projectAndGetPerspectiveRatio(e.anchorPointX+T[0],e.anchorPointY+T[1],g,A,P),N=l*B.perspectiveRatio;let $;if(y||w)$=this._projectCollisionBox(e,N,h,g,y,w,T,B,A,D,P);else{const ue=B.x+(D?D.x*N:0),te=B.y+(D?D.y*N:0);$={allPointsOccluded:!1,box:[ue+e.x1*N,te+e.y1*N,ue+e.x2*N,te+e.y2*N]}}const[X,Y,Q,ee]=$.box,J=y?$.allPointsOccluded:B.isOccluded;let se=J;return se||(se=B.perspectiveRatio<this.perspectiveRatioCutoff),se||(se=!this.isInsideGrid(X,Y,Q,ee)),se||r!=="always"&&this.grid.hitTest(X,Y,Q,ee,r,E)?{box:[X,Y,Q,ee],placeable:!1,offscreen:!1,occluded:J}:{box:[X,Y,Q,ee],placeable:!0,offscreen:this.isOffscreen(X,Y,Q,ee),occluded:J}}placeCollisionCircles(e,r,l,h,g,y,w,T,E,A,D,P,B,N){const $=[],X=new d.P(r.anchorX,r.anchorY),Y=this.getPerspectiveRatio(X.x,X.y,y,N),Q=(E?g*this.transform.getPitchedTextCorrection(r.anchorX,r.anchorY,y)/Y:g*Y)/d.aB,ee={getElevation:N,pitchedLabelPlaneMatrix:w,lineVertexArray:l,pitchWithMap:E,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:X,unwrappedTileID:y,width:this.transform.width,height:this.transform.height,translation:B},J=Ns(Q,h,r.lineOffsetX*Q,r.lineOffsetY*Q,!1,r,!1,ee);let se=!1,ue=!1,te=!0;if(J){const de=.5*D*Y+P,Ce=new d.P(-100,-100),Te=new d.P(this.screenRightBoundary,this.screenBottomBoundary),Se=new Pi,Ee=J.first,We=J.last;let Qe=[];for(let Lt=Ee.path.length-1;Lt>=1;Lt--)Qe.push(Ee.path[Lt]);for(let Lt=1;Lt<We.path.length;Lt++)Qe.push(We.path[Lt]);const Ve=2.5*de;if(E){const Lt=this.projectPathToScreenSpace(Qe,ee);Qe=Lt.some((li=>li.signedDistanceFromCamera<=0))?[]:Lt.map((li=>li.point))}let lt=[];if(Qe.length>0){const Lt=Qe[0].clone(),li=Qe[0].clone();for(let ki=1;ki<Qe.length;ki++)Lt.x=Math.min(Lt.x,Qe[ki].x),Lt.y=Math.min(Lt.y,Qe[ki].y),li.x=Math.max(li.x,Qe[ki].x),li.y=Math.max(li.y,Qe[ki].y);lt=Lt.x>=Ce.x&&li.x<=Te.x&&Lt.y>=Ce.y&&li.y<=Te.y?[Qe]:li.x<Ce.x||Lt.x>Te.x||li.y<Ce.y||Lt.y>Te.y?[]:d.ay([Qe],Ce.x,Ce.y,Te.x,Te.y)}for(const Lt of lt){Se.reset(Lt,.25*de);let li=0;li=Se.length<=.5*de?1:Math.ceil(Se.paddedLength/Ve)+1;for(let ki=0;ki<li;ki++){const Ai=ki/Math.max(li-1,1),Vi=Se.lerp(Ai),Bi=Vi.x+Ii,Bn=Vi.y+Ii;$.push(Bi,Bn,de,0);const Zi=Bi-de,xi=Bn-de,Si=Bi+de,Gt=Bn+de;if(te=te&&this.isOffscreen(Zi,xi,Si,Gt),ue=ue||this.isInsideGrid(Zi,xi,Si,Gt),e!=="always"&&this.grid.hitTestCircle(Bi,Bn,de,e,A)&&(se=!0,!T))return{circles:[],offscreen:!1,collisionDetected:se}}}}return{circles:!T&&se||!ue||Y<this.perspectiveRatioCutoff?[]:$,offscreen:te,collisionDetected:se}}projectPathToScreenSpace(e,r){const l=(function(h,g){const y=d.L();return d.aq(y,g.pitchedLabelPlaneMatrix),h.map((w=>{const T=fn(w.x,w.y,y,g.getElevation),E=g.transform.projectTileCoordinates(T.point.x,T.point.y,g.unwrappedTileID,g.getElevation);return E.point.x=(.5*E.point.x+.5)*g.width,E.point.y=(.5*-E.point.y+.5)*g.height,E}))})(e,r);return(function(h){let g=0,y=0,w=0,T=0;for(let E=0;E<h.length;E++)h[E].isOccluded?(w=E+1,T=0):(T++,T>y&&(y=T,g=w));return h.slice(g,g+y)})(l)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[],l=new d.a2;for(const D of e){const P=new d.P(D.x+Ii,D.y+Ii);l.extend(P),r.push(P)}const{minX:h,minY:g,maxX:y,maxY:w}=l,T=this.grid.query(h,g,y,w).concat(this.ignoredGrid.query(h,g,y,w)),E={},A={};for(const D of T){const P=D.key;if(E[P.bucketInstanceId]===void 0&&(E[P.bucketInstanceId]={}),E[P.bucketInstanceId][P.featureIndex])continue;const B=[new d.P(D.x1,D.y1),new d.P(D.x2,D.y1),new d.P(D.x2,D.y2),new d.P(D.x1,D.y2)];d.az(r,B)&&(E[P.bucketInstanceId][P.featureIndex]=!0,A[P.bucketInstanceId]===void 0&&(A[P.bucketInstanceId]=[]),A[P.bucketInstanceId].push(P.featureIndex))}return A}insertCollisionBox(e,r,l,h,g,y){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:g,collisionGroupID:y,overlapMode:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,r,l,h,g,y){const w=l?this.ignoredGrid:this.grid,T={bucketInstanceId:h,featureIndex:g,collisionGroupID:y,overlapMode:r};for(let E=0;E<e.length;E+=4)w.insertCircle(T,e[E],e[E+1],e[E+2])}projectAndGetPerspectiveRatio(e,r,l,h,g){if(g){let y;h?(y=[e,r,h(e,r),1],d.aw(y,y,g)):(y=[e,r,0,1],Ir(y,y,g));const w=y[3];return{x:(y[0]/w+1)/2*this.transform.width+Ii,y:(-y[1]/w+1)/2*this.transform.height+Ii,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}{const y=this.transform.projectTileCoordinates(e,r,l,h);return{x:(y.point.x+1)/2*this.transform.width+Ii,y:(1-y.point.y)/2*this.transform.height+Ii,perspectiveRatio:.5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5,isOccluded:y.isOccluded,signedDistanceFromCamera:y.signedDistanceFromCamera}}}getPerspectiveRatio(e,r,l,h){const g=this.transform.projectTileCoordinates(e,r,l,h);return .5+this.transform.cameraToCenterDistance/g.signedDistanceFromCamera*.5}isOffscreen(e,r,l,h){return l<Ii||e>=this.screenRightBoundary||h<Ii||r>this.screenBottomBoundary}isInsideGrid(e,r,l,h){return l>=0&&e<this.gridRightBoundary&&h>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const e=d.ag([]);return d.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,r,l,h,g,y,w,T,E,A,D){let P=1,B=0,N=0,$=1;const X=e.anchorPointX+w[0],Y=e.anchorPointY+w[1];if(y&&!g){const Qe=this.projectAndGetPerspectiveRatio(X+1,Y,h,E,D),Ve=Qe.x-T.x,lt=Math.atan((Qe.y-T.y)/Ve)+(Ve<0?Math.PI:0),Lt=Math.sin(lt),li=Math.cos(lt);P=li,B=Lt,N=-Lt,$=li}else if(!y&&g){const Qe=Di(this.transform);P=Qe.vecEast[0],B=Qe.vecEast[1],N=Qe.vecSouth[0],$=Qe.vecSouth[1]}let Q=T.x,ee=T.y,J=r;g&&(Q=X,ee=Y,J=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),J*=this.transform.getPitchedTextCorrection(X,Y,h),A||(J*=d.ah(.5+T.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),A&&(Q+=P*A.x*J+N*A.y*J,ee+=B*A.x*J+$*A.y*J);const se=e.x1*J,ue=e.x2*J,te=(se+ue)/2,de=e.y1*J,Ce=e.y2*J,Te=(de+Ce)/2,Se=[{offsetX:se,offsetY:de},{offsetX:te,offsetY:de},{offsetX:ue,offsetY:de},{offsetX:ue,offsetY:Te},{offsetX:ue,offsetY:Ce},{offsetX:te,offsetY:Ce},{offsetX:se,offsetY:Ce},{offsetX:se,offsetY:Te}];let Ee=[];for(const{offsetX:Qe,offsetY:Ve}of Se)Ee.push(new d.P(Q+P*Qe+N*Ve,ee+B*Qe+$*Ve));let We=!1;if(g){const Qe=Ee.map((Ve=>this.projectAndGetPerspectiveRatio(Ve.x,Ve.y,h,E,D)));We=Qe.some((Ve=>!Ve.isOccluded)),Ee=Qe.map((Ve=>new d.P(Ve.x,Ve.y)))}else We=!0;return{box:d.aA(Ee),allPointsOccluded:!We}}}class Ta{constructor(e,r,l,h){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?r:-r))):h&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class Ti{constructor(e,r,l,h,g){this.text=new Ta(e?e.text:null,r,l,g),this.icon=new Ta(e?e.icon:null,r,h,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Gs{constructor(e,r,l){this.text=e,this.icon=r,this.skipFade=l}}class Rr{constructor(e,r,l,h,g){this.bucketInstanceId=e,this.featureIndex=r,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=g}}class vu{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const r=++this.maxGroupID;this.collisionGroups[e]={ID:r,predicate:l=>l.collisionGroupID===r}}return this.collisionGroups[e]}}function ds(m,e,r,l,h){const{horizontalAlign:g,verticalAlign:y}=d.aH(m);return new d.P(-(g-.5)*e+l[0]*h,-(y-.5)*r+l[1]*h)}class fs{constructor(e,r,l,h,g){this.transform=e.clone(),this.terrain=r,this.collisionIndex=new _n(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new vu(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const r=this.terrain;return r?(l,h)=>r.getElevation(e,l,h):null}getBucketParts(e,r,l,h){const g=l.getBucket(r),y=l.latestFeatureIndex;if(!g||!y||r.id!==g.layerIds[0])return;const w=l.collisionBoxArray,T=g.layers[0].layout,E=g.layers[0].paint,A=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),D=l.tileSize/d.$,P=l.tileID.toUnwrapped(),B=T.get("text-rotation-alignment")==="map",N=d.aC(l,1,this.transform.zoom),$=d.aD(this.collisionIndex.transform,l,E.get("text-translate"),E.get("text-translate-anchor")),X=d.aD(this.collisionIndex.transform,l,E.get("icon-translate"),E.get("icon-translate-anchor")),Y=jn(B,this.transform,N);this.retainedQueryData[g.bucketInstanceId]=new Rr(g.bucketInstanceId,y,g.sourceLayerIndex,g.index,l.tileID);const Q={bucket:g,layout:T,translationText:$,translationIcon:X,unwrappedTileID:P,pitchedLabelPlaneMatrix:Y,scale:A,textPixelRatio:D,holdingForFade:l.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:d.an(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(h)for(const ee of g.sortKeyRanges){const{sortKey:J,symbolInstanceStart:se,symbolInstanceEnd:ue}=ee;e.push({sortKey:J,symbolInstanceStart:se,symbolInstanceEnd:ue,parameters:Q})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:Q})}attemptAnchorPlacement(e,r,l,h,g,y,w,T,E,A,D,P,B,N,$,X,Y,Q,ee,J){const se=d.aE[e.textAnchor],ue=[e.textOffset0,e.textOffset1],te=ds(se,l,h,ue,g),de=this.collisionIndex.placeCollisionBox(r,P,T,E,A,w,y,X,D.predicate,ee,te,J);if((!Q||this.collisionIndex.placeCollisionBox(Q,P,T,E,A,w,y,Y,D.predicate,ee,te,J).placeable)&&de.placeable){let Ce;if(this.prevPlacement&&this.prevPlacement.variableOffsets[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID].text&&(Ce=this.prevPlacement.variableOffsets[B.crossTileID].anchor),B.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[B.crossTileID]={textOffset:ue,width:l,height:h,anchor:se,textBoxScale:g,prevAnchor:Ce},this.markUsedJustification(N,se,B,$),N.allowVerticalPlacement&&(this.markUsedOrientation(N,$,B),this.placedOrientations[B.crossTileID]=$),{shift:te,placedGlyphBoxes:de}}}placeLayerBucketPart(e,r,l){const{bucket:h,layout:g,translationText:y,translationIcon:w,unwrappedTileID:T,pitchedLabelPlaneMatrix:E,textPixelRatio:A,holdingForFade:D,collisionBoxArray:P,partiallyEvaluatedTextSize:B,collisionGroup:N}=e.parameters,$=g.get("text-optional"),X=g.get("icon-optional"),Y=d.aF(g,"text-overlap","text-allow-overlap"),Q=Y==="always",ee=d.aF(g,"icon-overlap","icon-allow-overlap"),J=ee==="always",se=g.get("text-rotation-alignment")==="map",ue=g.get("text-pitch-alignment")==="map",te=g.get("icon-text-fit")!=="none",de=g.get("symbol-z-order")==="viewport-y",Ce=Q&&(J||!h.hasIconData()||X),Te=J&&(Q||!h.hasTextData()||$);!h.collisionArrays&&P&&h.deserializeCollisionBoxes(P);const Se=this.retainedQueryData[h.bucketInstanceId].tileID,Ee=this._getTerrainElevationFunc(Se),We=this.transform.getFastPathSimpleProjectionMatrix(Se),Qe=(Ve,lt,Lt)=>{var li,ki;if(r[Ve.crossTileID])return;if(D)return void(this.placements[Ve.crossTileID]=new Gs(!1,!1,!1));let Ai=!1,Vi=!1,Bi=!0,Bn=null,Zi={box:null,placeable:!1,offscreen:null,occluded:!1},xi={placeable:!1},Si=null,Gt=null,On=null,lr=0,uo=0,ts=0;lt.textFeatureIndex?lr=lt.textFeatureIndex:Ve.useRuntimeCollisionCircles&&(lr=Ve.featureIndex),lt.verticalTextFeatureIndex&&(uo=lt.verticalTextFeatureIndex);const Fo=lt.textBox;if(Fo){const Za=xn=>{let mn=d.ao.horizontal;if(h.allowVerticalPlacement&&!xn&&this.prevPlacement){const va=this.prevPlacement.placedOrientations[Ve.crossTileID];va&&(this.placedOrientations[Ve.crossTileID]=va,mn=va,this.markUsedOrientation(h,mn,Ve))}return mn},As=(xn,mn)=>{if(h.allowVerticalPlacement&&Ve.numVerticalGlyphVertices>0&&lt.verticalTextBox){for(const va of h.writingModes)if(va===d.ao.vertical?(Zi=mn(),xi=Zi):Zi=xn(),Zi&&Zi.placeable)break}else Zi=xn()},Cr=Ve.textAnchorOffsetStartIndex,zs=Ve.textAnchorOffsetEndIndex;if(zs===Cr){const xn=(mn,va)=>{const Oi=this.collisionIndex.placeCollisionBox(mn,Y,A,Se,T,ue,se,y,N.predicate,Ee,void 0,We);return Oi&&Oi.placeable&&(this.markUsedOrientation(h,va,Ve),this.placedOrientations[Ve.crossTileID]=va),Oi};As((()=>xn(Fo,d.ao.horizontal)),(()=>{const mn=lt.verticalTextBox;return h.allowVerticalPlacement&&Ve.numVerticalGlyphVertices>0&&mn?xn(mn,d.ao.vertical):{box:null,offscreen:null}})),Za(Zi&&Zi.placeable)}else{let xn=d.aE[(ki=(li=this.prevPlacement)===null||li===void 0?void 0:li.variableOffsets[Ve.crossTileID])===null||ki===void 0?void 0:ki.anchor];const mn=(Oi,Yc,Kc)=>{const Hu=Oi.x2-Oi.x1,Nh=Oi.y2-Oi.y1,_c=Ve.textBoxScale,wl=te&&ee==="never"?Yc:null;let Ga=null,is=Y==="never"?1:2,cr="never";xn&&is++;for(let ns=0;ns<is;ns++){for(let fo=Cr;fo<zs;fo++){const yc=h.textAnchorOffsets.get(fo);if(xn&&yc.textAnchor!==xn)continue;const Uo=this.attemptAnchorPlacement(yc,Oi,Hu,Nh,_c,se,ue,A,Se,T,N,cr,Ve,h,Kc,y,w,wl,Ee);if(Uo&&(Ga=Uo.placedGlyphBoxes,Ga&&Ga.placeable))return Ai=!0,Bn=Uo.shift,Ga}xn?xn=null:cr=Y}return l&&!Ga&&(Ga={box:this.collisionIndex.placeCollisionBox(Fo,"always",A,Se,T,ue,se,y,N.predicate,Ee,void 0,We).box,offscreen:!1,placeable:!1,occluded:!1}),Ga};As((()=>mn(Fo,lt.iconBox,d.ao.horizontal)),(()=>{const Oi=lt.verticalTextBox;return h.allowVerticalPlacement&&(!Zi||!Zi.placeable)&&Ve.numVerticalGlyphVertices>0&&Oi?mn(Oi,lt.verticalIconBox,d.ao.vertical):{box:null,occluded:!0,offscreen:null}})),Zi&&(Ai=Zi.placeable,Bi=Zi.offscreen);const va=Za(Zi&&Zi.placeable);if(!Ai&&this.prevPlacement){const Oi=this.prevPlacement.variableOffsets[Ve.crossTileID];Oi&&(this.variableOffsets[Ve.crossTileID]=Oi,this.markUsedJustification(h,Oi.anchor,Ve,va))}}}if(Si=Zi,Ai=Si&&Si.placeable,Bi=Si&&Si.offscreen,Ve.useRuntimeCollisionCircles&&Ve.centerJustifiedTextSymbolIndex>=0){const Za=h.text.placedSymbolArray.get(Ve.centerJustifiedTextSymbolIndex),As=d.ap(h.textSizeData,B,Za),Cr=g.get("text-padding");Gt=this.collisionIndex.placeCollisionCircles(Y,Za,h.lineVertexArray,h.glyphOffsetArray,As,T,E,l,ue,N.predicate,Ve.collisionCircleDiameter,Cr,y,Ee),Gt.circles.length&&Gt.collisionDetected&&!l&&d.w("Collisions detected, but collision boxes are not shown"),Ai=Q||Gt.circles.length>0&&!Gt.collisionDetected,Bi=Bi&&Gt.offscreen}if(lt.iconFeatureIndex&&(ts=lt.iconFeatureIndex),lt.iconBox){const Za=As=>this.collisionIndex.placeCollisionBox(As,ee,A,Se,T,ue,se,w,N.predicate,Ee,te&&Bn?Bn:void 0,We);xi&&xi.placeable&&lt.verticalIconBox?(On=Za(lt.verticalIconBox),Vi=On.placeable):(On=Za(lt.iconBox),Vi=On.placeable),Bi=Bi&&On.offscreen}const bl=$||Ve.numHorizontalGlyphVertices===0&&Ve.numVerticalGlyphVertices===0,Es=X||Ve.numIconVertices===0;bl||Es?Es?bl||(Vi=Vi&&Ai):Ai=Vi&&Ai:Vi=Ai=Vi&&Ai;const ho=Vi&&On.placeable;if(Ai&&Si.placeable&&this.collisionIndex.insertCollisionBox(Si.box,Y,g.get("text-ignore-placement"),h.bucketInstanceId,xi&&xi.placeable&&uo?uo:lr,N.ID),ho&&this.collisionIndex.insertCollisionBox(On.box,ee,g.get("icon-ignore-placement"),h.bucketInstanceId,ts,N.ID),Gt&&Ai&&this.collisionIndex.insertCollisionCircles(Gt.circles,Y,g.get("text-ignore-placement"),h.bucketInstanceId,lr,N.ID),l&&this.storeCollisionData(h.bucketInstanceId,Lt,lt,Si,On,Gt),Ve.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ve.crossTileID]=new Gs((Ai||Ce)&&!Si?.occluded,(Vi||Te)&&!On?.occluded,Bi||h.justReloaded),r[Ve.crossTileID]=!0};if(de){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ve=h.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let lt=Ve.length-1;lt>=0;--lt){const Lt=Ve[lt];Qe(h.symbolInstances.get(Lt),h.collisionArrays[Lt],Lt)}}else for(let Ve=e.symbolInstanceStart;Ve<e.symbolInstanceEnd;Ve++)Qe(h.symbolInstances.get(Ve),h.collisionArrays[Ve],Ve);h.justReloaded=!1}storeCollisionData(e,r,l,h,g,y){if(l.textBox||l.iconBox){let w,T;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(r)?T=w.get(r):(T={text:null,icon:null},w.set(r,T)),l.textBox&&(T.text=h.box),l.iconBox&&(T.icon=g.box)}if(y){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=[]);for(let T=0;T<y.circles.length;T+=4)w.push(y.circles[T+0]-Ii),w.push(y.circles[T+1]-Ii),w.push(y.circles[T+2]),w.push(y.collisionDetected?1:0)}}markUsedJustification(e,r,l,h){let g;g=h===d.ao.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[d.aG(r)];const y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of y)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=g>=0&&w!==g?0:l.crossTileID)}markUsedOrientation(e,r,l){const h=r===d.ao.horizontal||r===d.ao.horizontalOnly?r:0,g=r===d.ao.vertical?r:0,y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of y)e.text.placedSymbolArray.get(w).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let l=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const h=r?r.symbolFadeChange(e):1,g=r?r.opacities:{},y=r?r.variableOffsets:{},w=r?r.placedOrientations:{};for(const T in this.placements){const E=this.placements[T],A=g[T];A?(this.opacities[T]=new Ti(A,h,E.text,E.icon),l=l||E.text!==A.text.placed||E.icon!==A.icon.placed):(this.opacities[T]=new Ti(null,h,E.text,E.icon,E.skipFade),l=l||E.text||E.icon)}for(const T in g){const E=g[T];if(!this.opacities[T]){const A=new Ti(E,h,!1,!1);A.isHidden()||(this.opacities[T]=A,l=l||E.text.placed||E.icon.placed)}}for(const T in y)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=y[T]);for(const T in w)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=w[T]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:e)}updateLayerOpacities(e,r){const l={};for(const h of r){const g=h.getBucket(e);g&&h.latestFeatureIndex&&e.id===g.layerIds[0]&&this.updateBucketOpacities(g,h.tileID,l,h.collisionBoxArray)}}updateBucketOpacities(e,r,l,h){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const g=e.layers[0],y=g.layout,w=new Ti(null,0,!1,!1,!0),T=y.get("text-allow-overlap"),E=y.get("icon-allow-overlap"),A=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),D=y.get("text-rotation-alignment")==="map",P=y.get("text-pitch-alignment")==="map",B=y.get("icon-text-fit")!=="none",N=new Ti(null,0,T&&(E||!e.hasIconData()||y.get("icon-optional")),E&&(T||!e.hasTextData()||y.get("text-optional")),!0);!e.collisionArrays&&h&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(h);const $=(Y,Q,ee)=>{for(let J=0;J<Q/4;J++)Y.opacityVertexArray.emplaceBack(ee);Y.hasVisibleVertices=Y.hasVisibleVertices||ee!==ps},X=this.collisionBoxArrays.get(e.bucketInstanceId);for(let Y=0;Y<e.symbolInstances.length;Y++){const Q=e.symbolInstances.get(Y),{numHorizontalGlyphVertices:ee,numVerticalGlyphVertices:J,crossTileID:se}=Q;let ue=this.opacities[se];l[se]?ue=w:ue||(ue=N,this.opacities[se]=ue),l[se]=!0;const te=Q.numIconVertices>0,de=this.placedOrientations[Q.crossTileID],Ce=de===d.ao.vertical,Te=de===d.ao.horizontal||de===d.ao.horizontalOnly;if(ee>0||J>0){const Ee=Ec(ue.text);$(e.text,ee,Ce?ps:Ee),$(e.text,J,Te?ps:Ee);const We=ue.text.isHidden();[Q.rightJustifiedTextSymbolIndex,Q.centerJustifiedTextSymbolIndex,Q.leftJustifiedTextSymbolIndex].forEach((lt=>{lt>=0&&(e.text.placedSymbolArray.get(lt).hidden=We||Ce?1:0)})),Q.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(Q.verticalPlacedTextSymbolIndex).hidden=We||Te?1:0);const Qe=this.variableOffsets[Q.crossTileID];Qe&&this.markUsedJustification(e,Qe.anchor,Q,de);const Ve=this.placedOrientations[Q.crossTileID];Ve&&(this.markUsedJustification(e,"left",Q,Ve),this.markUsedOrientation(e,Ve,Q))}if(te){const Ee=Ec(ue.icon),We=!(B&&Q.verticalPlacedIconSymbolIndex&&Ce);Q.placedIconSymbolIndex>=0&&($(e.icon,Q.numIconVertices,We?Ee:ps),e.icon.placedSymbolArray.get(Q.placedIconSymbolIndex).hidden=ue.icon.isHidden()),Q.verticalPlacedIconSymbolIndex>=0&&($(e.icon,Q.numVerticalIconVertices,We?ps:Ee),e.icon.placedSymbolArray.get(Q.verticalPlacedIconSymbolIndex).hidden=ue.icon.isHidden())}const Se=X&&X.has(Y)?X.get(Y):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Ee=e.collisionArrays[Y];if(Ee){let We=new d.P(0,0);if(Ee.textBox||Ee.verticalTextBox){let Qe=!0;if(A){const Ve=this.variableOffsets[se];Ve?(We=ds(Ve.anchor,Ve.width,Ve.height,Ve.textOffset,Ve.textBoxScale),D&&We._rotate(P?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Qe=!1}if(Ee.textBox||Ee.verticalTextBox){let Ve;Ee.textBox&&(Ve=Ce),Ee.verticalTextBox&&(Ve=Te),xu(e.textCollisionBox.collisionVertexArray,ue.text.placed,!Qe||Ve,Se.text,We.x,We.y)}}if(Ee.iconBox||Ee.verticalIconBox){const Qe=!!(!Te&&Ee.verticalIconBox);let Ve;Ee.iconBox&&(Ve=Qe),Ee.verticalIconBox&&(Ve=!Qe),xu(e.iconCollisionBox.collisionVertexArray,ue.icon.placed,Ve,Se.icon,B?We.x:0,B?We.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,r){const l=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function xu(m,e,r,l,h,g){l&&l.length!==0||(l=[0,0,0,0]);const y=l[0]-Ii,w=l[1]-Ii,T=l[2]-Ii,E=l[3]-Ii;m.emplaceBack(e?1:0,r?1:0,h||0,g||0,y,w),m.emplaceBack(e?1:0,r?1:0,h||0,g||0,T,w),m.emplaceBack(e?1:0,r?1:0,h||0,g||0,T,E),m.emplaceBack(e?1:0,r?1:0,h||0,g||0,y,E)}const Fl=Math.pow(2,25),Ul=Math.pow(2,24),Ia=Math.pow(2,17),Xa=Math.pow(2,16),Ch=Math.pow(2,9),zd=Math.pow(2,8),bu=Math.pow(2,1);function Ec(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const e=m.placed?1:0,r=Math.floor(127*m.opacity);return r*Fl+e*Ul+r*Ia+e*Xa+r*Ch+e*zd+r*bu+e}const ps=0;class wu{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,r,l,h,g){const y=this._bucketParts;for(;this._currentTileIndex<e.length;)if(r.getBucketParts(y,h,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort(((w,T)=>w.sortKey-T.sortKey)));this._currentPartIndex<y.length;)if(r.placeLayerBucketPart(y[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,g())return!0;return!1}}class Ra{constructor(e,r,l,h,g,y,w,T){this.placement=new fs(e,r,y,w,T),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(e,r,l){const h=Ke.now(),g=()=>!this._forceFullPlacement&&Ke.now()-h>2;for(;this._currentPlacementIndex>=0;){const y=r[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(y.type==="symbol"&&(!y.minzoom||y.minzoom<=w)&&(!y.maxzoom||y.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new wu(y)),this._inProgressLayer.continuePlacement(l[y.source],this.placement,this._showCollisionBoxes,y,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const qs=512/d.$/2;class Ac{constructor(e,r,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const h=new Map;for(let g=0;g<r.length;g++){const y=r.get(g),w=y.key,T=h.get(w);T?T.push(y):h.set(w,[y])}for(const[g,y]of h){const w={positions:y.map((T=>({x:Math.floor(T.anchorX*qs),y:Math.floor(T.anchorY*qs)}))),crossTileIDs:y.map((T=>T.crossTileID))};if(w.positions.length>128){const T=new d.aI(w.positions.length,16,Uint16Array);for(const{x:E,y:A}of w.positions)T.add(E,A);T.finish(),delete w.positions,w.index=T}this._symbolsByKey[g]=w}}getScaledCoordinates(e,r){const{x:l,y:h,z:g}=this.tileID.canonical,{x:y,y:w,z:T}=r.canonical,E=qs/Math.pow(2,T-g),A=(w*d.$+e.anchorY)*E,D=h*d.$*qs;return{x:Math.floor((y*d.$+e.anchorX)*E-l*d.$*qs),y:Math.floor(A-D)}}findMatches(e,r,l){const h=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let g=0;g<e.length;g++){const y=e.get(g);if(y.crossTileID)continue;const w=this._symbolsByKey[y.key];if(!w)continue;const T=this.getScaledCoordinates(y,r);if(w.index){const E=w.index.range(T.x-h,T.y-h,T.x+h,T.y+h).sort();for(const A of E){const D=w.crossTileIDs[A];if(!l[D]){l[D]=!0,y.crossTileID=D;break}}}else if(w.positions)for(let E=0;E<w.positions.length;E++){const A=w.positions[E],D=w.crossTileIDs[E];if(Math.abs(A.x-T.x)<=h&&Math.abs(A.y-T.y)<=h&&!l[D]){l[D]=!0,y.crossTileID=D;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class jl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class el{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const r=Math.round((e-this.lng)/360);if(r!==0)for(const l in this.indexes){const h=this.indexes[l],g={};for(const y in h){const w=h[y];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+r),g[w.tileID.key]=w}this.indexes[l]=g}this.lng=e}addBucket(e,r,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let g=0;g<r.symbolInstances.length;g++)r.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const h=this.usedCrossTileIDs[e.overscaledZ];for(const g in this.indexes){const y=this.indexes[g];if(Number(g)>e.overscaledZ)for(const w in y){const T=y[w];T.tileID.isChildOf(e)&&T.findMatches(r.symbolInstances,e,h)}else{const w=y[e.scaledTo(Number(g)).key];w&&w.findMatches(r.symbolInstances,e,h)}}for(let g=0;g<r.symbolInstances.length;g++){const y=r.symbolInstances.get(g);y.crossTileID||(y.crossTileID=l.generate(),h[y.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Ac(e,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(e,r){for(const l of r.getCrossTileIDsLists())for(const h of l)delete this.usedCrossTileIDs[e][h]}removeStaleBuckets(e){let r=!1;for(const l in this.indexes){const h=this.indexes[l];for(const g in h)e[h[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[g]),delete h[g],r=!0)}return r}}class wo{constructor(){this.layerIndexes={},this.crossTileIDs=new jl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,r,l){let h=this.layerIndexes[e.id];h===void 0&&(h=this.layerIndexes[e.id]=new el);let g=!1;const y={};h.handleWrapJump(l);for(const w of r){const T=w.getBucket(e);T&&e.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(w.tileID,T,this.crossTileIDs)&&(g=!0),y[T.bucketInstanceId]=!0)}return h.removeStaleBuckets(y)&&(g=!0),g}pruneUnusedLayers(e){const r={};e.forEach((l=>{r[l]=!0}));for(const l in this.layerIndexes)r[l]||delete this.layerIndexes[l]}}var tl="void main() {fragColor=vec4(1.0);}";const da={prelude:qt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:qt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:qt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:qt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:qt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:qt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:qt(tl,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:qt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:qt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:qt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:qt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:qt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:qt(tl,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:qt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:qt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:qt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:qt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:qt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:qt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:qt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:qt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:qt(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:qt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:qt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:qt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:qt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:qt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:qt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:qt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:qt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:qt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:qt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function qt(m,e){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/in ([\w]+) ([\w]+)/g),h=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=g?g.concat(h):h,w={};return{fragmentSource:m=m.replace(r,((T,E,A,D,P)=>(w[P]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${P}
in ${A} ${D} ${P};
#else
uniform ${A} ${D} u_${P};
#endif
`:`
#ifdef HAS_UNIFORM_u_${P}
    ${A} ${D} ${P} = u_${P};
#endif
`))),vertexSource:e=e.replace(r,((T,E,A,D,P)=>{const B=D==="float"?"vec2":"vec4",N=P.match(/color/)?"color":B;return w[P]?E==="define"?`
#ifndef HAS_UNIFORM_u_${P}
uniform lowp float u_${P}_t;
in ${A} ${B} a_${P};
out ${A} ${D} ${P};
#else
uniform ${A} ${D} u_${P};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${P}
    ${P} = a_${P};
#else
    ${A} ${D} ${P} = u_${P};
#endif
`:`
#ifndef HAS_UNIFORM_u_${P}
    ${P} = unpack_mix_${N}(a_${P}, u_${P}_t);
#else
    ${A} ${D} ${P} = u_${P};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${P}
uniform lowp float u_${P}_t;
in ${A} ${B} a_${P};
#else
uniform ${A} ${D} u_${P};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${P}
    ${A} ${D} ${P} = a_${P};
#else
    ${A} ${D} ${P} = u_${P};
#endif
`:`
#ifndef HAS_UNIFORM_u_${P}
    ${A} ${D} ${P} = unpack_mix_${N}(a_${P}, u_${P}_t);
#else
    ${A} ${D} ${P} = u_${P};
#endif
`})),staticAttributes:l,staticUniforms:y}}class Hs{constructor(e,r,l){this.vertexBuffer=e,this.indexBuffer=r,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var ms=d.aJ([{name:"a_pos",type:"Int16",components:2}]);const xr="#define PROJECTION_MERCATOR",To="mercator";class Ht{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return To}get shaderDefine(){return xr}get shaderPreludeCode(){return da.projectionMercator}get vertexShaderPreludeCode(){return da.projectionMercator.vertexSource}get subdivisionGranularity(){return d.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,r,l,h,g){if(this._cachedMesh)return this._cachedMesh;const y=new d.aL;y.emplaceBack(0,0),y.emplaceBack(d.$,0),y.emplaceBack(0,d.$),y.emplaceBack(d.$,d.$);const w=e.createVertexBuffer(y,ms.members),T=d.aM.simpleSegment(0,0,4,2),E=new d.aN;E.emplaceBack(1,0,2),E.emplaceBack(1,2,3);const A=e.createIndexBuffer(E);return this._cachedMesh=new Hs(w,A,T),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class Lr{constructor(e=0,r=0,l=0,h=0){if(isNaN(e)||e<0||isNaN(r)||r<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=r,this.left=l,this.right=h}interpolate(e,r,l){return r.top!=null&&e.top!=null&&(this.top=d.C.number(e.top,r.top,l)),r.bottom!=null&&e.bottom!=null&&(this.bottom=d.C.number(e.bottom,r.bottom,l)),r.left!=null&&e.left!=null&&(this.left=d.C.number(e.left,r.left,l)),r.right!=null&&e.right!=null&&(this.right=d.C.number(e.right,r.right,l)),this}getCenter(e,r){const l=d.ah((this.left+e-this.right)/2,0,e),h=d.ah((this.top+r-this.bottom)/2,0,r);return new d.P(l,h)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Lr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function rr(m,e){if(!m.renderWorldCopies||m.lngRange)return;const r=e.lng-m.center.lng;e.lng+=r>180?-360:r<-180?360:0}function il(m){return Math.max(0,Math.floor(m))}class oa{constructor(e,r,l,h,g,y){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=y===void 0||!!y,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=h??0,this._maxPitch=g??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new d.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=il(this._zoom),this._scale=d.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Lr,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,r,l){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=il(this._zoom),this._scale=d.af(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Lr(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!l&&e.autoCalculateNearFarZ,r&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const r=d.aO(e,-180,180)*Math.PI/180;var l,h,g,y,w,T,E,A,D;this._bearingInRadians!==r&&(this._unmodified=!1,this._bearingInRadians=r,this._calcMatrices(),this._rotationMatrix=Ie(),l=this._rotationMatrix,g=-this._bearingInRadians,y=(h=this._rotationMatrix)[0],w=h[1],T=h[2],E=h[3],A=Math.sin(g),D=Math.cos(g),l[0]=y*D+T*A,l[1]=w*D+E*A,l[2]=y*-A+T*D,l[3]=w*-A+E*D)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const r=d.ah(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==r&&(this._unmodified=!1,this._pitchInRadians=r,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const r=e/180*Math.PI;this._rollInRadians!==r&&(this._unmodified=!1,this._rollInRadians=r,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return d.aP(this._fovInRadians)}setFov(e){e=d.ah(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=d.ae(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const r=this.getConstrained(this._center,e).zoom;this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this._tileZoom=Math.max(0,Math.floor(r)),this._scale=d.af(r),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,r){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=r,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,r,l){this._unmodified=!1,this._edgeInsets.interpolate(e,r,l),this._constrain(),this._calcMatrices()}resize(e,r,l=!0){this._width=e,this._height=r,l&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Ni([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-d.ai,d.ai])}getConstrained(e,r){return this._callbacks.getConstrained(e,r)}getCameraQueryGeometry(e,r){if(r.length===1)return[r[0],e];{const{minX:l,minY:h,maxX:g,maxY:y}=d.a2.fromPoints(r).extend(e);return[new d.P(l,h),new d.P(g,h),new d.P(g,y),new d.P(l,y),new d.P(l,h)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:r,zoom:l}=this.getConstrained(this.center,this.zoom);this.setCenter(r),this.setZoom(l),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=d.ag(new Float64Array(16));d.N(e,e,[this._width/2,-this._height/2,1]),d.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=d.ag(new Float64Array(16)),d.N(e,e,[1,-1,1]),d.M(e,e,[-1,-1,0]),d.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,r,l,h){const g=l!==void 0?l:this.bearing,y=h=h!==void 0?h:this.pitch,w=d.a1.fromLngLat(e,r),T=-Math.cos(d.ae(y)),E=Math.sin(d.ae(y)),A=E*Math.sin(d.ae(g)),D=-E*Math.cos(d.ae(g));let P=this.elevation;const B=r-P;let N;T*B>=0||Math.abs(T)<.1?(N=1e4,P=r+N*T):N=-B/T;let $,X,Y=d.aQ(1,w.y),Q=0;do{if(Q+=1,Q>10)break;X=N/Y,$=new d.a1(w.x+A*X,w.y+D*X),Y=1/$.meterInMercatorCoordinateUnits()}while(Math.abs(N-X*Y)>1e-12);return{center:$.toLngLat(),elevation:P,zoom:d.ak(this.height/2/Math.tan(this.fovInRadians/2)/X/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const r=d.aj(1,this.center.lat)*this.worldSize,l=this.cameraToCenterDistance/r,h=d.a1.fromLngLat(this.center,this.elevation),g=xe(this.center,this.elevation,this.pitch,this.bearing,l);this._elevation=e;const y=this.calculateCenterFromCameraLngLatAlt(g.toLngLat(),d.aQ(g.z,h.y),this.bearing,this.pitch);this._elevation=y.elevation,this._center=y.center,this.setZoom(y.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=d.aj(1,this.center.lat)*this.worldSize;return xe(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const r=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/r,e.canonical.y/r,1/r/d.$,1/r/d.$]}}class on{constructor(e,r){this.min=e,this.max=r,this.center=d.aR([],d.aS([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],l=d.aT(this.min),h=d.aT(this.max);for(let g=0;g<r.length;g++)l[g]=r[g]?this.min[g]:this.center[g],h[g]=r[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new on(l,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let r=!0;for(let l=0;l<e.planes.length;l++){const h=this.intersectsPlane(e.planes[l]);if(h===0)return 0;h===1&&(r=!1)}return r?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let r=e[3],l=e[3];for(let h=0;h<3;h++)e[h]>0?(r+=e[h]*this.min[h],l+=e[h]*this.max[h]):(l+=e[h]*this.min[h],r+=e[h]*this.max[h]);return r>=0?2:l<0?0:1}}class Rn{distanceToTile2d(e,r,l,h){const g=h.distanceX([e,r]),y=h.distanceY([e,r]);return Math.hypot(g,y)}getWrap(e,r,l){return l}getTileBoundingVolume(e,r,l,h){var g,y;let w=0,T=0;if(h?.terrain){const A=new d.Z(e.z,r,e.z,e.x,e.y),D=h.terrain.getMinMaxElevation(A);w=(g=D.minElevation)!==null&&g!==void 0?g:Math.min(0,l),T=(y=D.maxElevation)!==null&&y!==void 0?y:Math.max(0,l)}const E=1<<e.z;return new on([r+e.x/E,e.y/E,w],[r+(e.x+1)/E,(e.y+1)/E,T])}allowVariableZoom(e,r){const l=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,h=d.ah(78.5-l/2,0,60);return!!r.terrain||e.pitch>h}allowWorldCopies(){return!0}prepareNextFrame(){}}class yn{constructor(e,r,l){this.points=e,this.planes=r,this.aabb=l}static fromInvProjectionMatrix(e,r=1,l=0,h,g){const y=g?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],w=Math.pow(2,l),T=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((P=>(function(B,N,$,X){const Y=d.aw([],B,N),Q=1/Y[3]/$*X;return d.aY(Y,Y,[Q,Q,1/Y[3],Q])})(P,e,r,w)));h&&(function(P,B,N,$){const X=$?4:0,Y=$?0:4;let Q=0;const ee=[],J=[];for(let te=0;te<4;te++){const de=d.aU([],P[te+Y],P[te+X]),Ce=d.aZ(de);d.aR(de,de,1/Ce),ee.push(Ce),J.push(de)}for(let te=0;te<4;te++){const de=d.a_(P[te+X],J[te],N);Q=de!==null&&de>=0?Math.max(Q,de):Math.max(Q,ee[te])}const se=(function(te,de){const Ce=d.aU([],te[de[0]],te[de[1]]),Te=d.aU([],te[de[2]],te[de[1]]),Se=[0,0,0,0];return d.aV(Se,d.aW([],Ce,Te)),Se[3]=-d.aX(Se,te[de[0]]),Se})(P,B),ue=(function(te,de){const Ce=d.a$(te),Te=d.b0([],te,1/Ce),Se=d.aU([],de,d.aR([],Te,d.aX(de,Te))),Ee=d.a$(Se);if(Ee>0){const We=Math.sqrt(1-Te[3]*Te[3]),Qe=d.aR([],Te,-Te[3]),Ve=d.aS([],Qe,d.aR([],Se,We/Ee));return d.b1(de,Ve)}return null})(N,se);if(ue!==null){const te=ue/d.aX(J[0],se);Q=Math.min(Q,te)}for(let te=0;te<4;te++){const de=Math.min(Q,ee[te]);P[te+Y]=[P[te+X][0]+J[te][0]*de,P[te+X][1]+J[te][1]*de,P[te+X][2]+J[te][2]*de,1]}})(T,y[0],h,g);const E=y.map((P=>{const B=d.aU([],T[P[0]],T[P[1]]),N=d.aU([],T[P[2]],T[P[1]]),$=d.aV([],d.aW([],B,N)),X=-d.aX($,T[P[1]]);return $.concat(X)})),A=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],D=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const P of T)for(let B=0;B<3;B++)A[B]=Math.min(A[B],P[B]),D[B]=Math.max(D[B],P[B]);return new yn(T,E,new on(A,D))}}class _i{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,l){return this._helper.interpolatePadding(e,r,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,l=!0){this._helper.resize(e,r,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,r){}constructor(e,r,l,h,g){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new oa({calcMatrices:()=>{this._calcMatrices()},getConstrained:(y,w)=>this.getConstrained(y,w)},e,r,l,h,g),this._coveringTilesDetailsProvider=new Rn}clone(){const e=new _i;return e.apply(this),e}apply(e,r,l){this._helper.apply(e,r,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const r=[new d.b2(0,e)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new d.P(0,0)),h=this.screenPointToMercatorCoordinate(new d.P(this._helper._width,0)),g=this.screenPointToMercatorCoordinate(new d.P(this._helper._width,this._helper._height)),y=this.screenPointToMercatorCoordinate(new d.P(0,this._helper._height)),w=Math.floor(Math.min(l.x,h.x,g.x,y.x)),T=Math.floor(Math.max(l.x,h.x,g.x,y.x)),E=1;for(let A=w-E;A<=T+E;A++)A!==0&&r.push(new d.b2(A,e))}return r}getCameraFrustum(){return yn.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const r=this.screenPointToLocation(this.centerPoint,e),l=e?e.getElevationForLngLatZoom(r,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(e,r){const l=d.aj(this.elevation,this.center.lat),h=this.screenPointToMercatorCoordinateAtZ(r,l),g=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),y=d.a1.fromLngLat(e),w=new d.a1(y.x-(h.x-g.x),y.y-(h.y-g.y));this.setCenter(w?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,r){return r?this.coordinatePoint(d.a1.fromLngLat(e),r.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(d.a1.fromLngLat(e))}screenPointToLocation(e,r){var l;return(l=this.screenPointToMercatorCoordinate(e,r))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(e,r){if(r){const l=r.pointCoordinate(e);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,r){const l=r||0,h=[e.x,e.y,0,1],g=[e.x,e.y,1,1];d.aw(h,h,this._pixelMatrixInverse),d.aw(g,g,this._pixelMatrixInverse);const y=h[3],w=g[3],T=h[1]/y,E=g[1]/w,A=h[2]/y,D=g[2]/w,P=A===D?0:(l-A)/(D-A);return new d.a1(d.C.number(h[0]/y,g[0]/w,P)/this.worldSize,d.C.number(T,E,P)/this.worldSize,l)}coordinatePoint(e,r=0,l=this._pixelMatrix){const h=[e.x*this.worldSize,e.y*this.worldSize,r,1];return d.aw(h,h,l),new d.P(h[0]/h[3],h[1]/h[3])}getBounds(){const e=Math.max(0,this._helper._height/2-oe(this));return new Ni().extend(this.screenPointToLocation(new d.P(0,e))).extend(this.screenPointToLocation(new d.P(this._helper._width,e))).extend(this.screenPointToLocation(new d.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new d.P(0,this._helper._height)))}isPointOnMapSurface(e,r){return r?r.pointCoordinate(e)!=null:e.y>this.height/2-oe(this)}calculatePosMatrix(e,r=!1,l){var h;const g=(h=e.key)!==null&&h!==void 0?h:d.b3(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),y=r?this._alignedPosMatrixCache:this._posMatrixCache;if(y.has(g)){const E=y.get(g);return l?E.f32:E.f64}const w=fe(e,this.worldSize);d.O(w,r?this._alignedProjMatrix:this._viewProjMatrix,w);const T={f64:w,f32:new Float32Array(w)};return y.set(g,T),l?T.f32:T.f64}calculateFogMatrix(e){const r=e.key,l=this._fogMatrixCacheF32;if(l.has(r))return l.get(r);const h=fe(e,this.worldSize);return d.O(h,this._fogMatrix,h),l.set(r,new Float32Array(h)),l.get(r)}getConstrained(e,r){r=d.ah(+r,this.minZoom,this.maxZoom);const l={center:new d.S(e.lng,e.lat),zoom:r};let h=this._helper._lngRange;if(!this._helper._renderWorldCopies&&h===null){const ee=179.9999999999;h=[-ee,ee]}const g=this.tileSize*d.af(l.zoom);let y=0,w=g,T=0,E=g,A=0,D=0;const{x:P,y:B}=this.size;if(this._helper._latRange){const ee=this._helper._latRange;y=d.U(ee[1])*g,w=d.U(ee[0])*g,w-y<B&&(A=B/(w-y))}h&&(T=d.aO(d.V(h[0])*g,0,g),E=d.aO(d.V(h[1])*g,0,g),E<T&&(E+=g),E-T<P&&(D=P/(E-T)));const{x:N,y:$}=G(g,e);let X,Y;const Q=Math.max(D||0,A||0);if(Q){const ee=new d.P(D?(E+T)/2:N,A?(w+y)/2:$);return l.center=ie(g,ee).wrap(),l.zoom+=d.ak(Q),l}if(this._helper._latRange){const ee=B/2;$-ee<y&&(Y=y+ee),$+ee>w&&(Y=w-ee)}if(h){const ee=(T+E)/2;let J=N;this._helper._renderWorldCopies&&(J=d.aO(N,ee-g/2,ee+g/2));const se=P/2;J-se<T&&(X=T+se),J+se>E&&(X=E-se)}if(X!==void 0||Y!==void 0){const ee=new d.P(X??N,Y??$);l.center=ie(g,ee).wrap()}return l}calculateCenterFromCameraLngLatAlt(e,r,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,l,h)}_calculateNearFarZIfNeeded(e,r,l){if(!this._helper.autoCalculateNearFarZ)return;const h=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),g=e-h*this._helper._pixelPerMeter/Math.cos(r),y=h<0?g:e,w=Math.PI/2+this.pitchInRadians,T=d.ae(this.fov)*(Math.abs(Math.cos(d.ae(this.roll)))*this.height+Math.abs(Math.sin(d.ae(this.roll)))*this.width)/this.height*(.5+l.y/this.height),E=Math.sin(T)*y/Math.sin(d.ah(Math.PI-w-T,.01,Math.PI-.01)),A=oe(this),D=Math.atan(A/this._helper.cameraToCenterDistance),P=d.ae(.75),B=D>P?2*D*(.5+l.y/(2*A)):P,N=Math.sin(B)*y/Math.sin(d.ah(Math.PI-w-B,.01,Math.PI-.01)),$=Math.min(E,N);this._helper._farZ=1.01*(Math.cos(Math.PI/2-r)*$+y),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,r=G(this.worldSize,this.center),l=r.x,h=r.y;this._helper._pixelPerMeter=d.aj(1,this.center.lat)*this.worldSize;const g=d.ae(Math.min(this.pitch,j)),y=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(g));let w;this._calculateNearFarZIfNeeded(y,g,e),w=new Float64Array(16),d.b4(w,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),d.aq(this._invProjMatrix,w),w[8]=2*-e.x/this._helper._width,w[9]=2*e.y/this._helper._height,this._projectionMatrix=d.b5(w),d.N(w,w,[1,-1,1]),d.M(w,w,[0,0,-this._helper.cameraToCenterDistance]),d.b6(w,w,-this.rollInRadians),d.b7(w,w,this.pitchInRadians),d.b6(w,w,-this.bearingInRadians),d.M(w,w,[-l,-h,0]),this._mercatorMatrix=d.N([],w,[this.worldSize,this.worldSize,this.worldSize]),d.N(w,w,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=d.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,w),d.M(w,w,[0,0,-this.elevation]),this._viewProjMatrix=w,this._invViewProjMatrix=d.aq([],w);const T=[0,0,-1,1];d.aw(T,T,this._invViewProjMatrix),this._cameraPosition=[T[0]/T[3],T[1]/T[3],T[2]/T[3]],this._fogMatrix=new Float64Array(16),d.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,y,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,d.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),d.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),d.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),d.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),d.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),d.M(this._fogMatrix,this._fogMatrix,[-l,-h,0]),d.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),d.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=d.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,w);const E=this._helper._width%2/2,A=this._helper._height%2/2,D=Math.cos(this.bearingInRadians),P=Math.sin(-this.bearingInRadians),B=l-Math.round(l)+D*E+P*A,N=h-Math.round(h)+D*A+P*E,$=new Float64Array(w);if(d.M($,$,[B>.5?B-1:B,N>.5?N-1:N,0]),this._alignedProjMatrix=$,w=d.aq(new Float64Array(16),this._pixelMatrix),!w)throw new Error("failed to invert matrix");this._pixelMatrixInverse=w,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new d.P(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return d.aw(r,r,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=d.aj(1,this.center.lat)*this.worldSize;return xe(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,r){const l=d.a1.fromLngLat(e),h=[l.x*this.worldSize,l.y*this.worldSize,r,1];return d.aw(h,h,this._viewProjMatrix),h[2]/h[3]}getProjectionData(e){const{overscaledTileID:r,aligned:l,applyTerrainMatrix:h}=e,g=this._helper.getMercatorTileCoordinates(r),y=r?this.calculatePosMatrix(r,l,!0):null;let w;return w=r&&r.terrainRttPosMatrix32f&&h?r.terrainRttPosMatrix32f:y||d.b8(),{mainMatrix:w,tileMercatorCoords:g,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:w}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,r,l){return 1}transformLightDirection(e){return d.aT(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,r,l,h){const g=this.calculatePosMatrix(l);let y;h?(y=[e,r,h(e,r),1],d.aw(y,y,g)):(y=[e,r,0,1],Ir(y,y,g));const w=y[3];return{point:new d.P(y[0]/w,y[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}populateCache(e){for(const r of e)this.calculatePosMatrix(r)}getMatrixForModel(e,r){const l=d.a1.fromLngLat(e,r),h=l.meterInMercatorCoordinateUnits(),g=d.b9();return d.M(g,g,[l.x,l.y,l.z]),d.b6(g,g,Math.PI),d.b7(g,g,Math.PI/2),d.N(g,g,[-h,h,h]),g}getProjectionDataForCustomLayer(e=!0){const r=new d.Z(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:r,applyGlobeMatrix:e}),h=fe(r,this.worldSize);d.O(h,this._viewProjMatrix,h),l.tileMercatorCoords=[0,0,1,1];const g=[d.$,d.$,this.worldSize/this._helper.pixelsPerMeter],y=d.ba();return d.N(y,h,g),l.fallbackMatrix=y,l.mainMatrix=y,l}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Tu(){d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Vn(m){if(m.useSlerp)if(m.k<1){const e=d.bb(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),r=d.bb(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),l=new Float64Array(4);d.bc(l,e,r,m.k);const h=d.bd(l);m.tr.setRoll(h.roll),m.tr.setPitch(h.pitch),m.tr.setBearing(h.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(d.C.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(d.C.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(d.C.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function vn(m,e,r,l,h){const g=h.padding,y=G(h.worldSize,r.getNorthWest()),w=G(h.worldSize,r.getNorthEast()),T=G(h.worldSize,r.getSouthEast()),E=G(h.worldSize,r.getSouthWest()),A=d.ae(-l),D=y.rotate(A),P=w.rotate(A),B=T.rotate(A),N=E.rotate(A),$=new d.P(Math.max(D.x,P.x,N.x,B.x),Math.max(D.y,P.y,N.y,B.y)),X=new d.P(Math.min(D.x,P.x,N.x,B.x),Math.min(D.y,P.y,N.y,B.y)),Y=$.sub(X),Q=(h.width-(g.left+g.right+e.left+e.right))/Y.x,ee=(h.height-(g.top+g.bottom+e.top+e.bottom))/Y.y;if(ee<0||Q<0)return void Tu();const J=Math.min(d.ak(h.scale*Math.min(Q,ee)),m.maxZoom),se=d.P.convert(m.offset),ue=new d.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(d.ae(l)),te=se.add(ue).mult(h.scale/d.af(J));return{center:ie(h.worldSize,y.add(T).div(2).sub(te)),zoom:J,bearing:l}}class Wn{get useGlobeControls(){return!1}handlePanInertia(e,r){const l=e.mag(),h=Math.abs(oe(r));return{easingOffset:e.mult(Math.min(.75*h/l,1)),easingCenter:r.center}}handleMapControlsRollPitchBearingZoom(e,r){e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta),e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta)}handleMapControlsPan(e,r,l){e.around.distSqr(r.centerPoint)<.01||r.setLocationAtPoint(l,e.around)}cameraForBoxAndBearing(e,r,l,h,g){return vn(e,r,l,h,g)}handleJumpToCenterZoom(e,r){e.zoom!==(r.zoom!==void 0?+r.zoom:e.zoom)&&e.setZoom(+r.zoom),r.center!==void 0&&e.setCenter(d.S.convert(r.center))}handleEaseTo(e,r){const l=e.zoom,h=e.padding,g={roll:e.roll,pitch:e.pitch,bearing:e.bearing},y={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},w=r.zoom!==void 0,T=!e.isPaddingEqual(r.padding);let E=!1;const A=w?+r.zoom:e.zoom;let D=e.centerPoint.add(r.offsetAsPoint);const P=e.screenPointToLocation(D),{center:B,zoom:N}=e.getConstrained(d.S.convert(r.center||P),A??l);rr(e,B);const $=G(e.worldSize,P),X=G(e.worldSize,B).sub($),Y=d.af(N-l);return E=N!==l,{easeFunc:Q=>{if(E&&e.setZoom(d.C.number(l,N,Q)),d.be(g,y)||Vn({startEulerAngles:g,endEulerAngles:y,tr:e,k:Q,useSlerp:g.roll!=y.roll}),T&&(e.interpolatePadding(h,r.padding,Q),D=e.centerPoint.add(r.offsetAsPoint)),r.around)e.setLocationAtPoint(r.around,r.aroundPoint);else{const ee=d.af(e.zoom-l),J=N>l?Math.min(2,Y):Math.max(.5,Y),se=Math.pow(J,1-Q),ue=ie(e.worldSize,$.add(X.mult(Q*se)).mult(ee));e.setLocationAtPoint(e.renderWorldCopies?ue.wrap():ue,D)}},isZooming:E,elevationCenter:B}}handleFlyTo(e,r){const l=r.zoom!==void 0,h=e.zoom,g=e.getConstrained(d.S.convert(r.center||r.locationAtOffset),l?+r.zoom:h),y=g.center,w=g.zoom;rr(e,y);const T=G(e.worldSize,r.locationAtOffset),E=G(e.worldSize,y).sub(T),A=E.mag(),D=d.af(w-h);let P;if(r.minZoom!==void 0){const B=Math.min(+r.minZoom,h,w),N=e.getConstrained(y,B).zoom;P=d.af(N-h)}return{easeFunc:(B,N,$,X)=>{e.setZoom(B===1?w:h+d.ak(N));const Y=B===1?y:ie(e.worldSize,T.add(E.mult($)).mult(N));e.setLocationAtPoint(e.renderWorldCopies?Y.wrap():Y,X)},scaleOfZoom:D,targetCenter:y,scaleOfMinZoom:P,pixelPathLength:A}}}class yi{constructor(e,r,l){this.blendFunction=e,this.blendColor=r,this.mask=l}}yi.Replace=[1,0],yi.disabled=new yi(yi.Replace,d.bf.transparent,[!1,!1,!1,!1]),yi.unblended=new yi(yi.Replace,d.bf.transparent,[!0,!0,!0,!0]),yi.alphaBlended=new yi([1,771],d.bf.transparent,[!0,!0,!0,!0]);const La=2305;class bt{constructor(e,r,l){this.enable=e,this.mode=r,this.frontFace=l}}bt.disabled=new bt(!1,1029,La),bt.backCCW=new bt(!0,1029,La),bt.frontCCW=new bt(!0,1028,La);class zt{constructor(e,r,l){this.func=e,this.mask=r,this.range=l}}zt.ReadOnly=!1,zt.ReadWrite=!0,zt.disabled=new zt(519,zt.ReadOnly,[0,1]);const kr=7680;class Yt{constructor(e,r,l,h,g,y){this.test=e,this.ref=r,this.mask=l,this.fail=h,this.depthFail=g,this.pass=y}}Yt.disabled=new Yt({func:519,mask:0},0,0,kr,kr,kr);const fa=new WeakMap;function br(m){var e;if(fa.has(m))return fa.get(m);{const r=(e=m.getParameter(m.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return fa.set(m,r),r}}class ln{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const r=e.context,l=r.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const h=new d.aL;h.emplaceBack(-1,-1),h.emplaceBack(2,-1),h.emplaceBack(-1,2);const g=new d.aN;g.emplaceBack(0,1,2),this._fullscreenTriangle=new Hs(r.createVertexBuffer(h,ms.members),r.createIndexBuffer(g),d.aM.simpleSegment(0,0,h.length,g.length)),this._resultBuffer=new Uint8Array(4),r.activeTexture.set(l.TEXTURE1);const y=l.createTexture();l.bindTexture(l.TEXTURE_2D,y),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=r.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(y),br(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,r){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,r),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,r=e.gl;e.activeTexture.set(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,r){const l=this._cachedRenderContext.context,h=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:d.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,h.TRIANGLES,zt.disabled,Yt.disabled,yi.unblended,bt.disabled,((g,y)=>({u_input:g,u_output_expected:y}))(e,r),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&br(h)){h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.readBuffer(h.COLOR_ATTACHMENT0),h.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null);const g=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:g}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&br(e)){const r=e.clientWaitSync(this._readbackQueue.sync,0,0);if(r===e.WAIT_FAILED)return d.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(r===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=ln._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let r=0;return r+=e[0]/256,r+=e[1]/65536,r+=e[2]/16777216,e[3]<127&&(r=-r),r/128}}const Br=d.$/128;function nl(m,e){const r=m.granularity!==void 0?Math.max(m.granularity,1):1,l=r+(m.generateBorders?2:0),h=r+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),g=l+1,y=h+1,w=m.generateBorders?-1:0,T=m.generateBorders||m.extendToNorthPole?-1:0,E=r+(m.generateBorders?1:0),A=r+(m.generateBorders||m.extendToSouthPole?1:0),D=g*y,P=l*h*6,B=g*y>65536;if(B&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const N=B||e==="32bit",$=new Int16Array(2*D);let X=0;for(let ee=T;ee<=A;ee++)for(let J=w;J<=E;J++){let se=J/r*d.$;J===-1&&(se=-Br),J===r+1&&(se=d.$+Br);let ue=ee/r*d.$;ee===-1&&(ue=m.extendToNorthPole?d.bh:-Br),ee===r+1&&(ue=m.extendToSouthPole?d.bi:d.$+Br),$[X++]=se,$[X++]=ue}const Y=N?new Uint32Array(P):new Uint16Array(P);let Q=0;for(let ee=0;ee<h;ee++)for(let J=0;J<l;J++){const se=J+1+ee*g,ue=J+(ee+1)*g,te=J+1+(ee+1)*g;Y[Q++]=J+ee*g,Y[Q++]=ue,Y[Q++]=se,Y[Q++]=se,Y[Q++]=ue,Y[Q++]=te}return{vertices:$.buffer.slice(0),indices:Y.buffer.slice(0),uses32bitIndices:N}}const Or=new d.aK({fill:new d.bj(128,2),line:new d.bj(512,0),tile:new d.bj(128,32),stencil:new d.bj(128,1),circle:3});class Nl{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return da.projectionGlobe}get vertexShaderPreludeCode(){return da.projectionMercator.vertexSource}get subdivisionGranularity(){return Or}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new ln(e));const r=d.U(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-r*Math.PI*2))-.5*Math.PI,h=this._errorMeasurement.updateErrorLoop(r,l),g=Ke.now();h!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=h,this._errorMeasurementLastChangeTime=g);const y=Math.min(Math.max((g-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=d.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,d.bl(y))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,r,l,h,g){const y=(g==="stencil"?Or.stencil:Or.tile).getGranularityForZoomLevel(r.z);return this._getMesh(e,{granularity:y,generateBorders:l,extendToNorthPole:r.y===0&&h,extendToSouthPole:r.y===(1<<r.z)-1&&h})}_getMesh(e,r){const l=this._getMeshKey(r);if(l in this._tileMeshCache)return this._tileMeshCache[l];const h=(function(g,y){const w=nl(y,"16bit"),T=d.aL.deserialize({arrayBuffer:w.vertices,length:w.vertices.byteLength/2/2}),E=d.aN.deserialize({arrayBuffer:w.indices,length:w.indices.byteLength/2/3});return new Hs(g.createVertexBuffer(T,ms.members),g.createIndexBuffer(E),d.aM.simpleSegment(0,0,T.length,E.length))})(e,r);return this._tileMeshCache[l]=h,h}recalculate(e){}hasTransition(){const e=Ke.now();let r=!1;return r=r||(e-this._errorMeasurementLastChangeTime)/1e3<.7,r=r||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,r}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const al=new d.r({type:new d.D(d.v.projection.type)});class rl extends d.E{constructor(e){super(),this._transitionable=new d.t(al,void 0),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.F(0)),this._mercatorProjection=new Ht,this._verticalPerspectiveProjection=new Nl}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof d.bm){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,r,l,h,g){return this.currentProjection.getMeshFromTileID(e,r,l,h,g)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function $s(m){const e=sl(m.worldSize,m.center.lat);return 2*Math.PI*e}function ka(m,e,r,l,h){const g=1/(1<<h),y=e/d.$*g+l*g,w=d.bo((m/d.$*g+r*g)*Math.PI*2+Math.PI,2*Math.PI),T=2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI,E=Math.cos(T),A=new Float64Array(3);return A[0]=Math.sin(w)*E,A[1]=Math.sin(T),A[2]=Math.cos(w)*E,A}function Zn(m){return(function(e,r){const l=Math.cos(r),h=new Float64Array(3);return h[0]=Math.sin(e)*l,h[1]=Math.sin(r),h[2]=Math.cos(e)*l,h})(m.lng*Math.PI/180,m.lat*Math.PI/180)}function sl(m,e){return m/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Vl(m){const e=Math.asin(m[1])/Math.PI*180,r=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(r>1e-6){const l=m[0]/r,h=Math.acos(m[2]/r),g=(l>0?h:-h)/Math.PI*180;return new d.S(d.aO(g,-180,180),e)}return new d.S(0,e)}function So(m){return Math.cos(m*Math.PI/180)}function Wi(m,e){const r=So(m),l=So(e);return d.ak(l/r)}function Eh(m,e){const r=m.rotate(e.bearingInRadians),l=e.zoom+Wi(e.center.lat,0),h=d.bk(1/So(e.center.lat),1/So(Math.min(Math.abs(e.center.lat),60)),d.bn(l,7,3,0,1)),g=360/$s({worldSize:e.worldSize,center:{lat:e.center.lat}});return new d.S(e.center.lng-r.x*g*h,d.ah(e.center.lat+r.y*g,-d.ai,d.ai))}function Zl(m){const e=.5*m,r=Math.sin(e),l=Math.cos(e);return Math.log(r+l)-Math.log(l-r)}function Su(m,e,r,l){const h=m.lat+r*l;if(Math.abs(r)>1){const g=(Math.sign(m.lat+r)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,y=Math.abs(m.lat+r)*Math.PI/180,w=Zl(g+l*(y-g)),T=Zl(g),E=Zl(y);return new d.S(m.lng+e*((w-T)/(E-T)),h)}return new d.S(m.lng+e*l,h)}class Pd{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,r,l,h){const g=`${e.z}_${e.x}_${e.y}_${h?.terrain?"t":""}`,y=this._cache.get(g);if(y)return y;const w=this._cachePrevious.get(g);if(w)return this._cache.set(g,w),w;const T=this._boundingVolumeFactory(e,r,l,h);return this._cache.set(g,T),this._hadAnyChanges=!0,T}}class ol{constructor(e,r,l,h){this.min=l,this.max=h,this.points=e,this.planes=r}static fromAabb(e,r){const l=[];for(let h=0;h<8;h++)l.push([1&~h?e[0]:r[0],(h>>1&1)==1?r[1]:e[1],(h>>2&1)==1?r[2]:e[2]]);return new ol(l,[[-1,0,0,r[0]],[1,0,0,-e[0]],[0,-1,0,r[1]],[0,1,0,-e[1]],[0,0,-1,r[2]],[0,0,1,-e[2]]],e,r)}static fromCenterSizeAngles(e,r,l){const h=d.br([],l[0],l[1],l[2]),g=d.bs([],[r[0],0,0],h),y=d.bs([],[0,r[1],0],h),w=d.bs([],[0,0,r[2]],h),T=[...e],E=[...e];for(let D=0;D<8;D++)for(let P=0;P<3;P++){const B=e[P]+g[P]*(1&~D?-1:1)+y[P]*((D>>1&1)==1?1:-1)+w[P]*((D>>2&1)==1?1:-1);T[P]=Math.min(T[P],B),E[P]=Math.max(E[P],B)}const A=[];for(let D=0;D<8;D++){const P=[...e];d.aS(P,P,d.aR([],g,1&~D?-1:1)),d.aS(P,P,d.aR([],y,(D>>1&1)==1?1:-1)),d.aS(P,P,d.aR([],w,(D>>2&1)==1?1:-1)),A.push(P)}return new ol(A,[[...g,-d.aX(g,A[0])],[...y,-d.aX(y,A[0])],[...w,-d.aX(w,A[0])],[-g[0],-g[1],-g[2],-d.aX(g,A[7])],[-y[0],-y[1],-y[2],-d.aX(y,A[7])],[-w[0],-w[1],-w[2],-d.aX(w,A[7])]],T,E)}intersectsFrustum(e){let r=!0;const l=this.points.length,h=this.planes.length,g=e.planes.length,y=e.points.length;for(let w=0;w<g;w++){const T=e.planes[w];let E=0;for(let A=0;A<l;A++){const D=this.points[A];T[0]*D[0]+T[1]*D[1]+T[2]*D[2]+T[3]>=0&&E++}if(E===0)return 0;E<l&&(r=!1)}if(r)return 2;for(let w=0;w<h;w++){const T=this.planes[w];let E=0;for(let A=0;A<y;A++){const D=e.points[A];T[0]*D[0]+T[1]*D[1]+T[2]*D[2]+T[3]>=0&&E++}if(E===0)return 0}return 1}intersectsPlane(e){const r=this.points.length;let l=0;for(let h=0;h<r;h++){const g=this.points[h];e[0]*g[0]+e[1]*g[1]+e[2]*g[2]+e[3]>=0&&l++}return l===r?2:l===0?0:1}}function Jn(m,e,r){const l=m-e;return l<0?-l:Math.max(0,l-r)}function Gl(m,e,r,l,h){const g=m-r;let y;return y=g<0?Math.min(-g,1+g-h):g>1?Math.min(Math.max(g-h,0),1-g):0,Math.max(y,Jn(e,l,h))}class Fr{constructor(){this._boundingVolumeCache=new Pd(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,r,l,h){const g=1<<l.z,y=1/g,w=l.x/g,T=l.y/g;let E=2;return E=Math.min(E,Gl(e,r,w,T,y)),E=Math.min(E,Gl(e,r,w+.5,-T-y,y)),E=Math.min(E,Gl(e,r,w+.5,2-T-y,y)),E}getWrap(e,r,l){const h=1<<r.z,g=1/h,y=r.x/h,w=Jn(e.x,y,g),T=Jn(e.x,y-1,g),E=Jn(e.x,y+1,g),A=Math.min(w,T,E);return A===E?1:A===T?-1:0}allowVariableZoom(e,r){return ct(e,r)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,r,l,h){return this._boundingVolumeCache.getTileBoundingVolume(e,r,l,h)}_computeTileBoundingVolume(e,r,l,h){var g,y;let w=0,T=0;if(h?.terrain){const E=new d.Z(e.z,r,e.z,e.x,e.y),A=h.terrain.getMinMaxElevation(E);w=(g=A.minElevation)!==null&&g!==void 0?g:Math.min(0,l),T=(y=A.maxElevation)!==null&&y!==void 0?y:Math.max(0,l)}if(w/=d.bu,T/=d.bu,w+=1,T+=1,e.z<=0)return ol.fromAabb([-T,-T,-T],[T,T,T]);if(e.z===1)return ol.fromAabb([e.x===0?-T:0,e.y===0?0:-T,-T],[e.x===0?0:T,e.y===0?T:0,T]);{const E=[ka(0,0,e.x,e.y,e.z),ka(d.$,0,e.x,e.y,e.z),ka(d.$,d.$,e.x,e.y,e.z),ka(0,d.$,e.x,e.y,e.z)],A=[];for(const Se of E)A.push(d.aR([],Se,T));if(T!==w)for(const Se of E)A.push(d.aR([],Se,w));e.y===0&&A.push([0,1,0]),e.y===(1<<e.z)-1&&A.push([0,-1,0]);const D=[1,1,1],P=[-1,-1,-1];for(const Se of A)for(let Ee=0;Ee<3;Ee++)D[Ee]=Math.min(D[Ee],Se[Ee]),P[Ee]=Math.max(P[Ee],Se[Ee]);const B=ka(d.$/2,d.$/2,e.x,e.y,e.z),N=d.aW([],[0,1,0],B);d.aV(N,N);const $=d.aW([],B,N);d.aV($,$);const X=d.aW([],E[2],E[1]);d.aV(X,X);const Y=d.aW([],E[0],E[3]);d.aV(Y,Y),A.push(d.aR([],B,T)),e.y>=(1<<e.z)/2&&A.push(d.aR([],ka(d.$/2,0,e.x,e.y,e.z),T)),e.y<(1<<e.z)/2&&A.push(d.aR([],ka(d.$/2,d.$,e.x,e.y,e.z),T));const Q=ql(B,A),ee=ql($,A),J=[-B[0],-B[1],-B[2],Q.max],se=[B[0],B[1],B[2],-Q.min],ue=[-$[0],-$[1],-$[2],ee.max],te=[$[0],$[1],$[2],-ee.min],de=[...X,0],Ce=[...Y,0],Te=[];return e.y===0?Te.push(d.bt(Ce,de,J),d.bt(Ce,de,se)):Te.push(d.bt(ue,de,J),d.bt(ue,de,se),d.bt(ue,Ce,J),d.bt(ue,Ce,se)),e.y===(1<<e.z)-1?Te.push(d.bt(Ce,de,J),d.bt(Ce,de,se)):Te.push(d.bt(te,de,J),d.bt(te,de,se),d.bt(te,Ce,J),d.bt(te,Ce,se)),new ol(Te,[J,se,ue,te,de,Ce],D,P)}}}function ql(m,e){let r=1/0,l=-1/0;for(const h of e){const g=d.aX(m,h);r=Math.min(r,g),l=Math.max(l,g)}return{min:r,max:l}}class Hl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,l){return this._helper.interpolatePadding(e,r,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r){this._helper.resize(e,r)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=d.bv(),this._projectionMatrix=d.b9(),this._globeViewProjMatrix32f=d.b8(),this._globeViewProjMatrixNoCorrection=d.b9(),this._globeViewProjMatrixNoCorrectionInverted=d.b9(),this._globeProjMatrixInverted=d.b9(),this._cameraPosition=d.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new oa({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,r)=>this.getConstrained(e,r)}),this._coveringTilesDetailsProvider=new Fr}clone(){const e=new Hl;return e.apply(this),e}apply(e,r){this._globeLatitudeErrorCorrectionRadians=r||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=d.bp();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:r,applyGlobeMatrix:l}=e,h=this._helper.getMercatorTileCoordinates(r);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:h,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const r=this.pitchInRadians,l=this.cameraToCenterDistance/e,h=Math.sin(r)*l,g=Math.cos(r)*l+1,y=1/Math.sqrt(h*h+g*g)*1;let w=-h,T=g;const E=Math.sqrt(w*w+T*T);w/=E,T/=E;const A=[0,w,T];d.bw(A,A,[0,0,0],-this.bearingInRadians),d.bx(A,A,[0,0,0],-1*this.center.lat*Math.PI/180),d.by(A,A,[0,0,0],this.center.lng*Math.PI/180);const D=1/d.aZ(A);return d.aR(A,A,D),[...A,-y*D]}isLocationOccluded(e){return!this.isSurfacePointVisible(Zn(e))}transformLightDirection(e){const r=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,h=Math.cos(l),g=[Math.sin(r)*h,Math.sin(l),Math.cos(r)*h],y=[g[2],0,-g[0]],w=[0,0,0];d.aW(w,y,g),d.aV(y,y),d.aV(w,w);const T=[0,0,0];return d.aV(T,[y[0]*e[0]+w[0]*e[1]+g[0]*e[2],y[1]*e[0]+w[1]*e[1]+g[1]*e[2],y[2]*e[0]+w[2]*e[1]+g[2]*e[2]]),T}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,r,l){const h=(function(w,T,E){const A=1/(1<<E.z);return new d.a1(w/d.$*A+E.x*A,T/d.$*A+E.y*A)})(e,r,l.canonical),g=(y=h.y,[d.bo(h.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI]);var y;return this.getCircleRadiusCorrection()/Math.cos(g[1])}projectTileCoordinates(e,r,l,h){const g=l.canonical,y=ka(e,r,g.x,g.y,g.z),w=1+(h?h(e,r):0)/d.bu,T=[y[0]*w,y[1]*w,y[2]*w,1];d.aw(T,T,this._globeViewProjMatrixNoCorrection);const E=this._cachedClippingPlane,A=E[0]*y[0]+E[1]*y[1]+E[2]*y[2]+E[3]<0;return{point:new d.P(T[0]/T[3],T[1]/T[3]),signedDistanceFromCamera:T[3],isOccluded:A}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=sl(this.worldSize,this.center.lat),r=d.ba(),l=d.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),d.b4(r,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const h=this.centerOffset;r[8]=2*-h.x/this._helper._width,r[9]=2*h.y/this._helper._height,this._projectionMatrix=d.b5(r),this._globeProjMatrixInverted=d.ba(),d.aq(this._globeProjMatrixInverted,r),d.M(r,r,[0,0,-this.cameraToCenterDistance]),d.b6(r,r,this.rollInRadians),d.b7(r,r,-this.pitchInRadians),d.b6(r,r,this.bearingInRadians),d.M(r,r,[0,0,-e]);const g=d.bp();g[0]=e,g[1]=e,g[2]=e,d.b7(l,r,this.center.lat*Math.PI/180),d.bz(l,l,-this.center.lng*Math.PI/180),d.N(l,l,g),this._globeViewProjMatrixNoCorrection=l,d.b7(r,r,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),d.bz(r,r,-this.center.lng*Math.PI/180),d.N(r,r,g),this._globeViewProjMatrix32f=new Float32Array(r),this._globeViewProjMatrixNoCorrectionInverted=d.ba(),d.aq(this._globeViewProjMatrixNoCorrectionInverted,l);const y=d.bp();this._cameraPosition=d.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/e,d.bw(this._cameraPosition,this._cameraPosition,y,-this.rollInRadians),d.bx(this._cameraPosition,this._cameraPosition,y,this.pitchInRadians),d.bw(this._cameraPosition,this._cameraPosition,y,-this.bearingInRadians),d.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),d.bx(this._cameraPosition,this._cameraPosition,y,-this.center.lat*Math.PI/180),d.by(this._cameraPosition,this._cameraPosition,y,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const w=d.b5(this._globeViewProjMatrixNoCorrectionInverted);d.N(w,w,[1,1,-1]),this._cachedFrustum=yn.fromInvProjectionMatrix(w,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){d.w("calculateFogMatrix is not supported on globe projection.");const r=d.ba();return d.ag(r),r}getVisibleUnwrappedCoordinates(e){return[new d.b2(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&d.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=Zn(e);d.aR(l,l,1+r/d.bu);const h=d.bv();return d.aw(h,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),h[2]/h[3]}populateCache(e){}getBounds(){const e=.5*this.width,r=.5*this.height,l=[new d.P(0,0),new d.P(e,0),new d.P(this.width,0),new d.P(this.width,r),new d.P(this.width,this.height),new d.P(e,this.height),new d.P(0,this.height),new d.P(0,r)],h=[];for(const D of l)h.push(this.unprojectScreenPoint(D));let g=0,y=0,w=0,T=0;const E=this.center;for(const D of h){const P=d.bA(E.lng,D.lng),B=d.bA(E.lat,D.lat);P<y&&(y=P),P>g&&(g=P),B<T&&(T=B),B>w&&(w=B)}const A=[E.lng+y,E.lat+T,E.lng+g,E.lat+w];return this.isSurfacePointOnScreen([0,1,0])&&(A[3]=90,A[0]=-180,A[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(A[1]=-90,A[0]=-180,A[2]=180),new Ni(A)}getConstrained(e,r){const l=d.ah(e.lat,-d.ai,d.ai),h=d.ah(+r,this.minZoom+Wi(0,l),this.maxZoom);return{center:new d.S(e.lng,l),zoom:h}}calculateCenterFromCameraLngLatAlt(e,r,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,l,h)}setLocationAtPoint(e,r){const l=Zn(this.unprojectScreenPoint(r)),h=Zn(e),g=d.bp();d.bB(g);const y=d.bp();d.by(y,l,g,-this.center.lng*Math.PI/180),d.bx(y,y,g,this.center.lat*Math.PI/180);const w=h[0]*h[0]+h[2]*h[2],T=y[0]*y[0];if(w<T)return;const E=Math.sqrt(w-T),A=-E,D=d.bC(h[0],h[2],y[0],E),P=d.bC(h[0],h[2],y[0],A),B=d.bp();d.by(B,h,g,-D);const N=d.bC(B[1],B[2],y[1],y[2]),$=d.bp();d.by($,h,g,-P);const X=d.bC($[1],$[2],y[1],y[2]),Y=.5*Math.PI,Q=N>=-Y&&N<=Y,ee=X>=-Y&&X<=Y;let J,se;if(Q&&ee){const Ce=this.center.lng*Math.PI/180,Te=this.center.lat*Math.PI/180;d.bD(D,Ce)+d.bD(N,Te)<d.bD(P,Ce)+d.bD(X,Te)?(J=D,se=N):(J=P,se=X)}else if(Q)J=D,se=N;else{if(!ee)return;J=P,se=X}const ue=J/Math.PI*180,te=se/Math.PI*180,de=this.center.lat;this.setCenter(new d.S(ue,d.ah(te,-90,90))),this.setZoom(this.zoom+Wi(de,this.center.lat))}locationToScreenPoint(e,r){const l=Zn(e);if(r){const h=r.getElevationForLngLatZoom(e,this._helper._tileZoom);d.aR(l,l,1+h/d.bu)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(e){const r=d.bv();return d.aw(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],new d.P((.5*r[0]+.5)*this.width,(.5*-r[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,r){if(r){const l=r.pointCoordinate(e);if(l)return l}return d.a1.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,r){var l;return(l=this.screenPointToMercatorCoordinate(e,r))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(e,r){const l=this._cameraPosition,h=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(l,h)}getRayDirectionFromPixel(e){const r=d.bv();r[0]=e.x/this.width*2-1,r[1]=-1*(e.y/this.height*2-1),r[2]=1,r[3]=1,d.aw(r,r,this._globeViewProjMatrixNoCorrectionInverted),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3];const l=d.bp();l[0]=r[0]-this._cameraPosition[0],l[1]=r[1]-this._cameraPosition[1],l[2]=r[2]-this._cameraPosition[2];const h=d.bp();return d.aV(h,l),h}isSurfacePointVisible(e){const r=this._cachedClippingPlane;return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const r=d.bv();return d.aw(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3],r[0]>-1&&r[0]<1&&r[1]>-1&&r[1]<1&&r[2]>-1&&r[2]<1}rayPlanetIntersection(e,r){const l=d.aX(e,r),h=d.bp(),g=d.bp();d.aR(g,r,l),d.aU(h,e,g);const y=1-d.aX(h,h);if(y<0)return null;const w=d.aX(e,e)-1,T=-l+(l<0?1:-1)*Math.sqrt(y),E=w/T,A=T;return{tMin:Math.min(E,A),tMax:Math.max(E,A)}}unprojectScreenPoint(e){const r=this._cameraPosition,l=this.getRayDirectionFromPixel(e),h=this.rayPlanetIntersection(r,l);if(h){const A=d.bp();d.aS(A,r,[l[0]*h.tMin,l[1]*h.tMin,l[2]*h.tMin]);const D=d.bp();return d.aV(D,A),Vl(D)}const g=this._cachedClippingPlane,y=g[0]*l[0]+g[1]*l[1]+g[2]*l[2],w=-d.b1(g,r)/y,T=d.bp();if(w>0)d.aS(T,r,[l[0]*w,l[1]*w,l[2]*w]);else{const A=d.bp();d.aS(A,r,[2*l[0],2*l[1],2*l[2]]);const D=d.b1(this._cachedClippingPlane,A);d.aU(T,A,[this._cachedClippingPlane[0]*D,this._cachedClippingPlane[1]*D,this._cachedClippingPlane[2]*D])}const E=(function(A){const D=d.bp();return D[0]=A[0]*-A[3],D[1]=A[1]*-A[3],D[2]=A[2]*-A[3],{center:D,radius:Math.sqrt(1-A[3]*A[3])}})(g);return Vl((function(A,D,P){const B=d.bp();d.aU(B,P,A);const N=d.bp();return d.bq(N,A,B,D/d.a$(B)),N})(E.center,E.radius,T))}getMatrixForModel(e,r){const l=d.S.convert(e),h=1/d.bu,g=d.b9();return d.bz(g,g,l.lng/180*Math.PI),d.b7(g,g,-l.lat/180*Math.PI),d.M(g,g,[0,0,1+r/d.bu]),d.b7(g,g,.5*Math.PI),d.N(g,g,[h,h,h]),g}getProjectionDataForCustomLayer(e=!0){const r=this.getProjectionData({overscaledTileID:new d.Z(0,0,0,0,0),applyGlobeMatrix:e});return r.tileMercatorCoords=[0,0,1,1],r}getFastPathSimpleProjectionMatrix(e){}}class Mo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,l){return this._helper.interpolatePadding(e,r,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,l=!0){this._helper.resize(e,r,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,r){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=r,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new oa({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,r)=>this.getConstrained(e,r)}),this._globeness=1,this._mercatorTransform=new _i,this._verticalPerspectiveTransform=new Hl}clone(){const e=new Mo;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const r=this._mercatorTransform.getProjectionData(e),l=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:r.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:r.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return d.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return d.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,r,l){const h=this._mercatorTransform.getPitchedTextCorrection(e,r,l),g=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,r,l);return d.bk(h,g,this._globeness)}projectTileCoordinates(e,r,l,h){return this.currentTransform.projectTileCoordinates(e,r,l,h)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){return this.currentTransform.lngLatToCameraDepth(e,r)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,r){return this.currentTransform.getConstrained(e,r)}calculateCenterFromCameraLngLatAlt(e,r,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,l,h)}setLocationAtPoint(e,r){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,r),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,r),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,r){return this.currentTransform.locationToScreenPoint(e,r)}screenPointToMercatorCoordinate(e,r){return this.currentTransform.screenPointToMercatorCoordinate(e,r)}screenPointToLocation(e,r){return this.currentTransform.screenPointToLocation(e,r)}isPointOnMapSurface(e,r){return this.currentTransform.isPointOnMapSurface(e,r)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,r){return this.currentTransform.getMatrixForModel(e,r)}getProjectionDataForCustomLayer(e=!0){const r=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return r;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return l.fallbackMatrix=r.mainMatrix,l}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class pa{get useGlobeControls(){return!0}handlePanInertia(e,r){const l=Eh(e,r);return Math.abs(l.lng-r.center.lng)>180&&(l.lng=r.center.lng+179.5*Math.sign(l.lng-r.center.lng)),{easingCenter:l,easingOffset:new d.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,r){const l=e.around,h=r.screenPointToLocation(l);e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta);const g=r.zoom;e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta);const y=r.zoom-g;if(y===0)return;const w=d.bA(r.center.lng,h.lng),T=w/(Math.abs(w/180)+1),E=d.bA(r.center.lat,h.lat),A=r.getRayDirectionFromPixel(l),D=r.cameraPosition,P=-1*d.aX(D,A),B=d.bp();d.aS(B,D,[A[0]*P,A[1]*P,A[2]*P]);const N=d.aZ(B)-1,$=Math.exp(.5*-Math.max(N-.3,0)),X=sl(r.worldSize,r.center.lat)/Math.min(r.width,r.height),Y=d.bn(X,.9,.5,1,.25),Q=(1-d.af(-y))*Math.min($,Y),ee=r.center.lat,J=r.zoom,se=new d.S(r.center.lng+T*Q,d.ah(r.center.lat+E*Q,-d.ai,d.ai));r.setLocationAtPoint(h,l);const ue=r.center,te=d.bn(Math.abs(w),45,85,0,1),de=d.bn(X,.75,.35,0,1),Ce=Math.pow(Math.max(te,de),.25),Te=d.bA(ue.lng,se.lng),Se=d.bA(ue.lat,se.lat);r.setCenter(new d.S(ue.lng+Te*Ce,ue.lat+Se*Ce).wrap()),r.setZoom(J+Wi(ee,r.center.lat))}handleMapControlsPan(e,r,l){if(!e.panDelta)return;const h=r.center.lat,g=r.zoom;r.setCenter(Eh(e.panDelta,r).wrap()),r.setZoom(g+Wi(h,r.center.lat))}cameraForBoxAndBearing(e,r,l,h,g){const y=vn(e,r,l,h,g),w=r.left/g.width*2-1,T=(g.width-r.right)/g.width*2-1,E=r.top/g.height*-2+1,A=(g.height-r.bottom)/g.height*-2+1,D=d.bA(l.getWest(),l.getEast())<0,P=D?l.getEast():l.getWest(),B=D?l.getWest():l.getEast(),N=Math.max(l.getNorth(),l.getSouth()),$=Math.min(l.getNorth(),l.getSouth()),X=P+.5*d.bA(P,B),Y=N+.5*d.bA(N,$),Q=g.clone();Q.setCenter(y.center),Q.setBearing(y.bearing),Q.setPitch(0),Q.setRoll(0),Q.setZoom(y.zoom);const ee=Q.modelViewProjectionMatrix,J=[Zn(l.getNorthWest()),Zn(l.getNorthEast()),Zn(l.getSouthWest()),Zn(l.getSouthEast()),Zn(new d.S(B,Y)),Zn(new d.S(P,Y)),Zn(new d.S(X,N)),Zn(new d.S(X,$))],se=Zn(y.center);let ue=Number.POSITIVE_INFINITY;for(const te of J)w<0&&(ue=pa.getLesserNonNegativeNonNull(ue,pa.solveVectorScale(te,se,ee,"x",w))),T>0&&(ue=pa.getLesserNonNegativeNonNull(ue,pa.solveVectorScale(te,se,ee,"x",T))),E>0&&(ue=pa.getLesserNonNegativeNonNull(ue,pa.solveVectorScale(te,se,ee,"y",E))),A<0&&(ue=pa.getLesserNonNegativeNonNull(ue,pa.solveVectorScale(te,se,ee,"y",A)));if(Number.isFinite(ue)&&ue!==0)return y.zoom=Q.zoom+d.ak(ue),y;Tu()}handleJumpToCenterZoom(e,r){const l=e.center.lat,h=e.getConstrained(r.center?d.S.convert(r.center):e.center,e.zoom).center;e.setCenter(h.wrap());const g=r.zoom!==void 0?+r.zoom:e.zoom+Wi(l,h.lat);e.zoom!==g&&e.setZoom(g)}handleEaseTo(e,r){const l=e.zoom,h=e.center,g=e.padding,y={roll:e.roll,pitch:e.pitch,bearing:e.bearing},w={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},T=r.zoom!==void 0,E=!e.isPaddingEqual(r.padding);let A=!1;const D=r.center?d.S.convert(r.center):h,P=e.getConstrained(D,l).center;rr(e,P);const B=e.clone();B.setCenter(P),B.setZoom(T?+r.zoom:l+Wi(h.lat,D.lat)),B.setBearing(r.bearing);const N=new d.P(d.ah(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),d.ah(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));B.setLocationAtPoint(P,N);const $=(r.offset&&r.offsetAsPoint.mag())>0?B.center:P,X=T?+r.zoom:l+Wi(h.lat,$.lat),Y=l+Wi(h.lat,0),Q=X+Wi($.lat,0),ee=d.bA(h.lng,$.lng),J=d.bA(h.lat,$.lat),se=d.af(Q-Y);return A=X!==l,{easeFunc:ue=>{if(d.be(y,w)||Vn({startEulerAngles:y,endEulerAngles:w,tr:e,k:ue,useSlerp:y.roll!=w.roll}),E&&e.interpolatePadding(g,r.padding,ue),r.around)d.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(r.around,r.aroundPoint);else{const te=Q>Y?Math.min(2,se):Math.max(.5,se),de=Math.pow(te,1-ue),Ce=Su(h,ee,J,ue*de);e.setCenter(Ce.wrap())}if(A){const te=d.C.number(Y,Q,ue)+Wi(0,e.center.lat);e.setZoom(te)}},isZooming:A,elevationCenter:$}}handleFlyTo(e,r){const l=r.zoom!==void 0,h=e.center,g=e.zoom,y=e.padding,w=!e.isPaddingEqual(r.padding),T=e.getConstrained(d.S.convert(r.center||r.locationAtOffset),g).center,E=l?+r.zoom:e.zoom+Wi(e.center.lat,T.lat),A=e.clone();A.setCenter(T),A.setZoom(E),A.setBearing(r.bearing);const D=new d.P(d.ah(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),d.ah(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));A.setLocationAtPoint(T,D);const P=A.center;rr(e,P);const B=(function(J,se,ue){const te=Zn(se),de=Zn(ue),Ce=d.aX(te,de),Te=Math.acos(Ce),Se=$s(J);return Te/(2*Math.PI)*Se})(e,h,P),N=g+Wi(h.lat,0),$=E+Wi(P.lat,0),X=d.af($-N);let Y;if(typeof r.minZoom=="number"){const J=+r.minZoom+Wi(P.lat,0),se=Math.min(J,N,$)+Wi(0,P.lat),ue=e.getConstrained(P,se).zoom+Wi(P.lat,0);Y=d.af(ue-N)}const Q=d.bA(h.lng,P.lng),ee=d.bA(h.lat,P.lat);return{easeFunc:(J,se,ue,te)=>{const de=Su(h,Q,ee,ue);w&&e.interpolatePadding(y,r.padding,J);const Ce=J===1?P:de;e.setCenter(Ce.wrap());const Te=N+d.ak(se);e.setZoom(J===1?E:Te+Wi(0,Ce.lat))},scaleOfZoom:X,targetCenter:P,scaleOfMinZoom:Y,pixelPathLength:B}}static solveVectorScale(e,r,l,h,g){const y=h==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],w=[l[3],l[7],l[11],l[15]],T=e[0]*y[0]+e[1]*y[1]+e[2]*y[2],E=e[0]*w[0]+e[1]*w[1]+e[2]*w[2],A=r[0]*y[0]+r[1]*y[1]+r[2]*y[2],D=r[0]*w[0]+r[1]*w[1]+r[2]*w[2];return A+g*E===T+g*D||w[3]*(T-A)+y[3]*(D-E)+T*D==A*E?null:(A+y[3]-g*D-g*w[3])/(A-T-g*D+g*E)}static getLesserNonNegativeNonNull(e,r){return r!==null&&r>=0&&r<e?r:e}}class Ah{constructor(e){this._globe=e,this._mercatorCameraHelper=new Wn,this._verticalPerspectiveCameraHelper=new pa}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,r){return this.currentHelper.handlePanInertia(e,r)}handleMapControlsRollPitchBearingZoom(e,r){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,r)}handleMapControlsPan(e,r,l){this.currentHelper.handleMapControlsPan(e,r,l)}cameraForBoxAndBearing(e,r,l,h,g){return this.currentHelper.cameraForBoxAndBearing(e,r,l,h,g)}handleJumpToCenterZoom(e,r){this.currentHelper.handleJumpToCenterZoom(e,r)}handleEaseTo(e,r){return this.currentHelper.handleEaseTo(e,r)}handleFlyTo(e,r){return this.currentHelper.handleFlyTo(e,r)}}const zc=(m,e)=>d.y(m,e&&e.filter((r=>r.identifier!=="source.canvas"))),zh=d.bE();class Mu extends d.E{constructor(e,r={}){var l,h;super(),this._rtlPluginLoaded=()=>{for(const y in this.sourceCaches){const w=this.sourceCaches[y].getSource().type;w!=="vector"&&w!=="geojson"||this.sourceCaches[y].reload()}},this.map=e,this.dispatcher=new Ct(Mt(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((y,w)=>this.getGlyphs(y,w))),this.dispatcher.registerMessageHandler("GI",((y,w)=>this.getImages(y,w))),this.dispatcher.registerMessageHandler("GDA",((y,w)=>this.getDashes(y,w))),this.imageManager=new zn,this.imageManager.setEventedParent(this);const g=((l=e._container)===null||l===void 0?void 0:l.lang)||typeof document<"u"&&((h=document.documentElement)===null||h===void 0?void 0:h.lang)||void 0;this.glyphManager=new ha(e._requestManager,r.localIdeographFontFamily,g),this.lineAtlas=new _t(256,512),this.crossTileSymbolIndex=new wo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",d.bG()),cs().on(Un,this._rtlPluginLoaded),this.on("data",(y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const w=this.sourceCaches[y.sourceId];if(!w)return;const T=w.getSource();if(T&&T.vectorLayerIds)for(const E in this._layers){const A=this._layers[E];A.source===T.id&&this._validateLayer(A)}}))}setGlobalStateProperty(e,r){var l,h,g;this._checkLoaded();const y=r===null?(g=(h=(l=this.stylesheet.state)===null||l===void 0?void 0:l[e])===null||h===void 0?void 0:h.default)!==null&&g!==void 0?g:null:r;if(d.bH(y,this._globalState[e]))return this;this._globalState[e]=y,this._applyGlobalStateChanges([e])}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const r=[];for(const l in e)!d.bH(this._globalState[l],e[l].default)&&(r.push(l),this._globalState[l]=e[l].default);this._applyGlobalStateChanges(r)}_applyGlobalStateChanges(e){if(e.length===0)return;const r=new Set,l={};for(const h of e){l[h]=this._globalState[h];for(const g in this._layers){const y=this._layers[g],w=y.getLayoutAffectingGlobalStateRefs(),T=y.getPaintAffectingGlobalStateRefs();if(w.has(h)&&r.add(y.source),T.has(h))for(const{name:E,value:A}of T.get(h))this._updatePaintProperty(y,E,A)}}this.dispatcher.broadcast("UGS",l);for(const h in this.sourceCaches)r.has(h)&&(this._reloadSource(h),this._changed=!0)}loadURL(e,r={},l){this.fire(new d.l("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const h=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const g=this._loadStyleRequest;d.j(h,this._loadStyleRequest).then((y=>{this._loadStyleRequest=null,this._load(y.data,r,l)})).catch((y=>{this._loadStyleRequest=null,y&&!g.signal.aborted&&this.fire(new d.k(y))}))}loadJSON(e,r={},l){this.fire(new d.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Ke.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(e,r,l)})).catch((()=>{}))}loadEmpty(){this.fire(new d.l("dataloading",{dataType:"style"})),this._load(zh,{validate:!1})}_load(e,r,l){var h,g;let y=r.transformStyle?r.transformStyle(l,e):e;if(!r.validate||!zc(this,d.z(y))){y=Object.assign({},y),this._loaded=!0,this.stylesheet=y;for(const w in y.sources)this.addSource(w,y.sources[w],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new Be(this.stylesheet.light),this._setProjectionInternal(((h=this.stylesheet.projection)===null||h===void 0?void 0:h.type)||"mercator"),this.sky=new St(this.stylesheet.sky),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new d.l("data",{dataType:"style"})),this.fire(new d.l("style.load"))}}_createLayers(){var e;const r=d.bI(this.stylesheet.layers);this.setGlobalState((e=this.stylesheet.state)!==null&&e!==void 0?e:null),this.dispatcher.broadcast("SL",r),this._order=r.map((l=>l.id)),this._layers={},this._serializedLayers=null;for(const l of r){const h=d.bJ(l,this._globalState);h.setEventedParent(this,{layer:{id:l.id}}),this._layers[l.id]=h}}_loadSprite(e,r=!1,l=void 0){let h;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(g,y,w,T){return d._(this,void 0,void 0,(function*(){const E=Ui(g),A=w>1?"@2x":"",D={},P={};for(const{id:B,url:N}of E){const $=y.transformRequest(Nt(N,A,".json"),"SpriteJSON");D[B]=d.j($,T);const X=y.transformRequest(Nt(N,A,".png"),"SpriteImage");P[B]=Ci.getImage(X,T)}return yield Promise.all([...Object.values(D),...Object.values(P)]),(function(B,N){return d._(this,void 0,void 0,(function*(){const $={};for(const X in B){$[X]={};const Y=Ke.getImageCanvasContext((yield N[X]).data),Q=(yield B[X]).data;for(const ee in Q){const{width:J,height:se,x:ue,y:te,sdf:de,pixelRatio:Ce,stretchX:Te,stretchY:Se,content:Ee,textFitWidth:We,textFitHeight:Qe}=Q[ee];$[X][ee]={data:null,pixelRatio:Ce,sdf:de,stretchX:Te,stretchY:Se,content:Ee,textFitWidth:We,textFitHeight:Qe,spriteData:{width:J,height:se,x:ue,y:te,context:Y}}}}return $}))})(D,P)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((g=>{if(this._spriteRequest=null,g)for(const y in g){this._spritesImagesIds[y]=[];const w=this._spritesImagesIds[y]?this._spritesImagesIds[y].filter((T=>!(T in g))):[];for(const T of w)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in g[y]){const E=y==="default"?T:`${y}:${T}`;this._spritesImagesIds[y].push(E),E in this.imageManager.images?this.imageManager.updateImage(E,g[y][T],!1):this.imageManager.addImage(E,g[y][T]),r&&(this._changedImages[E]=!0)}}})).catch((g=>{this._spriteRequest=null,h=g,this.fire(new d.k(h))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"})),l&&l(h)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}_validateLayer(e){const r=this.sourceCaches[e.source];if(!r)return;const l=e.sourceLayer;if(!l)return;const h=r.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(l)===-1)&&this.fire(new d.k(new Error(`Source layer "${l}" does not exist on source "${h.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,r=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(r?d.bK(l):l);const h=[];for(const g of e)if(l[g]){const y=r?d.bK(l[g]):l[g];h.push(y)}return h}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const r=Object.keys(this._layers);for(const l of r){const h=this._layers[l];h.type!=="custom"&&(e[l]=h.serialize())}return e}hasTransitions(){var e,r,l;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((r=this.sky)===null||r===void 0)&&r.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(const h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const r=this._changed;if(r){const h=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(h.length||g.length)&&this._updateWorkerLayers(h,g);for(const y in this._updatedSources){const w=this._updatedSources[y];if(w==="reload")this._reloadSource(y);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(y)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const h in this.sourceCaches){const g=this.sourceCaches[h];l[h]=g.used,g.used=!1}for(const h of this._order){const g=this._layers[h];g.recalculate(e,this._availableImages),!g.isHidden(e.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(const h in l){const g=this.sourceCaches[h];!!l[h]!=!!g.used&&g.fire(new d.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,r&&this.fire(new d.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,r={}){var l;this._checkLoaded();const h=this.serialize();if(e=r.transformStyle?r.transformStyle(h,e):e,((l=r.validate)===null||l===void 0||l)&&zc(this,d.z(e)))return!1;(e=d.bK(e)).layers=d.bI(e.layers);const g=d.bL(h,e),y=this._getOperationsToPerform(g);if(y.unimplemented.length>0)throw new Error(`Unimplemented: ${y.unimplemented.join(", ")}.`);if(y.operations.length===0)return!1;for(const w of y.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const r=[],l=[];for(const h of e)switch(h.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":r.push((()=>this.addLayer.apply(this,h.args)));break;case"removeLayer":r.push((()=>this.removeLayer.apply(this,h.args)));break;case"setPaintProperty":r.push((()=>this.setPaintProperty.apply(this,h.args)));break;case"setLayoutProperty":r.push((()=>this.setLayoutProperty.apply(this,h.args)));break;case"setFilter":r.push((()=>this.setFilter.apply(this,h.args)));break;case"addSource":r.push((()=>this.addSource.apply(this,h.args)));break;case"removeSource":r.push((()=>this.removeSource.apply(this,h.args)));break;case"setLayerZoomRange":r.push((()=>this.setLayerZoomRange.apply(this,h.args)));break;case"setLight":r.push((()=>this.setLight.apply(this,h.args)));break;case"setGeoJSONSourceData":r.push((()=>this.setGeoJSONSourceData.apply(this,h.args)));break;case"setGlyphs":r.push((()=>this.setGlyphs.apply(this,h.args)));break;case"setSprite":r.push((()=>this.setSprite.apply(this,h.args)));break;case"setTerrain":r.push((()=>this.map.setTerrain.apply(this,h.args)));break;case"setSky":r.push((()=>this.setSky.apply(this,h.args)));break;case"setProjection":this.setProjection.apply(this,h.args);break;case"setGlobalState":r.push((()=>this.setGlobalState.apply(this,h.args)));break;case"setTransition":r.push((()=>{}));break;default:l.push(h.command)}return{operations:r,unimplemented:l}}addImage(e,r){if(this.getImage(e))return this.fire(new d.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,r),this._afterImageUpdated(e)}updateImage(e,r){this.imageManager.updateImage(e,r)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new d.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,r,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(d.z.source,`sources.${e}`,r,null,l))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const h=this.sourceCaches[e]=new Vt(e,r,this.dispatcher);h.style=this,h.setEventedParent(this,(()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:e}))),h.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new d.k(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const r=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],r.fire(new d.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,r){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(r),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,r,l={}){this._checkLoaded();const h=e.id;if(this.getLayer(h))return void this.fire(new d.k(new Error(`Layer "${h}" already exists on this map.`)));let g;if(e.type==="custom"){if(zc(this,d.bM(e)))return;g=d.bJ(e,this._globalState)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(h,e.source),e=d.bK(e),e=d.e(e,{source:h})),this._validate(d.z.layer,`layers.${h}`,e,{arrayIndex:-1},l))return;g=d.bJ(e,this._globalState),this._validateLayer(g),g.setEventedParent(this,{layer:{id:h}})}const y=r?this._order.indexOf(r):this._order.length;if(r&&y===-1)this.fire(new d.k(new Error(`Cannot add layer "${h}" before non-existing layer "${r}".`)));else{if(this._order.splice(y,0,h),this._layerOrderChanged=!0,this._layers[h]=g,this._removedLayers[h]&&g.source&&g.type!=="custom"){const w=this._removedLayers[h];delete this._removedLayers[h],w.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(e,r){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new d.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===r)return;const l=this._order.indexOf(e);this._order.splice(l,1);const h=r?this._order.indexOf(r):this._order.length;r&&h===-1?this.fire(new d.k(new Error(`Cannot move layer "${e}" before non-existing layer "${r}".`))):(this._order.splice(h,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const r=this._layers[e];if(!r)return void this.fire(new d.k(new Error(`Cannot remove non-existing layer "${e}".`)));r.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,r,l){this._checkLoaded();const h=this.getLayer(e);h?h.minzoom===r&&h.maxzoom===l||(r!=null&&(h.minzoom=r),l!=null&&(h.maxzoom=l),this._updateLayer(h)):this.fire(new d.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,r,l={}){this._checkLoaded();const h=this.getLayer(e);if(h){if(!d.bH(h.filter,r))return r==null?(h.setFilter(void 0),void this._updateLayer(h)):void(this._validate(d.z.filter,`layers.${h.id}.filter`,r,null,l)||(h.setFilter(d.bK(r)),this._updateLayer(h)))}else this.fire(new d.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return d.bK(this.getLayer(e).filter)}setLayoutProperty(e,r,l,h={}){this._checkLoaded();const g=this.getLayer(e);g?d.bH(g.getLayoutProperty(r),l)||(g.setLayoutProperty(r,l,h),this._updateLayer(g)):this.fire(new d.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,r){const l=this.getLayer(e);if(l)return l.getLayoutProperty(r);this.fire(new d.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,r,l,h={}){this._checkLoaded();const g=this.getLayer(e);g?d.bH(g.getPaintProperty(r),l)||this._updatePaintProperty(g,r,l,h):this.fire(new d.k(new Error(`Cannot style non-existing layer "${e}".`)))}_updatePaintProperty(e,r,l,h={}){e.setPaintProperty(r,l,h)&&this._updateLayer(e),this._changed=!0,this._updatedPaintProps[e.id]=!0,this._serializedLayers=null}getPaintProperty(e,r){return this.getLayer(e).getPaintProperty(r)}setFeatureState(e,r){this._checkLoaded();const l=e.source,h=e.sourceLayer,g=this.sourceCaches[l];if(g===void 0)return void this.fire(new d.k(new Error(`The source '${l}' does not exist in the map's style.`)));const y=g.getSource().type;y==="geojson"&&h?this.fire(new d.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||h?(e.id===void 0&&this.fire(new d.k(new Error("The feature id parameter must be provided."))),g.setFeatureState(h,e.id,r)):this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,r){this._checkLoaded();const l=e.source,h=this.sourceCaches[l];if(h===void 0)return void this.fire(new d.k(new Error(`The source '${l}' does not exist in the map's style.`)));const g=h.getSource().type,y=g==="vector"?e.sourceLayer:void 0;g!=="vector"||y?r&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new d.k(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(y,e.id,r):this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const r=e.source,l=e.sourceLayer,h=this.sourceCaches[r];if(h!==void 0)return h.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new d.k(new Error("The feature id parameter must be provided."))),h.getFeatureState(l,e.id)):void this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.k(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=d.bN(this.sourceCaches,(g=>g.serialize())),r=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,h=this.stylesheet;return d.bO({version:h.version,name:h.name,metadata:h.metadata,light:h.light,sky:h.sky,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,projection:h.projection,sources:e,layers:r,terrain:l},(g=>g!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const r=y=>this._layers[y].type==="fill-extrusion",l={},h=[];for(let y=this._order.length-1;y>=0;y--){const w=this._order[y];if(r(w)){l[w]=y;for(const T of e){const E=T[w];if(E)for(const A of E)h.push(A)}}}h.sort(((y,w)=>w.intersectionZ-y.intersectionZ));const g=[];for(let y=this._order.length-1;y>=0;y--){const w=this._order[y];if(r(w))for(let T=h.length-1;T>=0;T--){const E=h[T].feature;if(l[E.layer.id]<y)break;g.push(E),h.pop()}else for(const T of e){const E=T[w];if(E)for(const A of E)g.push(A.feature)}}return g}queryRenderedFeatures(e,r,l){r&&r.filter&&this._validate(d.z.filter,"queryRenderedFeatures.filter",r.filter,null,r);const h={};if(r&&r.layers){if(!(Array.isArray(r.layers)||r.layers instanceof Set))return this.fire(new d.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const E of r.layers){const A=this._layers[E];if(!A)return this.fire(new d.k(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];h[A.source]=!0}}const g=[];r.availableImages=this._availableImages;const y=this._serializedAllLayers(),w=r.layers instanceof Set?r.layers:Array.isArray(r.layers)?new Set(r.layers):null,T=Object.assign(Object.assign({},r),{layers:w,globalState:this._globalState});for(const E in this.sourceCaches)r.layers&&!h[E]||g.push(si(this.sourceCaches[E],this._layers,y,e,T,l,this.map.terrain?(A,D,P)=>this.map.terrain.getElevation(A,D,P):void 0));return this.placement&&g.push((function(E,A,D,P,B,N,$){const X={},Y=N.queryRenderedSymbols(P),Q=[];for(const ee of Object.keys(Y).map(Number))Q.push($[ee]);Q.sort(tr);for(const ee of Q){const J=ee.featureIndex.lookupSymbolFeatures(Y[ee.bucketInstanceId],A,ee.bucketIndex,ee.sourceLayerIndex,{filterSpec:B.filter,globalState:B.globalState},B.layers,B.availableImages,E);for(const se in J){const ue=X[se]=X[se]||[],te=J[se];te.sort(((de,Ce)=>{const Te=ee.featureSortOrder;if(Te){const Se=Te.indexOf(de.featureIndex);return Te.indexOf(Ce.featureIndex)-Se}return Ce.featureIndex-de.featureIndex}));for(const de of te)ue.push(de)}}return(function(ee,J,se){for(const ue in ee)for(const te of ee[ue])ir(te,se[J[ue].source]);return ee})(X,E,D)})(this._layers,y,this.sourceCaches,e,T,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(e,r){r?.filter&&this._validate(d.z.filter,"querySourceFeatures.filter",r.filter,null,r);const l=this.sourceCaches[e];return l?(function(h,g){const y=h.getRenderableIds().map((E=>h.getTileByID(E))),w=[],T={};for(let E=0;E<y.length;E++){const A=y[E],D=A.tileID.canonical.key;T[D]||(T[D]=!0,A.querySourceFeatures(w,g))}return w})(l,r?Object.assign(Object.assign({},r),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(e,r={}){this._checkLoaded();const l=this.light.getLight();let h=!1;for(const y in e)if(!d.bH(e[y],l[y])){h=!0;break}if(!h)return;const g={now:Ke.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(g)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,r={}){this._checkLoaded();const l=this.getSky();let h=!1;if(!e&&!l)return;if(e&&!l)h=!0;else if(!e&&l)h=!0;else for(const y in e)if(!d.bH(e[y],l[y])){h=!0;break}if(!h)return;const g={now:Ke.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,r),this.sky.updateTransitions(g)}_setProjectionInternal(e){const r=(function(l){if(Array.isArray(l)){const h=new rl({type:l});return{projection:h,transform:new Mo,cameraHelper:new Ah(h)}}switch(l){case"mercator":return{projection:new Ht,transform:new _i,cameraHelper:new Wn};case"globe":{const h=new rl({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:h,transform:new Mo,cameraHelper:new Ah(h)}}case"vertical-perspective":return{projection:new Nl,transform:new Hl,cameraHelper:new pa};default:return d.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new Ht,transform:new _i,cameraHelper:new Wn}}})(e);this.projection=r.projection,this.map.migrateProjection(r.transform,r.cameraHelper);for(const l in this.sourceCaches)this.sourceCaches[l].reload()}_validate(e,r,l,h,g={}){return(!g||g.validate!==!1)&&zc(this,e.call(d.z,d.e({key:r,style:this.serialize(),value:l,styleSpec:d.v},h)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),cs().off(Un,this._rtlPluginLoaded);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const l=this.sourceCaches[r];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const r in this.sourceCaches)this.sourceCaches[r].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,r,l,h,g=!1){let y=!1,w=!1;const T={};for(const E of this._order){const A=this._layers[E];if(A.type!=="symbol")continue;if(!T[A.source]){const P=this.sourceCaches[A.source];T[A.source]=P.getRenderableIds(!0).map((B=>P.getTileByID(B))).sort(((B,N)=>N.tileID.overscaledZ-B.tileID.overscaledZ||(B.tileID.isLessThan(N.tileID)?-1:1)))}const D=this.crossTileSymbolIndex.addLayer(A,T[A.source],e.center.lng);y=y||D}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Ke.now(),e.zoom))&&(this.pauseablePlacement=new Ra(e,this.map.terrain,this._order,g,r,l,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Ke.now()),w=!0),y&&this.pauseablePlacement.placement.setStale()),w||y)for(const E of this._order){const A=this._layers[E];A.type==="symbol"&&this.placement.updateLayerOpacities(A,T[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Ke.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,r){return d._(this,void 0,void 0,(function*(){const l=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();const h=this.sourceCaches[r.source];return h&&h.setDependencies(r.tileID.key,r.type,r.icons),l}))}getGlyphs(e,r){return d._(this,void 0,void 0,(function*(){const l=yield this.glyphManager.getGlyphs(r.stacks),h=this.sourceCaches[r.source];return h&&h.setDependencies(r.tileID.key,r.type,[""]),l}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,r={}){this._checkLoaded(),e&&this._validate(d.z.glyphs,"glyphs",e,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}getDashes(e,r){return d._(this,void 0,void 0,(function*(){const l={};for(const[h,g]of Object.entries(r.dashes))l[h]=this.lineAtlas.getDash(g.dasharray,g.round);return l}))}addSprite(e,r,l={},h){this._checkLoaded();const g=[{id:e,url:r}],y=[...Ui(this.stylesheet.sprite),...g];this._validate(d.z.sprite,"sprite",y,null,l)||(this.stylesheet.sprite=y,this._loadSprite(g,!0,h))}removeSprite(e){this._checkLoaded();const r=Ui(this.stylesheet.sprite);if(r.find((l=>l.id===e))){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;r.splice(r.findIndex((l=>l.id===e)),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}else this.fire(new d.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Ui(this.stylesheet.sprite)}setSprite(e,r={},l){this._checkLoaded(),e&&this._validate(d.z.sprite,"sprite",e,null,r)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var Dd=d.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Id{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,r,l,h,g,y,w,T,E){this.context=e;let A=this.boundPaintVertexBuffers.length!==h.length;for(let D=0;!A&&D<h.length;D++)this.boundPaintVertexBuffers[D]!==h[D]&&(A=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==l||A||this.boundIndexBuffer!==g||this.boundVertexOffset!==y||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==E?this.freshBind(r,l,h,g,y,w,T,E):(e.bindVertexArray.set(this.vao),w&&w.bind(),g&&g.dynamicDraw&&g.bind(),T&&T.bind(),E&&E.bind())}freshBind(e,r,l,h,g,y,w,T){const E=e.numAttributes,A=this.context,D=A.gl;this.vao&&this.destroy(),this.vao=A.createVertexArray(),A.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=y,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=T,r.enableAttributes(D,e);for(const P of l)P.enableAttributes(D,e);y&&y.enableAttributes(D,e),w&&w.enableAttributes(D,e),T&&T.enableAttributes(D,e),r.bind(),r.setVertexAttribPointers(D,e,g);for(const P of l)P.bind(),P.setVertexAttribPointers(D,e,g);y&&(y.bind(),y.setVertexAttribPointers(D,e,g)),h&&h.bind(),w&&(w.bind(),w.setVertexAttribPointers(D,e,g)),T&&(T.bind(),T.setVertexAttribPointers(D,e,g)),A.currentNumAttributes=E}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Pc=(m,e,r,l,h)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:e,u_fog_color:r?r.properties.get("fog-color"):d.bf.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:h?0:r?r.calculateFogBlendOpacity(l):0,u_horizon_color:r?r.properties.get("horizon-color"):d.bf.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:h?1:0}),Cu={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Co(m){const e=[];for(let r=0;r<m.length;r++){if(m[r]===null)continue;const l=m[r].split(" ");e.push(l.pop())}return e}class Eu{constructor(e,r,l,h,g,y,w,T,E=[]){const A=e.gl;this.program=A.createProgram();const D=Co(r.staticAttributes),P=l?l.getBinderAttributes():[],B=D.concat(P),N=da.prelude.staticUniforms?Co(da.prelude.staticUniforms):[],$=w.staticUniforms?Co(w.staticUniforms):[],X=r.staticUniforms?Co(r.staticUniforms):[],Y=l?l.getBinderUniforms():[],Q=N.concat($).concat(X).concat(Y),ee=[];for(const Te of Q)ee.indexOf(Te)<0&&ee.push(Te);const J=l?l.defines():[];br(A)&&J.unshift("#version 300 es"),g&&J.push("#define OVERDRAW_INSPECTOR;"),y&&J.push("#define TERRAIN3D;"),T&&J.push(T),E&&J.push(...E);let se=J.concat(da.prelude.fragmentSource,w.fragmentSource,r.fragmentSource).join(`
`),ue=J.concat(da.prelude.vertexSource,w.vertexSource,r.vertexSource).join(`
`);br(A)||(se=(function(Te){return Te.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(se),ue=(function(Te){return Te.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(ue));const te=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);if(A.shaderSource(te,se),A.compileShader(te),!A.getShaderParameter(te,A.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${A.getShaderInfoLog(te)}`);A.attachShader(this.program,te);const de=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);if(A.shaderSource(de,ue),A.compileShader(de),!A.getShaderParameter(de,A.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${A.getShaderInfoLog(de)}`);A.attachShader(this.program,de),this.attributes={};const Ce={};this.numAttributes=B.length;for(let Te=0;Te<this.numAttributes;Te++)B[Te]&&(A.bindAttribLocation(this.program,Te,B[Te]),this.attributes[B[Te]]=Te);if(A.linkProgram(this.program),!A.getProgramParameter(this.program,A.LINK_STATUS))throw new Error(`Program failed to link: ${A.getProgramInfoLog(this.program)}`);A.deleteShader(de),A.deleteShader(te);for(let Te=0;Te<ee.length;Te++){const Se=ee[Te];if(Se&&!Ce[Se]){const Ee=A.getUniformLocation(this.program,Se);Ee&&(Ce[Se]=Ee)}}this.fixedUniforms=h(e,Ce),this.terrainUniforms=((Te,Se)=>({u_depth:new d.bP(Te,Se.u_depth),u_terrain:new d.bP(Te,Se.u_terrain),u_terrain_dim:new d.bg(Te,Se.u_terrain_dim),u_terrain_matrix:new d.bR(Te,Se.u_terrain_matrix),u_terrain_unpack:new d.bS(Te,Se.u_terrain_unpack),u_terrain_exaggeration:new d.bg(Te,Se.u_terrain_exaggeration)}))(e,Ce),this.projectionUniforms=((Te,Se)=>({u_projection_matrix:new d.bR(Te,Se.u_projection_matrix),u_projection_tile_mercator_coords:new d.bS(Te,Se.u_projection_tile_mercator_coords),u_projection_clipping_plane:new d.bS(Te,Se.u_projection_clipping_plane),u_projection_transition:new d.bg(Te,Se.u_projection_transition),u_projection_fallback_matrix:new d.bR(Te,Se.u_projection_fallback_matrix)}))(e,Ce),this.binderUniforms=l?l.getUniforms(e,Ce):[]}draw(e,r,l,h,g,y,w,T,E,A,D,P,B,N,$,X,Y,Q,ee){const J=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(h),e.setColorMode(g),e.setCullFace(y),T){e.activeTexture.set(J.TEXTURE2),J.bindTexture(J.TEXTURE_2D,T.depthTexture),e.activeTexture.set(J.TEXTURE3),J.bindTexture(J.TEXTURE_2D,T.texture);for(const ue in this.terrainUniforms)this.terrainUniforms[ue].set(T[ue])}if(E)for(const ue in E)this.projectionUniforms[Cu[ue]].set(E[ue]);if(w)for(const ue in this.fixedUniforms)this.fixedUniforms[ue].set(w[ue]);X&&X.setUniforms(e,this.binderUniforms,N,{zoom:$});let se=0;switch(r){case J.LINES:se=2;break;case J.TRIANGLES:se=3;break;case J.LINE_STRIP:se=1}for(const ue of B.get()){const te=ue.vaos||(ue.vaos={});(te[A]||(te[A]=new Id)).bind(e,this,D,X?X.getPaintVertexBuffers():[],P,ue.vertexOffset,Y,Q,ee),J.drawElements(r,ue.primitiveLength*se,J.UNSIGNED_SHORT,ue.primitiveOffset*se*2)}}}function Dc(m,e,r){const l=1/d.aC(r,1,e.transform.tileZoom),h=Math.pow(2,r.tileID.overscaledZ),g=r.tileSize*Math.pow(2,e.transform.tileZoom)/h,y=g*(r.tileID.canonical.x+r.tileID.wrap*h),w=g*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[l,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[y>>16,w>>16],u_pixel_coord_lower:[65535&y,65535&w]}}const wr=(m,e,r,l)=>{const h=m.style.light,g=h.properties.get("position"),y=[g.x,g.y,g.z],w=d.bV();h.properties.get("anchor")==="viewport"&&d.bW(w,m.transform.bearingInRadians),d.bX(y,y,w);const T=m.transform.transformLightDirection(y),E=h.properties.get("color");return{u_lightpos:y,u_lightpos_globe:T,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+e,u_opacity:r,u_fill_translate:l}},Au=(m,e,r,l,h,g,y)=>d.e(wr(m,e,r,l),Dc(g,m,y),{u_height_factor:-Math.pow(2,h.overscaledZ)/y.tileSize/8}),Xs=(m,e,r,l)=>d.e(Dc(e,m,r),{u_fill_translate:l}),$l=(m,e)=>({u_world:m,u_fill_translate:e}),ll=(m,e,r,l,h)=>d.e(Xs(m,e,r,h),{u_world:l}),Ph=(m,e,r,l,h)=>{const g=m.transform;let y,w,T=0;if(r.paint.get("circle-pitch-alignment")==="map"){const E=d.aC(e,1,g.zoom);y=!0,w=[E,E],T=E/(d.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*h}else y=!1,w=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(r.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+y,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:w,u_globe_extrude_scale:T,u_translate:l}},Xl=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),Dh=m=>({u_viewport_size:[m.width,m.height]}),Ys=(m,e=1)=>({u_color:m,u_overlay:0,u_overlay_scale:e}),Eo=(m,e,r,l)=>{const h=d.aC(m,1,e)/(d.$*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:d.aC(m,1,e),u_intensity:r,u_globe_extrude_scale:h}},zu=(m,e,r,l)=>{const h=d.L();d.bY(h,0,m.width,m.height,0,0,1);const g=m.context.gl;return{u_matrix:h,u_world:[g.drawingBufferWidth,g.drawingBufferHeight],u_image:r,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}},Rd=(m,e,r)=>{const l=r.paint.get("hillshade-accent-color");let h;switch(r.paint.get("hillshade-method")){case"basic":h=4;break;case"combined":h=1;break;case"igor":h=2;break;case"multidirectional":h=3;break;default:h=0}const g=r.getIlluminationProperties();for(let y=0;y<g.directionRadians.length;y++)r.paint.get("hillshade-illumination-anchor")==="viewport"&&(g.directionRadians[y]+=m.transform.bearingInRadians);return{u_image:0,u_latrange:Ic(0,e.tileID),u_exaggeration:r.paint.get("hillshade-exaggeration"),u_altitudes:g.altitudeRadians,u_azimuths:g.directionRadians,u_accent:l,u_method:h,u_highlights:g.highlightColor,u_shadows:g.shadowColor}},Ih=(m,e)=>{const r=e.stride,l=d.L();return d.bY(l,0,d.$,-d.$,0,0,1),d.M(l,l,[0,-d.$,0]),{u_matrix:l,u_image:1,u_dimension:[r,r],u_zoom:m.overscaledZ,u_unpack:e.getUnpackVector()}};function Ic(m,e){const r=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new d.a1(0,l/r).toLngLat().lat,new d.a1(0,(l+1)/r).toLngLat().lat]}const Pu=(m,e,r=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:r,u_opacity:m.paint.get("color-relief-opacity")}),Ks=(m,e,r,l)=>{const h=m.transform;return{u_translation:Lc(m,e,r),u_ratio:l/d.aC(e,1,h.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},cl=(m,e,r,l,h)=>d.e(Ks(m,e,r,l),{u_image:0,u_image_height:h}),Rh=(m,e,r,l,h)=>{const g=m.transform,y=Rc(e,g);return{u_translation:Lc(m,e,r),u_texsize:e.imageAtlasTexture.size,u_ratio:l/d.aC(e,1,g.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[y,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Ur=(m,e,r,l,h)=>{const g=Rc(e,m.transform);return d.e(Ks(m,e,r,l),{u_tileratio:g,u_crossfade_from:h.fromScale,u_crossfade_to:h.toScale,u_image:0,u_mix:h.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})};function Rc(m,e){return 1/d.aC(m,1,e.tileZoom)}function Lc(m,e,r){return d.aD(m.transform,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const Ao=(m,e,r,l,h)=>{return{u_tl_parent:m,u_scale_parent:e,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(y=l.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(g=l.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:Du(l.paint.get("raster-hue-rotate")),u_coords_top:[h[0].x,h[0].y,h[1].x,h[1].y],u_coords_bottom:[h[3].x,h[3].y,h[2].x,h[2].y]};var g,y};function Du(m){m*=Math.PI/180;const e=Math.sin(m),r=Math.cos(m);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}const ul=(m,e,r,l,h,g,y,w,T,E,A,D,P)=>{const B=y.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:B.cameraToCenterDistance,u_pitch:B.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:B.width/B.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_label_plane_matrix:w,u_coord_matrix:T,u_is_text:+A,u_pitch_with_map:+l,u_is_along_line:h,u_is_variable_anchor:g,u_texsize:D,u_texture:0,u_translation:E,u_pitched_scale:P}},Iu=(m,e,r,l,h,g,y,w,T,E,A,D,P,B)=>{const N=y.transform;return d.e(ul(m,e,r,l,h,g,y,w,T,E,A,D,B),{u_gamma_scale:l?Math.cos(N.pitch*Math.PI/180)*N.cameraToCenterDistance:1,u_device_pixel_ratio:y.pixelRatio,u_is_halo:1})},Lh=(m,e,r,l,h,g,y,w,T,E,A,D,P)=>d.e(Iu(m,e,r,l,h,g,y,w,T,E,!0,A,0,P),{u_texsize_icon:D,u_texture_icon:1}),kh=(m,e)=>({u_opacity:m,u_color:e}),Bh=(m,e,r,l,h)=>d.e((function(g,y,w,T){const E=w.imageManager.getPattern(g.from.toString()),A=w.imageManager.getPattern(g.to.toString()),{width:D,height:P}=w.imageManager.getPixelSize(),B=Math.pow(2,T.tileID.overscaledZ),N=T.tileSize*Math.pow(2,w.transform.tileZoom)/B,$=N*(T.tileID.canonical.x+T.tileID.wrap*B),X=N*T.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:E.tl,u_pattern_br_a:E.br,u_pattern_tl_b:A.tl,u_pattern_br_b:A.br,u_texsize:[D,P],u_mix:y.t,u_pattern_size_a:E.displaySize,u_pattern_size_b:A.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/d.aC(T,1,w.transform.tileZoom),u_pixel_coord_upper:[$>>16,X>>16],u_pixel_coord_lower:[65535&$,65535&X]}})(r,h,e,l),{u_opacity:m}),Ru=(m,e)=>{},Lu={fillExtrusion:(m,e)=>({u_lightpos:new d.bT(m,e.u_lightpos),u_lightpos_globe:new d.bT(m,e.u_lightpos_globe),u_lightintensity:new d.bg(m,e.u_lightintensity),u_lightcolor:new d.bT(m,e.u_lightcolor),u_vertical_gradient:new d.bg(m,e.u_vertical_gradient),u_opacity:new d.bg(m,e.u_opacity),u_fill_translate:new d.bU(m,e.u_fill_translate)}),fillExtrusionPattern:(m,e)=>({u_lightpos:new d.bT(m,e.u_lightpos),u_lightpos_globe:new d.bT(m,e.u_lightpos_globe),u_lightintensity:new d.bg(m,e.u_lightintensity),u_lightcolor:new d.bT(m,e.u_lightcolor),u_vertical_gradient:new d.bg(m,e.u_vertical_gradient),u_height_factor:new d.bg(m,e.u_height_factor),u_opacity:new d.bg(m,e.u_opacity),u_fill_translate:new d.bU(m,e.u_fill_translate),u_image:new d.bP(m,e.u_image),u_texsize:new d.bU(m,e.u_texsize),u_pixel_coord_upper:new d.bU(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.bU(m,e.u_pixel_coord_lower),u_scale:new d.bT(m,e.u_scale),u_fade:new d.bg(m,e.u_fade)}),fill:(m,e)=>({u_fill_translate:new d.bU(m,e.u_fill_translate)}),fillPattern:(m,e)=>({u_image:new d.bP(m,e.u_image),u_texsize:new d.bU(m,e.u_texsize),u_pixel_coord_upper:new d.bU(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.bU(m,e.u_pixel_coord_lower),u_scale:new d.bT(m,e.u_scale),u_fade:new d.bg(m,e.u_fade),u_fill_translate:new d.bU(m,e.u_fill_translate)}),fillOutline:(m,e)=>({u_world:new d.bU(m,e.u_world),u_fill_translate:new d.bU(m,e.u_fill_translate)}),fillOutlinePattern:(m,e)=>({u_world:new d.bU(m,e.u_world),u_image:new d.bP(m,e.u_image),u_texsize:new d.bU(m,e.u_texsize),u_pixel_coord_upper:new d.bU(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.bU(m,e.u_pixel_coord_lower),u_scale:new d.bT(m,e.u_scale),u_fade:new d.bg(m,e.u_fade),u_fill_translate:new d.bU(m,e.u_fill_translate)}),circle:(m,e)=>({u_camera_to_center_distance:new d.bg(m,e.u_camera_to_center_distance),u_scale_with_map:new d.bP(m,e.u_scale_with_map),u_pitch_with_map:new d.bP(m,e.u_pitch_with_map),u_extrude_scale:new d.bU(m,e.u_extrude_scale),u_device_pixel_ratio:new d.bg(m,e.u_device_pixel_ratio),u_globe_extrude_scale:new d.bg(m,e.u_globe_extrude_scale),u_translate:new d.bU(m,e.u_translate)}),collisionBox:(m,e)=>({u_pixel_extrude_scale:new d.bU(m,e.u_pixel_extrude_scale)}),collisionCircle:(m,e)=>({u_viewport_size:new d.bU(m,e.u_viewport_size)}),debug:(m,e)=>({u_color:new d.bQ(m,e.u_color),u_overlay:new d.bP(m,e.u_overlay),u_overlay_scale:new d.bg(m,e.u_overlay_scale)}),depth:Ru,clippingMask:Ru,heatmap:(m,e)=>({u_extrude_scale:new d.bg(m,e.u_extrude_scale),u_intensity:new d.bg(m,e.u_intensity),u_globe_extrude_scale:new d.bg(m,e.u_globe_extrude_scale)}),heatmapTexture:(m,e)=>({u_matrix:new d.bR(m,e.u_matrix),u_world:new d.bU(m,e.u_world),u_image:new d.bP(m,e.u_image),u_color_ramp:new d.bP(m,e.u_color_ramp),u_opacity:new d.bg(m,e.u_opacity)}),hillshade:(m,e)=>({u_image:new d.bP(m,e.u_image),u_latrange:new d.bU(m,e.u_latrange),u_exaggeration:new d.bg(m,e.u_exaggeration),u_altitudes:new d.b_(m,e.u_altitudes),u_azimuths:new d.b_(m,e.u_azimuths),u_accent:new d.bQ(m,e.u_accent),u_method:new d.bP(m,e.u_method),u_shadows:new d.bZ(m,e.u_shadows),u_highlights:new d.bZ(m,e.u_highlights)}),hillshadePrepare:(m,e)=>({u_matrix:new d.bR(m,e.u_matrix),u_image:new d.bP(m,e.u_image),u_dimension:new d.bU(m,e.u_dimension),u_zoom:new d.bg(m,e.u_zoom),u_unpack:new d.bS(m,e.u_unpack)}),colorRelief:(m,e)=>({u_image:new d.bP(m,e.u_image),u_unpack:new d.bS(m,e.u_unpack),u_dimension:new d.bU(m,e.u_dimension),u_elevation_stops:new d.bP(m,e.u_elevation_stops),u_color_stops:new d.bP(m,e.u_color_stops),u_color_ramp_size:new d.bP(m,e.u_color_ramp_size),u_opacity:new d.bg(m,e.u_opacity)}),line:(m,e)=>({u_translation:new d.bU(m,e.u_translation),u_ratio:new d.bg(m,e.u_ratio),u_device_pixel_ratio:new d.bg(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.bU(m,e.u_units_to_pixels)}),lineGradient:(m,e)=>({u_translation:new d.bU(m,e.u_translation),u_ratio:new d.bg(m,e.u_ratio),u_device_pixel_ratio:new d.bg(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.bU(m,e.u_units_to_pixels),u_image:new d.bP(m,e.u_image),u_image_height:new d.bg(m,e.u_image_height)}),linePattern:(m,e)=>({u_translation:new d.bU(m,e.u_translation),u_texsize:new d.bU(m,e.u_texsize),u_ratio:new d.bg(m,e.u_ratio),u_device_pixel_ratio:new d.bg(m,e.u_device_pixel_ratio),u_image:new d.bP(m,e.u_image),u_units_to_pixels:new d.bU(m,e.u_units_to_pixels),u_scale:new d.bT(m,e.u_scale),u_fade:new d.bg(m,e.u_fade)}),lineSDF:(m,e)=>({u_translation:new d.bU(m,e.u_translation),u_ratio:new d.bg(m,e.u_ratio),u_device_pixel_ratio:new d.bg(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.bU(m,e.u_units_to_pixels),u_image:new d.bP(m,e.u_image),u_mix:new d.bg(m,e.u_mix),u_tileratio:new d.bg(m,e.u_tileratio),u_crossfade_from:new d.bg(m,e.u_crossfade_from),u_crossfade_to:new d.bg(m,e.u_crossfade_to),u_lineatlas_width:new d.bg(m,e.u_lineatlas_width),u_lineatlas_height:new d.bg(m,e.u_lineatlas_height)}),raster:(m,e)=>({u_tl_parent:new d.bU(m,e.u_tl_parent),u_scale_parent:new d.bg(m,e.u_scale_parent),u_buffer_scale:new d.bg(m,e.u_buffer_scale),u_fade_t:new d.bg(m,e.u_fade_t),u_opacity:new d.bg(m,e.u_opacity),u_image0:new d.bP(m,e.u_image0),u_image1:new d.bP(m,e.u_image1),u_brightness_low:new d.bg(m,e.u_brightness_low),u_brightness_high:new d.bg(m,e.u_brightness_high),u_saturation_factor:new d.bg(m,e.u_saturation_factor),u_contrast_factor:new d.bg(m,e.u_contrast_factor),u_spin_weights:new d.bT(m,e.u_spin_weights),u_coords_top:new d.bS(m,e.u_coords_top),u_coords_bottom:new d.bS(m,e.u_coords_bottom)}),symbolIcon:(m,e)=>({u_is_size_zoom_constant:new d.bP(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.bP(m,e.u_is_size_feature_constant),u_size_t:new d.bg(m,e.u_size_t),u_size:new d.bg(m,e.u_size),u_camera_to_center_distance:new d.bg(m,e.u_camera_to_center_distance),u_pitch:new d.bg(m,e.u_pitch),u_rotate_symbol:new d.bP(m,e.u_rotate_symbol),u_aspect_ratio:new d.bg(m,e.u_aspect_ratio),u_fade_change:new d.bg(m,e.u_fade_change),u_label_plane_matrix:new d.bR(m,e.u_label_plane_matrix),u_coord_matrix:new d.bR(m,e.u_coord_matrix),u_is_text:new d.bP(m,e.u_is_text),u_pitch_with_map:new d.bP(m,e.u_pitch_with_map),u_is_along_line:new d.bP(m,e.u_is_along_line),u_is_variable_anchor:new d.bP(m,e.u_is_variable_anchor),u_texsize:new d.bU(m,e.u_texsize),u_texture:new d.bP(m,e.u_texture),u_translation:new d.bU(m,e.u_translation),u_pitched_scale:new d.bg(m,e.u_pitched_scale)}),symbolSDF:(m,e)=>({u_is_size_zoom_constant:new d.bP(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.bP(m,e.u_is_size_feature_constant),u_size_t:new d.bg(m,e.u_size_t),u_size:new d.bg(m,e.u_size),u_camera_to_center_distance:new d.bg(m,e.u_camera_to_center_distance),u_pitch:new d.bg(m,e.u_pitch),u_rotate_symbol:new d.bP(m,e.u_rotate_symbol),u_aspect_ratio:new d.bg(m,e.u_aspect_ratio),u_fade_change:new d.bg(m,e.u_fade_change),u_label_plane_matrix:new d.bR(m,e.u_label_plane_matrix),u_coord_matrix:new d.bR(m,e.u_coord_matrix),u_is_text:new d.bP(m,e.u_is_text),u_pitch_with_map:new d.bP(m,e.u_pitch_with_map),u_is_along_line:new d.bP(m,e.u_is_along_line),u_is_variable_anchor:new d.bP(m,e.u_is_variable_anchor),u_texsize:new d.bU(m,e.u_texsize),u_texture:new d.bP(m,e.u_texture),u_gamma_scale:new d.bg(m,e.u_gamma_scale),u_device_pixel_ratio:new d.bg(m,e.u_device_pixel_ratio),u_is_halo:new d.bP(m,e.u_is_halo),u_translation:new d.bU(m,e.u_translation),u_pitched_scale:new d.bg(m,e.u_pitched_scale)}),symbolTextAndIcon:(m,e)=>({u_is_size_zoom_constant:new d.bP(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.bP(m,e.u_is_size_feature_constant),u_size_t:new d.bg(m,e.u_size_t),u_size:new d.bg(m,e.u_size),u_camera_to_center_distance:new d.bg(m,e.u_camera_to_center_distance),u_pitch:new d.bg(m,e.u_pitch),u_rotate_symbol:new d.bP(m,e.u_rotate_symbol),u_aspect_ratio:new d.bg(m,e.u_aspect_ratio),u_fade_change:new d.bg(m,e.u_fade_change),u_label_plane_matrix:new d.bR(m,e.u_label_plane_matrix),u_coord_matrix:new d.bR(m,e.u_coord_matrix),u_is_text:new d.bP(m,e.u_is_text),u_pitch_with_map:new d.bP(m,e.u_pitch_with_map),u_is_along_line:new d.bP(m,e.u_is_along_line),u_is_variable_anchor:new d.bP(m,e.u_is_variable_anchor),u_texsize:new d.bU(m,e.u_texsize),u_texsize_icon:new d.bU(m,e.u_texsize_icon),u_texture:new d.bP(m,e.u_texture),u_texture_icon:new d.bP(m,e.u_texture_icon),u_gamma_scale:new d.bg(m,e.u_gamma_scale),u_device_pixel_ratio:new d.bg(m,e.u_device_pixel_ratio),u_is_halo:new d.bP(m,e.u_is_halo),u_translation:new d.bU(m,e.u_translation),u_pitched_scale:new d.bg(m,e.u_pitched_scale)}),background:(m,e)=>({u_opacity:new d.bg(m,e.u_opacity),u_color:new d.bQ(m,e.u_color)}),backgroundPattern:(m,e)=>({u_opacity:new d.bg(m,e.u_opacity),u_image:new d.bP(m,e.u_image),u_pattern_tl_a:new d.bU(m,e.u_pattern_tl_a),u_pattern_br_a:new d.bU(m,e.u_pattern_br_a),u_pattern_tl_b:new d.bU(m,e.u_pattern_tl_b),u_pattern_br_b:new d.bU(m,e.u_pattern_br_b),u_texsize:new d.bU(m,e.u_texsize),u_mix:new d.bg(m,e.u_mix),u_pattern_size_a:new d.bU(m,e.u_pattern_size_a),u_pattern_size_b:new d.bU(m,e.u_pattern_size_b),u_scale_a:new d.bg(m,e.u_scale_a),u_scale_b:new d.bg(m,e.u_scale_b),u_pixel_coord_upper:new d.bU(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.bU(m,e.u_pixel_coord_lower),u_tile_units_to_pixels:new d.bg(m,e.u_tile_units_to_pixels)}),terrain:(m,e)=>({u_texture:new d.bP(m,e.u_texture),u_ele_delta:new d.bg(m,e.u_ele_delta),u_fog_matrix:new d.bR(m,e.u_fog_matrix),u_fog_color:new d.bQ(m,e.u_fog_color),u_fog_ground_blend:new d.bg(m,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new d.bg(m,e.u_fog_ground_blend_opacity),u_horizon_color:new d.bQ(m,e.u_horizon_color),u_horizon_fog_blend:new d.bg(m,e.u_horizon_fog_blend),u_is_globe_mode:new d.bg(m,e.u_is_globe_mode)}),terrainDepth:(m,e)=>({u_ele_delta:new d.bg(m,e.u_ele_delta)}),terrainCoords:(m,e)=>({u_texture:new d.bP(m,e.u_texture),u_terrain_coords_id:new d.bg(m,e.u_terrain_coords_id),u_ele_delta:new d.bg(m,e.u_ele_delta)}),projectionErrorMeasurement:(m,e)=>({u_input:new d.bg(m,e.u_input),u_output_expected:new d.bg(m,e.u_output_expected)}),atmosphere:(m,e)=>({u_sun_pos:new d.bT(m,e.u_sun_pos),u_atmosphere_blend:new d.bg(m,e.u_atmosphere_blend),u_globe_position:new d.bT(m,e.u_globe_position),u_globe_radius:new d.bg(m,e.u_globe_radius),u_inv_proj_matrix:new d.bR(m,e.u_inv_proj_matrix)}),sky:(m,e)=>({u_sky_color:new d.bQ(m,e.u_sky_color),u_horizon_color:new d.bQ(m,e.u_horizon_color),u_horizon:new d.bU(m,e.u_horizon),u_horizon_normal:new d.bU(m,e.u_horizon_normal),u_sky_horizon_blend:new d.bg(m,e.u_sky_horizon_blend),u_sky_blend:new d.bg(m,e.u_sky_blend)})};class Oh{constructor(e,r,l){this.context=e;const h=e.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ma={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ya{constructor(e,r,l,h){this.length=r.length,this.attributes=l,this.itemSize=r.bytesPerElement,this.dynamicDraw=h,this.context=e;const g=e.gl;this.buffer=g.createBuffer(),e.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,r){for(let l=0;l<this.attributes.length;l++){const h=r.attributes[this.attributes[l].name];h!==void 0&&e.enableVertexAttribArray(h)}}setVertexAttribPointers(e,r,l){for(let h=0;h<this.attributes.length;h++){const g=this.attributes[h],y=r.attributes[g.name];y!==void 0&&e.vertexAttribPointer(y,g.components,e[ma[g.type]],!1,this.itemSize,g.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ai{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class kc extends ai{getDefault(){return d.bf.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Bc extends ai{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class ku extends ai{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Yl extends ai{getDefault(){return[!0,!0,!0,!0]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class zo extends ai{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Qs extends ai{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Bu extends ai{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const r=this.current;(e.func!==r.func||e.ref!==r.ref||e.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Kl extends ai{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Ou extends ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=e,this.dirty=!1}}class Fh extends ai{getDefault(){return[0,1]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ws extends ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=e,this.dirty=!1}}class hl extends ai{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Oc extends ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.BLEND):r.disable(r.BLEND),this.current=e,this.dirty=!1}}class Ql extends ai{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class jr extends ai{getDefault(){return d.bf.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Wl extends ai{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Fc extends ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=e,this.dirty=!1}}class Js extends ai{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Jl extends ai{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class dl extends ai{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class sr extends ai{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Fu extends ai{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Uu extends ai{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class ec extends ai{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class la extends ai{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Po extends ai{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Sa extends ai{getDefault(){return null}set(e){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Nr extends ai{getDefault(){return null}set(e){var r;if(e===this.current&&!this.dirty)return;const l=this.gl;br(l)?l.bindVertexArray(e):(r=l.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class fl extends ai{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class tc extends ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class gs extends ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Vr extends ai{constructor(e,r){super(e),this.context=e,this.parent=r}getDefault(){return null}}class eo extends Vr{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Uc extends Vr{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Zt extends Vr{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Zr="Framebuffer is not complete";class Ld{constructor(e,r,l,h,g){this.context=e,this.width=r,this.height=l;const y=e.gl,w=this.framebuffer=y.createFramebuffer();if(this.colorAttachment=new eo(e,w),h)this.depthAttachment=g?new Zt(e,w):new Uc(e,w);else if(g)throw new Error("Stencil cannot be set without depth");if(y.checkFramebufferStatus(y.FRAMEBUFFER)!==y.FRAMEBUFFER_COMPLETE)throw new Error(Zr)}destroy(){const e=this.context.gl,r=this.colorAttachment.get();if(r&&e.deleteTexture(r),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class Ba{constructor(e){var r,l;if(this.gl=e,this.clearColor=new kc(this),this.clearDepth=new Bc(this),this.clearStencil=new ku(this),this.colorMask=new Yl(this),this.depthMask=new zo(this),this.stencilMask=new Qs(this),this.stencilFunc=new Bu(this),this.stencilOp=new Kl(this),this.stencilTest=new Ou(this),this.depthRange=new Fh(this),this.depthTest=new Ws(this),this.depthFunc=new hl(this),this.blend=new Oc(this),this.blendFunc=new Ql(this),this.blendColor=new jr(this),this.blendEquation=new Wl(this),this.cullFace=new Fc(this),this.cullFaceSide=new Js(this),this.frontFace=new Jl(this),this.program=new dl(this),this.activeTexture=new sr(this),this.viewport=new Fu(this),this.bindFramebuffer=new Uu(this),this.bindRenderbuffer=new ec(this),this.bindTexture=new la(this),this.bindVertexBuffer=new Po(this),this.bindElementBuffer=new Sa(this),this.bindVertexArray=new Nr(this),this.pixelStoreUnpack=new fl(this),this.pixelStoreUnpackPremultiplyAlpha=new tc(this),this.pixelStoreUnpackFlipY=new gs(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),br(e)){this.HALF_FLOAT=e.HALF_FLOAT;const h=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=e.RGBA16F)!==null&&r!==void 0?r:h?.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:h?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const h=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=h?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,r){return new Oh(this,e,r)}createVertexBuffer(e,r,l){return new Ya(this,e,r,l)}createRenderbuffer(e,r,l){const h=this.gl,g=h.createRenderbuffer();return this.bindRenderbuffer.set(g),h.renderbufferStorage(h.RENDERBUFFER,e,r,l),this.bindRenderbuffer.set(null),g}createFramebuffer(e,r,l,h){return new Ld(this,e,r,l,h)}clear({color:e,depth:r,stencil:l}){const h=this.gl;let g=0;e&&(g|=h.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(g|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),l!==void 0&&(g|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),h.clear(g)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){d.bH(e.blendFunction,yi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return br(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var r;return br(this.gl)?this.gl.deleteVertexArray(e):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let Gr;function qr(m,e,r,l,h){const g=m.context,y=m.transform,w=g.gl,T=m.useProgram("collisionBox"),E=[];let A=0,D=0;for(let Y=0;Y<l.length;Y++){const Q=l[Y],ee=e.getTile(Q).getBucket(r);if(!ee)continue;const J=h?ee.textCollisionBox:ee.iconCollisionBox,se=ee.collisionCircleArray;se.length>0&&(E.push({circleArray:se,circleOffset:D,coord:Q}),A+=se.length/4,D=A),J&&T.draw(g,w.LINES,zt.disabled,Yt.disabled,m.colorModeForRenderPass(),bt.disabled,Xl(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(Q),y.getProjectionData({overscaledTileID:Q,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,null,m.transform.zoom,null,null,J.collisionVertexBuffer)}if(!h||!E.length)return;const P=m.useProgram("collisionCircle"),B=new d.b$;B.resize(4*A),B._trim();let N=0;for(const Y of E)for(let Q=0;Q<Y.circleArray.length/4;Q++){const ee=4*Q,J=Y.circleArray[ee+0],se=Y.circleArray[ee+1],ue=Y.circleArray[ee+2],te=Y.circleArray[ee+3];B.emplace(N++,J,se,ue,te,0),B.emplace(N++,J,se,ue,te,1),B.emplace(N++,J,se,ue,te,2),B.emplace(N++,J,se,ue,te,3)}(!Gr||Gr.length<2*A)&&(Gr=(function(Y){const Q=2*Y,ee=new d.c1;ee.resize(Q),ee._trim();for(let J=0;J<Q;J++){const se=6*J;ee.uint16[se+0]=4*J+0,ee.uint16[se+1]=4*J+1,ee.uint16[se+2]=4*J+2,ee.uint16[se+3]=4*J+2,ee.uint16[se+4]=4*J+3,ee.uint16[se+5]=4*J+0}return ee})(A));const $=g.createIndexBuffer(Gr,!0),X=g.createVertexBuffer(B,d.c0.members,!0);for(const Y of E){const Q=Dh(m.transform);P.draw(g,w.TRIANGLES,zt.disabled,Yt.disabled,m.colorModeForRenderPass(),bt.disabled,Q,m.style.map.terrain&&m.style.map.terrain.getTerrainData(Y.coord),null,r.id,X,$,d.aM.simpleSegment(0,2*Y.circleOffset,Y.circleArray.length,Y.circleArray.length/2),null,m.transform.zoom,null,null,null)}X.destroy(),$.destroy()}const Uh=d.ag(new Float32Array(16));function ic(m,e,r,l,h,g){const{horizontalAlign:y,verticalAlign:w}=d.aH(m);return new d.P((-(y-.5)*e/h+l[0])*g,(-(w-.5)*r/h+l[1])*g)}function Do(m,e,r,l,h,g){const y=e.tileAnchorPoint.add(new d.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=l.mult(g);r||(w=w.rotate(-h));const T=y.add(w);return fn(T.x,T.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(r){const w=Nn(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(m),T=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return m.add(l.rotate(T))}return m.add(l)}function nc(m,e,r,l,h,g,y,w,T,E,A,D){const P=m.text.placedSymbolArray,B=m.text.dynamicLayoutVertexArray,N=m.icon.dynamicLayoutVertexArray,$={};B.clear();for(let X=0;X<P.length;X++){const Y=P.get(X),Q=Y.hidden||!Y.crossTileID||m.allowVerticalPlacement&&!Y.placedOrientation?null:l[Y.crossTileID];if(Q){const ee=new d.P(Y.anchorX,Y.anchorY),J={getElevation:D,width:h.width,height:h.height,pitchedLabelPlaneMatrix:g,pitchWithMap:r,transform:h,tileAnchorPoint:ee,translation:E,unwrappedTileID:A},se=r?Vs(ee.x,ee.y,J):Nn(ee.x,ee.y,J),ue=Ue(h.cameraToCenterDistance,se.signedDistanceFromCamera);let te=d.ap(m.textSizeData,w,Y)*ue/d.aB;r&&(te*=m.tilePixelRatio/y);const{width:de,height:Ce,anchor:Te,textOffset:Se,textBoxScale:Ee}=Q,We=ic(Te,de,Ce,Se,Ee,te),Qe=h.getPitchedTextCorrection(ee.x+E[0],ee.y+E[1],A),Ve=Do(se.point,J,e,We,-h.bearingInRadians,Qe),lt=m.allowVerticalPlacement&&Y.placedOrientation===d.ao.vertical?Math.PI/2:0;for(let Lt=0;Lt<Y.numGlyphs;Lt++)d.av(B,Ve,lt);T&&Y.associatedIconIndex>=0&&($[Y.associatedIconIndex]={shiftedAnchor:Ve,angle:lt})}else wa(Y.numGlyphs,B)}if(T){N.clear();const X=m.icon.placedSymbolArray;for(let Y=0;Y<X.length;Y++){const Q=X.get(Y);if(Q.hidden)wa(Q.numGlyphs,N);else{const ee=$[Y];if(ee)for(let J=0;J<Q.numGlyphs;J++)d.av(N,ee.shiftedAnchor,ee.angle);else wa(Q.numGlyphs,N)}}m.icon.dynamicLayoutVertexBuffer.updateData(N)}m.text.dynamicLayoutVertexBuffer.updateData(B)}function ac(m,e,r){return r.iconsInText&&e?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Io(m,e,r,l,h,g,y,w,T,E,A,D,P){const B=m.context,N=B.gl,$=m.transform,X=w==="map",Y=T==="map",Q=w!=="viewport"&&r.layout.get("symbol-placement")!=="point",ee=X&&!Y&&!Q,J=!r.layout.get("symbol-sort-key").isConstant();let se=!1;const ue=m.getDepthModeForSublayer(0,zt.ReadOnly),te=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),de=[],Ce=$.getCircleRadiusCorrection();for(const Te of l){const Se=e.getTile(Te),Ee=Se.getBucket(r);if(!Ee)continue;const We=h?Ee.text:Ee.icon;if(!We||!We.segments.get().length||!We.hasVisibleVertices)continue;const Qe=We.programConfigurations.get(r.id),Ve=h||Ee.sdfIcons,lt=h?Ee.textSizeData:Ee.iconSizeData,Lt=Y||$.pitch!==0,li=m.useProgram(ac(Ve,h,Ee),Qe),ki=d.an(lt,$.zoom),Ai=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Te);let Vi,Bi,Bn,Zi,xi=[0,0],Si=null;if(h)Bi=Se.glyphAtlasTexture,Bn=N.LINEAR,Vi=Se.glyphAtlasTexture.size,Ee.iconsInText&&(xi=Se.imageAtlasTexture.size,Si=Se.imageAtlasTexture,Zi=Lt||m.options.rotating||m.options.zooming||lt.kind==="composite"||lt.kind==="camera"?N.LINEAR:N.NEAREST);else{const xn=r.layout.get("icon-size").constantOr(0)!==1||Ee.iconsNeedLinear;Bi=Se.imageAtlasTexture,Bn=Ve||m.options.rotating||m.options.zooming||xn||Lt?N.LINEAR:N.NEAREST,Vi=Se.imageAtlasTexture.size}const Gt=d.aC(Se,1,m.transform.zoom),On=jn(X,m.transform,Gt),lr=d.L();d.aq(lr,On);const uo=In(Y,X,m.transform,Gt),ts=d.aD($,Se,g,y),Fo=$.getProjectionData({overscaledTileID:Te,applyGlobeMatrix:!P,applyTerrainMatrix:!0}),bl=te&&Ee.hasTextData(),Es=r.layout.get("icon-text-fit")!=="none"&&bl&&Ee.hasIconData();if(Q){const xn=m.style.map.terrain?(va,Oi)=>m.style.map.terrain.getElevation(Te,va,Oi):null,mn=r.layout.get("text-rotation-alignment")==="map";Da(Ee,m,h,On,lr,Y,E,mn,Te.toUnwrapped(),$.width,$.height,ts,xn)}const ho=h&&te||Es,Za=Q||ho?Uh:Y?On:m.transform.clipSpaceToPixelsMatrix,As=Ve&&r.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Cr;Cr=Ve?Ee.iconsInText?Lh(lt.kind,ki,ee,Y,Q,ho,m,Za,uo,ts,Vi,xi,Ce):Iu(lt.kind,ki,ee,Y,Q,ho,m,Za,uo,ts,h,Vi,0,Ce):ul(lt.kind,ki,ee,Y,Q,ho,m,Za,uo,ts,h,Vi,Ce);const zs={program:li,buffers:We,uniformValues:Cr,projectionData:Fo,atlasTexture:Bi,atlasTextureIcon:Si,atlasInterpolation:Bn,atlasInterpolationIcon:Zi,isSDF:Ve,hasHalo:As};if(J&&Ee.canOverlap){se=!0;const xn=We.segments.get();for(const mn of xn)de.push({segments:new d.aM([mn]),sortKey:mn.sortKey,state:zs,terrainData:Ai})}else de.push({segments:We.segments,sortKey:0,state:zs,terrainData:Ai})}se&&de.sort(((Te,Se)=>Te.sortKey-Se.sortKey));for(const Te of de){const Se=Te.state;if(B.activeTexture.set(N.TEXTURE0),Se.atlasTexture.bind(Se.atlasInterpolation,N.CLAMP_TO_EDGE),Se.atlasTextureIcon&&(B.activeTexture.set(N.TEXTURE1),Se.atlasTextureIcon&&Se.atlasTextureIcon.bind(Se.atlasInterpolationIcon,N.CLAMP_TO_EDGE)),Se.isSDF){const Ee=Se.uniformValues;Se.hasHalo&&(Ee.u_is_halo=1,pl(Se.buffers,Te.segments,r,m,Se.program,ue,A,D,Ee,Se.projectionData,Te.terrainData)),Ee.u_is_halo=0}pl(Se.buffers,Te.segments,r,m,Se.program,ue,A,D,Se.uniformValues,Se.projectionData,Te.terrainData)}}function pl(m,e,r,l,h,g,y,w,T,E,A){const D=l.context;h.draw(D,D.gl.TRIANGLES,g,y,w,bt.backCCW,T,A,E,r.id,m.layoutVertexBuffer,m.indexBuffer,e,r.paint,l.transform.zoom,m.programConfigurations.get(r.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Oa(m,e,r,l,h){const g=m.context,y=g.gl,w=Yt.disabled,T=new yi([y.ONE,y.ONE],d.bf.transparent,[!0,!0,!0,!0]),E=e.getBucket(r);if(!E)return;const A=l.key;let D=r.heatmapFbos.get(A);D||(D=Hr(g,e.tileSize,e.tileSize),r.heatmapFbos.set(A,D)),g.bindFramebuffer.set(D.framebuffer),g.viewport.set([0,0,e.tileSize,e.tileSize]),g.clear({color:d.bf.transparent});const P=E.programConfigurations.get(r.id),B=m.useProgram("heatmap",P,!h),N=m.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),$=m.style.map.terrain.getTerrainData(l);B.draw(g,y.TRIANGLES,zt.disabled,w,T,bt.disabled,Eo(e,m.transform.zoom,r.paint.get("heatmap-intensity"),1),$,N,r.id,E.layoutVertexBuffer,E.indexBuffer,E.segments,r.paint,m.transform.zoom,P)}function Ro(m,e,r,l,h){const g=m.context,y=g.gl,w=m.transform;g.setColorMode(m.colorModeForRenderPass());const T=to(g,e),E=r.key,A=e.heatmapFbos.get(E);if(!A)return;g.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,A.colorAttachment.get()),g.activeTexture.set(y.TEXTURE1),T.bind(y.LINEAR,y.CLAMP_TO_EDGE);const D=w.getProjectionData({overscaledTileID:r,applyTerrainMatrix:h,applyGlobeMatrix:!l});m.useProgram("heatmapTexture").draw(g,y.TRIANGLES,zt.disabled,Yt.disabled,m.colorModeForRenderPass(),bt.disabled,zu(m,e,0,1),null,D,e.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,e.paint,w.zoom),A.destroy(),e.heatmapFbos.delete(E)}function Hr(m,e,r){var l,h;const g=m.gl,y=g.createTexture();g.bindTexture(g.TEXTURE_2D,y),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR);const w=(l=m.HALF_FLOAT)!==null&&l!==void 0?l:g.UNSIGNED_BYTE,T=(h=m.RGBA16F)!==null&&h!==void 0?h:g.RGBA;g.texImage2D(g.TEXTURE_2D,0,T,e,r,0,g.RGBA,w,null);const E=m.createFramebuffer(e,r,!1,!1);return E.colorAttachment.set(y),E}function to(m,e){return e.colorRampTexture||(e.colorRampTexture=new d.T(m,e.colorRamp,m.gl.RGBA)),e.colorRampTexture}function _s(m,e,r,l,h){if(!r||!l||!l.imageAtlas)return;const g=l.imageAtlas.patternPositions;let y=g[r.to.toString()],w=g[r.from.toString()];if(!y&&w&&(y=w),!w&&y&&(w=y),!y||!w){const T=h.getPaintProperty(e);y=g[T],w=g[T]}y&&w&&m.setConstantPatternPositions(y,w)}function ea(m,e,r,l,h,g,y,w){const T=m.context.gl,E="fill-pattern",A=r.paint.get(E),D=A&&A.constantOr(1),P=r.getCrossfadeParameters();let B,N,$,X,Y;const Q=m.transform,ee=r.paint.get("fill-translate"),J=r.paint.get("fill-translate-anchor");y?(N=D&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=T.LINES):(N=D?"fillPattern":"fill",B=T.TRIANGLES);const se=A.constantOr(null);for(const ue of l){const te=e.getTile(ue);if(D&&!te.patternsLoaded())continue;const de=te.getBucket(r);if(!de)continue;const Ce=de.programConfigurations.get(r.id),Te=m.useProgram(N,Ce),Se=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ue);D&&(m.context.activeTexture.set(T.TEXTURE0),te.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),Ce.updatePaintBuffers(P)),_s(Ce,E,se,te,r);const Ee=Q.getProjectionData({overscaledTileID:ue,applyGlobeMatrix:!w,applyTerrainMatrix:!0}),We=d.aD(Q,te,ee,J);if(y){X=de.indexBuffer2,Y=de.segments2;const Ve=[T.drawingBufferWidth,T.drawingBufferHeight];$=N==="fillOutlinePattern"&&D?ll(m,P,te,Ve,We):$l(Ve,We)}else X=de.indexBuffer,Y=de.segments,$=D?Xs(m,P,te,We):{u_fill_translate:We};const Qe=m.stencilModeForClipping(ue);Te.draw(m.context,B,h,Qe,g,bt.backCCW,$,Se,Ee,r.id,de.layoutVertexBuffer,X,Y,r.paint,m.transform.zoom,Ce)}}function ga(m,e,r,l,h,g,y,w){const T=m.context,E=T.gl,A="fill-extrusion-pattern",D=r.paint.get(A),P=D.constantOr(1),B=r.getCrossfadeParameters(),N=r.paint.get("fill-extrusion-opacity"),$=D.constantOr(null),X=m.transform;for(const Y of l){const Q=e.getTile(Y),ee=Q.getBucket(r);if(!ee)continue;const J=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Y),se=ee.programConfigurations.get(r.id),ue=m.useProgram(P?"fillExtrusionPattern":"fillExtrusion",se);P&&(m.context.activeTexture.set(E.TEXTURE0),Q.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),se.updatePaintBuffers(B));const te=X.getProjectionData({overscaledTileID:Y,applyGlobeMatrix:!w,applyTerrainMatrix:!0});_s(se,A,$,Q,r);const de=d.aD(X,Q,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Ce=r.paint.get("fill-extrusion-vertical-gradient"),Te=P?Au(m,Ce,N,de,Y,B,Q):wr(m,Ce,N,de);ue.draw(T,T.gl.TRIANGLES,h,g,y,bt.backCCW,Te,J,te,r.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,r.paint,m.transform.zoom,se,m.style.map.terrain&&ee.centroidVertexBuffer)}}function $r(m,e,r,l,h,g,y,w,T){var E;const A=m.style.projection,D=m.context,P=m.transform,B=D.gl,N=[`#define NUM_ILLUMINATION_SOURCES ${r.paint.get("hillshade-highlight-color").values.length}`],$=m.useProgram("hillshade",null,!1,N),X=!m.options.moving;for(const Y of l){const Q=e.getTile(Y),ee=Q.fbo;if(!ee)continue;const J=A.getMeshFromTileID(D,Y.canonical,w,!0,"raster"),se=(E=m.style.map.terrain)===null||E===void 0?void 0:E.getTerrainData(Y);D.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,ee.colorAttachment.get());const ue=P.getProjectionData({overscaledTileID:Y,aligned:X,applyGlobeMatrix:!T,applyTerrainMatrix:!0});$.draw(D,B.TRIANGLES,g,h[Y.overscaledZ],y,bt.backCCW,Rd(m,Q,r),se,ue,r.id,J.vertexBuffer,J.indexBuffer,J.segments)}}function _a(m,e,r,l,h,g,y,w,T){var E;const A=m.style.projection,D=m.context,P=m.transform,B=D.gl,N=m.useProgram("colorRelief"),$=!m.options.moving;let X=!0,Y=0;for(const Q of l){const ee=e.getTile(Q),J=ee.dem;if(X){const Te=B.getParameter(B.MAX_TEXTURE_SIZE),{elevationTexture:Se,colorTexture:Ee}=r.getColorRampTextures(D,Te,J.getUnpackVector());D.activeTexture.set(B.TEXTURE1),Se.bind(B.NEAREST,B.CLAMP_TO_EDGE),D.activeTexture.set(B.TEXTURE4),Ee.bind(B.LINEAR,B.CLAMP_TO_EDGE),X=!1,Y=Se.size[0]}if(!J||!J.data)continue;const se=J.stride,ue=J.getPixels();if(D.activeTexture.set(B.TEXTURE0),D.pixelStoreUnpackPremultiplyAlpha.set(!1),ee.demTexture=ee.demTexture||m.getTileTexture(se),ee.demTexture){const Te=ee.demTexture;Te.update(ue,{premultiply:!1}),Te.bind(B.LINEAR,B.CLAMP_TO_EDGE)}else ee.demTexture=new d.T(D,ue,B.RGBA,{premultiply:!1}),ee.demTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const te=A.getMeshFromTileID(D,Q.canonical,w,!0,"raster"),de=(E=m.style.map.terrain)===null||E===void 0?void 0:E.getTerrainData(Q),Ce=P.getProjectionData({overscaledTileID:Q,aligned:$,applyGlobeMatrix:!T,applyTerrainMatrix:!0});N.draw(D,B.TRIANGLES,g,h[Q.overscaledZ],y,bt.backCCW,Pu(r,ee.dem,Y),de,Ce,r.id,te.vertexBuffer,te.indexBuffer,te.segments)}}const or=[new d.P(0,0),new d.P(d.$,0),new d.P(d.$,d.$),new d.P(0,d.$)];function Ka(m,e,r,l,h,g,y,w,T=!1,E=!1){const A=l[l.length-1].overscaledZ,D=m.context,P=D.gl,B=m.useProgram("raster"),N=m.transform,$=m.style.projection,X=m.colorModeForRenderPass(),Y=!m.options.moving;for(const Q of l){const ee=m.getDepthModeForSublayer(Q.overscaledZ-A,r.paint.get("raster-opacity")===1?zt.ReadWrite:zt.ReadOnly,P.LESS),J=e.getTile(Q);J.registerFadeDuration(r.paint.get("raster-fade-duration"));const se=e.findLoadedParent(Q,0),ue=e.findLoadedSibling(Q),te=rc(J,se||ue||null,e,r,m.transform,m.style.map.terrain);let de,Ce;const Te=r.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;D.activeTexture.set(P.TEXTURE0),J.texture.bind(Te,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),D.activeTexture.set(P.TEXTURE1),se?(se.texture.bind(Te,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),de=Math.pow(2,se.tileID.overscaledZ-J.tileID.overscaledZ),Ce=[J.tileID.canonical.x*de%1,J.tileID.canonical.y*de%1]):J.texture.bind(Te,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),J.texture.useMipmap&&D.extTextureFilterAnisotropic&&m.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const Se=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Q),Ee=N.getProjectionData({overscaledTileID:Q,aligned:Y,applyGlobeMatrix:!E,applyTerrainMatrix:!0}),We=Ao(Ce||[0,0],de||1,te,r,w),Qe=$.getMeshFromTileID(D,Q.canonical,g,y,"raster");B.draw(D,P.TRIANGLES,ee,h?h[Q.overscaledZ]:Yt.disabled,X,T?bt.frontCCW:bt.backCCW,We,Se,Ee,r.id,Qe.vertexBuffer,Qe.indexBuffer,Qe.segments)}}function rc(m,e,r,l,h,g){const y=l.paint.get("raster-fade-duration");if(!g&&y>0){const w=Ke.now(),T=(w-m.timeAdded)/y,E=e?(w-e.timeAdded)/y:-1,A=r.getSource(),D=ct(h,{tileSize:A.tileSize,roundZoom:A.roundZoom}),P=!e||Math.abs(e.tileID.overscaledZ-D)>Math.abs(m.tileID.overscaledZ-D),B=P&&m.refreshedUponExpiration?1:d.ah(P?T:1-E,0,1);return m.refreshedUponExpiration&&T>=1&&(m.refreshedUponExpiration=!1),e?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}const sc=new d.bf(1,0,0,1),jc=new d.bf(0,1,0,1),ju=new d.bf(0,0,1,1),Ln=new d.bf(1,0,1,1),Ri=new d.bf(0,1,1,1);function Jt(m,e,r,l){ei(m,0,e+r/2,m.transform.width,r,l)}function Xr(m,e,r,l){ei(m,e-r/2,0,r,m.transform.height,l)}function ei(m,e,r,l,h,g){const y=m.context,w=y.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*m.pixelRatio,r*m.pixelRatio,l*m.pixelRatio,h*m.pixelRatio),y.clear({color:g}),w.disable(w.SCISSOR_TEST)}function ys(m,e,r){const l=m.context,h=l.gl,g=m.useProgram("debug"),y=zt.disabled,w=Yt.disabled,T=m.colorModeForRenderPass(),E="$debug",A=m.style.map.terrain&&m.style.map.terrain.getTerrainData(r);l.activeTexture.set(h.TEXTURE0);const D=e.getTileByID(r.key).latestRawTileData,P=Math.floor((D&&D.byteLength||0)/1024),B=e.getTile(r).tileSize,N=512/Math.min(B,512)*(r.overscaledZ/m.transform.zoom)*.5;let $=r.canonical.toString();r.overscaledZ!==r.canonical.z&&($+=` => ${r.overscaledZ}`),(function(Y,Q){Y.initDebugOverlayCanvas();const ee=Y.debugOverlayCanvas,J=Y.context.gl,se=Y.debugOverlayCanvas.getContext("2d");se.clearRect(0,0,ee.width,ee.height),se.shadowColor="white",se.shadowBlur=2,se.lineWidth=1.5,se.strokeStyle="white",se.textBaseline="top",se.font="bold 36px Open Sans, sans-serif",se.fillText(Q,5,5),se.strokeText(Q,5,5),Y.debugOverlayTexture.update(ee),Y.debugOverlayTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE)})(m,`${$} ${P}kB`);const X=m.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(l,h.TRIANGLES,y,w,yi.alphaBlended,bt.disabled,Ys(d.bf.transparent,N),null,X,E,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),g.draw(l,h.LINE_STRIP,y,w,T,bt.disabled,Ys(d.bf.red),A,X,E,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function kn(m,e,r,l){const{isRenderingGlobe:h}=l,g=m.context,y=g.gl,w=m.transform,T=m.colorModeForRenderPass(),E=m.getDepthModeFor3D(),A=m.useProgram("terrain");g.bindFramebuffer.set(null),g.viewport.set([0,0,m.width,m.height]);for(const D of r){const P=e.getTerrainMesh(D.tileID),B=m.renderToTexture.getTexture(D),N=e.getTerrainData(D.tileID);g.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,B.texture);const $=e.getMeshFrameDelta(w.zoom),X=w.calculateFogMatrix(D.tileID.toUnwrapped()),Y=Pc($,X,m.style.sky,w.pitch,h),Q=w.getProjectionData({overscaledTileID:D.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});A.draw(g,y.TRIANGLES,E,Yt.disabled,T,bt.backCCW,Y,N,Q,"terrain",P.vertexBuffer,P.indexBuffer,P.segments)}}function oc(m,e){if(!e.mesh){const r=new d.aL;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);const l=new d.aN;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),e.mesh=new Hs(m.createVertexBuffer(r,ms.members),m.createIndexBuffer(l),d.aM.simpleSegment(0,0,r.length,l.length))}return e.mesh}class lc{constructor(e,r){this.context=new Ba(e),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Vt.maxUnderzooming+Vt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new wo}resize(e,r,l){if(this.width=Math.floor(e*l),this.height=Math.floor(r*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const e=this.context,r=new d.aL;r.emplaceBack(0,0),r.emplaceBack(d.$,0),r.emplaceBack(0,d.$),r.emplaceBack(d.$,d.$),this.tileExtentBuffer=e.createVertexBuffer(r,ms.members),this.tileExtentSegments=d.aM.simpleSegment(0,0,4,2);const l=new d.aL;l.emplaceBack(0,0),l.emplaceBack(d.$,0),l.emplaceBack(0,d.$),l.emplaceBack(d.$,d.$),this.debugBuffer=e.createVertexBuffer(l,ms.members),this.debugSegments=d.aM.simpleSegment(0,0,4,5);const h=new d.c6;h.emplaceBack(0,0,0,0),h.emplaceBack(d.$,0,d.$,0),h.emplaceBack(0,d.$,0,d.$),h.emplaceBack(d.$,d.$,d.$,d.$),this.rasterBoundsBuffer=e.createVertexBuffer(h,Dd.members),this.rasterBoundsSegments=d.aM.simpleSegment(0,0,4,2);const g=new d.aL;g.emplaceBack(0,0),g.emplaceBack(d.$,0),g.emplaceBack(0,d.$),g.emplaceBack(d.$,d.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(g,ms.members),this.rasterBoundsSegmentsPosOnly=d.aM.simpleSegment(0,0,4,5);const y=new d.aL;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(y,ms.members),this.viewportSegments=d.aM.simpleSegment(0,0,4,2);const w=new d.c7;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(w);const T=new d.aN;T.emplaceBack(1,0,2),T.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(T);const E=this.context.gl;this.stencilClearMode=new Yt({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO),this.tileExtentMesh=new Hs(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=d.L();d.bY(l,0,this.width,this.height,0,0,1),d.N(l,l,[r.drawingBufferWidth,r.drawingBufferHeight,0]);const h={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(e,r.TRIANGLES,zt.disabled,this.stencilClearMode,yi.disabled,bt.disabled,null,null,h,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,r,l){if(this.currentStencilSource===e.source||!e.isTileClipped()||!r||!r.length)return;this.currentStencilSource=e.source,this.nextStencilID+r.length>256&&this.clearStencil();const h=this.context;h.setColorMode(yi.disabled),h.setDepthMode(zt.disabled);const g={};for(const y of r)g[y.key]=this.nextStencilID++;this._renderTileMasks(g,r,l,!0),this._renderTileMasks(g,r,l,!1),this._tileClippingMaskIDs=g}_renderTileMasks(e,r,l,h){const g=this.context,y=g.gl,w=this.style.projection,T=this.transform,E=this.useProgram("clippingMask");for(const A of r){const D=e[A.key],P=this.style.map.terrain&&this.style.map.terrain.getTerrainData(A),B=w.getMeshFromTileID(this.context,A.canonical,h,!0,"stencil"),N=T.getProjectionData({overscaledTileID:A,applyGlobeMatrix:!l,applyTerrainMatrix:!0});E.draw(g,y.TRIANGLES,zt.disabled,new Yt({func:y.ALWAYS,mask:0},D,255,y.KEEP,y.KEEP,y.REPLACE),yi.disabled,l?bt.disabled:bt.backCCW,null,P,N,"$clipping",B.vertexBuffer,B.indexBuffer,B.segments)}}_renderTilesDepthBuffer(){const e=this.context,r=e.gl,l=this.style.projection,h=this.transform,g=this.useProgram("depth"),y=this.getDepthModeFor3D(),w=_e(h,{tileSize:h.tileSize});for(const T of w){const E=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T),A=l.getMeshFromTileID(this.context,T.canonical,!0,!0,"raster"),D=h.getProjectionData({overscaledTileID:T,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(e,r.TRIANGLES,y,Yt.disabled,yi.disabled,bt.backCCW,null,E,D,"$clipping",A.vertexBuffer,A.indexBuffer,A.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,r=this.context.gl;return new Yt({func:r.NOTEQUAL,mask:255},e,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(e){const r=this.context.gl;return new Yt({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,r.KEEP,r.KEEP,r.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const r=this.context.gl,l=e.sort(((y,w)=>w.overscaledZ-y.overscaledZ)),h=l[l.length-1].overscaledZ,g=l[0].overscaledZ-h+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const y={};for(let w=0;w<g;w++)y[w+h]=new Yt({func:r.GEQUAL,mask:255},w+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=g,[y,l]}return[{[h]:Yt.disabled},l]}stencilConfigForOverlapTwoPass(e){const r=this.context.gl,l=e.sort(((y,w)=>w.overscaledZ-y.overscaledZ)),h=l[l.length-1].overscaledZ,g=l[0].overscaledZ-h+1;if(this.clearStencil(),g>1){const y={},w={};for(let T=0;T<g;T++)y[T+h]=new Yt({func:r.GREATER,mask:255},g+1+T,255,r.KEEP,r.KEEP,r.REPLACE),w[T+h]=new Yt({func:r.GREATER,mask:255},1+T,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID=2*g+1,[y,w,l]}return this.nextStencilID=3,[{[h]:new Yt({func:r.GREATER,mask:255},2,255,r.KEEP,r.KEEP,r.REPLACE)},{[h]:new Yt({func:r.GREATER,mask:255},1,255,r.KEEP,r.KEEP,r.REPLACE)},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new yi([e.CONSTANT_COLOR,e.ONE],new d.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?yi.unblended:yi.alphaBlended}getDepthModeForSublayer(e,r,l){if(!this.opaquePassEnabledForLayer())return zt.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new zt(l||this.context.gl.LEQUAL,r,[h,h])}getDepthModeFor3D(){return new zt(this.context.gl.LEQUAL,zt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,r){var l,h;this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Ke.now()),this.imageManager.beginFrame();const g=this.style._order,y=this.style.sourceCaches,w={},T={},E={},A={isRenderingToTexture:!1,isRenderingGlobe:((l=e.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const P in y){const B=y[P];B.used&&B.prepare(this.context),w[P]=B.getVisibleCoordinates(!1),T[P]=w[P].slice().reverse(),E[P]=B.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let P=0;P<g.length;P++)if(this.style._layers[g[P]].is3D()){this.opaquePassCutoff=P;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const P of g){const B=this.style._layers[P];if(!B.hasOffscreenPass()||B.isHidden(this.transform.zoom))continue;const N=T[B.source];(B.type==="custom"||N.length)&&this.renderLayer(this,y[B.source],B,N,A)}if((h=this.style.projection)===null||h===void 0||h.updateGPUdependent({context:this.context,useProgram:P=>this.useProgram(P)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?d.bf.black:d.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(P,B){const N=P.context,$=N.gl,X=((ue,te,de)=>{const Ce=Math.cos(te.rollInRadians),Te=Math.sin(te.rollInRadians),Se=oe(te),Ee=te.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ue.properties.get("sky-color"),u_horizon_color:ue.properties.get("horizon-color"),u_horizon:[(te.width/2-Se*Te)*de,(te.height/2+Se*Ce)*de],u_horizon_normal:[-Te,Ce],u_sky_horizon_blend:ue.properties.get("sky-horizon-blend")*te.height/2*de,u_sky_blend:Ee}})(B,P.style.map.transform,P.pixelRatio),Y=new zt($.LEQUAL,zt.ReadWrite,[0,1]),Q=Yt.disabled,ee=P.colorModeForRenderPass(),J=P.useProgram("sky"),se=oc(N,B);J.draw(N,$.TRIANGLES,Y,Q,ee,bt.disabled,X,null,void 0,"sky",se.vertexBuffer,se.indexBuffer,se.segments)})(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const P=this.style._layers[g[this.currentLayer]],B=y[P.source],N=w[P.source];this._renderTileClippingMasks(P,N,!1),this.renderLayer(this,B,P,N,A)}this.renderPass="translucent";let D=!1;for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const P=this.style._layers[g[this.currentLayer]],B=y[P.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(P,A))continue;this.opaquePassEnabledForLayer()||D||(D=!0,A.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const N=(P.type==="symbol"?E:T)[P.source];this._renderTileClippingMasks(P,w[P.source],!!this.renderToTexture),this.renderLayer(this,B,P,N,A)}if(A.isRenderingGlobe&&(function(P,B,N){const $=P.context,X=$.gl,Y=P.useProgram("atmosphere"),Q=new zt(X.LEQUAL,zt.ReadOnly,[0,1]),ee=P.transform,J=(function(Ee,We){const Qe=Ee.properties.get("position"),Ve=[-Qe.x,-Qe.y,-Qe.z],lt=d.ag(new Float64Array(16));return Ee.properties.get("anchor")==="map"&&(d.b6(lt,lt,We.rollInRadians),d.b7(lt,lt,-We.pitchInRadians),d.b6(lt,lt,We.bearingInRadians),d.b7(lt,lt,We.center.lat*Math.PI/180),d.bz(lt,lt,-We.center.lng*Math.PI/180)),d.c5(Ve,Ve,lt),Ve})(N,P.transform),se=ee.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ue=B.properties.get("atmosphere-blend")*se.projectionTransition;if(ue===0)return;const te=sl(ee.worldSize,ee.center.lat),de=ee.inverseProjectionMatrix,Ce=new Float64Array(4);Ce[3]=1,d.aw(Ce,Ce,ee.modelViewProjectionMatrix),Ce[0]/=Ce[3],Ce[1]/=Ce[3],Ce[2]/=Ce[3],Ce[3]=1,d.aw(Ce,Ce,de),Ce[0]/=Ce[3],Ce[1]/=Ce[3],Ce[2]/=Ce[3],Ce[3]=1;const Te=((Ee,We,Qe,Ve,lt)=>({u_sun_pos:Ee,u_atmosphere_blend:We,u_globe_position:Qe,u_globe_radius:Ve,u_inv_proj_matrix:lt}))(J,ue,[Ce[0],Ce[1],Ce[2]],te,de),Se=oc($,B);Y.draw($,X.TRIANGLES,Q,Yt.disabled,yi.alphaBlended,bt.disabled,Te,null,null,"atmosphere",Se.vertexBuffer,Se.indexBuffer,Se.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const P=(function(B,N){let $=null;const X=Object.values(B._layers).flatMap((J=>J.source&&!J.isHidden(N)?[B.sourceCaches[J.source]]:[])),Y=X.filter((J=>J.getSource().type==="vector")),Q=X.filter((J=>J.getSource().type!=="vector")),ee=J=>{(!$||$.getSource().maxzoom<J.getSource().maxzoom)&&($=J)};return Y.forEach((J=>ee(J))),$||Q.forEach((J=>ee(J))),$})(this.style,this.transform.zoom);P&&(function(B,N,$){for(let X=0;X<$.length;X++)ys(B,N,$[X])})(this,P,P.getVisibleCoordinates())}this.options.showPadding&&(function(P){const B=P.transform.padding;Jt(P,P.transform.height-(B.top||0),3,sc),Jt(P,B.bottom||0,3,jc),Xr(P,B.left||0,3,ju),Xr(P,P.transform.width-(B.right||0),3,Ln);const N=P.transform.centerPoint;(function($,X,Y,Q){ei($,X-1,Y-10,2,20,Q),ei($,X-10,Y-1,20,2,Q)})(P,N.x,P.transform.height-N.y,Ri)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const r=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let h=this.terrainFacilitator.dirty;h||(h=e?!d.c8(r,l):!d.c9(r,l)),h||(h=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),h&&(d.ca(r,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(g,y){const w=g.context,T=w.gl,E=g.transform,A=yi.unblended,D=new zt(T.LEQUAL,zt.ReadWrite,[0,1]),P=y.sourceCache.getRenderableTiles(),B=g.useProgram("terrainDepth");w.bindFramebuffer.set(y.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),w.clear({color:d.bf.transparent,depth:1});for(const N of P){const $=y.getTerrainMesh(N.tileID),X=y.getTerrainData(N.tileID),Y=E.getProjectionData({overscaledTileID:N.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Q={u_ele_delta:y.getMeshFrameDelta(E.zoom)};B.draw(w,T.TRIANGLES,D,Yt.disabled,A,bt.backCCW,Q,X,Y,"terrain",$.vertexBuffer,$.indexBuffer,$.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,g.width,g.height])})(this,this.style.map.terrain),(function(g,y){const w=g.context,T=w.gl,E=g.transform,A=yi.unblended,D=new zt(T.LEQUAL,zt.ReadWrite,[0,1]),P=y.getCoordsTexture(),B=y.sourceCache.getRenderableTiles(),N=g.useProgram("terrainCoords");w.bindFramebuffer.set(y.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),w.clear({color:d.bf.transparent,depth:1}),y.coordsIndex=[];for(const $ of B){const X=y.getTerrainMesh($.tileID),Y=y.getTerrainData($.tileID);w.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,P.texture);const Q={u_terrain_coords_id:(255-y.coordsIndex.length)/255,u_texture:0,u_ele_delta:y.getMeshFrameDelta(E.zoom)},ee=E.getProjectionData({overscaledTileID:$.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});N.draw(w,T.TRIANGLES,D,Yt.disabled,A,bt.backCCW,Q,Y,ee,"terrain",X.vertexBuffer,X.indexBuffer,X.segments),y.coordsIndex.push($.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,g.width,g.height])})(this,this.style.map.terrain))}renderLayer(e,r,l,h,g){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(h||[]).length)&&(this.id=l.id,d.cb(l)?(function(y,w,T,E,A,D){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:P}=D,B=Yt.disabled,N=y.colorModeForRenderPass();(T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function($,X,Y,Q,ee,J,se,ue,te){const de=X.transform,Ce=X.style.map.terrain,Te=ee==="map",Se=J==="map";for(const Ee of $){const We=Q.getTile(Ee),Qe=We.getBucket(Y);if(!Qe||!Qe.text||!Qe.text.segments.get().length)continue;const Ve=d.an(Qe.textSizeData,de.zoom),lt=d.aC(We,1,X.transform.zoom),Lt=jn(Te,X.transform,lt),li=Y.layout.get("icon-text-fit")!=="none"&&Qe.hasIconData();if(Ve){const ki=Math.pow(2,de.zoom-We.tileID.overscaledZ),Ai=Ce?(Vi,Bi)=>Ce.getElevation(Ee,Vi,Bi):null;nc(Qe,Te,Se,te,de,Lt,ki,Ve,li,d.aD(de,We,se,ue),Ee.toUnwrapped(),Ai)}}})(E,y,T,w,T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),A),T.paint.get("icon-opacity").constantOr(1)!==0&&Io(y,w,T,E,!1,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),T.layout.get("icon-rotation-alignment"),T.layout.get("icon-pitch-alignment"),T.layout.get("icon-keep-upright"),B,N,P),T.paint.get("text-opacity").constantOr(1)!==0&&Io(y,w,T,E,!0,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.layout.get("text-keep-upright"),B,N,P),w.map.showCollisionBoxes&&(qr(y,w,T,E,!0),qr(y,w,T,E,!1))})(e,r,l,h,this.style.placement.variableOffsets,g):d.cc(l)?(function(y,w,T,E,A){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:D}=A,P=T.paint.get("circle-opacity"),B=T.paint.get("circle-stroke-width"),N=T.paint.get("circle-stroke-opacity"),$=!T.layout.get("circle-sort-key").isConstant();if(P.constantOr(1)===0&&(B.constantOr(1)===0||N.constantOr(1)===0))return;const X=y.context,Y=X.gl,Q=y.transform,ee=y.getDepthModeForSublayer(0,zt.ReadOnly),J=Yt.disabled,se=y.colorModeForRenderPass(),ue=[],te=Q.getCircleRadiusCorrection();for(let de=0;de<E.length;de++){const Ce=E[de],Te=w.getTile(Ce),Se=Te.getBucket(T);if(!Se)continue;const Ee=T.paint.get("circle-translate"),We=T.paint.get("circle-translate-anchor"),Qe=d.aD(Q,Te,Ee,We),Ve=Se.programConfigurations.get(T.id),lt=y.useProgram("circle",Ve),Lt=Se.layoutVertexBuffer,li=Se.indexBuffer,ki=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ce),Ai={programConfiguration:Ve,program:lt,layoutVertexBuffer:Lt,indexBuffer:li,uniformValues:Ph(y,Te,T,Qe,te),terrainData:ki,projectionData:Q.getProjectionData({overscaledTileID:Ce,applyGlobeMatrix:!D,applyTerrainMatrix:!0})};if($){const Vi=Se.segments.get();for(const Bi of Vi)ue.push({segments:new d.aM([Bi]),sortKey:Bi.sortKey,state:Ai})}else ue.push({segments:Se.segments,sortKey:0,state:Ai})}$&&ue.sort(((de,Ce)=>de.sortKey-Ce.sortKey));for(const de of ue){const{programConfiguration:Ce,program:Te,layoutVertexBuffer:Se,indexBuffer:Ee,uniformValues:We,terrainData:Qe,projectionData:Ve}=de.state;Te.draw(X,Y.TRIANGLES,ee,J,se,bt.backCCW,We,Qe,Ve,T.id,Se,Ee,de.segments,T.paint,y.transform.zoom,Ce)}})(e,r,l,h,g):d.cd(l)?(function(y,w,T,E,A){if(T.paint.get("heatmap-opacity")===0)return;const D=y.context,{isRenderingToTexture:P,isRenderingGlobe:B}=A;if(y.style.map.terrain){for(const N of E){const $=w.getTile(N);w.hasRenderableParent(N)||(y.renderPass==="offscreen"?Oa(y,$,T,N,B):y.renderPass==="translucent"&&Ro(y,T,N,P,B))}D.viewport.set([0,0,y.width,y.height])}else y.renderPass==="offscreen"?(function(N,$,X,Y){const Q=N.context,ee=Q.gl,J=N.transform,se=Yt.disabled,ue=new yi([ee.ONE,ee.ONE],d.bf.transparent,[!0,!0,!0,!0]);(function(te,de,Ce){const Te=te.gl;te.activeTexture.set(Te.TEXTURE1),te.viewport.set([0,0,de.width/4,de.height/4]);let Se=Ce.heatmapFbos.get(d.c2);Se?(Te.bindTexture(Te.TEXTURE_2D,Se.colorAttachment.get()),te.bindFramebuffer.set(Se.framebuffer)):(Se=Hr(te,de.width/4,de.height/4),Ce.heatmapFbos.set(d.c2,Se))})(Q,N,X),Q.clear({color:d.bf.transparent});for(let te=0;te<Y.length;te++){const de=Y[te];if($.hasRenderableParent(de))continue;const Ce=$.getTile(de),Te=Ce.getBucket(X);if(!Te)continue;const Se=Te.programConfigurations.get(X.id),Ee=N.useProgram("heatmap",Se),We=J.getProjectionData({overscaledTileID:de,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Qe=J.getCircleRadiusCorrection();Ee.draw(Q,ee.TRIANGLES,zt.disabled,se,ue,bt.backCCW,Eo(Ce,J.zoom,X.paint.get("heatmap-intensity"),Qe),null,We,X.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,X.paint,J.zoom,Se)}Q.viewport.set([0,0,N.width,N.height])})(y,w,T,E):y.renderPass==="translucent"&&(function(N,$){const X=N.context,Y=X.gl;X.setColorMode(N.colorModeForRenderPass());const Q=$.heatmapFbos.get(d.c2);Q&&(X.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,Q.colorAttachment.get()),X.activeTexture.set(Y.TEXTURE1),to(X,$).bind(Y.LINEAR,Y.CLAMP_TO_EDGE),N.useProgram("heatmapTexture").draw(X,Y.TRIANGLES,zt.disabled,Yt.disabled,N.colorModeForRenderPass(),bt.disabled,zu(N,$,0,1),null,null,$.id,N.viewportBuffer,N.quadTriangleIndexBuffer,N.viewportSegments,$.paint,N.transform.zoom))})(y,T)})(e,r,l,h,g):d.ce(l)?(function(y,w,T,E,A){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:D}=A,P=T.paint.get("line-opacity"),B=T.paint.get("line-width");if(P.constantOr(1)===0||B.constantOr(1)===0)return;const N=y.getDepthModeForSublayer(0,zt.ReadOnly),$=y.colorModeForRenderPass(),X=T.paint.get("line-dasharray"),Y=X.constantOr(1),Q=T.paint.get("line-pattern"),ee=Q.constantOr(1),J=T.paint.get("line-gradient"),se=T.getCrossfadeParameters(),ue=ee?"linePattern":Y?"lineSDF":J?"lineGradient":"line",te=y.context,de=te.gl,Ce=y.transform;let Te=!0;for(const Se of E){const Ee=w.getTile(Se);if(ee&&!Ee.patternsLoaded())continue;const We=Ee.getBucket(T);if(!We)continue;const Qe=We.programConfigurations.get(T.id),Ve=y.context.program.get(),lt=y.useProgram(ue,Qe),Lt=Te||lt.program!==Ve,li=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Se),ki=Q.constantOr(null),Ai=X&&X.constantOr(null);if(ki&&Ee.imageAtlas){const xi=Ee.imageAtlas,Si=xi.patternPositions[ki.to.toString()],Gt=xi.patternPositions[ki.from.toString()];Si&&Gt&&Qe.setConstantPatternPositions(Si,Gt)}else if(Ai){const xi=T.layout.get("line-cap")==="round",Si=y.lineAtlas.getDash(Ai.to,xi),Gt=y.lineAtlas.getDash(Ai.from,xi);Qe.setConstantDashPositions(Si,Gt)}const Vi=Ce.getProjectionData({overscaledTileID:Se,applyGlobeMatrix:!D,applyTerrainMatrix:!0}),Bi=Ce.getPixelScale(),Bn=ee?Rh(y,Ee,T,Bi,se):Y?Ur(y,Ee,T,Bi,se):J?cl(y,Ee,T,Bi,We.lineClipsArray.length):Ks(y,Ee,T,Bi);if(ee)te.activeTexture.set(de.TEXTURE0),Ee.imageAtlasTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE),Qe.updatePaintBuffers(se);else if(Y)(Lt||y.lineAtlas.dirty)&&(te.activeTexture.set(de.TEXTURE0),y.lineAtlas.bind(te)),Qe.updatePaintBuffers(se);else if(J){const xi=We.gradients[T.id];let Si=xi.texture;if(T.gradientVersion!==xi.version){let Gt=256;if(T.stepInterpolant){const On=w.getSource().maxzoom,lr=Se.canonical.z===On?Math.ceil(1<<y.transform.maxZoom-Se.canonical.z):1;Gt=d.ah(d.c3(We.maxLineLength/d.$*1024*lr),256,te.maxTextureSize)}xi.gradient=d.c4({expression:T.gradientExpression(),evaluationKey:"lineProgress",resolution:Gt,image:xi.gradient||void 0,clips:We.lineClipsArray}),xi.texture?xi.texture.update(xi.gradient):xi.texture=new d.T(te,xi.gradient,de.RGBA),xi.version=T.gradientVersion,Si=xi.texture}te.activeTexture.set(de.TEXTURE0),Si.bind(T.stepInterpolant?de.NEAREST:de.LINEAR,de.CLAMP_TO_EDGE)}const Zi=y.stencilModeForClipping(Se);lt.draw(te,de.TRIANGLES,N,Zi,$,bt.disabled,Bn,li,Vi,T.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,T.paint,y.transform.zoom,Qe,We.layoutVertexBuffer2),Te=!1}})(e,r,l,h,g):d.cf(l)?(function(y,w,T,E,A){const D=T.paint.get("fill-color"),P=T.paint.get("fill-opacity");if(P.constantOr(1)===0)return;const{isRenderingToTexture:B}=A,N=y.colorModeForRenderPass(),$=T.paint.get("fill-pattern"),X=y.opaquePassEnabledForLayer()&&!$.constantOr(1)&&D.constantOr(d.bf.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===X){const Y=y.getDepthModeForSublayer(1,y.renderPass==="opaque"?zt.ReadWrite:zt.ReadOnly);ea(y,w,T,E,Y,N,!1,B)}if(y.renderPass==="translucent"&&T.paint.get("fill-antialias")){const Y=y.getDepthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,zt.ReadOnly);ea(y,w,T,E,Y,N,!0,B)}})(e,r,l,h,g):d.cg(l)?(function(y,w,T,E,A){const D=T.paint.get("fill-extrusion-opacity");if(D===0)return;const{isRenderingToTexture:P}=A;if(y.renderPass==="translucent"){const B=new zt(y.context.gl.LEQUAL,zt.ReadWrite,y.depthRangeFor3D);if(D!==1||T.paint.get("fill-extrusion-pattern").constantOr(1))ga(y,w,T,E,B,Yt.disabled,yi.disabled,P),ga(y,w,T,E,B,y.stencilModeFor3D(),y.colorModeForRenderPass(),P);else{const N=y.colorModeForRenderPass();ga(y,w,T,E,B,Yt.disabled,N,P)}}})(e,r,l,h,g):d.ch(l)?(function(y,w,T,E,A){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const{isRenderingToTexture:D}=A,P=y.context,B=y.style.projection.useSubdivision,N=y.getDepthModeForSublayer(0,zt.ReadOnly),$=y.colorModeForRenderPass();if(y.renderPass==="offscreen")(function(X,Y,Q,ee,J,se,ue){const te=X.context,de=te.gl;for(const Ce of Q){const Te=Y.getTile(Ce),Se=Te.dem;if(!Se||!Se.data||!Te.needsHillshadePrepare)continue;const Ee=Se.dim,We=Se.stride,Qe=Se.getPixels();if(te.activeTexture.set(de.TEXTURE1),te.pixelStoreUnpackPremultiplyAlpha.set(!1),Te.demTexture=Te.demTexture||X.getTileTexture(We),Te.demTexture){const lt=Te.demTexture;lt.update(Qe,{premultiply:!1}),lt.bind(de.NEAREST,de.CLAMP_TO_EDGE)}else Te.demTexture=new d.T(te,Qe,de.RGBA,{premultiply:!1}),Te.demTexture.bind(de.NEAREST,de.CLAMP_TO_EDGE);te.activeTexture.set(de.TEXTURE0);let Ve=Te.fbo;if(!Ve){const lt=new d.T(te,{width:Ee,height:Ee,data:null},de.RGBA);lt.bind(de.LINEAR,de.CLAMP_TO_EDGE),Ve=Te.fbo=te.createFramebuffer(Ee,Ee,!0,!1),Ve.colorAttachment.set(lt.texture)}te.bindFramebuffer.set(Ve.framebuffer),te.viewport.set([0,0,Ee,Ee]),X.useProgram("hillshadePrepare").draw(te,de.TRIANGLES,J,se,ue,bt.disabled,Ih(Te.tileID,Se),null,null,ee.id,X.rasterBoundsBuffer,X.quadTriangleIndexBuffer,X.rasterBoundsSegments),Te.needsHillshadePrepare=!1}})(y,w,E,T,N,Yt.disabled,$),P.viewport.set([0,0,y.width,y.height]);else if(y.renderPass==="translucent")if(B){const[X,Y,Q]=y.stencilConfigForOverlapTwoPass(E);$r(y,w,T,Q,X,N,$,!1,D),$r(y,w,T,Q,Y,N,$,!0,D)}else{const[X,Y]=y.getStencilConfigForOverlapAndUpdateStencilID(E);$r(y,w,T,Y,X,N,$,!1,D)}})(e,r,l,h,g):d.ci(l)?(function(y,w,T,E,A){if(y.renderPass!=="translucent"||!E.length)return;const{isRenderingToTexture:D}=A,P=y.style.projection.useSubdivision,B=y.getDepthModeForSublayer(0,zt.ReadOnly),N=y.colorModeForRenderPass();if(P){const[$,X,Y]=y.stencilConfigForOverlapTwoPass(E);_a(y,w,T,Y,$,B,N,!1,D),_a(y,w,T,Y,X,B,N,!0,D)}else{const[$,X]=y.getStencilConfigForOverlapAndUpdateStencilID(E);_a(y,w,T,X,$,B,N,!1,D)}})(e,r,l,h,g):d.cj(l)?(function(y,w,T,E,A){if(y.renderPass!=="translucent"||T.paint.get("raster-opacity")===0||!E.length)return;const{isRenderingToTexture:D}=A,P=w.getSource(),B=y.style.projection.useSubdivision;if(P instanceof ar)Ka(y,w,T,E,null,!1,!1,P.tileCoords,P.flippedWindingOrder,D);else if(B){const[N,$,X]=y.stencilConfigForOverlapTwoPass(E);Ka(y,w,T,X,N,!1,!0,or,!1,D),Ka(y,w,T,X,$,!0,!0,or,!1,D)}else{const[N,$]=y.getStencilConfigForOverlapAndUpdateStencilID(E);Ka(y,w,T,$,N,!1,!0,or,!1,D)}})(e,r,l,h,g):d.ck(l)?(function(y,w,T,E,A){const D=T.paint.get("background-color"),P=T.paint.get("background-opacity");if(P===0)return;const{isRenderingToTexture:B}=A,N=y.context,$=N.gl,X=y.style.projection,Y=y.transform,Q=Y.tileSize,ee=T.paint.get("background-pattern");if(y.isPatternMissing(ee))return;const J=!ee&&D.a===1&&P===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==J)return;const se=Yt.disabled,ue=y.getDepthModeForSublayer(0,J==="opaque"?zt.ReadWrite:zt.ReadOnly),te=y.colorModeForRenderPass(),de=y.useProgram(ee?"backgroundPattern":"background"),Ce=E||_e(Y,{tileSize:Q,terrain:y.style.map.terrain});ee&&(N.activeTexture.set($.TEXTURE0),y.imageManager.bind(y.context));const Te=T.getCrossfadeParameters();for(const Se of Ce){const Ee=Y.getProjectionData({overscaledTileID:Se,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),We=ee?Bh(P,y,ee,{tileID:Se,tileSize:Q},Te):kh(P,D),Qe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Se),Ve=X.getMeshFromTileID(N,Se.canonical,!1,!0,"raster");de.draw(N,$.TRIANGLES,ue,se,te,bt.backCCW,We,Qe,Ee,T.id,Ve.vertexBuffer,Ve.indexBuffer,Ve.segments)}})(e,0,l,h,g):d.cl(l)&&(function(y,w,T,E){const{isRenderingGlobe:A}=E,D=y.context,P=T.implementation,B=y.style.projection,N=y.transform,$=N.getProjectionDataForCustomLayer(A),X={farZ:N.farZ,nearZ:N.nearZ,fov:N.fov*Math.PI/180,modelViewProjectionMatrix:N.modelViewProjectionMatrix,projectionMatrix:N.projectionMatrix,shaderData:{variantName:B.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${B.shaderPreludeCode.vertexSource}`,define:B.shaderDefine},defaultProjectionData:$},Y=P.renderingMode?P.renderingMode:"2d";if(y.renderPass==="offscreen"){const Q=P.prerender;Q&&(y.setCustomLayerDefaults(),D.setColorMode(y.colorModeForRenderPass()),Q.call(P,D.gl,X),D.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),D.setColorMode(y.colorModeForRenderPass()),D.setStencilMode(Yt.disabled);const Q=Y==="3d"?y.getDepthModeFor3D():y.getDepthModeForSublayer(0,zt.ReadOnly);D.setDepthMode(Q),P.render(D.gl,X),D.setDirty(),y.setBaseState(),D.bindFramebuffer.set(null)}})(e,0,l,g))}saveTileTexture(e){const r=this._tileTextures[e.size[0]];r?r.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const r=this._tileTextures[e];return r&&r.length>0?r.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const r=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!r||!l}useProgram(e,r,l=!1,h=[]){this.cache=this.cache||{};const g=!!this.style.map.terrain,y=this.style.projection,w=l?da.projectionMercator:y.shaderPreludeCode,T=l?xr:y.shaderDefine,E=e+(r?r.cacheKey:"")+`/${l?To:y.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(g?"/terrain":"")+(h?`/${h.join("/")}`:"");return this.cache[E]||(this.cache[E]=new Eu(this.context,da[e],r,Lu[e],this._showOverdrawInspector,g,w,T,h)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:r}=this.context.gl;return this.width!==e||this.height!==r}}function io(m,e){let r,l=!1,h=null,g=null;const y=()=>{h=null,l&&(m.apply(g,r),h=setTimeout(y,e),l=!1)};return(...w)=>(l=!0,g=this,r=w,h||y(),h)}class Qa{constructor(e){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map((h=>h.split("="))).forEach((h=>{h[0]===this._hashName&&(l=h)})),(l&&l[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(!this._isValidHash(r))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:l,pitch:+(r[4]||0)}),!0},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{const r=this._getCurrentHash();if(r.length===0)return;const l=r.join("/");let h=l;h.split("&").length>0&&(h=h.split("&")[0]),this._hashName&&(h=`${this._hashName}=${l}`);let g=window.location.hash.replace(h,"");g.startsWith("#&")?g=g.slice(0,1)+g.slice(2):g==="#"&&(g="");let y=window.location.href.replace(/(#.+)?$/,g);y=y.replace("&&","&"),window.history.replaceState(window.history.state,null,y)},this._updateHash=io(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const r=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,h),y=Math.round(r.lng*g)/g,w=Math.round(r.lat*g)/g,T=this._map.getBearing(),E=this._map.getPitch();let A="";if(A+=e?`/${y}/${w}/${l}`:`${l}/${w}/${y}`,(T||E)&&(A+="/"+Math.round(10*T)/10),E&&(A+=`/${Math.round(E)}`),this._hashName){const D=this._hashName;let P=!1;const B=window.location.hash.slice(1).split("&").map((N=>{const $=N.split("=")[0];return $===D?(P=!0,`${$}=${A}`):N})).filter((N=>N));return P||B.push(`${D}=${A}`),`#${B.join("&")}`}return`#${A}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new d.S(+e[2],+e[1])}catch{return!1}const r=+e[0],l=+(e[3]||0),h=+(e[4]||0);return r>=this._map.getMinZoom()&&r<=this._map.getMaxZoom()&&l>=-180&&l<=180&&h>=this._map.getMinPitch()&&h<=this._map.getMaxPitch()}}const vs={linearity:.3,easing:d.cm(0,0,.3,1)},xs=d.e({deceleration:2500,maxSpeed:1400},vs),cc=d.e({deceleration:20,maxSpeed:1400},vs),no=d.e({deceleration:1e3,maxSpeed:360},vs),Yr=d.e({deceleration:1e3,maxSpeed:90},vs),bs=d.e({deceleration:1e3,maxSpeed:360},vs);class Kr{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Ke.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,r=Ke.now();for(;e.length>0&&r-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,roll:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)r.zoom+=g.zoomDelta||0,r.bearing+=g.bearingDelta||0,r.pitch+=g.pitchDelta||0,r.roll+=g.rollDelta||0,g.panDelta&&r.pan._add(g.panDelta),g.around&&(r.around=g.around),g.pinchAround&&(r.pinchAround=g.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(r.pan.mag()){const g=Wa(r.pan.mag(),l,d.e({},xs,e||{})),y=r.pan.mult(g.amount/r.pan.mag()),w=this._map.cameraHelper.handlePanInertia(y,this._map.transform);h.center=w.easingCenter,h.offset=w.easingOffset,ao(h,g)}if(r.zoom){const g=Wa(r.zoom,l,cc);h.zoom=this._map.transform.zoom+g.amount,ao(h,g)}if(r.bearing){const g=Wa(r.bearing,l,no);h.bearing=this._map.transform.bearing+d.ah(g.amount,-179,179),ao(h,g)}if(r.pitch){const g=Wa(r.pitch,l,Yr);h.pitch=this._map.transform.pitch+g.amount,ao(h,g)}if(r.roll){const g=Wa(r.roll,l,bs);h.roll=this._map.transform.roll+d.ah(g.amount,-179,179),ao(h,g)}if(h.zoom||h.bearing){const g=r.pinchAround===void 0?r.around:r.pinchAround;h.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),d.e(h,{noMoveStart:!0})}}function ao(m,e){(!m.duration||m.duration<e.duration)&&(m.duration=e.duration,m.easing=e.easing)}function Wa(m,e,r){const{maxSpeed:l,linearity:h,deceleration:g}=r,y=d.ah(m*h/(e/1e3),-l,l),w=Math.abs(y)/(g*h);return{easing:r.easing,duration:1e3*w,amount:y*(w/2)}}class Gn extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,l,h={}){l=l instanceof MouseEvent?l:new MouseEvent(e,l);const g=be.mousePos(r.getCanvas(),l),y=r.unproject(g);super(e,d.e({point:g,lngLat:y,originalEvent:l},h)),this._defaultPrevented=!1,this.target=r}}class ws extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,l){const h=e==="touchend"?l.changedTouches:l.touches,g=be.touchPos(r.getCanvasContainer(),h),y=g.map((T=>r.unproject(T))),w=g.reduce(((T,E,A,D)=>T.add(E.div(D.length))),new d.P(0,0));super(e,{points:g,point:w,lngLats:y,lngLat:r.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class Ts extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class ta{constructor(e,r){this._map=e,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Ts(e.type,this._map,e))}mousedown(e,r){return this._mousedownPos=r,this._firePreventable(new Gn(e.type,this._map,e))}mouseup(e){this._map.fire(new Gn(e.type,this._map,e))}click(e,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new Gn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Gn(e.type,this._map,e))}mouseover(e){this._map.fire(new Gn(e.type,this._map,e))}mouseout(e){this._map.fire(new Gn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new ws(e.type,this._map,e))}touchmove(e){this._map.fire(new ws(e.type,this._map,e))}touchend(e){this._map.fire(new ws(e.type,this._map,e))}touchcancel(e){this._map.fire(new ws(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class uc{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Gn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Gn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Lo{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(d.P.convert(e),this._map.terrain)}}class Nu{constructor(e,r){this._map=e,this._tr=new Lo(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,r){this.isEnabled()&&e.shiftKey&&e.button===0&&(be.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(e,r){if(!this._active)return;const l=r;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=l,this._box||(this._box=be.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const g=Math.min(h.x,l.x),y=Math.max(h.x,l.x),w=Math.min(h.y,l.y),T=Math.max(h.y,l.y);be.setTransform(this._box,`translate(${g}px,${w}px)`),this._box.style.width=y-g+"px",this._box.style.height=T-w+"px"}mouseupWindow(e,r){if(!this._active||e.button!==0)return;const l=this._startPos,h=r;if(this.reset(),be.suppressClick(),l.x!==h.x||l.y!==h.y)return this._map.fire(new d.l("boxzoomend",{originalEvent:e})),{cameraAnimation:g=>g.fitScreenCoordinates(l,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(be.remove(this._box),this._box=null),be.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,r){return this._map.fire(new d.l(e,{originalEvent:r}))}}function Nc(m,e){if(m.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${e.length}`);const r={};for(let l=0;l<m.length;l++)r[m[l].identifier]=e[l];return r}class Vc{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,r,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=(function(h){const g=new d.P(0,0);for(const y of h)g._add(y);return g.div(h.length)})(r),this.touches=Nc(l,r)))}touchmove(e,r,l){if(this.aborted||!this.centroid)return;const h=Nc(l,r);for(const g in this.touches){const y=h[g];(!y||y.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(e,r,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class cn{constructor(e){this.singleTap=new Vc(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,r,l){this.singleTap.touchstart(e,r,l)}touchmove(e,r,l){this.singleTap.touchmove(e,r,l)}touchend(e,r,l){const h=this.singleTap.touchend(e,r,l);if(h){const g=e.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(h)<30;if(g&&y||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class Fa{constructor(e){this._tr=new Lo(e),this._zoomIn=new cn({numTouches:1,numTaps:2}),this._zoomOut=new cn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,r,l){this._zoomIn.touchstart(e,r,l),this._zoomOut.touchstart(e,r,l)}touchmove(e,r,l){this._zoomIn.touchmove(e,r,l),this._zoomOut.touchmove(e,r,l)}touchend(e,r,l){const h=this._zoomIn.touchend(e,r,l),g=this._zoomOut.touchend(e,r,l),y=this._tr;return h?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:y.zoom+1,around:y.unproject(h)},{originalEvent:e})}):g?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:y.zoom-1,around:y.unproject(g)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qn{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const r=this._moveFunction(...e);if(r.bearingDelta||r.pitchDelta||r.rollDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(e,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(r)?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,r){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const h=Array.isArray(r)?r[0]:r;return!this._moved&&h.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(l,h))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&be.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ml=0,Ja=2,Tr={[ml]:1,[Ja]:2};class Qr{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const r=be.mouseButton(e);this._eventButton=r}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(r,l){const h=Tr[l];return r.buttons===void 0||(r.buttons&h)!==h})(e,this._eventButton)}isValidEndEvent(e){return be.mouseButton(e)===this._eventButton}}class kd{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class jh{constructor(e=new Qr({checkCorrectEvent:()=>!0}),r=new kd){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=r}_executeRelevantHandler(e,r,l){return e instanceof MouseEvent?r(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?l(e):void 0}startMove(e){this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.startMove(r)),(r=>this.oneFingerTouchMoveStateManager.startMove(r)))}endMove(e){this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.endMove(r)),(r=>this.oneFingerTouchMoveStateManager.endMove(r)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.isValidStartEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidStartEvent(r)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.isValidMoveEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(r)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.isValidEndEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidEndEvent(r)))}}const Zc=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=e=>{e.preventDefault()}};class Vu{constructor(e,r){this._clickTolerance=e.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,r,l){return this._calculateTransform(e,r,l)}touchmove(e,r,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,r,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,r,l){this._calculateTransform(e,r,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,r,l){l.length>0&&(this._active=!0);const h=Nc(l,r),g=new d.P(0,0),y=new d.P(0,0);let w=0;for(const E in h){const A=h[E],D=this._touches[E];D&&(g._add(A),y._add(A.sub(D)),w++,h[E]=A)}if(this._touches=h,this._shouldBePrevented(w)||!y.mag())return;const T=y.div(w);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(w),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class er{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,r,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([r[0],r[1]]))}touchmove(e,r,l){if(!this._firstTwoTouches)return;e.preventDefault();const[h,g]=this._firstTwoTouches,y=Ua(l,r,h),w=Ua(l,r,g);if(!y||!w)return;const T=this._aroundCenter?null:y.add(w).div(2);return this._move([y,w],T,e)}touchend(e,r,l){if(!this._firstTwoTouches)return;const[h,g]=this._firstTwoTouches,y=Ua(l,r,h),w=Ua(l,r,g);y&&w||(this._active&&be.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ua(m,e,r){for(let l=0;l<m.length;l++)if(m[l].identifier===r)return e[l]}function st(m,e){return Math.log(m/e)/Math.LN2}class Gc extends er{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,r){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(st(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:st(this._distance,l),pinchAround:r}}}function Ss(m,e){return 180*m.angleWith(e)/Math.PI}class hc extends er{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,r,l){const h=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ss(this._vector,h),pinchAround:r}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const r=25/(Math.PI*this._minDiameter)*360,l=Ss(e,this._startVector);return Math.abs(l)<r}}function Wr(m){return Math.abs(m.y)>Math.abs(m.x)}class Ms extends er{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,r,l){super.touchstart(e,r,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,Wr(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,r,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const h=e[0].sub(this._lastPoints[0]),g=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,g,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(h.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(e,r,l){if(this._valid!==void 0)return this._valid;const h=e.mag()>=2,g=r.mag()>=2;if(!h&&!g)return;if(!h||!g)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const y=e.y>0==r.y>0;return Wr(e)&&Wr(r)&&y}}const qc={panStep:100,bearingStep:15,pitchStep:10};class $t{constructor(e){this._tr=new Lo(e);const r=qc;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let r=0,l=0,h=0,g=0,y=0;switch(e.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),g=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),g=1);break;case 38:e.shiftKey?h=1:(e.preventDefault(),y=-1);break;case 40:e.shiftKey?h=-1:(e.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(l=0,h=0),{cameraAnimation:w=>{const T=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:Cs,zoom:r?Math.round(T.zoom)+r*(e.shiftKey?2:1):T.zoom,bearing:T.bearing+l*this._bearingStep,pitch:T.pitch+h*this._pitchStep,offset:[-g*this._panStep,-y*this._panStep],center:T.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Cs(m){return m*(2-m)}const ro=4.000244140625,Hc=1/450;class Zu{constructor(e,r){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new Lo(e),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Hc}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let r=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=Ke.now(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,r!==0&&r%ro==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(h*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=be.mousePos(this._map.getCanvas(),e),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(d.S.convert(l.center)):r,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const w=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=w),typeof this._targetZoom=="number"&&(this._targetZoom+=w)}if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>ro?this._wheelZoomRate:this._defaultZoomRate;let T=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&T!==0&&(T=1/T);const E=typeof this._targetZoom!="number"?e.scale:d.af(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),d.ak(E*T)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,l=this._startZoom,h=this._easing;let g,y=!1;if(this._type==="wheel"&&l&&h){const w=Ke.now()-this._lastWheelEventTime,T=Math.min((w+5)/200,1),E=h(T);g=d.C.number(l,r,E),T<1?this._frameId||(this._frameId=!0):y=!0}else g=r,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=g,{noInertia:!0,needsRenderFrame:!y,zoomDelta:g-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let r=d.co;if(this._prevEase){const l=this._prevEase,h=(Ke.now()-l.start)/l.duration,g=l.easing(h+.01)-l.easing(h),y=.27/Math.sqrt(g*g+1e-4)*.01,w=Math.sqrt(.0729-y*y);r=d.cm(y,w,.25,1)}return this._prevEase={start:Ke.now(),duration:e,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ko{constructor(e,r){this._clickZoom=e,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class gl{constructor(e){this._tr=new Lo(e),this.reset()}reset(){this._active=!1}dblclick(e,r){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _l{constructor(){this._tap=new cn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,r,l){if(!this._swipePoint)if(this._tapTime){const h=r[0],g=e.timeStamp-this._tapTime<500,y=this._tapPoint.dist(h)<30;g&&y?l.length>0&&(this._swipePoint=h,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,r,l)}touchmove(e,r,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const h=r[0],g=h.y-this._swipePoint.y;return this._swipePoint=h,e.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(e,r,l)}touchend(e,r,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const h=this._tap.touchend(e,r,l);h&&(this._tapTime=e.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bo{constructor(e,r,l){this._el=e,this._mousePan=r,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class dc{constructor(e,r,l,h){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=r,this._mousePitch=l,this._mouseRoll=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class $c{constructor(e,r,l,h){this._el=e,this._touchZoom=r,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class so{constructor(e,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=be.create("div","maplibregl-cooperative-gesture-screen",e);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),h=document.createElement("div");h.className="maplibregl-desktop-message",h.textContent=r,this._container.appendChild(h);const g=document.createElement("div");g.className="maplibregl-mobile-message",g.textContent=l,this._container.appendChild(g),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(be.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,r){this._enabled&&(this._map.fire(new d.l("cooperativegestureprevented",{gestureType:e,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const fc=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class Ma extends d.l{}function ui(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class Gu{constructor(e,r){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,g)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const y=h.type==="renderFrame"?void 0:h,w={needsRenderFrame:!1},T={},E={};for(const{handlerName:P,handler:B,allowed:N}of this._handlers){if(!B.isEnabled())continue;let $;if(this._blockedByActive(E,N,P))B.reset();else if(B[g||h.type]){if(d.cp(h,g||h.type)){const X=be.mousePos(this._map.getCanvas(),h);$=B[g||h.type](h,X)}else if(d.cq(h,g||h.type)){const X=this._getMapTouches(h.touches),Y=be.touchPos(this._map.getCanvas(),X);$=B[g||h.type](h,Y,X)}else d.cr(g||h.type)||($=B[g||h.type](h));this.mergeHandlerResult(w,T,$,P,y),$&&$.needsRenderFrame&&this._triggerRenderFrame()}($||B.isActive())&&(E[P]=B)}const A={};for(const P in this._previousActiveHandlers)E[P]||(A[P]=y);this._previousActiveHandlers=E,(Object.keys(A).length||ui(w))&&(this._changes.push([w,T,A]),this._triggerRenderFrame()),(Object.keys(E).length||ui(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:D}=w;D&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],D(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Kr(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,g,y]of this._listeners)be.addEventListener(h,g,h===document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[e,r,l]of this._listeners)be.removeEventListener(e,r,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const r=this._map,l=r.getCanvasContainer();this._add("mapEvent",new ta(r,e));const h=r.boxZoom=new Nu(r,e);this._add("boxZoom",h),e.interactive&&e.boxZoom&&h.enable();const g=r.cooperativeGestures=new so(r,e.cooperativeGestures);this._add("cooperativeGestures",g),e.cooperativeGestures&&g.enable();const y=new Fa(r),w=new gl(r);r.doubleClickZoom=new ko(w,y),this._add("tapZoom",y),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&r.doubleClickZoom.enable();const T=new _l;this._add("tapDragZoom",T);const E=r.touchPitch=new Ms(r);this._add("touchPitch",E),e.interactive&&e.touchPitch&&r.touchPitch.enable(e.touchPitch);const A=()=>r.project(r.getCenter()),D=(function({enable:J,clickTolerance:se,aroundCenter:ue=!0,minPixelCenterThreshold:te=100,rotateDegreesPerPixelMoved:de=.8},Ce){const Te=new Qr({checkCorrectEvent:Se=>be.mouseButton(Se)===0&&Se.ctrlKey||be.mouseButton(Se)===2&&!Se.ctrlKey});return new qn({clickTolerance:se,move:(Se,Ee)=>{const We=Ce();if(ue&&Math.abs(We.y-Se.y)>te)return{bearingDelta:d.cn(new d.P(Se.x,Ee.y),Ee,We)};let Qe=(Ee.x-Se.x)*de;return ue&&Ee.y<We.y&&(Qe=-Qe),{bearingDelta:Qe}},moveStateManager:Te,enable:J,assignEvents:Zc})})(e,A),P=(function({enable:J,clickTolerance:se,pitchDegreesPerPixelMoved:ue=-.5}){const te=new Qr({checkCorrectEvent:de=>be.mouseButton(de)===0&&de.ctrlKey||be.mouseButton(de)===2});return new qn({clickTolerance:se,move:(de,Ce)=>({pitchDelta:(Ce.y-de.y)*ue}),moveStateManager:te,enable:J,assignEvents:Zc})})(e),B=(function({enable:J,clickTolerance:se,rollDegreesPerPixelMoved:ue=.3},te){const de=new Qr({checkCorrectEvent:Ce=>be.mouseButton(Ce)===2&&Ce.ctrlKey});return new qn({clickTolerance:se,move:(Ce,Te)=>{const Se=te();let Ee=(Te.x-Ce.x)*ue;return Te.y<Se.y&&(Ee=-Ee),{rollDelta:Ee}},moveStateManager:de,enable:J,assignEvents:Zc})})(e,A);r.dragRotate=new dc(e,D,P,B),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",P,["mouseRotate","mouseRoll"]),this._add("mouseRoll",B,["mousePitch"]),e.interactive&&e.dragRotate&&r.dragRotate.enable();const N=(function({enable:J,clickTolerance:se}){const ue=new Qr({checkCorrectEvent:te=>be.mouseButton(te)===0&&!te.ctrlKey});return new qn({clickTolerance:se,move:(te,de)=>({around:de,panDelta:de.sub(te)}),activateOnStart:!0,moveStateManager:ue,enable:J,assignEvents:Zc})})(e),$=new Vu(e,r);r.dragPan=new Bo(l,N,$),this._add("mousePan",N),this._add("touchPan",$,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&r.dragPan.enable(e.dragPan);const X=new hc,Y=new Gc;r.touchZoomRotate=new $c(l,Y,X,T),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&r.touchZoomRotate.enable(e.touchZoomRotate);const Q=r.scrollZoom=new Zu(r,(()=>this._triggerRenderFrame()));this._add("scrollZoom",Q,["mousePan"]),e.interactive&&e.scrollZoom&&r.scrollZoom.enable(e.scrollZoom);const ee=r.keyboard=new $t(r);this._add("keyboard",ee),e.interactive&&e.keyboard&&r.keyboard.enable(),this._add("blockableMapEvent",new uc(r))}_add(e,r,l){this._handlers.push({handlerName:e,handler:r,allowed:l}),this._handlersById[e]=r}stop(e){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!fc(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,r,l){for(const h in e)if(h!==l&&(!r||r.indexOf(h)<0))return!0;return!1}_getMapTouches(e){const r=[];for(const l of e)this._el.contains(l.target)&&r.push(l);return r}mergeHandlerResult(e,r,l,h,g){if(!l)return;d.e(e,l);const y={handlerName:h,originalEvent:l.originalEvent||g};l.zoomDelta!==void 0&&(r.zoom=y),l.panDelta!==void 0&&(r.drag=y),l.rollDelta!==void 0&&(r.roll=y),l.pitchDelta!==void 0&&(r.pitch=y),l.bearingDelta!==void 0&&(r.rotate=y)}_applyChanges(){const e={},r={},l={};for(const[h,g,y]of this._changes)h.panDelta&&(e.panDelta=(e.panDelta||new d.P(0,0))._add(h.panDelta)),h.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+h.pitchDelta),h.rollDelta&&(e.rollDelta=(e.rollDelta||0)+h.rollDelta),h.around!==void 0&&(e.around=h.around),h.pinchAround!==void 0&&(e.pinchAround=h.pinchAround),h.noInertia&&(e.noInertia=h.noInertia),d.e(r,g),d.e(l,y);this._updateMapTransform(e,r,l),this._changes=[]}_updateMapTransform(e,r,l){const h=this._map,g=h._getTransformForUpdate(),y=h.terrain;if(!(ui(e)||y&&this._terrainMovement))return this._fireEvents(r,l,!0);h._stop(!0);let{panDelta:w,zoomDelta:T,bearingDelta:E,pitchDelta:A,rollDelta:D,around:P,pinchAround:B}=e;B!==void 0&&(P=B),P=P||h.transform.centerPoint,y&&!g.isPointOnMapSurface(P)&&(P=g.centerPoint);const N={panDelta:w,zoomDelta:T,rollDelta:D,pitchDelta:A,bearingDelta:E,around:P};this._map.cameraHelper.useGlobeControls&&!g.isPointOnMapSurface(P)&&(P=g.centerPoint);const $=P.distSqr(g.centerPoint)<.01?g.center:g.screenPointToLocation(w?P.sub(w):P);this._handleMapControls({terrain:y,tr:g,deltasForHelper:N,preZoomAroundLoc:$,combinedEventsInProgress:r,panDelta:w}),h._applyUpdatedTransform(g),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(r,l,!0)}_handleMapControls({terrain:e,tr:r,deltasForHelper:l,preZoomAroundLoc:h,combinedEventsInProgress:g,panDelta:y}){const w=this._map.cameraHelper;if(w.handleMapControlsRollPitchBearingZoom(l,r),e)return w.useGlobeControls?(this._terrainMovement||!g.drag&&!g.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void w.handleMapControlsPan(l,r,h)):this._terrainMovement||!g.drag&&!g.zoom?void(g.drag&&this._terrainMovement&&y?r.setCenter(r.screenPointToLocation(r.centerPoint.sub(y))):w.handleMapControlsPan(l,r,h)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void w.handleMapControlsPan(l,r,h));w.handleMapControlsPan(l,r,h)}_fireEvents(e,r,l){const h=fc(this._eventsInProgress),g=fc(e),y={};for(const D in e){const{originalEvent:P}=e[D];this._eventsInProgress[D]||(y[`${D}start`]=P),this._eventsInProgress[D]=e[D]}!h&&g&&this._fireEvent("movestart",g.originalEvent);for(const D in y)this._fireEvent(D,y[D]);g&&this._fireEvent("move",g.originalEvent);for(const D in e){const{originalEvent:P}=e[D];this._fireEvent(D,P)}const w={};let T;for(const D in this._eventsInProgress){const{handlerName:P,originalEvent:B}=this._eventsInProgress[D];this._handlersById[P].isActive()||(delete this._eventsInProgress[D],T=r[P]||B,w[`${D}end`]=T)}for(const D in w)this._fireEvent(D,w[D]);const E=fc(this._eventsInProgress),A=(h||g)&&!E;if(A&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const D=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&D.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(D)}if(l&&A){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;!D||!D.essential&&Ke.prefersReducedMotion?(this._map.fire(new d.l("moveend",{originalEvent:T})),P(this._map.getBearing())&&this._map.resetNorth()):(P(D.bearing||this._map.getBearing())&&(D.bearing=0),D.freezeElevation=!0,this._map.easeTo(D,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(e,r){this._map.fire(new d.l(e,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new Ma("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Sr extends d.E{constructor(e,r,l){super(),this._renderFrameCallback=()=>{const h=Math.min((Ke.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=l.bearingSnap,this.cameraHelper=r,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,r){e.apply(this.transform),this.transform=e,this.cameraHelper=r}getCenter(){return new d.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,r){return this.jumpTo({center:e},r)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,r){return this.jumpTo({elevation:e},r),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,r,l){return e=d.P.convert(e).mult(-1),this.panTo(this.transform.center,d.e({offset:e},r),l)}panTo(e,r,l){return this.easeTo(d.e({center:e},r),l)}getZoom(){return this.transform.zoom}setZoom(e,r){return this.jumpTo({zoom:e},r),this}zoomTo(e,r,l){return this.easeTo(d.e({zoom:e},r),l)}zoomIn(e,r){return this.zoomTo(this.getZoom()+1,e,r),this}zoomOut(e,r){return this.zoomTo(this.getZoom()-1,e,r),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,r){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new d.l("movestart",r)).fire(new d.l("move",r)).fire(new d.l("moveend",r))),this}getBearing(){return this.transform.bearing}setBearing(e,r){return this.jumpTo({bearing:e},r),this}getPadding(){return this.transform.padding}setPadding(e,r){return this.jumpTo({padding:e},r),this}rotateTo(e,r,l){return this.easeTo(d.e({bearing:e},r),l)}resetNorth(e,r){return this.rotateTo(0,d.e({duration:1e3},e),r),this}resetNorthPitch(e,r){return this.easeTo(d.e({bearing:0,pitch:0,roll:0,duration:1e3},e),r),this}snapToNorth(e,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,r):this}getPitch(){return this.transform.pitch}setPitch(e,r){return this.jumpTo({pitch:e},r),this}getRoll(){return this.transform.roll}setRoll(e,r){return this.jumpTo({roll:e},r),this}cameraForBounds(e,r){e=Ni.convert(e).adjustAntiMeridian();const l=r&&r.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,r)}_cameraForBoxAndBearing(e,r,l,h){const g={top:0,bottom:0,right:0,left:0};if(typeof(h=d.e({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const E=h.padding;h.padding={top:E,bottom:E,right:E,left:E}}const y=d.e(g,h.padding);h.padding=y;const w=this.transform,T=new Ni(e,r);return this.cameraHelper.cameraForBoxAndBearing(h,y,T,l,w)}fitBounds(e,r,l){return this._fitInternal(this.cameraForBounds(e,r),r,l)}fitScreenCoordinates(e,r,l,h,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(d.P.convert(e)),this.transform.screenPointToLocation(d.P.convert(r)),l,h),h,g)}_fitInternal(e,r,l){return e?(delete(r=d.e(e,r)).padding,r.linear?this.easeTo(r,l):this.flyTo(r,l)):this}jumpTo(e,r){this.stop();const l=this._getTransformForUpdate();let h=!1,g=!1,y=!1;const w=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,e);const T=l.zoom!==w;return"elevation"in e&&l.elevation!==+e.elevation&&l.setElevation(+e.elevation),"bearing"in e&&l.bearing!==+e.bearing&&(h=!0,l.setBearing(+e.bearing)),"pitch"in e&&l.pitch!==+e.pitch&&(g=!0,l.setPitch(+e.pitch)),"roll"in e&&l.roll!==+e.roll&&(y=!0,l.setRoll(+e.roll)),e.padding==null||l.isPaddingEqual(e.padding)||l.setPadding(e.padding),this._applyUpdatedTransform(l),this.fire(new d.l("movestart",r)).fire(new d.l("move",r)),T&&this.fire(new d.l("zoomstart",r)).fire(new d.l("zoom",r)).fire(new d.l("zoomend",r)),h&&this.fire(new d.l("rotatestart",r)).fire(new d.l("rotate",r)).fire(new d.l("rotateend",r)),g&&this.fire(new d.l("pitchstart",r)).fire(new d.l("pitch",r)).fire(new d.l("pitchend",r)),y&&this.fire(new d.l("rollstart",r)).fire(new d.l("roll",r)).fire(new d.l("rollend",r)),this.fire(new d.l("moveend",r))}calculateCameraOptionsFromTo(e,r,l,h=0){const g=d.a1.fromLngLat(e,r),y=d.a1.fromLngLat(l,h),w=y.x-g.x,T=y.y-g.y,E=y.z-g.z,A=Math.hypot(w,T,E);if(A===0)throw new Error("Can't calculate camera options with same From and To");const D=Math.hypot(w,T),P=d.ak(this.transform.cameraToCenterDistance/A/this.transform.tileSize),B=180*Math.atan2(w,-T)/Math.PI;let N=180*Math.acos(D/A)/Math.PI;return N=E<0?90-N:90+N,{center:y.toLngLat(),elevation:h,zoom:P,pitch:N,bearing:B}}calculateCameraOptionsFromCameraLngLatAltRotation(e,r,l,h,g){const y=this.transform.calculateCenterFromCameraLngLatAlt(e,r,l,h);return{center:y.center,elevation:y.elevation,zoom:y.zoom,bearing:l,pitch:h,roll:g}}easeTo(e,r){this._stop(!1,e.easeId),((e=d.e({offset:[0,0],duration:500,easing:d.co},e)).animate===!1||!e.essential&&Ke.prefersReducedMotion)&&(e.duration=0);const l=this._getTransformForUpdate(),h=this.getBearing(),g=l.pitch,y=l.roll,w="bearing"in e?this._normalizeBearing(e.bearing,h):h,T="pitch"in e?+e.pitch:g,E="roll"in e?this._normalizeBearing(e.roll,y):y,A="padding"in e?e.padding:l.padding,D=d.P.convert(e.offset);let P,B;e.around&&(P=d.S.convert(e.around),B=l.locationToScreenPoint(P));const N={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},$=this.cameraHelper.handleEaseTo(l,{bearing:w,pitch:T,roll:E,padding:A,around:P,aroundPoint:B,offsetAsPoint:D,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||h!==w,this._pitching=this._pitching||T!==g,this._rolling=this._rolling||E!==y,this._padding=!l.isPaddingEqual(A),this._zooming=this._zooming||$.isZooming,this._easeId=e.easeId,this._prepareEase(r,e.noMoveStart,N),this.terrain&&this._prepareElevation($.elevationCenter),this._ease((X=>{$.easeFunc(X),this.terrain&&!e.freezeElevation&&this._updateElevation(X),this._applyUpdatedTransform(l),this._fireMoveEvents(r)}),(X=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r,X)}),e),this}_prepareEase(e,r,l={}){this._moving=!0,r||l.moving||this.fire(new d.l("movestart",e)),this._zooming&&!l.zooming&&this.fire(new d.l("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new d.l("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new d.l("pitchstart",e)),this._rolling&&!l.rolling&&this.fire(new d.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&r!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(r-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=r}this.transform.setElevation(d.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const r=e.getCameraLngLat(),l=e.getCameraAltitude(),h=this.terrain?this.terrain.getElevationForLngLatZoom(r,e.zoom):0;if(l<h){const g=this.calculateCameraOptionsFromTo(r,h,e.center,e.elevation);return{pitch:g.pitch,zoom:g.zoom}}return{}}_applyUpdatedTransform(e){const r=[];if(r.push((h=>this._elevateCameraIfInsideTerrain(h))),this.transformCameraUpdate&&r.push((h=>this.transformCameraUpdate(h))),!r.length)return;const l=e.clone();for(const h of r){const g=l.clone(),{center:y,zoom:w,roll:T,pitch:E,bearing:A,elevation:D}=h(g);y&&g.setCenter(y),D!==void 0&&g.setElevation(D),w!==void 0&&g.setZoom(w),T!==void 0&&g.setRoll(T),E!==void 0&&g.setPitch(E),A!==void 0&&g.setBearing(A),l.apply(g)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new d.l("move",e)),this._zooming&&this.fire(new d.l("zoom",e)),this._rotating&&this.fire(new d.l("rotate",e)),this._pitching&&this.fire(new d.l("pitch",e)),this._rolling&&this.fire(new d.l("roll",e))}_afterEase(e,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const l=this._zooming,h=this._rotating,g=this._pitching,y=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new d.l("zoomend",e)),h&&this.fire(new d.l("rotateend",e)),g&&this.fire(new d.l("pitchend",e)),y&&this.fire(new d.l("rollend",e)),this.fire(new d.l("moveend",e))}flyTo(e,r){if(!e.essential&&Ke.prefersReducedMotion){const Ee=d.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Ee,r)}this.stop(),e=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.co},e);const l=this._getTransformForUpdate(),h=l.bearing,g=l.pitch,y=l.roll,w=l.padding,T="bearing"in e?this._normalizeBearing(e.bearing,h):h,E="pitch"in e?+e.pitch:g,A="roll"in e?this._normalizeBearing(e.roll,y):y,D="padding"in e?e.padding:l.padding,P=d.P.convert(e.offset);let B=l.centerPoint.add(P);const N=l.screenPointToLocation(B),$=this.cameraHelper.handleFlyTo(l,{bearing:T,pitch:E,roll:A,padding:D,locationAtOffset:N,offsetAsPoint:P,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let X=e.curve;const Y=Math.max(l.width,l.height),Q=Y/$.scaleOfZoom,ee=$.pixelPathLength;typeof $.scaleOfMinZoom=="number"&&(X=Math.sqrt(Y/$.scaleOfMinZoom/ee*2));const J=X*X;function se(Ee){const We=(Q*Q-Y*Y+(Ee?-1:1)*J*J*ee*ee)/(2*(Ee?Q:Y)*J*ee);return Math.log(Math.sqrt(We*We+1)-We)}function ue(Ee){return(Math.exp(Ee)-Math.exp(-Ee))/2}function te(Ee){return(Math.exp(Ee)+Math.exp(-Ee))/2}const de=se(!1);let Ce=function(Ee){return te(de)/te(de+X*Ee)},Te=function(Ee){return Y*((te(de)*(ue(We=de+X*Ee)/te(We))-ue(de))/J)/ee;var We},Se=(se(!0)-de)/X;if(Math.abs(ee)<2e-6||!isFinite(Se)){if(Math.abs(Y-Q)<1e-6)return this.easeTo(e,r);const Ee=Q<Y?-1:1;Se=Math.abs(Math.log(Q/Y))/X,Te=()=>0,Ce=We=>Math.exp(Ee*X*We)}return e.duration="duration"in e?+e.duration:1e3*Se/("screenSpeed"in e?+e.screenSpeed/X:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=h!==T,this._pitching=E!==g,this._rolling=A!==y,this._padding=!l.isPaddingEqual(D),this._prepareEase(r,!1),this.terrain&&this._prepareElevation($.targetCenter),this._ease((Ee=>{const We=Ee*Se,Qe=1/Ce(We),Ve=Te(We);this._rotating&&l.setBearing(d.C.number(h,T,Ee)),this._pitching&&l.setPitch(d.C.number(g,E,Ee)),this._rolling&&l.setRoll(d.C.number(y,A,Ee)),this._padding&&(l.interpolatePadding(w,D,Ee),B=l.centerPoint.add(P)),$.easeFunc(Ee,Qe,Ve,B),this.terrain&&!e.freezeElevation&&this._updateElevation(Ee),this._applyUpdatedTransform(l),this._fireMoveEvents(r)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,r){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,r)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,r,l){l.animate===!1||l.duration===0?(e(1),r()):(this._easeStart=Ke.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,r){e=d.aO(e,-180,180);const l=Math.abs(e-r);return Math.abs(e-360-r)<l&&(e-=360),Math.abs(e+360-r)<l&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(d.S.convert(e),this.transform.tileZoom):null}}const Mr={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Oo{constructor(e=Mr){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=be.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=be.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=be.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){be.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,r){const l=this._map._getUIString(`AttributionControl.${r}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((h=>typeof h!="string"?"":h))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const r=this._map.style.sourceCaches;for(const h in r){const g=r[h];if(g.used||g.usedForTerrain){const y=g.getSource();y.attribution&&e.indexOf(y.attribution)<0&&e.push(y.attribution)}}e=e.filter((h=>String(h).trim())),e.sort(((h,g)=>h.length-g.length)),e=e.filter(((h,g)=>{for(let y=g+1;y<e.length;y++)if(e[y].indexOf(h)>=0)return!1;return!0}));const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=be.sanitize(l),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class pc{constructor(e={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=be.create("div","maplibregl-ctrl");const r=be.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){be.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Xc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const r=++this._id;return this._queue.push({callback:e,id:r,cancelled:!1}),r}remove(e){const r=this._currentlyRunning,l=r?this._queue.concat(r):this._queue;for(const h of l)if(h.id===e)return void(h.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const l of r)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var mc=d.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class ja extends d.E{constructor(e){super(),this._lastTilesetChange=Ke.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,r){this.sourceCache.update(e,r),this._renderableTilesKeys=[];const l={};for(const h of _e(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))l[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.terrainRttPosMatrix32f=new Float64Array(16),d.bY(h.terrainRttPosMatrix32f,0,d.$,d.$,0,0,1),this._tiles[h.key]=new us(h,this.tileSize),this._lastTilesetChange=Ke.now());for(const h in this._tiles)l[h]||delete this._tiles[h]}freeRtt(e){for(const r in this._tiles){const l=this._tiles[r];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,r){return r?this._getTerrainCoordsForTileRanges(e,r):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const r={};for(const l of this._renderableTilesKeys){const h=this._tiles[l].tileID,g=e.clone(),y=d.ba();if(h.canonical.equals(e.canonical))d.bY(y,0,d.$,d.$,0,0,1);else if(h.canonical.isChildOf(e.canonical)){const w=h.canonical.z-e.canonical.z,T=h.canonical.x-(h.canonical.x>>w<<w),E=h.canonical.y-(h.canonical.y>>w<<w),A=d.$>>w;d.bY(y,0,A,A,0,0,1),d.M(y,y,[-T*A,-E*A,0])}else{if(!e.canonical.isChildOf(h.canonical))continue;{const w=e.canonical.z-h.canonical.z,T=e.canonical.x-(e.canonical.x>>w<<w),E=e.canonical.y-(e.canonical.y>>w<<w),A=d.$>>w;d.bY(y,0,d.$,d.$,0,0,1),d.M(y,y,[T*A,E*A,0]),d.N(y,y,[1/2**w,1/2**w,0])}}g.terrainRttPosMatrix32f=new Float32Array(y),r[l]=g}return r}_getTerrainCoordsForTileRanges(e,r){const l={};for(const h of this._renderableTilesKeys){const g=this._tiles[h].tileID;if(!this._isWithinTileRanges(g,r))continue;const y=e.clone(),w=d.ba();if(g.canonical.z===e.canonical.z){const T=e.canonical.x-g.canonical.x,E=e.canonical.y-g.canonical.y;d.bY(w,0,d.$,d.$,0,0,1),d.M(w,w,[T*d.$,E*d.$,0])}else if(g.canonical.z>e.canonical.z){const T=g.canonical.z-e.canonical.z,E=g.canonical.x-(g.canonical.x>>T<<T),A=g.canonical.y-(g.canonical.y>>T<<T),D=e.canonical.x-(g.canonical.x>>T),P=e.canonical.y-(g.canonical.y>>T),B=d.$>>T;d.bY(w,0,B,B,0,0,1),d.M(w,w,[-E*B+D*d.$,-A*B+P*d.$,0])}else{const T=e.canonical.z-g.canonical.z,E=e.canonical.x-(e.canonical.x>>T<<T),A=e.canonical.y-(e.canonical.y>>T<<T),D=(e.canonical.x>>T)-g.canonical.x,P=(e.canonical.y>>T)-g.canonical.y,B=d.$<<T;d.bY(w,0,B,B,0,0,1),d.M(w,w,[E*d.$+D*B,A*d.$+P*B,0])}y.terrainRttPosMatrix32f=new Float32Array(w),l[h]=y}return l}getSourceTile(e,r){const l=this.sourceCache._source;let h=e.overscaledZ-this.deltaZoom;if(h>l.maxzoom&&(h=l.maxzoom),h<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(h).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!g||!g.dem)&&r)for(;h>=l.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(e.scaledTo(h--).key);return g}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,r){return r[e.canonical.z]&&e.canonical.x>=r[e.canonical.z].minTileX&&e.canonical.x<=r[e.canonical.z].maxTileX&&e.canonical.y>=r[e.canonical.z].minTileY&&e.canonical.y<=r[e.canonical.z].maxTileY}}class gc{constructor(e,r,l){this._meshCache={},this.painter=e,this.sourceCache=new ja(r),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,r,l,h=d.$){var g;if(!(r>=0&&r<h&&l>=0&&l<h))return 0;const y=this.getTerrainData(e),w=(g=y.tile)===null||g===void 0?void 0:g.dem;if(!w)return 0;const T=d.cs([],[r/h*d.$,l/h*d.$],y.u_terrain_matrix),E=[T[0]*w.dim,T[1]*w.dim],A=Math.floor(E[0]),D=Math.floor(E[1]),P=E[0]-A,B=E[1]-D;return w.get(A,D)*(1-P)*(1-B)+w.get(A+1,D)*P*(1-B)+w.get(A,D+1)*(1-P)*B+w.get(A+1,D+1)*P*B}getElevationForLngLatZoom(e,r){if(!d.ct(r,e.wrap()))return 0;const{tileID:l,mercatorX:h,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(e,r);return this.getElevation(l,h%d.$,g%d.$,d.$)}getElevation(e,r,l,h=d.$){return this.getDEMElevation(e,r,l,h)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const h=this.painter.context,g=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new d.T(h,g,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new d.T(h,new d.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.ag([])}const r=this.sourceCache.getSourceTile(e,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const h=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new d.T(h,r.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),r.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const l=r&&r+r.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const h=this.sourceCache.sourceCache._source.maxzoom;let g=e.canonical.z-r.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=h?g=e.canonical.z-h:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const y=e.canonical.x-(e.canonical.x>>g<<g),w=e.canonical.y-(e.canonical.y>>g<<g),T=d.cu(new Float64Array(16),[1/(d.$<<g),1/(d.$<<g),0]);d.M(T,T,[y*d.$,w*d.$,0]),this._demMatrixCache[e.key]={matrix:T,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(e){const r=this.painter,l=r.width/devicePixelRatio,h=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new d.T(r.context,{width:l,height:h,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new d.T(r.context,{width:l,height:h,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(l,h,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,l,h))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,y=0;g<this._coordsTextureSize;g++)for(let w=0;w<this._coordsTextureSize;w++,y+=4)r[y+0]=255&w,r[y+1]=255&g,r[y+2]=w>>8<<4|g>>8,r[y+3]=0;const l=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),h=new d.T(e,l,e.gl.RGBA,{premultiply:!1});return h.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const r=new Uint8Array(4),l=this.painter.context,h=l.gl,g=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),y=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(g,w-y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,r),l.bindFramebuffer.set(null);const T=r[0]+(r[2]>>4<<8),E=r[1]+((15&r[2])<<8),A=this.coordsIndex[255-r[3]],D=A&&this.sourceCache.getTileByID(A);if(!D)return null;const P=this._coordsTextureSize,B=(1<<D.tileID.canonical.z)*P;return new d.a1((D.tileID.canonical.x*P+T)/B+D.tileID.wrap,(D.tileID.canonical.y*P+E)/B,this.getElevation(D.tileID,T,E,P))}depthAtPoint(e){const r=new Uint8Array(4),l=this.painter.context,h=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),h.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,r),l.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(e){var r;const l=((r=this.painter.style.projection)===null||r===void 0?void 0:r.transitionState)>0,h=l&&e.canonical.y===0,g=l&&e.canonical.y===(1<<e.canonical.z)-1,y=`m_${h?"n":""}_${g?"s":""}`;if(this._meshCache[y])return this._meshCache[y];const w=this.painter.context,T=new d.cv,E=new d.aN,A=this.meshSize,D=d.$/A,P=A*A;for(let te=0;te<=A;te++)for(let de=0;de<=A;de++)T.emplaceBack(de*D,te*D,0);for(let te=0;te<P;te+=A+1)for(let de=0;de<A;de++)E.emplaceBack(de+te,A+de+te+1,A+de+te+2),E.emplaceBack(de+te,A+de+te+2,de+te+1);const B=T.length,N=B+(A+1),$=(A+1)*A,X=h?d.bh:0,Y=h?0:1,Q=g?d.bi:d.$,ee=g?0:1;for(let te=0;te<=A;te++)T.emplaceBack(te*D,X,Y);for(let te=0;te<=A;te++)T.emplaceBack(te*D,Q,ee);for(let te=0;te<A;te++)E.emplaceBack($+te,N+te,N+te+1),E.emplaceBack($+te,N+te+1,$+te+1),E.emplaceBack(0+te,B+te+1,B+te),E.emplaceBack(0+te,0+te+1,B+te+1);const J=T.length,se=J+2*(A+1);for(const te of[0,1])for(let de=0;de<=A;de++)for(const Ce of[0,1])T.emplaceBack(te*d.$,de*D,Ce);for(let te=0;te<2*A;te+=2)E.emplaceBack(J+te,J+te+1,J+te+3),E.emplaceBack(J+te,J+te+3,J+te+2),E.emplaceBack(se+te,se+te+3,se+te+1),E.emplaceBack(se+te,se+te+2,se+te+3);const ue=new Hs(w.createVertexBuffer(T,mc.members),w.createIndexBuffer(E),d.aM.simpleSegment(0,0,T.length,E.length));return this._meshCache[y]=ue,ue}getMeshFrameDelta(e){return 2*Math.PI*d.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,r){var l;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(e,r);return(l=this.getMinMaxElevation(h).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const r=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return r&&r.dem&&(l.minElevation=r.dem.min*this.exaggeration,l.maxElevation=r.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,r){const l=d.a1.fromLngLat(e.wrap()),h=(1<<r)*d.$,g=l.x*h,y=l.y*h,w=Math.floor(g/d.$),T=Math.floor(y/d.$);return{tileID:new d.Z(r,0,r,w,T),mercatorX:g,mercatorY:y}}}class dt{constructor(e,r,l){this._context=e,this._size=r,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new d.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(l.texture),{id:e,fbo:r,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((r=>e.id!==r)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const mt={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class oo{constructor(e,r){this.painter=e,this.terrain=r,this.pool=new dt(e.context,30,r.sourceCache.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((l=>!e._layers[l].isHidden(r))),this._coordsAscending={};for(const l in e.sourceCaches){this._coordsAscending[l]={};const h=e.sourceCaches[l].getVisibleCoordinates(),g=e.sourceCaches[l].getSource(),y=g instanceof ar?g.terrainTileRanges:null;for(const w of h){const T=this.terrain.sourceCache.getTerrainCoords(w,y);for(const E in T)this._coordsAscending[l][E]||(this._coordsAscending[l][E]=[]),this._coordsAscending[l][E].push(T[E])}}this._coordsAscendingStr={};for(const l of e._order){const h=e._layers[l],g=h.source;if(mt[h.type]&&!this._coordsAscendingStr[g]){this._coordsAscendingStr[g]={};for(const y in this._coordsAscending[g])this._coordsAscendingStr[g][y]=this._coordsAscending[g][y].map((w=>w.key)).sort().join()}}for(const l of this._renderableTiles)for(const h in this._coordsAscendingStr){const g=this._coordsAscendingStr[h][l.tileID.key];g&&g!==l.rttCoords[h]&&(l.rtt=[])}}renderLayer(e,r){if(e.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},r),{isRenderingToTexture:!0}),h=e.type,g=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(mt[h]&&(this._prevType&&mt[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(e.id),!y))return!0;if(mt[this._prevType]||mt[h]&&y){this._prevType=h;const w=this._stacks.length-1,T=this._stacks[w]||[];for(const E of this._renderableTiles){if(this.pool.isFull()&&(kn(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(E),E.rtt[w]){const D=this.pool.getObjectForId(E.rtt[w].id);if(D.stamp===E.rtt[w].stamp){this.pool.useObject(D);continue}}const A=this.pool.getOrCreateFreeObject();this.pool.useObject(A),this.pool.stampObject(A),E.rtt[w]={id:A.id,stamp:A.stamp},g.context.bindFramebuffer.set(A.fbo.framebuffer),g.context.clear({color:d.bf.transparent,stencil:0}),g.currentStencilSource=void 0;for(let D=0;D<T.length;D++){const P=g.style._layers[T[D]],B=P.source?this._coordsAscending[P.source][E.tileID.key]:[E.tileID];g.context.viewport.set([0,0,A.fbo.width,A.fbo.height]),g._renderTileClippingMasks(P,B,!0),g.renderLayer(g,g.style.sourceCaches[P.source],P,B,l),P.source&&(E.rttCoords[P.source]=this._coordsAscendingStr[P.source][E.tileID.key])}}return kn(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),mt[h]}return!1}}const qu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},yl=ze,ia={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Mr,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Na={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class pn{constructor(e,r,l=!1){this.mousedown=g=>{this.startMove(g,be.mousePos(this.element,g)),be.addEventListener(window,"mousemove",this.mousemove),be.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=g=>{this.move(g,be.mousePos(this.element,g))},this.mouseup=g=>{this._rotatePitchHandler.dragEnd(g),this.offTemp()},this.touchstart=g=>{g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=be.touchPos(this.element,g.targetTouches)[0],this.startMove(g,this._startPos),be.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),be.addEventListener(window,"touchend",this.touchend))},this.touchmove=g=>{g.targetTouches.length!==1?this.reset():(this._lastPos=be.touchPos(this.element,g.targetTouches)[0],this.move(g,this._lastPos))},this.touchend=g=>{g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=r;const h=new jh;this._rotatePitchHandler=new qn({clickTolerance:3,move:(g,y)=>{const w=r.getBoundingClientRect(),T=new d.P((w.bottom-w.top)/2,(w.right-w.left)/2);return{bearingDelta:d.cn(new d.P(g.x,y.y),y,T),pitchDelta:l?-.5*(y.y-g.y):void 0}},moveStateManager:h,enable:!0,assignEvents:()=>{}}),this.map=e,be.addEventListener(r,"mousedown",this.mousedown),be.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),be.addEventListener(r,"touchcancel",this.reset)}startMove(e,r){this._rotatePitchHandler.dragStart(e,r),be.disableDrag()}move(e,r){const l=this.map,{bearingDelta:h,pitchDelta:g}=this._rotatePitchHandler.dragMove(e,r)||{};h&&l.setBearing(l.getBearing()+h),g&&l.setPitch(l.getPitch()+g)}off(){const e=this.element;be.removeEventListener(e,"mousedown",this.mousedown),be.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),be.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),be.removeEventListener(window,"touchend",this.touchend),be.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){be.enableDrag(),be.removeEventListener(window,"mousemove",this.mousemove),be.removeEventListener(window,"mouseup",this.mouseup),be.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),be.removeEventListener(window,"touchend",this.touchend)}}let Va;function lo(m,e,r,l=!1){if(l||!r.getCoveringTilesDetailsProvider().allowWorldCopies())return m?.wrap();const h=new d.S(m.lng,m.lat);if(m=new d.S(m.lng,m.lat),e){const g=new d.S(m.lng-360,m.lat),y=new d.S(m.lng+360,m.lat),w=r.locationToScreenPoint(m).distSqr(e);r.locationToScreenPoint(g).distSqr(e)<w?m=g:r.locationToScreenPoint(y).distSqr(e)<w&&(m=y)}for(;Math.abs(m.lng-r.center.lng)>180;){const g=r.locationToScreenPoint(m);if(g.x>=0&&g.y>=0&&g.x<=r.width&&g.y<=r.height)break;m.lng>r.center.lng?m.lng-=360:m.lng+=360}return m.lng!==h.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(m))?m:h}const Li={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function vi(m,e,r){const l=m.classList;for(const h in Li)l.remove(`maplibregl-${r}-anchor-${h}`);l.add(`maplibregl-${r}-anchor-${e}`)}class ya extends d.E{constructor(e){if(super(),this._onKeyPress=r=>{const l=r.code,h=r.charCode||r.keyCode;l!=="Space"&&l!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=r=>{const l=r.originalEvent.target,h=this._element;this._popup&&(l===h||h.contains(l))&&this.togglePopup()},this._update=r=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();(r?.type==="terrain"||r?.type==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=lo(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),be.setTransform(this._element,`${Li[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${g} ${h}`),Ke.frameAsync(new AbortController).then((()=>{this._updateOpacity(r&&r.type==="moveend")})).catch((()=>{}))},this._onMove=r=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.l("dragstart"))),this.fire(new d.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.l("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=d.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=be.create("div");const r=be.createNS("http://www.w3.org/2000/svg","svg"),l=41,h=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${l}px`),r.setAttributeNS(null,"width",`${h}px`),r.setAttributeNS(null,"viewBox",`0 0 ${h} ${l}`);const g=be.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");const y=be.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"fill-rule","nonzero");const w=be.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Y of T){const Q=be.createNS("http://www.w3.org/2000/svg","ellipse");Q.setAttributeNS(null,"opacity","0.04"),Q.setAttributeNS(null,"cx","10.5"),Q.setAttributeNS(null,"cy","5.80029008"),Q.setAttributeNS(null,"rx",Y.rx),Q.setAttributeNS(null,"ry",Y.ry),w.appendChild(Q)}const E=be.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill",this._color);const A=be.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),E.appendChild(A);const D=be.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"opacity","0.25"),D.setAttributeNS(null,"fill","#000000");const P=be.createNS("http://www.w3.org/2000/svg","path");P.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),D.appendChild(P);const B=be.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(6.0, 7.0)"),B.setAttributeNS(null,"fill","#FFFFFF");const N=be.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(8.0, 8.0)");const $=be.createNS("http://www.w3.org/2000/svg","circle");$.setAttributeNS(null,"fill","#000000"),$.setAttributeNS(null,"opacity","0.25"),$.setAttributeNS(null,"cx","5.5"),$.setAttributeNS(null,"cy","5.5"),$.setAttributeNS(null,"r","5.4999962");const X=be.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#FFFFFF"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962"),N.appendChild($),N.appendChild(X),y.appendChild(w),y.appendChild(E),y.appendChild(D),y.appendChild(B),y.appendChild(N),r.appendChild(y),r.setAttributeNS(null,"height",l*this._scale+"px"),r.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(r),this._offset=d.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(r=>{r.preventDefault()})),this._element.addEventListener("mousedown",(r=>{r.preventDefault()})),vi(this._element,this._anchor,"marker"),e&&e.className)for(const r of e.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),be.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=d.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const h=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var r,l;const h=(r=this._map)===null||r===void 0?void 0:r.terrain,g=this._map.transform.isLocationOccluded(this._lngLat);if(!h||g){const B=g?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==B&&(this._element.style.opacity=B))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const y=this._map,w=y.terrain.depthAtPoint(this._pos),T=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);if(y.transform.lngLatToCameraDepth(this._lngLat,T)-w<.006)return void(this._element.style.opacity=this._opacity);const E=-this._offset.y/y.transform.pixelsPerMeter,A=Math.sin(y.getPitch()*Math.PI/180)*E,D=y.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),P=y.transform.lngLatToCameraDepth(this._lngLat,T+A)-D>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&P&&this._popup.remove(),this._element.style.opacity=P?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=d.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,r){return(this._opacity===void 0||e===void 0&&r===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}const Yi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Jr=0,Ca=!1;const Ut={maxWidth:100,unit:"metric"};function di(m,e,r){const l=r&&r.maxWidth||100,h=m._container.clientHeight/2,g=m._container.clientWidth/2,y=m.unproject([g-l/2,h]),w=m.unproject([g+l/2,h]),T=Math.round(m.project(w).x-m.project(y).x),E=Math.min(l,T,m._container.clientWidth),A=y.distanceTo(w);if(r&&r.unit==="imperial"){const D=3.2808*A;D>5280?Ei(e,E,D/5280,m._getUIString("ScaleControl.Miles")):Ei(e,E,D,m._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?Ei(e,E,A/1852,m._getUIString("ScaleControl.NauticalMiles")):A>=1e3?Ei(e,E,A/1e3,m._getUIString("ScaleControl.Kilometers")):Ei(e,E,A,m._getUIString("ScaleControl.Meters"))}function Ei(m,e,r,l){const h=(function(g){const y=Math.pow(10,`${Math.floor(g)}`.length-1);let w=g/y;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:(function(T){const E=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*E)/E})(w),y*w})(r);m.style.width=e*(h/r)+"px",m.innerHTML=`${h}&nbsp;${l}`}const vl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},co=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function es(m){if(m){if(typeof m=="number"){const e=Math.round(Math.abs(m)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,m),"top-left":new d.P(e,e),"top-right":new d.P(-e,e),bottom:new d.P(0,-m),"bottom-left":new d.P(e,-e),"bottom-right":new d.P(-e,-e),left:new d.P(m,0),right:new d.P(-m,0)}}if(m instanceof d.P||Array.isArray(m)){const e=d.P.convert(m);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:d.P.convert(m.center||[0,0]),top:d.P.convert(m.top||[0,0]),"top-left":d.P.convert(m["top-left"]||[0,0]),"top-right":d.P.convert(m["top-right"]||[0,0]),bottom:d.P.convert(m.bottom||[0,0]),"bottom-left":d.P.convert(m["bottom-left"]||[0,0]),"bottom-right":d.P.convert(m["bottom-right"]||[0,0]),left:d.P.convert(m.left||[0,0]),right:d.P.convert(m.right||[0,0])}}return es(new d.P(0,0))}const xl=ze;I.AJAXError=d.cz,I.Event=d.l,I.Evented=d.E,I.LngLat=d.S,I.MercatorCoordinate=d.a1,I.Point=d.P,I.addProtocol=d.cA,I.config=d.a,I.removeProtocol=d.cB,I.AttributionControl=Oo,I.BoxZoomHandler=Nu,I.CanvasSource=Pr,I.CooperativeGesturesHandler=so,I.DoubleClickZoomHandler=ko,I.DragPanHandler=Bo,I.DragRotateHandler=dc,I.EdgeInsets=Lr,I.FullscreenControl=class extends d.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var e;let r=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=r?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)r=r.shadowRoot.fullscreenElement;r===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=be.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){be.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=be.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);be.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},I.GeoJSONSource=vr,I.GeolocateControl=class extends d.E{constructor(m){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new d.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const r=new d.S(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,h=this._map.getBearing(),g=d.e({bearing:h},this.options.fitBoundsOptions),y=Ni.fromLngLat(r,l);this._map.fitBounds(y,g,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const r=new d.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=e.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Ca)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=be.create("button","maplibregl-ctrl-geolocate",this._container),be.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=be.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ya({element:this._dotElement}),this._circleElement=be.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ya({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(r=>{const l=r?.[0]instanceof ResizeObserverEntry;r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.l("trackuserlocationend")),this.fire(new d.l("userlocationlostfocus")))}))}},this.options=d.e({},Yi,m)}onAdd(m){return this._map=m,this._container=be.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return d._(this,arguments,void 0,(function*(e=!1){if(Va!==void 0&&!e)return Va;if(window.navigator.permissions===void 0)return Va=!!window.navigator.geolocation,Va;try{Va=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Va=!!window.navigator.geolocation}return Va}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),be.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Jr=0,Ca=!1}_isOutOfMapMaxBounds(m){const e=this._map.getMaxBounds(),r=m.coords;return e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const m=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&m))return;const e=this._map.project(m),r=this._map.unproject([e.x+100,e.y]),l=m.distanceTo(r)/100,h=2*this._accuracy/l;this._circleElement.style.width=`${h.toFixed(2)}px`,this._circleElement.style.height=`${h.toFixed(2)}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Jr--,Ca=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.l("trackuserlocationstart")),this.fire(new d.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Jr++,Jr>1?(m={maximumAge:6e5,timeout:0},Ca=!0):(m=this.options.positionOptions,Ca=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},I.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;const e=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=be.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=be.create("button","maplibregl-ctrl-globe",this._container),be.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){be.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},I.Hash=Qa,I.ImageSource=ar,I.KeyboardHandler=$t,I.LngLatBounds=Ni,I.LogoControl=pc,I.Map=class extends Sr{constructor(m){var e,r;d.cw.mark(d.cx.create);const l=Object.assign(Object.assign(Object.assign({},ia),m),{canvasContextAttributes:Object.assign(Object.assign({},ia.canvasContextAttributes),m.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const h=new _i,g=new Wn;if(l.minZoom!==void 0&&h.setMinZoom(l.minZoom),l.maxZoom!==void 0&&h.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&h.setMinPitch(l.minPitch),l.maxPitch!==void 0&&h.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&h.setRenderWorldCopies(l.renderWorldCopies),super(h,g,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Xc,this._controls=[],this._mapId=d.a7(),this._contextLost=w=>{w.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new d.l("webglcontextlost",{originalEvent:w}))},this._contextRestored=w=>{this._setupPainter(),this.resize(),this._update(),this.fire(new d.l("webglcontextrestored",{originalEvent:w}))},this._onMapScroll=w=>{if(w.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},qu),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this.transformCameraUpdate=l.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ci.addThrottleControl((()=>this.isMoving())),this._requestManager=new Kn(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let w=!1;const T=io((E=>{this._trackResize&&!this._removed&&(this.resize(E),this.redraw())}),50);this._resizeObserver=new ResizeObserver((E=>{w?T(E):w=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Gu(this,l),this._hash=l.hash&&new Qa(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,d.e({},l.fitBoundsOptions,{duration:0}))));const y=typeof l.style=="string"||((r=(e=l.style)===null||e===void 0?void 0:e.projection)===null||r===void 0?void 0:r.type)!=="globe";this.resize(null,y),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new Oo(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new pc,l.logoPosition),this.on("style.load",(()=>{if(y||this._resizeTransform(),this.transform.unmodified){const w=d.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(w)}})),this.on("data",(w=>{this._update(w.dataType==="style"),this.fire(new d.l(`${w.dataType}data`,w))})),this.on("dataloading",(w=>{this.fire(new d.l(`${w.dataType}dataloading`,w))})),this.on("dataabort",(w=>{this.fire(new d.l("sourcedataabort",w))}))}_getMapId(){return this._mapId}setGlobalStateProperty(m,e){return this.style.setGlobalStateProperty(m,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(m,e){if(e===void 0&&(e=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new d.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=m.onAdd(this);this._controls.push(m);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(r,l.firstChild):l.appendChild(r),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new d.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(m);return e>-1&&this._controls.splice(e,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}coveringTiles(m){return _e(this.transform,m)}calculateCameraOptionsFromTo(m,e,r,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,e,r,l)}resize(m,e=!0){const[r,l]=this._containerDimensions(),h=this._getClampedPixelRatio(r,l);if(this._resizeCanvas(r,l,h),this.painter.resize(r,l,h),this.painter.overLimit()){const y=this.painter.context.gl;this._maxCanvasSize=[y.drawingBufferWidth,y.drawingBufferHeight];const w=this._getClampedPixelRatio(r,l);this._resizeCanvas(r,l,w),this.painter.resize(r,l,w)}this._resizeTransform(e);const g=!this._moving;return g&&(this.stop(),this.fire(new d.l("movestart",m)).fire(new d.l("move",m))),this.fire(new d.l("resize",m)),g&&this.fire(new d.l("moveend",m)),this}_resizeTransform(m=!0){var e;const[r,l]=this._containerDimensions();this.transform.resize(r,l,m),(e=this._requestedCameraState)===null||e===void 0||e.resize(r,l,m)}_getClampedPixelRatio(m,e){const{0:r,1:l}=this._maxCanvasSize,h=this.getPixelRatio(),g=m*h,y=e*h;return Math.min(g>r?r/g:1,y>l?l/y:1)*h}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(Ni.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.setMinZoom(m),this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.setMaxZoom(m),this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.setMinPitch(m),this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch)return this.transform.setMaxPitch(m),this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}project(m){return this.transform.locationToScreenPoint(d.S.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(d.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,e,r){if(m==="mouseenter"||m==="mouseover"){let l=!1;return{layers:e,listener:r,delegates:{mousemove:g=>{const y=e.filter((T=>this.getLayer(T))),w=y.length!==0?this.queryRenderedFeatures(g.point,{layers:y}):[];w.length?l||(l=!0,r.call(this,new Gn(m,this,g.originalEvent,{features:w}))):l=!1},mouseout:()=>{l=!1}}}}if(m==="mouseleave"||m==="mouseout"){let l=!1;return{layers:e,listener:r,delegates:{mousemove:y=>{const w=e.filter((T=>this.getLayer(T)));(w.length!==0?this.queryRenderedFeatures(y.point,{layers:w}):[]).length?l=!0:l&&(l=!1,r.call(this,new Gn(m,this,y.originalEvent)))},mouseout:y=>{l&&(l=!1,r.call(this,new Gn(m,this,y.originalEvent)))}}}}{const l=h=>{const g=e.filter((w=>this.getLayer(w))),y=g.length!==0?this.queryRenderedFeatures(h.point,{layers:g}):[];y.length&&(h.features=y,r.call(this,h),delete h.features)};return{layers:e,listener:r,delegates:{[m]:l}}}}_saveDelegatedListener(m,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(e)}_removeDelegatedListener(m,e,r){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const l=this._delegatedListeners[m];for(let h=0;h<l.length;h++){const g=l[h];if(g.listener===r&&g.layers.length===e.length&&g.layers.every((y=>e.includes(y)))){for(const y in g.delegates)this.off(y,g.delegates[y]);return void l.splice(h,1)}}}on(m,e,r){if(r===void 0)return super.on(m,e);const l=typeof e=="string"?[e]:e,h=this._createDelegatedListener(m,l,r);this._saveDelegatedListener(m,h);for(const g in h.delegates)this.on(g,h.delegates[g]);return{unsubscribe:()=>{this._removeDelegatedListener(m,l,r)}}}once(m,e,r){if(r===void 0)return super.once(m,e);const l=typeof e=="string"?[e]:e,h=this._createDelegatedListener(m,l,r);for(const g in h.delegates){const y=h.delegates[g];h.delegates[g]=(...w)=>{this._removeDelegatedListener(m,l,r),y(...w)}}this._saveDelegatedListener(m,h);for(const g in h.delegates)this.once(g,h.delegates[g]);return this}off(m,e,r){return r===void 0?super.off(m,e):(this._removeDelegatedListener(m,typeof e=="string"?[e]:e,r),this)}queryRenderedFeatures(m,e){if(!this.style)return[];let r;const l=m instanceof d.P||Array.isArray(m),h=l?m:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:m)||{},h instanceof d.P||typeof h[0]=="number")r=[d.P.convert(h)];else{const g=d.P.convert(h[0]),y=d.P.convert(h[1]);r=[g,new d.P(y.x,g.y),y,new d.P(g.x,y.y),g]}return this.style.queryRenderedFeatures(r,e,this.transform)}querySourceFeatures(m,e){return this.style.querySourceFeatures(m,e)}setStyle(m,e){return(e=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(m,e))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const e=this._locale[m];if(e==null)throw new Error(`Missing UI string '${m}'`);return e}_updateStyle(m,e){var r,l;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(m,e)));const h=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new Mu(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,e,h):this.style.loadJSON(m,e,h),this):((l=(r=this.style)===null||r===void 0?void 0:r.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Mu(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,e){if(typeof m=="string"){const r=this._requestManager.transformRequest(m,"Style");d.j(r,new AbortController).then((l=>{this._updateDiff(l.data,e)})).catch((l=>{l&&this.fire(new d.k(l))}))}else typeof m=="object"&&this._updateDiff(m,e)}_updateDiff(m,e){try{this.style.setState(m,e)&&this._update(!0)}catch(r){d.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(m,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(m,e){return this._lazyInitEmptyStyle(),this.style.addSource(m,e),this._update(!0)}isSourceLoaded(m){const e=this.style&&this.style.sourceCaches[m];if(e!==void 0)return e.loaded();this.fire(new d.k(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const e=this.style.sourceCaches[m.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&e.reload();for(const r in this.style._layers){const l=this.style._layers[r];l.type==="hillshade"&&l.source===m.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),l.type==="color-relief"&&l.source===m.source&&d.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new gc(this.painter,e,m),this.painter.renderToTexture=new oo(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=r=>{var l;r.dataType==="style"?this.terrain.sourceCache.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=r.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new d.l("terrain",{terrain:m})),this}getTerrain(){var m,e;return(e=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const e in m){const r=m[e]._tiles;for(const l in r){const h=r[l];if(h.state!=="loaded"&&h.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}setSourceTileLodParams(m,e,r){if(r){const l=this.getSource(r);if(!l)throw new Error(`There is no source with ID "${r}", cannot set LOD parameters`);l.calculateTileZoom=Xe(Math.max(1,m),Math.max(1,e))}else for(const l in this.style.sourceCaches)this.style.sourceCaches[l].getSource().calculateTileZoom=Xe(Math.max(1,m),Math.max(1,e));return this._update(!0),this}refreshTiles(m,e){const r=this.style.sourceCaches[m];if(!r)throw new Error(`There is no source cache with ID "${m}", cannot refresh tile`);e===void 0?r.reload(!0):r.refreshTiles(e.map((l=>new d.a4(l.z,l.x,l.y))))}addImage(m,e,r={}){const{pixelRatio:l=1,sdf:h=!1,stretchX:g,stretchY:y,content:w,textFitWidth:T,textFitHeight:E}=r;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||d.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new d.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:D,data:P}=e,B=e;return this.style.addImage(m,{data:new d.R({width:A,height:D},new Uint8Array(P)),pixelRatio:l,stretchX:g,stretchY:y,content:w,textFitWidth:T,textFitHeight:E,sdf:h,version:0,userImage:B}),B.onAdd&&B.onAdd(this,m),this}}{const{width:A,height:D,data:P}=Ke.getImageData(e);this.style.addImage(m,{data:new d.R({width:A,height:D},P),pixelRatio:l,stretchX:g,stretchY:y,content:w,textFitWidth:T,textFitHeight:E,sdf:h,version:0})}}updateImage(m,e){const r=this.style.getImage(m);if(!r)return this.fire(new d.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||d.b(e)?Ke.getImageData(e):e,{width:h,height:g,data:y}=l;if(h===void 0||g===void 0)return this.fire(new d.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==r.data.width||g!==r.data.height)return this.fire(new d.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(e instanceof HTMLImageElement||d.b(e));return r.data.replace(y,w),this.style.updateImage(m,r),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new d.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return Ci.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,e){return this._lazyInitEmptyStyle(),this.style.addLayer(m,e),this._update(!0)}moveLayer(m,e){return this.style.moveLayer(m,e),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,e,r){return this.style.setLayerZoomRange(m,e,r),this._update(!0)}setFilter(m,e,r={}){return this.style.setFilter(m,e,r),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,e,r,l={}){return this.style.setPaintProperty(m,e,r,l),this._update(!0)}getPaintProperty(m,e){return this.style.getPaintProperty(m,e)}setLayoutProperty(m,e,r,l={}){return this.style.setLayoutProperty(m,e,r,l),this._update(!0)}getLayoutProperty(m,e){return this.style.getLayoutProperty(m,e)}setGlyphs(m,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,e,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,e,r,(l=>{l||this._update(!0)})),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,e,(r=>{r||this._update(!0)})),this}setLight(m,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,e){return this.style.setFeatureState(m,e),this._update()}removeFeatureState(m,e){return this.style.removeFeatureState(m,e),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,e=0;return this._container&&(m=this._container.clientWidth||400,e=this._container.clientHeight||300),[m,e]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const e=this._canvasContainer=be.create("div","maplibregl-canvas-container",m);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=be.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),l=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],l);const h=this._controlContainer=be.create("div","maplibregl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((y=>{g[y]=be.create("div",`maplibregl-ctrl-${y} `,h)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,e,r){this._canvas.width=Math.floor(r*m),this._canvas.height=Math.floor(r*e),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",(l=>{e={requestedAttributes:m},l&&(e.statusMessage=l.statusMessage,e.type=l.type)}),{once:!0});let r=null;if(r=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!r){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new lc(r,this.transform),ci.testSupport(r)}migrateProjection(m,e){super.migrateProjection(m,e),this.painter.transform=m,this.fire(new d.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var e,r,l,h,g;const y=this._idleTriggered?this._fadeDuration:0,w=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let T=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const D=this.transform.zoom,P=Ke.now();this.style.zoomHistory.update(D,P);const B=new d.F(D,{now:P,fadeDuration:y,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),N=B.crossFadingFactor();N===1&&N===this._crossFadingFactor||(T=!0,this._crossFadingFactor=N),this.style.update(B)}const E=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0!==w;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((h=this.style.projection)===null||h===void 0?void 0:h.transitionState,(g=this.style.projection)===null||g===void 0?void 0:g.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||E)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,E),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,showPadding:this.showPadding}),this.fire(new d.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.cw.mark(d.cx.load),this.fire(new d.l("load"))),this.style&&(this.style.hasTransitions()||T)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const A=this._sourcesDirty||this._styleDirty||this._placementDirty;return A||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.l("idle")),!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,d.cw.mark(d.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ci.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),be.remove(this._canvasContainer),be.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),d.cw.clearMetrics(),this._removed=!0,this.fire(new d.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Ke.frame(this._frameRequest,(m=>{d.cw.frame(m),this._frameRequest=null;try{this._render(m)}catch(e){if(!d.cy(e)&&!(function(r){return r.message===Zr})(e))throw e}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return yl}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},I.MapMouseEvent=Gn,I.MapTouchEvent=ws,I.MapWheelEvent=Ts,I.Marker=ya,I.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const e=this._map.getZoom(),r=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,r)=>{const l=this._map._getUIString(`NavigationControl.${r}`);e.title=l,e.setAttribute("aria-label",l)},this.options=d.e({},Na,m),this._container=be.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),be.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),be.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=be.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new pn(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){be.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,e){const r=be.create("button",m,this._container);return r.type="button",r.addEventListener("click",e),r}},I.Popup=class extends d.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&be.remove(this._content),this._container&&(be.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=be.create("div","maplibregl-popup",this._map.getContainer()),this._tip=be.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const y of this.options.className.split(" "))this._container.classList.add(y);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=lo(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const r=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const h=es(this.options.offset);if(!l){const y=this._container.offsetWidth,w=this._container.offsetHeight;let T;T=r.y+h.bottom.y<w?["top"]:r.y>this._map.transform.height-w?["bottom"]:[],r.x<y/2?T.push("left"):r.x>this._map.transform.width-y/2&&T.push("right"),l=T.length===0?"bottom":T.join("-")}let g=r.add(h[l]);this.options.subpixelPositioning||(g=g.round()),be.setTransform(this._container,`${Li[l]} translate(${g.x}px,${g.y}px)`),vi(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(vl),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=d.S.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const e=document.createDocumentFragment(),r=document.createElement("body");let l;for(r.innerHTML=m;l=r.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=be.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=be.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(co);m&&m.focus()}},I.RasterDEMTileSource=xo,I.RasterTileSource=nr,I.ScaleControl=class{constructor(m){this._onMove=()=>{di(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,di(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ut),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=be.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){be.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},I.ScrollZoomHandler=Zu,I.Style=Mu,I.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=be.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=be.create("button","maplibregl-ctrl-terrain",this._container),be.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){be.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},I.TwoFingersTouchPitchHandler=Ms,I.TwoFingersTouchRotateHandler=hc,I.TwoFingersTouchZoomHandler=Gc,I.TwoFingersTouchZoomRotateHandler=$c,I.VectorTileSource=$a,I.VideoSource=Os,I.addSourceType=(m,e)=>d._(void 0,void 0,void 0,(function*(){if(Us(m))throw new Error(`A source type called "${m}" already exists.`);((r,l)=>{Fs[r]=l})(m,e)})),I.clearPrewarmedResources=function(){const m=at;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(ni),at=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},I.createTileMesh=nl,I.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},I.getRTLTextPluginStatus=function(){return cs().getRTLTextPluginStatus()},I.getVersion=function(){return xl},I.getWorkerCount=function(){return he.workerCount},I.getWorkerUrl=function(){return d.a.WORKER_URL},I.importScriptInWorkers=function(m){return Qt().broadcast("IS",m)},I.prewarm=function(){Mt().acquire(ni)},I.setMaxParallelImageRequests=function(m){d.a.MAX_PARALLEL_IMAGE_REQUESTS=m},I.setRTLTextPlugin=function(m,e){return cs().setRTLTextPlugin(m,e)},I.setWorkerCount=function(m){he.workerCount=m},I.setWorkerUrl=function(m){d.a.WORKER_URL=m}}));var $e=ae;return $e}))})(Ap)),Ap.exports}var eg=Jm();const zp=Nm(eg);var Bs=Uint8Array,Ed=Uint16Array,tg=Int32Array,wm=new Bs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Tm=new Bs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ig=new Bs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Sm=function(K,re){for(var ae=new Ed(31),H=0;H<31;++H)ae[H]=re+=1<<K[H-1];for(var Me=new tg(ae[30]),H=1;H<30;++H)for(var $e=ae[H];$e<ae[H+1];++$e)Me[$e]=$e-ae[H]<<5|H;return{b:ae,r:Me}},Mm=Sm(wm,2),Cm=Mm.b,ng=Mm.r;Cm[28]=258,ng[258]=28;var ag=Sm(Tm,0),rg=ag.b,tm=new Ed(32768);for(var En=0;En<32768;++En){var yu=(En&43690)>>1|(En&21845)<<1;yu=(yu&52428)>>2|(yu&13107)<<2,yu=(yu&61680)>>4|(yu&3855)<<4,tm[En]=((yu&65280)>>8|(yu&255)<<8)>>1}var Bf=(function(K,re,ae){for(var H=K.length,Me=0,$e=new Ed(re);Me<H;++Me)K[Me]&&++$e[K[Me]-1];var I=new Ed(re);for(Me=1;Me<re;++Me)I[Me]=I[Me-1]+$e[Me-1]<<1;var d;if(ae){d=new Ed(1<<re);var ze=15-re;for(Me=0;Me<H;++Me)if(K[Me])for(var Ie=Me<<4|K[Me],ot=re-K[Me],Ye=I[K[Me]-1]++<<ot,Ke=Ye|(1<<ot)-1;Ye<=Ke;++Ye)d[tm[Ye]>>ze]=Ie}else for(d=new Ed(H),Me=0;Me<H;++Me)K[Me]&&(d[Me]=tm[I[K[Me]-1]++]>>15-K[Me]);return d}),Ff=new Bs(288);for(var En=0;En<144;++En)Ff[En]=8;for(var En=144;En<256;++En)Ff[En]=9;for(var En=256;En<280;++En)Ff[En]=7;for(var En=280;En<288;++En)Ff[En]=8;var Em=new Bs(32);for(var En=0;En<32;++En)Em[En]=5;var sg=Bf(Ff,9,1),og=Bf(Em,5,1),Jp=function(K){for(var re=K[0],ae=1;ae<K.length;++ae)K[ae]>re&&(re=K[ae]);return re},Jo=function(K,re,ae){var H=re/8|0;return(K[H]|K[H+1]<<8)>>(re&7)&ae},em=function(K,re){var ae=re/8|0;return(K[ae]|K[ae+1]<<8|K[ae+2]<<16)>>(re&7)},lg=function(K){return(K+7)/8|0},cg=function(K,re,ae){return(ae==null||ae>K.length)&&(ae=K.length),new Bs(K.subarray(re,ae))},ug=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ks=function(K,re,ae){var H=new Error(re||ug[K]);if(H.code=K,Error.captureStackTrace&&Error.captureStackTrace(H,ks),!ae)throw H;return H},am=function(K,re,ae,H){var Me=K.length,$e=0;if(!Me||re.f&&!re.l)return ae||new Bs(0);var I=!ae,d=I||re.i!=2,ze=re.i;I&&(ae=new Bs(Me*3));var Ie=function(ir){var Qn=ae.length;if(ir>Qn){var Ni=new Bs(Math.max(Qn*2,ir));Ni.set(ae),ae=Ni}},ot=re.f||0,Ye=re.p||0,Ke=re.b||0,be=re.l,ci=re.d,Bt=re.m,tn=re.n,dn=Me*8;do{if(!be){ot=Jo(K,Ye,1);var hi=Jo(K,Ye+1,3);if(Ye+=3,hi)if(hi==1)be=sg,ci=og,Bt=9,tn=5;else if(hi==2){var Ui=Jo(K,Ye,31)+257,Nt=Jo(K,Ye+10,15)+4,An=Ui+Jo(K,Ye+5,31)+1;Ye+=14;for(var zn=new Bs(An),Pn=new Bs(19),gi=0;gi<Nt;++gi)Pn[ig[gi]]=Jo(K,Ye+gi*3,7);Ye+=Nt*3;for(var ji=Jp(Pn),ha=(1<<ji)-1,ba=Bf(Pn,ji,1),gi=0;gi<An;){var Dn=ba[Jo(K,Ye,ha)];Ye+=Dn&15;var It=Dn>>4;if(It<16)zn[gi++]=It;else{var Be=0,rt=0;for(It==16?(rt=3+Jo(K,Ye,3),Ye+=2,Be=zn[gi-1]):It==17?(rt=3+Jo(K,Ye,7),Ye+=3):It==18&&(rt=11+Jo(K,Ye,127),Ye+=7);rt--;)zn[gi++]=Be}}var St=zn.subarray(0,Ui),_t=zn.subarray(Ui);Bt=Jp(St),tn=Jp(_t),be=Bf(St,Bt,1),ci=Bf(_t,tn,1)}else ks(1);else{var It=lg(Ye)+4,Ci=K[It-4]|K[It-3]<<8,Kn=It+Ci;if(Kn>Me){ze&&ks(0);break}d&&Ie(Ke+Ci),ae.set(K.subarray(It,Kn),Ke),re.b=Ke+=Ci,re.p=Ye=Kn*8,re.f=ot;continue}if(Ye>dn){ze&&ks(0);break}}d&&Ie(Ke+131072);for(var ni=(1<<Bt)-1,he=(1<<tn)-1,Ne=Ye;;Ne=Ye){var Be=be[em(K,Ye)&ni],at=Be>>4;if(Ye+=Be&15,Ye>dn){ze&&ks(0);break}if(Be||ks(2),at<256)ae[Ke++]=at;else if(at==256){Ne=Ye,be=null;break}else{var ut=at-254;if(at>264){var gi=at-257,Mt=wm[gi];ut=Jo(K,Ye,(1<<Mt)-1)+Cm[gi],Ye+=Mt}var Ct=ci[em(K,Ye)&he],Qt=Ct>>4;Ct||ks(3),Ye+=Ct&15;var _t=rg[Qt];if(Qt>3){var Mt=Tm[Qt];_t+=em(K,Ye)&(1<<Mt)-1,Ye+=Mt}if(Ye>dn){ze&&ks(0);break}d&&Ie(Ke+131072);var wi=Ke+ut;if(Ke<_t){var si=$e-_t,tr=Math.min(_t,wi);for(si+Ke<0&&ks(3);Ke<tr;++Ke)ae[Ke]=H[si+Ke]}for(;Ke<wi;++Ke)ae[Ke]=ae[Ke-_t]}}re.l=be,re.p=Ne,re.b=Ke,re.f=ot,be&&(ot=1,re.m=Bt,re.d=ci,re.n=tn)}while(!ot);return Ke!=ae.length&&I?cg(ae,0,Ke):ae.subarray(0,Ke)},hg=new Bs(0),dg=function(K){(K[0]!=31||K[1]!=139||K[2]!=8)&&ks(6,"invalid gzip data");var re=K[3],ae=10;re&4&&(ae+=(K[10]|K[11]<<8)+2);for(var H=(re>>3&1)+(re>>4&1);H>0;H-=!K[ae++]);return ae+(re&2)},fg=function(K){var re=K.length;return(K[re-4]|K[re-3]<<8|K[re-2]<<16|K[re-1]<<24)>>>0},pg=function(K,re){return((K[0]&15)!=8||K[0]>>4>7||(K[0]<<8|K[1])%31)&&ks(6,"invalid zlib data"),(K[1]>>5&1)==1&&ks(6,"invalid zlib data: "+(K[1]&32?"need":"unexpected")+" dictionary"),(K[1]>>3&4)+2};function mg(K,re){return am(K,{i:2},re,re)}function gg(K,re){var ae=dg(K);return ae+8>K.length&&ks(6,"invalid gzip data"),am(K.subarray(ae,-8),{i:2},new Bs(fg(K)),re)}function _g(K,re){return am(K.subarray(pg(K),-4),{i:2},re,re)}function yg(K,re){return K[0]==31&&K[1]==139&&K[2]==8?gg(K,re):(K[0]&15)!=8||K[0]>>4>7||(K[0]<<8|K[1])%31?mg(K,re):_g(K,re)}var vg=typeof TextDecoder<"u"&&new TextDecoder,xg=0;try{vg.decode(hg,{stream:!0}),xg=1}catch{}var bg=Object.defineProperty,Of=Math.pow,en=(K,re)=>bg(K,"name",{value:re,configurable:!0}),Ha=(K,re,ae)=>new Promise((H,Me)=>{var $e=ze=>{try{d(ae.next(ze))}catch(Ie){Me(Ie)}},I=ze=>{try{d(ae.throw(ze))}catch(Ie){Me(Ie)}},d=ze=>ze.done?H(ze.value):Promise.resolve(ze.value).then($e,I);d((ae=ae.apply(K,re)).next())});en((K,re)=>{let ae=!1,H="",Me=L.GridLayer.extend({createTile:en(($e,I)=>{let d=document.createElement("img"),ze=new AbortController,Ie=ze.signal;return d.cancel=()=>{ze.abort()},ae||(K.getHeader().then(ot=>{ot.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):ot.tileType===2?H="image/png":ot.tileType===3?H="image/jpeg":ot.tileType===4?H="image/webp":ot.tileType===5&&(H="image/avif")}),ae=!0),K.getZxy($e.z,$e.x,$e.y,Ie).then(ot=>{if(ot){let Ye=new Blob([ot.data],{type:H}),Ke=window.URL.createObjectURL(Ye);d.src=Ke,d.cancel=void 0,I(void 0,d)}}).catch(ot=>{if(ot.name!=="AbortError")throw ot}),d},"createTile"),_removeTile:en(function($e){let I=this._tiles[$e];I&&(I.el.cancel&&I.el.cancel(),I.el.width=0,I.el.height=0,I.el.deleted=!0,L.DomUtil.remove(I.el),delete this._tiles[$e],this.fire("tileunload",{tile:I.el,coords:this._keyToTileCoords($e)}))},"_removeTile")});return new Me(re)},"leafletRasterLayer");var wg=en(K=>(re,ae)=>{if(ae instanceof AbortController)return K(re,ae);let H=new AbortController;return K(re,H).then(Me=>ae(void 0,Me.data,Me.cacheControl||"",Me.expires||""),Me=>ae(Me)).catch(Me=>ae(Me)),{cancel:en(()=>H.abort(),"cancel")}},"v3compat"),Am=class{constructor(re){this.tilev4=en((ae,H)=>Ha(this,null,function*(){if(ae.type==="json"){let be=ae.url.substr(10),ci=this.tiles.get(be);if(ci||(ci=new xm(be),this.tiles.set(be,ci)),this.metadata)return{data:yield ci.getTileJson(ae.url)};let Bt=yield ci.getHeader();return(Bt.minLon>=Bt.maxLon||Bt.minLat>=Bt.maxLat)&&console.error(`Bounds of PMTiles archive ${Bt.minLon},${Bt.minLat},${Bt.maxLon},${Bt.maxLat} are not valid.`),{data:{tiles:[`${ae.url}/{z}/{x}/{y}`],minzoom:Bt.minZoom,maxzoom:Bt.maxZoom,bounds:[Bt.minLon,Bt.minLat,Bt.maxLon,Bt.maxLat]}}}let Me=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),$e=ae.url.match(Me);if(!$e)throw new Error("Invalid PMTiles protocol URL");let I=$e[1],d=this.tiles.get(I);d||(d=new xm(I),this.tiles.set(I,d));let ze=$e[2],Ie=$e[3],ot=$e[4],Ye=yield d.getHeader(),Ke=yield d?.getZxy(+ze,+Ie,+ot,H.signal);if(Ke)return{data:new Uint8Array(Ke.data),cacheControl:Ke.cacheControl,expires:Ke.expires};if(Ye.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=wg(this.tilev4),this.tiles=new Map,this.metadata=re?.metadata||!1,this.errorOnMissingTile=re?.errorOnMissingTile||!1}add(re){this.tiles.set(re.source.getKey(),re)}get(re){return this.tiles.get(re)}};en(Am,"Protocol");var Tg=Am;function zm(K,re){return(re>>>0)*4294967296+(K>>>0)}en(zm,"toNum");function Pm(K,re){let ae=re.buf,H=ae[re.pos++],Me=(H&112)>>4;if(H<128||(H=ae[re.pos++],Me|=(H&127)<<3,H<128)||(H=ae[re.pos++],Me|=(H&127)<<10,H<128)||(H=ae[re.pos++],Me|=(H&127)<<17,H<128)||(H=ae[re.pos++],Me|=(H&127)<<24,H<128)||(H=ae[re.pos++],Me|=(H&1)<<31,H<128))return zm(K,Me);throw new Error("Expected varint not more than 10 bytes")}en(Pm,"readVarintRemainder");function Cd(K){let re=K.buf,ae=re[K.pos++],H=ae&127;return ae<128||(ae=re[K.pos++],H|=(ae&127)<<7,ae<128)||(ae=re[K.pos++],H|=(ae&127)<<14,ae<128)||(ae=re[K.pos++],H|=(ae&127)<<21,ae<128)?H:(ae=re[K.pos],H|=(ae&15)<<28,Pm(H,K))}en(Cd,"readVarint");function rm(K,re,ae,H){if(H===0){ae===1&&(re[0]=K-1-re[0],re[1]=K-1-re[1]);let Me=re[0];re[0]=re[1],re[1]=Me}}en(rm,"rotate");function Dm(K,re){let ae=Of(2,K),H=re,Me=re,$e=re,I=[0,0],d=1;for(;d<ae;)H=1&$e/2,Me=1&($e^H),rm(d,I,H,Me),I[0]+=d*H,I[1]+=d*Me,$e=$e/4,d*=2;return[K,I[0],I[1]]}en(Dm,"idOnLevel");var Sg=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Im(K,re,ae){if(K>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(re>Of(2,K)-1||ae>Of(2,K)-1)throw new Error("tile x/y outside zoom level bounds");let H=Sg[K],Me=Of(2,K),$e=0,I=0,d=0,ze=[re,ae],Ie=Me/2;for(;Ie>0;)$e=(ze[0]&Ie)>0?1:0,I=(ze[1]&Ie)>0?1:0,d+=Ie*Ie*(3*$e^I),rm(Ie,ze,$e,I),Ie=Ie/2;return H+d}en(Im,"zxyToTileId");function Mg(K){let re=0;for(let ae=0;ae<27;ae++){let H=(1<<ae)*(1<<ae);if(re+H>K)return Dm(ae,K-re);re+=H}throw new Error("Tile zoom level exceeds max safe number limit (26)")}en(Mg,"tileIdToZxy");var Cg=(K=>(K[K.Unknown=0]="Unknown",K[K.None=1]="None",K[K.Gzip=2]="Gzip",K[K.Brotli=3]="Brotli",K[K.Zstd=4]="Zstd",K))(Cg||{});function Dp(K,re){return Ha(this,null,function*(){if(re===1||re===0)return K;if(re===2){if(typeof globalThis.DecompressionStream>"u")return yg(new Uint8Array(K));let ae=new Response(K).body;if(!ae)throw new Error("Failed to read response stream");let H=ae.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(H).arrayBuffer()}throw new Error("Compression method not supported")})}en(Dp,"defaultDecompress");var Eg=(K=>(K[K.Unknown=0]="Unknown",K[K.Mvt=1]="Mvt",K[K.Png=2]="Png",K[K.Jpeg=3]="Jpeg",K[K.Webp=4]="Webp",K[K.Avif=5]="Avif",K))(Eg||{});function Rm(K){return K===1?".mvt":K===2?".png":K===3?".jpg":K===4?".webp":K===5?".avif":""}en(Rm,"tileTypeExt");var Ag=127;function Lm(K,re){let ae=0,H=K.length-1;for(;ae<=H;){let Me=H+ae>>1,$e=re-K[Me].tileId;if($e>0)ae=Me+1;else if($e<0)H=Me-1;else return K[Me]}return H>=0&&(K[H].runLength===0||re-K[H].tileId<K[H].runLength)?K[H]:null}en(Lm,"findTile");var zg=class{constructor(re){this.file=re}getKey(){return this.file.name}getBytes(re,ae){return Ha(this,null,function*(){return{data:yield this.file.slice(re,re+ae).arrayBuffer()}})}};en(zg,"FileSource");var km=class{constructor(re,ae=new Headers){this.url=re,this.customHeaders=ae,this.mustReload=!1;let H="";"navigator"in globalThis&&(H=globalThis.navigator.userAgent||"");let Me=H.indexOf("Windows")>-1,$e=/Chrome|Chromium|Edg|OPR|Brave/.test(H);this.chromeWindowsNoCache=!1,Me&&$e&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(re){this.customHeaders=re}getBytes(re,ae,H,Me){return Ha(this,null,function*(){let $e,I;H?I=H:($e=new AbortController,I=$e.signal);let d=new Headers(this.customHeaders);d.set("range",`bytes=${re}-${re+ae-1}`);let ze;this.mustReload?ze="reload":this.chromeWindowsNoCache&&(ze="no-store");let Ie=yield fetch(this.url,{signal:I,cache:ze,headers:d});if(re===0&&Ie.status===416){let Ke=Ie.headers.get("Content-Range");if(!Ke||!Ke.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let be=+Ke.substr(8);Ie=yield fetch(this.url,{signal:I,cache:"reload",headers:{range:`bytes=0-${be-1}`}})}let ot=Ie.headers.get("Etag");if(ot!=null&&ot.startsWith("W/")&&(ot=null),Ie.status===416||Me&&ot&&ot!==Me)throw this.mustReload=!0,new im(`Server returned non-matching ETag ${Me} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(Ie.status>=300)throw new Error(`Bad response code: ${Ie.status}`);let Ye=Ie.headers.get("Content-Length");if(Ie.status===200&&(!Ye||+Ye>ae))throw $e&&$e.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield Ie.arrayBuffer(),etag:ot||void 0,cacheControl:Ie.headers.get("Cache-Control")||void 0,expires:Ie.headers.get("Expires")||void 0}})}};en(km,"FetchSource");var Pg=km;function vo(K,re){let ae=K.getUint32(re+4,!0),H=K.getUint32(re+0,!0);return ae*Of(2,32)+H}en(vo,"getUint64");function Bm(K,re){let ae=new DataView(K),H=ae.getUint8(7);if(H>3)throw new Error(`Archive is spec version ${H} but this library supports up to spec version 3`);return{specVersion:H,rootDirectoryOffset:vo(ae,8),rootDirectoryLength:vo(ae,16),jsonMetadataOffset:vo(ae,24),jsonMetadataLength:vo(ae,32),leafDirectoryOffset:vo(ae,40),leafDirectoryLength:vo(ae,48),tileDataOffset:vo(ae,56),tileDataLength:vo(ae,64),numAddressedTiles:vo(ae,72),numTileEntries:vo(ae,80),numTileContents:vo(ae,88),clustered:ae.getUint8(96)===1,internalCompression:ae.getUint8(97),tileCompression:ae.getUint8(98),tileType:ae.getUint8(99),minZoom:ae.getUint8(100),maxZoom:ae.getUint8(101),minLon:ae.getInt32(102,!0)/1e7,minLat:ae.getInt32(106,!0)/1e7,maxLon:ae.getInt32(110,!0)/1e7,maxLat:ae.getInt32(114,!0)/1e7,centerZoom:ae.getUint8(118),centerLon:ae.getInt32(119,!0)/1e7,centerLat:ae.getInt32(123,!0)/1e7,etag:re}}en(Bm,"bytesToHeader");function sm(K){let re={buf:new Uint8Array(K),pos:0},ae=Cd(re),H=[],Me=0;for(let $e=0;$e<ae;$e++){let I=Cd(re);H.push({tileId:Me+I,offset:0,length:0,runLength:1}),Me+=I}for(let $e=0;$e<ae;$e++)H[$e].runLength=Cd(re);for(let $e=0;$e<ae;$e++)H[$e].length=Cd(re);for(let $e=0;$e<ae;$e++){let I=Cd(re);I===0&&$e>0?H[$e].offset=H[$e-1].offset+H[$e-1].length:H[$e].offset=I-1}return H}en(sm,"deserializeIndex");var Om=class extends Error{};en(Om,"EtagMismatch");var im=Om;function om(K,re){return Ha(this,null,function*(){let ae=yield K.getBytes(0,16384);if(new DataView(ae.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let H=ae.data.slice(0,Ag),Me=Bm(H,ae.etag),$e=ae.data.slice(Me.rootDirectoryOffset,Me.rootDirectoryOffset+Me.rootDirectoryLength),I=`${K.getKey()}|${Me.etag||""}|${Me.rootDirectoryOffset}|${Me.rootDirectoryLength}`,d=sm(yield re($e,Me.internalCompression));return[Me,[I,d.length,d]]})}en(om,"getHeaderAndRoot");function lm(K,re,ae,H,Me){return Ha(this,null,function*(){let $e=yield K.getBytes(ae,H,void 0,Me.etag),I=yield re($e.data,Me.internalCompression),d=sm(I);if(d.length===0)throw new Error("Empty directory is invalid");return d})}en(lm,"getDirectory");var Dg=class{constructor(re=100,ae=!0,H=Dp){this.cache=new Map,this.maxCacheEntries=re,this.counter=1,this.decompress=H}getHeader(re){return Ha(this,null,function*(){let ae=re.getKey(),H=this.cache.get(ae);if(H)return H.lastUsed=this.counter++,H.data;let Me=yield om(re,this.decompress);return Me[1]&&this.cache.set(Me[1][0],{lastUsed:this.counter++,data:Me[1][2]}),this.cache.set(ae,{lastUsed:this.counter++,data:Me[0]}),this.prune(),Me[0]})}getDirectory(re,ae,H,Me){return Ha(this,null,function*(){let $e=`${re.getKey()}|${Me.etag||""}|${ae}|${H}`,I=this.cache.get($e);if(I)return I.lastUsed=this.counter++,I.data;let d=yield lm(re,this.decompress,ae,H,Me);return this.cache.set($e,{lastUsed:this.counter++,data:d}),this.prune(),d})}prune(){if(this.cache.size>this.maxCacheEntries){let re=1/0,ae;this.cache.forEach((H,Me)=>{H.lastUsed<re&&(re=H.lastUsed,ae=Me)}),ae&&this.cache.delete(ae)}}invalidate(re){return Ha(this,null,function*(){this.cache.delete(re.getKey())})}};en(Dg,"ResolvedValueCache");var Fm=class{constructor(re=100,ae=!0,H=Dp){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=re,this.counter=1,this.decompress=H}getHeader(re){return Ha(this,null,function*(){let ae=re.getKey(),H=this.cache.get(ae);if(H)return H.lastUsed=this.counter++,yield H.data;let Me=new Promise(($e,I)=>{om(re,this.decompress).then(d=>{d[1]&&this.cache.set(d[1][0],{lastUsed:this.counter++,data:Promise.resolve(d[1][2])}),$e(d[0]),this.prune()}).catch(d=>{I(d)})});return this.cache.set(ae,{lastUsed:this.counter++,data:Me}),Me})}getDirectory(re,ae,H,Me){return Ha(this,null,function*(){let $e=`${re.getKey()}|${Me.etag||""}|${ae}|${H}`,I=this.cache.get($e);if(I)return I.lastUsed=this.counter++,yield I.data;let d=new Promise((ze,Ie)=>{lm(re,this.decompress,ae,H,Me).then(ot=>{ze(ot),this.prune()}).catch(ot=>{Ie(ot)})});return this.cache.set($e,{lastUsed:this.counter++,data:d}),d})}prune(){if(this.cache.size>=this.maxCacheEntries){let re=1/0,ae;this.cache.forEach((H,Me)=>{H.lastUsed<re&&(re=H.lastUsed,ae=Me)}),ae&&this.cache.delete(ae)}}invalidate(re){return Ha(this,null,function*(){let ae=re.getKey();if(this.invalidations.get(ae))return yield this.invalidations.get(ae);this.cache.delete(re.getKey());let H=new Promise((Me,$e)=>{this.getHeader(re).then(I=>{Me(),this.invalidations.delete(ae)}).catch(I=>{$e(I)})});this.invalidations.set(ae,H)})}};en(Fm,"SharedPromiseCache");var Ig=Fm,Um=class{constructor(re,ae,H){typeof re=="string"?this.source=new Pg(re):this.source=re,H?this.decompress=H:this.decompress=Dp,ae?this.cache=ae:this.cache=new Ig}getHeader(){return Ha(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(re,ae,H,Me){return Ha(this,null,function*(){let $e=Im(re,ae,H),I=yield this.cache.getHeader(this.source);if(re<I.minZoom||re>I.maxZoom)return;let d=I.rootDirectoryOffset,ze=I.rootDirectoryLength;for(let Ie=0;Ie<=3;Ie++){let ot=yield this.cache.getDirectory(this.source,d,ze,I),Ye=Lm(ot,$e);if(Ye){if(Ye.runLength>0){let Ke=yield this.source.getBytes(I.tileDataOffset+Ye.offset,Ye.length,Me,I.etag);return{data:yield this.decompress(Ke.data,I.tileCompression),cacheControl:Ke.cacheControl,expires:Ke.expires}}d=I.leafDirectoryOffset+Ye.offset,ze=Ye.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(re,ae,H,Me){return Ha(this,null,function*(){try{return yield this.getZxyAttempt(re,ae,H,Me)}catch($e){if($e instanceof im)return this.cache.invalidate(this.source),yield this.getZxyAttempt(re,ae,H,Me);throw $e}})}getMetadataAttempt(){return Ha(this,null,function*(){let re=yield this.cache.getHeader(this.source),ae=yield this.source.getBytes(re.jsonMetadataOffset,re.jsonMetadataLength,void 0,re.etag),H=yield this.decompress(ae.data,re.internalCompression),Me=new TextDecoder("utf-8");return JSON.parse(Me.decode(H))})}getMetadata(){return Ha(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(re){if(re instanceof im)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw re}})}getTileJson(re){return Ha(this,null,function*(){let ae=yield this.getHeader(),H=yield this.getMetadata(),Me=Rm(ae.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${re}/{z}/{x}/{y}${Me}`],vector_layers:H.vector_layers,attribution:H.attribution,description:H.description,name:H.name,version:H.version,bounds:[ae.minLon,ae.minLat,ae.maxLon,ae.maxLat],center:[ae.centerLon,ae.centerLat,ae.centerZoom],minzoom:ae.minZoom,maxzoom:ae.maxZoom}})}};en(Um,"PMTiles");var xm=Um;const Rg=["rail_road_other","rail_road_jr_base","rail_road_jr_dash","rail_road_shinkansen_base","rail_road_shinkansen_dash","station_passengers_circles"],Lg=K=>{K.on("click",re=>{const ae=K.queryRenderedFeatures(re.point,{layers:Rg});if(ae.length===0)return;const H=kg(ae[0]);new zp.Popup({closeOnClick:!0}).setLngLat(re.lngLat).setHTML(H).addTo(K)})},kg=K=>{const re=K.properties??{},ae=K.layer.id;return ae==="rail_road_other"||ae==="rail_road_jr_base"||ae==="rail_road_jr_dash"||ae==="rail_road_shinkansen_base"||ae==="rail_road_shinkansen_dash"?Bg(re):ae==="station_passengers_circles"?Og(re):Fg(re)},Bg=K=>{const re=K.name||"";return`
    <table style="border-collapse:collapse;">
      <tr>
        <td style="padding:4px; border:1px solid #ccc;"><strong></strong></td>
        <td style="padding:4px; border:1px solid #ccc;">${Pp(re)}</td>
      </tr>
    </table>
  `},Og=K=>{const re=K.name||"",ae=K.passengers||0,H=Number(ae).toLocaleString();return`
    <table style="border-collapse:collapse;">
      <tr>
        <td style="padding:4px; border:1px solid #ccc;"><strong></strong></td>
        <td style="padding:4px; border:1px solid #ccc;">${Pp(re)}</td>
      </tr>
      <tr>
        <td style="padding:4px; border:1px solid #ccc;"><strong></strong></td>
        <td style="padding:4px; border:1px solid #ccc;">${H}/</td>
      </tr>
    </table>
  `},Fg=K=>{let re='<table style="border-collapse:collapse;">';for(const ae in K){let H=ae,Me=K[ae];Object.prototype.hasOwnProperty.call(K,ae)&&(re+=`
        <tr>
          <td style="padding:4px; border:1px solid #ccc;"><strong>${Pp(H)}</strong></td>
          <td style="padding:4px; border:1px solid #ccc;">${Pp(String(Me))}</td>
        </tr>`)}return re+="</table>",re},Pp=K=>K.replace(/[&<>"']/g,re=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[re]),Ug=["rail_road_other","rail_road_jr_base","rail_road_jr_dash","rail_road_shinkansen_base","rail_road_shinkansen_dash","station_passengers_circles"],jg=K=>{K.on("mousemove",re=>{K.queryRenderedFeatures(re.point,{layers:Ug}).length>0?K.getCanvas().style.cursor="pointer":K.getCanvas().style.cursor=""})},Ng=()=>{const K=Ep.useRef(null),re=Ep.useRef(null);return Ep.useEffect(()=>{const ae=new Tg;zp.addProtocol("pmtiles",ae.tile);const H=new zp.Map({container:K.current,style:"styles/style.json",center:[139.75439,35.68601],zoom:10,minZoom:4,hash:!0});return re.current=H,H.addControl(new zp.NavigationControl,"top-right"),H.on("load",()=>{}),Lg(H),jg(H),()=>{H.remove()}},[]),{mapContainerRef:K,mapRef:re}},Vg=()=>{const{mapContainerRef:K}=Ng();return Ad.jsx(Ad.Fragment,{children:Ad.jsx("div",{ref:K,style:{width:"100%",height:"100vh"}})})};function Zg(){return Ad.jsx(Vg,{})}Qm.createRoot(document.getElementById("root")).render(Ad.jsx(Ep.StrictMode,{children:Ad.jsx(Zg,{})}));
